<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.49">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <meta property="og:url" content="https://tommyi.netlify.app/Java%E5%90%8E%E7%AB%AF/03SSM/01Spring/day03/Spring-day03.html"><meta property="og:site_name" content="Hades"><meta property="og:title" content="Spring-day03"><meta property="og:type" content="article"><meta property="og:updated_time" content="2022-08-24T10:18:01.000Z"><meta property="og:locale" content="zh-CN"><meta property="article:modified_time" content="2022-08-24T10:18:01.000Z"><script>
      (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?2f464624c31a5d7de6e6fbc082a73e6b";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);})();
     </script><link rel="icon" type="image/png" sizes="16x16" href="/images/icons/favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/icons/favicon-32x32.png"><link rel="manifest" href="/manifest.webmanifest"><meta name="application-name" content="VuePress"><meta name="referrer" content="no-referrer"><meta name="apple-mobile-web-app-title" content="VuePress"><meta name="apple-mobile-web-app-status-bar-style" content="black"><link rel="apple-touch-icon" href="https://www.vuepress.cn/icons/apple-touch-icon-152x152.png"><link rel="mask-icon" href="/images/icons/safari-pinned-tab.svg" color="#3eaf7c"><meta name="msapplication-TileColor" content="#3eaf7c"><meta name="theme-color" content="#3eaf7c"><title>Spring-day03 | Hades</title><meta name="description" content="这是一本笔记，用于记录编程过程中的知识点">
    <link rel="modulepreload" href="/assets/app.3924f47e.js"><link rel="modulepreload" href="/assets/Spring-day03.html.608fd426.js"><link rel="modulepreload" href="/assets/Spring-day03.html.7c161a28.js"><link rel="prefetch" href="/assets/index.html.3fba8fa2.js"><link rel="prefetch" href="/assets/index.html.4d596f1b.js"><link rel="prefetch" href="/assets/index.html.ac0d3ff8.js"><link rel="prefetch" href="/assets/Mac下mongodb安装和配置.html.19173e70.js"><link rel="prefetch" href="/assets/Mac下命令行配置环境变量.html.c2873a5f.js"><link rel="prefetch" href="/assets/Mac全自动安装brew一键配置国内镜像源.html.8866f2df.js"><link rel="prefetch" href="/assets/Mac终端命令记录.html.75e46e91.js"><link rel="prefetch" href="/assets/Nginx搭建HTTPS，并反向代理到web页面_mkcert生成本地SSL证书.html.f67c5203.js"><link rel="prefetch" href="/assets/PDF转Markdown文件.html.dc7ca7bb.js"><link rel="prefetch" href="/assets/index.html.f2e8c2ba.js"><link rel="prefetch" href="/assets/VSCode使用记录.html.3b0db4ce.js"><link rel="prefetch" href="/assets/docsearch全站搜索.html.105a6071.js"><link rel="prefetch" href="/assets/idea插件分享.html.841f8833.js"><link rel="prefetch" href="/assets/jetbrains全家桶激活策略.html.daa401c8.js"><link rel="prefetch" href="/assets/中华人民共和国劳动合同法.html.6b4a5117.js"><link rel="prefetch" href="/assets/浅谈文言文与英语语法的相似点.html.96535ae8.js"><link rel="prefetch" href="/assets/面向AI开发.html.06a44d4c.js"><link rel="prefetch" href="/assets/鸿蒙3安装apk无须登录.html.7ceb3fbf.js"><link rel="prefetch" href="/assets/index.html.7d5c183e.js"><link rel="prefetch" href="/assets/index.html.f4857994.js"><link rel="prefetch" href="/assets/aboutme.html.03b08c9b.js"><link rel="prefetch" href="/assets/index.html.62929ac9.js"><link rel="prefetch" href="/assets/FRP内网穿透搭建(无域名版).html.6029f667.js"><link rel="prefetch" href="/assets/index.html.5fd246dd.js"><link rel="prefetch" href="/assets/linux前端项目部署.html.0029fa36.js"><link rel="prefetch" href="/assets/linux环境变量配置错误后命令无法使用解决方案.html.e194e944.js"><link rel="prefetch" href="/assets/内网穿透工具比较.html.a6564717.js"><link rel="prefetch" href="/assets/在CentOS上搭建Samba服务器.html.5dc34a00.js"><link rel="prefetch" href="/assets/第01章Android开发环境搭建.html.4ea72447.js"><link rel="prefetch" href="/assets/第02章AndroidApp开发基础.html.24ac8732.js"><link rel="prefetch" href="/assets/第03章简单控件.html.3128fa37.js"><link rel="prefetch" href="/assets/第04章活动Activity.html.9169add5.js"><link rel="prefetch" href="/assets/第05章中级控件.html.75bd951e.js"><link rel="prefetch" href="/assets/第06章数据存储.html.c29220e0.js"><link rel="prefetch" href="/assets/第07章内容共享.html.ef3fb778.js"><link rel="prefetch" href="/assets/第08章高级控件.html.a4ef2f0d.js"><link rel="prefetch" href="/assets/第09章广播组件Broadcast.html.7130bec3.js"><link rel="prefetch" href="/assets/第10章自定义控件.html.1c777745.js"><link rel="prefetch" href="/assets/AndroidStudio代理问题Connect.html.357fa090.js"><link rel="prefetch" href="/assets/AndroidStudio打包aar丢失远程依赖问题解决.html.26db85ab.js"><link rel="prefetch" href="/assets/AndroidStudio登录google账号失败问题.html.60601dbe.js"><link rel="prefetch" href="/assets/Apk应用重签名—使用AndroidStudio自带工具apksigner.html.be412465.js"><link rel="prefetch" href="/assets/不常用的ADB命令.html.162faa7e.js"><link rel="prefetch" href="/assets/01MySQL精简笔记.html.b6c76536.js"><link rel="prefetch" href="/assets/02JDBC.html.cd83be25.js"><link rel="prefetch" href="/assets/03Maven.html.2826552b.js"><link rel="prefetch" href="/assets/04Mybatis.html.e3b26918.js"><link rel="prefetch" href="/assets/05网页三剑客.html.7eb4fd73.js"><link rel="prefetch" href="/assets/06HTTP_Tomcat_Servlet.html.e72ce829.js"><link rel="prefetch" href="/assets/07Request_Response.html.dbb06678.js"><link rel="prefetch" href="/assets/08JSP.html.9fe6edfb.js"><link rel="prefetch" href="/assets/09Cookie_Session.html.a6775789.js"><link rel="prefetch" href="/assets/10Filter_Listener_Ajax.html.ca49deec.js"><link rel="prefetch" href="/assets/11Vue_Element.html.13f1ff54.js"><link rel="prefetch" href="/assets/12综合案例.html.0e382c65.js"><link rel="prefetch" href="/assets/index.html.145fbfc9.js"><link rel="prefetch" href="/assets/POM文件帮助文档.html.71fe5a3a.js"><link rel="prefetch" href="/assets/index.html.4c10d115.js"><link rel="prefetch" href="/assets/index.html.8002c9df.js"><link rel="prefetch" href="/assets/index.html.456530ad.js"><link rel="prefetch" href="/assets/index.html.a6dacb19.js"><link rel="prefetch" href="/assets/index.html.155f6415.js"><link rel="prefetch" href="/assets/index.html.ddabe501.js"><link rel="prefetch" href="/assets/index.html.85baad59.js"><link rel="prefetch" href="/assets/index.html.b4cc03cf.js"><link rel="prefetch" href="/assets/index.html.781336e1.js"><link rel="prefetch" href="/assets/index.html.61a0c47f.js"><link rel="prefetch" href="/assets/request.getInputStream只能读取一次问题.html.b885ecdb.js"><link rel="prefetch" href="/assets/程序包com.alibaba.fastjson不存在.html.271dbf39.js"><link rel="prefetch" href="/assets/错误集合.html.7aaff025.js"><link rel="prefetch" href="/assets/index.html.a8875e4a.js"><link rel="prefetch" href="/assets/index.html.500a4c6c.js"><link rel="prefetch" href="/assets/index.html.e490b0a7.js"><link rel="prefetch" href="/assets/index.html.7c8a7fda.js"><link rel="prefetch" href="/assets/Node多版本管理.html.323287ed.js"><link rel="prefetch" href="/assets/index.html.0e0c40e6.js"><link rel="prefetch" href="/assets/Web调试入门.html.779c051c.js"><link rel="prefetch" href="/assets/关于ESLInk配置问题.html.813173ed.js"><link rel="prefetch" href="/assets/index.html.bbbe52d8.js"><link rel="prefetch" href="/assets/MySQL-基础篇.html.72f3c6e1.js"><link rel="prefetch" href="/assets/Maven高级.html.88e987e2.js"><link rel="prefetch" href="/assets/SpringBoot.html.900a4e3a.js"><link rel="prefetch" href="/assets/MyBatisPlus.html.f232bc92.js"><link rel="prefetch" href="/assets/RestTemplate.html.e8ab904e.js"><link rel="prefetch" href="/assets/Dubbo详解.html.99b80cf1.js"><link rel="prefetch" href="/assets/Mac下ZooKeeper安装和使用.html.6c1f13af.js"><link rel="prefetch" href="/assets/Zookeeper集群搭建.html.52dab835.js"><link rel="prefetch" href="/assets/传智健康项目讲义（第10章）.html.e13e9f83.js"><link rel="prefetch" href="/assets/传智健康项目讲义（第11章）.html.f5126906.js"><link rel="prefetch" href="/assets/传智健康项目讲义（第12章）.html.44d84044.js"><link rel="prefetch" href="/assets/传智健康项目讲义（第13章）.html.a07d7436.js"><link rel="prefetch" href="/assets/传智健康项目讲义（第1章）.html.a4da5427.js"><link rel="prefetch" href="/assets/传智健康项目讲义（第2章）.html.2fefeebf.js"><link rel="prefetch" href="/assets/传智健康项目讲义（第3章）.html.027ab944.js"><link rel="prefetch" href="/assets/传智健康项目讲义（第4章）.html.0dbf7d93.js"><link rel="prefetch" href="/assets/传智健康项目讲义（第5章）.html.fdc355fa.js"><link rel="prefetch" href="/assets/传智健康项目讲义（第6章）.html.cfd20322.js"><link rel="prefetch" href="/assets/传智健康项目讲义（第7章）.html.b3623f0b.js"><link rel="prefetch" href="/assets/传智健康项目讲义（第8章）.html.9d9da6cc.js"><link rel="prefetch" href="/assets/传智健康项目讲义（第9章）.html.90642054.js"><link rel="prefetch" href="/assets/SpringBoot讲义.html.7a7d55bb.js"><link rel="prefetch" href="/assets/Linux-Day01.html.fdebd37c.js"><link rel="prefetch" href="/assets/Linux-Day02.html.7812a3ac.js"><link rel="prefetch" href="/assets/Redis基础.html.601c5b80.js"><link rel="prefetch" href="/assets/Git课程讲义.html.ebe75592.js"><link rel="prefetch" href="/assets/瑞吉外卖-Day01.html.f58e19c2.js"><link rel="prefetch" href="/assets/瑞吉外卖-Day02.html.4ded6959.js"><link rel="prefetch" href="/assets/瑞吉外卖-Day03.html.c35f1242.js"><link rel="prefetch" href="/assets/瑞吉外卖-Day04.html.3d44fe14.js"><link rel="prefetch" href="/assets/瑞吉外卖-Day05.html.3f4ef4e7.js"><link rel="prefetch" href="/assets/瑞吉外卖-Day06.html.9cd411dc.js"><link rel="prefetch" href="/assets/瑞吉外卖优化-Day01.html.78783912.js"><link rel="prefetch" href="/assets/瑞吉外卖优化-Day02.html.cb2d7616.js"><link rel="prefetch" href="/assets/瑞吉外卖优化-Day03.html.6076c5a3.js"><link rel="prefetch" href="/assets/微服务常见面试题.html.a5dcd6ba.js"><link rel="prefetch" href="/assets/错误笔记.html.ed3ccb3a.js"><link rel="prefetch" href="/assets/day01-HTML基础.html.a6ab2338.js"><link rel="prefetch" href="/assets/day02-HTML进阶.html.6a75b495.js"><link rel="prefetch" href="/assets/day03-CSS基础.html.42169736.js"><link rel="prefetch" href="/assets/day04-CSS进阶.html.691a9b64.js"><link rel="prefetch" href="/assets/day05-盒子模型.html.4992e05c.js"><link rel="prefetch" href="/assets/day06-Flex布局.html.c0632a9a.js"><link rel="prefetch" href="/assets/day07-学成在线.html.31966167.js"><link rel="prefetch" href="/assets/day08-CSS高级.html.7139befe.js"><link rel="prefetch" href="/assets/day09-小兔鲜儿.html.a4f48ad2.js"><link rel="prefetch" href="/assets/day10-小兔鲜儿.html.58643326.js"><link rel="prefetch" href="/assets/Day01-项目介绍及初始化-登录页面.html.1162a8bc.js"><link rel="prefetch" href="/assets/Day02-登录模块-主页鉴权.html.8dfc8019.js"><link rel="prefetch" href="/assets/Day03-主页模块-修改密码.html.011cdd7f.js"><link rel="prefetch" href="/assets/Day04-组织架构.html.5275e26a.js"><link rel="prefetch" href="/assets/Day05-组织架构-角色管理.html.ced63442.js"><link rel="prefetch" href="/assets/Day06-角色管理-员工管理.html.6caefea8.js"><link rel="prefetch" href="/assets/Day07-员工管理-上传下载.html.e3f31d8e.js"><link rel="prefetch" href="/assets/Day08-Cos上传和权限数据.html.20830962.js"><link rel="prefetch" href="/assets/Day09-权限应用-首页.html.da56bbaa.js"><link rel="prefetch" href="/assets/Day10-首页图表-Nginx上线.html.d3348164.js"><link rel="prefetch" href="/assets/1.Vue3入门.html.03fe22ad.js"><link rel="prefetch" href="/assets/10.购物车.html.471b3316.js"><link rel="prefetch" href="/assets/11.订单页.html.f7fcb785.js"><link rel="prefetch" href="/assets/12.支付页.html.7e26fb78.js"><link rel="prefetch" href="/assets/13.会员中心.html.b90bf2e3.js"><link rel="prefetch" href="/assets/14.拓展部分.html.0d32fa78.js"><link rel="prefetch" href="/assets/2.Pinia入门.html.e8abdd29.js"><link rel="prefetch" href="/assets/3.项目起步.html.498101f0.js"><link rel="prefetch" href="/assets/4.Layout页.html.0c374127.js"><link rel="prefetch" href="/assets/5.Home页.html.a6e30fe0.js"><link rel="prefetch" href="/assets/6.一级分类页.html.f6efdd5c.js"><link rel="prefetch" href="/assets/7.二级分类页.html.01823995.js"><link rel="prefetch" href="/assets/8.商品详情.html.5c665585.js"><link rel="prefetch" href="/assets/9.登录页.html.35d98706.js"><link rel="prefetch" href="/assets/day01.html.8ffdb6de.js"><link rel="prefetch" href="/assets/day02.html.43bccf1f.js"><link rel="prefetch" href="/assets/day03.html.191e82ec.js"><link rel="prefetch" href="/assets/index.html.f947a12b.js"><link rel="prefetch" href="/assets/day01.html.de22280d.js"><link rel="prefetch" href="/assets/day02.html.37fef858.js"><link rel="prefetch" href="/assets/day03.html.b3311c03.js"><link rel="prefetch" href="/assets/day04.html.14ed5a97.js"><link rel="prefetch" href="/assets/index.html.ea0c61d2.js"><link rel="prefetch" href="/assets/interview-base.html.b48b64bf.js"><link rel="prefetch" href="/assets/interview-enjoy-plus.html.8071948e.js"><link rel="prefetch" href="/assets/Redis基础篇.html.a0667b10.js"><link rel="prefetch" href="/assets/Redis快速入门.html.d25877b5.js"><link rel="prefetch" href="/assets/Redis实战篇.html.9a5d06d2.js"><link rel="prefetch" href="/assets/Redis原理篇.html.4f69d42d.js"><link rel="prefetch" href="/assets/课堂笔记.html.6422e94e.js"><link rel="prefetch" href="/assets/课堂笔记.html.3b96b75e.js"><link rel="prefetch" href="/assets/Spring-day01.html.e68ec110.js"><link rel="prefetch" href="/assets/Spring-day02.html.59a1d60e.js"><link rel="prefetch" href="/assets/SpringMVC-day01.html.457335ff.js"><link rel="prefetch" href="/assets/SpringMVC-day02.html.031f2edf.js"><link rel="prefetch" href="/assets/错误笔记.html.62610a4e.js"><link rel="prefetch" href="/assets/SpringBootStart.html.105a81fc.js"><link rel="prefetch" href="/assets/SpringBoot整合SSMP.html.e9ae476c.js"><link rel="prefetch" href="/assets/SpringBoot综合案例.html.0b423631.js"><link rel="prefetch" href="/assets/SpringBoot讲义.html.ab71429a.js"><link rel="prefetch" href="/assets/SpringBoot讲义.html.985d261c.js"><link rel="prefetch" href="/assets/Centos8-stream在真机上安装排坑.html.6126641d.js"><link rel="prefetch" href="/assets/Centos9安装mysql.html.2e8a0e74.js"><link rel="prefetch" href="/assets/SpringCloud01.html.7e4ce9d2.js"><link rel="prefetch" href="/assets/SpringCloud实用篇02.html.96a09c5c.js"><link rel="prefetch" href="/assets/Docker实用篇.html.a17cc52f.js"><link rel="prefetch" href="/assets/RabbitMQ.html.bd4e2cf4.js"><link rel="prefetch" href="/assets/分布式搜索引擎01.html.4e38b9ff.js"><link rel="prefetch" href="/assets/分布式搜索引擎02.html.57698f1d.js"><link rel="prefetch" href="/assets/分布式搜索引擎03.html.28ba2809.js"><link rel="prefetch" href="/assets/微服务保护.html.62adb493.js"><link rel="prefetch" href="/assets/分布式事务.html.e90c30b9.js"><link rel="prefetch" href="/assets/分布式缓存.html.01435b66.js"><link rel="prefetch" href="/assets/多级缓存.html.4a5cc484.js"><link rel="prefetch" href="/assets/RabbitMQ-高级篇.html.0c480ed8.js"><link rel="prefetch" href="/assets/Mybatis第一天.html.a3edd17b.js"><link rel="prefetch" href="/assets/Mybatis第二天.html.802a2571.js"><link rel="prefetch" href="/assets/移动web第一天.html.2e8f46f4.js"><link rel="prefetch" href="/assets/移动Web第二天.html.8226f808.js"><link rel="prefetch" href="/assets/移动Web第三天.html.11831bcd.js"><link rel="prefetch" href="/assets/移动Web第四天.html.6547a63e.js"><link rel="prefetch" href="/assets/移动Web第五天.html.d74bd617.js"><link rel="prefetch" href="/assets/JavaScript基础第一天.html.cff4e109.js"><link rel="prefetch" href="/assets/JavaScript基础第三天.html.f99eff7e.js"><link rel="prefetch" href="/assets/javascript基础第二天笔记.html.aebc5333.js"><link rel="prefetch" href="/assets/JavaScript基础第五天.html.e35620d6.js"><link rel="prefetch" href="/assets/JavaScript基础第四天.html.958a84e6.js"><link rel="prefetch" href="/assets/index.html.ef8647c7.js"><link rel="prefetch" href="/assets/个人实战文档.html.1743365c.js"><link rel="prefetch" href="/assets/index.html.c647080e.js"><link rel="prefetch" href="/assets/index.html.04decc95.js"><link rel="prefetch" href="/assets/index.html.dbce89c2.js"><link rel="prefetch" href="/assets/index.html.850a5fdc.js"><link rel="prefetch" href="/assets/index.html.c1ac903f.js"><link rel="prefetch" href="/assets/JavaScript进阶第一天.html.1df28442.js"><link rel="prefetch" href="/assets/day03.html.c7bd1e6a.js"><link rel="prefetch" href="/assets/day02.html.d4b18232.js"><link rel="prefetch" href="/assets/day04.html.c85f4095.js"><link rel="prefetch" href="/assets/笔记.html.f18bcd72.js"><link rel="prefetch" href="/assets/笔记.html.cc5e606b.js"><link rel="prefetch" href="/assets/笔记.html.9b36d8a2.js"><link rel="prefetch" href="/assets/day01.html.afa0570c.js"><link rel="prefetch" href="/assets/day02.html.cc0ddb05.js"><link rel="prefetch" href="/assets/day03.html.66b1101e.js"><link rel="prefetch" href="/assets/day04.html.d57e8ef7.js"><link rel="prefetch" href="/assets/day05.html.be548191.js"><link rel="prefetch" href="/assets/day06.html.9d2732e7.js"><link rel="prefetch" href="/assets/day07.html.e2014f42.js"><link rel="prefetch" href="/assets/智慧商城项目.html.b037ba30.js"><link rel="prefetch" href="/assets/Vue3入门.html.1dddd2c1.js"><link rel="prefetch" href="/assets/Pinia.html.d1f7ef83.js"><link rel="prefetch" href="/assets/大事件管理系统.html.a9636e94.js"><link rel="prefetch" href="/assets/01-项目起步.html.82651da2.js"><link rel="prefetch" href="/assets/02-首页模块.html.6f46afbf.js"><link rel="prefetch" href="/assets/03-推荐模块.html.b6efbf66.js"><link rel="prefetch" href="/assets/04-分类模块.html.89b1138d.js"><link rel="prefetch" href="/assets/05-详情模块.html.e88ab276.js"><link rel="prefetch" href="/assets/06-登录模块.html.277d50c6.js"><link rel="prefetch" href="/assets/07-用户模块.html.925b2d13.js"><link rel="prefetch" href="/assets/08-地址模块.html.f75d39b9.js"><link rel="prefetch" href="/assets/09-SKU模块.html.397ec6ac.js"><link rel="prefetch" href="/assets/10-购物车模块.html.813ab58c.js"><link rel="prefetch" href="/assets/11-订单模块.html.26617e36.js"><link rel="prefetch" href="/assets/12-项目打包.html.bcb19f5b.js"><link rel="prefetch" href="/assets/index.html.0ad324c8.js"><link rel="prefetch" href="/assets/第1天.html.2a9a1263.js"><link rel="prefetch" href="/assets/第2天.html.f92837a4.js"><link rel="prefetch" href="/assets/第3天.html.8346e116.js"><link rel="prefetch" href="/assets/第4天.html.64ba4427.js"><link rel="prefetch" href="/assets/第5天.html.aa93a841.js"><link rel="prefetch" href="/assets/小程序自定义tabBar.html.efad290d.js"><link rel="prefetch" href="/assets/第6天.html.44cac1f7.js"><link rel="prefetch" href="/assets/Redis高级-分布式缓存.html.3b0165ff.js"><link rel="prefetch" href="/assets/Redis高级篇之最佳实践.html.7874bd22.js"><link rel="prefetch" href="/assets/多级缓存.html.bffd36ce.js"><link rel="prefetch" href="/assets/Nacos安装指南.html.39daa776.js"><link rel="prefetch" href="/assets/Nacos集群搭建.html.568d560d.js"><link rel="prefetch" href="/assets/Centos7安装Docker.html.b0ad27b4.js"><link rel="prefetch" href="/assets/RabbitMQ部署指南.html.1ab7fab6.js"><link rel="prefetch" href="/assets/安装elasticsearch.html.81544b59.js"><link rel="prefetch" href="/assets/Day01_AJAX入门.html.2b734238.js"><link rel="prefetch" href="/assets/Day02_AJAX综合案例.html.afc30063.js"><link rel="prefetch" href="/assets/Day03_AJAX原理.html.099c6350.js"><link rel="prefetch" href="/assets/Day04_AJAX进阶.html.54ac1199.js"><link rel="prefetch" href="/assets/404.html.65323de0.js"><link rel="prefetch" href="/assets/index.html.c2004e41.js"><link rel="prefetch" href="/assets/index.html.0a1a6ee5.js"><link rel="prefetch" href="/assets/index.html.f945d969.js"><link rel="prefetch" href="/assets/Mac下mongodb安装和配置.html.e2c67aa6.js"><link rel="prefetch" href="/assets/Mac下命令行配置环境变量.html.8a2850de.js"><link rel="prefetch" href="/assets/Mac全自动安装brew一键配置国内镜像源.html.07fdd575.js"><link rel="prefetch" href="/assets/Mac终端命令记录.html.6d80b9a9.js"><link rel="prefetch" href="/assets/Nginx搭建HTTPS，并反向代理到web页面_mkcert生成本地SSL证书.html.a7957a1e.js"><link rel="prefetch" href="/assets/PDF转Markdown文件.html.feec0bcf.js"><link rel="prefetch" href="/assets/index.html.5e329dbc.js"><link rel="prefetch" href="/assets/VSCode使用记录.html.1b9c3954.js"><link rel="prefetch" href="/assets/docsearch全站搜索.html.11ac0386.js"><link rel="prefetch" href="/assets/idea插件分享.html.e735132b.js"><link rel="prefetch" href="/assets/jetbrains全家桶激活策略.html.2c4209df.js"><link rel="prefetch" href="/assets/中华人民共和国劳动合同法.html.25a32dec.js"><link rel="prefetch" href="/assets/浅谈文言文与英语语法的相似点.html.70458d5a.js"><link rel="prefetch" href="/assets/面向AI开发.html.bbacf680.js"><link rel="prefetch" href="/assets/鸿蒙3安装apk无须登录.html.954e9feb.js"><link rel="prefetch" href="/assets/index.html.7945a029.js"><link rel="prefetch" href="/assets/index.html.0ae148ed.js"><link rel="prefetch" href="/assets/aboutme.html.fc5cac36.js"><link rel="prefetch" href="/assets/index.html.2b0f20c6.js"><link rel="prefetch" href="/assets/FRP内网穿透搭建(无域名版).html.81827334.js"><link rel="prefetch" href="/assets/index.html.99e37cf4.js"><link rel="prefetch" href="/assets/linux前端项目部署.html.ac0e6e56.js"><link rel="prefetch" href="/assets/linux环境变量配置错误后命令无法使用解决方案.html.55d4e715.js"><link rel="prefetch" href="/assets/内网穿透工具比较.html.5a67b7cd.js"><link rel="prefetch" href="/assets/在CentOS上搭建Samba服务器.html.00a1980e.js"><link rel="prefetch" href="/assets/第01章Android开发环境搭建.html.cf4d9730.js"><link rel="prefetch" href="/assets/第02章AndroidApp开发基础.html.754702f7.js"><link rel="prefetch" href="/assets/第03章简单控件.html.01b0c160.js"><link rel="prefetch" href="/assets/第04章活动Activity.html.fefe5748.js"><link rel="prefetch" href="/assets/第05章中级控件.html.4ffad4a2.js"><link rel="prefetch" href="/assets/第06章数据存储.html.c5ecff80.js"><link rel="prefetch" href="/assets/第07章内容共享.html.c4a4f5a6.js"><link rel="prefetch" href="/assets/第08章高级控件.html.370cebf1.js"><link rel="prefetch" href="/assets/第09章广播组件Broadcast.html.48bd6edd.js"><link rel="prefetch" href="/assets/第10章自定义控件.html.c461cf7c.js"><link rel="prefetch" href="/assets/AndroidStudio代理问题Connect.html.52cac2d0.js"><link rel="prefetch" href="/assets/AndroidStudio打包aar丢失远程依赖问题解决.html.b9dfedc9.js"><link rel="prefetch" href="/assets/AndroidStudio登录google账号失败问题.html.d68b7a31.js"><link rel="prefetch" href="/assets/Apk应用重签名—使用AndroidStudio自带工具apksigner.html.478565d0.js"><link rel="prefetch" href="/assets/不常用的ADB命令.html.e2566718.js"><link rel="prefetch" href="/assets/01MySQL精简笔记.html.94a32d52.js"><link rel="prefetch" href="/assets/02JDBC.html.d492416c.js"><link rel="prefetch" href="/assets/03Maven.html.e1ad8403.js"><link rel="prefetch" href="/assets/04Mybatis.html.fd2ed841.js"><link rel="prefetch" href="/assets/05网页三剑客.html.17b749de.js"><link rel="prefetch" href="/assets/06HTTP_Tomcat_Servlet.html.dbceb0a6.js"><link rel="prefetch" href="/assets/07Request_Response.html.f3027523.js"><link rel="prefetch" href="/assets/08JSP.html.1035c2be.js"><link rel="prefetch" href="/assets/09Cookie_Session.html.b2d088ee.js"><link rel="prefetch" href="/assets/10Filter_Listener_Ajax.html.227df185.js"><link rel="prefetch" href="/assets/11Vue_Element.html.505f4406.js"><link rel="prefetch" href="/assets/12综合案例.html.b838ca5a.js"><link rel="prefetch" href="/assets/index.html.47cf74ec.js"><link rel="prefetch" href="/assets/POM文件帮助文档.html.a94cca23.js"><link rel="prefetch" href="/assets/index.html.2201bff8.js"><link rel="prefetch" href="/assets/index.html.8c27f45b.js"><link rel="prefetch" href="/assets/index.html.3a2e6e3b.js"><link rel="prefetch" href="/assets/index.html.05a74410.js"><link rel="prefetch" href="/assets/index.html.b8265f48.js"><link rel="prefetch" href="/assets/index.html.d506303c.js"><link rel="prefetch" href="/assets/index.html.e82b5574.js"><link rel="prefetch" href="/assets/index.html.f2b238c0.js"><link rel="prefetch" href="/assets/index.html.6aa4c4d9.js"><link rel="prefetch" href="/assets/index.html.3c05eba6.js"><link rel="prefetch" href="/assets/request.getInputStream只能读取一次问题.html.fcce7ee3.js"><link rel="prefetch" href="/assets/程序包com.alibaba.fastjson不存在.html.babc873c.js"><link rel="prefetch" href="/assets/错误集合.html.a1ecc4a5.js"><link rel="prefetch" href="/assets/index.html.fa4dfe36.js"><link rel="prefetch" href="/assets/index.html.e61f55a9.js"><link rel="prefetch" href="/assets/index.html.1e34786c.js"><link rel="prefetch" href="/assets/index.html.b91e9ccf.js"><link rel="prefetch" href="/assets/Node多版本管理.html.168fea28.js"><link rel="prefetch" href="/assets/index.html.0dbd251c.js"><link rel="prefetch" href="/assets/Web调试入门.html.f16d6923.js"><link rel="prefetch" href="/assets/关于ESLInk配置问题.html.2c7b7f3a.js"><link rel="prefetch" href="/assets/index.html.6fb059c2.js"><link rel="prefetch" href="/assets/MySQL-基础篇.html.b2722477.js"><link rel="prefetch" href="/assets/Maven高级.html.024104c5.js"><link rel="prefetch" href="/assets/SpringBoot.html.663c509e.js"><link rel="prefetch" href="/assets/MyBatisPlus.html.a68080f4.js"><link rel="prefetch" href="/assets/RestTemplate.html.80f150f6.js"><link rel="prefetch" href="/assets/Dubbo详解.html.5587eca9.js"><link rel="prefetch" href="/assets/Mac下ZooKeeper安装和使用.html.acc0383e.js"><link rel="prefetch" href="/assets/Zookeeper集群搭建.html.68e733e2.js"><link rel="prefetch" href="/assets/传智健康项目讲义（第10章）.html.0650bc5a.js"><link rel="prefetch" href="/assets/传智健康项目讲义（第11章）.html.354aac2b.js"><link rel="prefetch" href="/assets/传智健康项目讲义（第12章）.html.20276d75.js"><link rel="prefetch" href="/assets/传智健康项目讲义（第13章）.html.193981fb.js"><link rel="prefetch" href="/assets/传智健康项目讲义（第1章）.html.103f148c.js"><link rel="prefetch" href="/assets/传智健康项目讲义（第2章）.html.afae10ca.js"><link rel="prefetch" href="/assets/传智健康项目讲义（第3章）.html.ff571203.js"><link rel="prefetch" href="/assets/传智健康项目讲义（第4章）.html.32780907.js"><link rel="prefetch" href="/assets/传智健康项目讲义（第5章）.html.1cffb0e0.js"><link rel="prefetch" href="/assets/传智健康项目讲义（第6章）.html.e6e80ae2.js"><link rel="prefetch" href="/assets/传智健康项目讲义（第7章）.html.06771479.js"><link rel="prefetch" href="/assets/传智健康项目讲义（第8章）.html.bf5b5766.js"><link rel="prefetch" href="/assets/传智健康项目讲义（第9章）.html.bb663df8.js"><link rel="prefetch" href="/assets/SpringBoot讲义.html.69f86bff.js"><link rel="prefetch" href="/assets/Linux-Day01.html.b1b6fb06.js"><link rel="prefetch" href="/assets/Linux-Day02.html.bea67e08.js"><link rel="prefetch" href="/assets/Redis基础.html.4d6aced6.js"><link rel="prefetch" href="/assets/Git课程讲义.html.189b44ac.js"><link rel="prefetch" href="/assets/瑞吉外卖-Day01.html.5616fc38.js"><link rel="prefetch" href="/assets/瑞吉外卖-Day02.html.bf4badc4.js"><link rel="prefetch" href="/assets/瑞吉外卖-Day03.html.7827f98f.js"><link rel="prefetch" href="/assets/瑞吉外卖-Day04.html.9c611a94.js"><link rel="prefetch" href="/assets/瑞吉外卖-Day05.html.4f7ada6b.js"><link rel="prefetch" href="/assets/瑞吉外卖-Day06.html.55fe895e.js"><link rel="prefetch" href="/assets/瑞吉外卖优化-Day01.html.6b5a4312.js"><link rel="prefetch" href="/assets/瑞吉外卖优化-Day02.html.0349c8df.js"><link rel="prefetch" href="/assets/瑞吉外卖优化-Day03.html.9f453a10.js"><link rel="prefetch" href="/assets/微服务常见面试题.html.3faa5dc5.js"><link rel="prefetch" href="/assets/错误笔记.html.83b74f2f.js"><link rel="prefetch" href="/assets/day01-HTML基础.html.63b748cd.js"><link rel="prefetch" href="/assets/day02-HTML进阶.html.46a16144.js"><link rel="prefetch" href="/assets/day03-CSS基础.html.54c26625.js"><link rel="prefetch" href="/assets/day04-CSS进阶.html.e2d4feae.js"><link rel="prefetch" href="/assets/day05-盒子模型.html.01441e17.js"><link rel="prefetch" href="/assets/day06-Flex布局.html.5d92e88d.js"><link rel="prefetch" href="/assets/day07-学成在线.html.3466d7e7.js"><link rel="prefetch" href="/assets/day08-CSS高级.html.d3c2c18c.js"><link rel="prefetch" href="/assets/day09-小兔鲜儿.html.9b9ec0c3.js"><link rel="prefetch" href="/assets/day10-小兔鲜儿.html.3f83236a.js"><link rel="prefetch" href="/assets/Day01-项目介绍及初始化-登录页面.html.915f4e88.js"><link rel="prefetch" href="/assets/Day02-登录模块-主页鉴权.html.3be6906c.js"><link rel="prefetch" href="/assets/Day03-主页模块-修改密码.html.4d558a4d.js"><link rel="prefetch" href="/assets/Day04-组织架构.html.dc7c7c0e.js"><link rel="prefetch" href="/assets/Day05-组织架构-角色管理.html.b9eea018.js"><link rel="prefetch" href="/assets/Day06-角色管理-员工管理.html.2d8e165b.js"><link rel="prefetch" href="/assets/Day07-员工管理-上传下载.html.7a06865a.js"><link rel="prefetch" href="/assets/Day08-Cos上传和权限数据.html.25a1a504.js"><link rel="prefetch" href="/assets/Day09-权限应用-首页.html.6eca6b6c.js"><link rel="prefetch" href="/assets/Day10-首页图表-Nginx上线.html.69bcc449.js"><link rel="prefetch" href="/assets/1.Vue3入门.html.c7761663.js"><link rel="prefetch" href="/assets/10.购物车.html.4c6880a6.js"><link rel="prefetch" href="/assets/11.订单页.html.94088313.js"><link rel="prefetch" href="/assets/12.支付页.html.2d478a1d.js"><link rel="prefetch" href="/assets/13.会员中心.html.c7b3f643.js"><link rel="prefetch" href="/assets/14.拓展部分.html.893b37a4.js"><link rel="prefetch" href="/assets/2.Pinia入门.html.e287b89d.js"><link rel="prefetch" href="/assets/3.项目起步.html.41d2fdfc.js"><link rel="prefetch" href="/assets/4.Layout页.html.ecc0d610.js"><link rel="prefetch" href="/assets/5.Home页.html.9d314e7c.js"><link rel="prefetch" href="/assets/6.一级分类页.html.730e97a5.js"><link rel="prefetch" href="/assets/7.二级分类页.html.2ebfc31b.js"><link rel="prefetch" href="/assets/8.商品详情.html.b9adfba3.js"><link rel="prefetch" href="/assets/9.登录页.html.964580c2.js"><link rel="prefetch" href="/assets/day01.html.983104c3.js"><link rel="prefetch" href="/assets/day02.html.467dd511.js"><link rel="prefetch" href="/assets/day03.html.d28d4956.js"><link rel="prefetch" href="/assets/index.html.67f1f801.js"><link rel="prefetch" href="/assets/day01.html.69f0117d.js"><link rel="prefetch" href="/assets/day02.html.f4928106.js"><link rel="prefetch" href="/assets/day03.html.5717e8c8.js"><link rel="prefetch" href="/assets/day04.html.02e02b44.js"><link rel="prefetch" href="/assets/index.html.3b33834d.js"><link rel="prefetch" href="/assets/interview-base.html.c7ded4c6.js"><link rel="prefetch" href="/assets/interview-enjoy-plus.html.45300616.js"><link rel="prefetch" href="/assets/Redis基础篇.html.4bfe8e4c.js"><link rel="prefetch" href="/assets/Redis快速入门.html.6f71b8c9.js"><link rel="prefetch" href="/assets/Redis实战篇.html.a9cb7bba.js"><link rel="prefetch" href="/assets/Redis原理篇.html.4ace4ced.js"><link rel="prefetch" href="/assets/课堂笔记.html.97e38832.js"><link rel="prefetch" href="/assets/课堂笔记.html.8fd679e5.js"><link rel="prefetch" href="/assets/Spring-day01.html.7d9834f7.js"><link rel="prefetch" href="/assets/Spring-day02.html.53dd479c.js"><link rel="prefetch" href="/assets/SpringMVC-day01.html.8cda15fa.js"><link rel="prefetch" href="/assets/SpringMVC-day02.html.a7e2d610.js"><link rel="prefetch" href="/assets/错误笔记.html.7636a53c.js"><link rel="prefetch" href="/assets/SpringBootStart.html.803fe3e4.js"><link rel="prefetch" href="/assets/SpringBoot整合SSMP.html.4894a971.js"><link rel="prefetch" href="/assets/SpringBoot综合案例.html.b4285cc6.js"><link rel="prefetch" href="/assets/SpringBoot讲义.html.5b7f2173.js"><link rel="prefetch" href="/assets/SpringBoot讲义.html.6e01245c.js"><link rel="prefetch" href="/assets/Centos8-stream在真机上安装排坑.html.a00dfbf5.js"><link rel="prefetch" href="/assets/Centos9安装mysql.html.9839b7c4.js"><link rel="prefetch" href="/assets/SpringCloud01.html.aaa7056a.js"><link rel="prefetch" href="/assets/SpringCloud实用篇02.html.93522e30.js"><link rel="prefetch" href="/assets/Docker实用篇.html.6ad09e7e.js"><link rel="prefetch" href="/assets/RabbitMQ.html.077be3a0.js"><link rel="prefetch" href="/assets/分布式搜索引擎01.html.c091c964.js"><link rel="prefetch" href="/assets/分布式搜索引擎02.html.6db2bda3.js"><link rel="prefetch" href="/assets/分布式搜索引擎03.html.60987b70.js"><link rel="prefetch" href="/assets/微服务保护.html.edcfd89b.js"><link rel="prefetch" href="/assets/分布式事务.html.dcb38d3b.js"><link rel="prefetch" href="/assets/分布式缓存.html.18b00f8d.js"><link rel="prefetch" href="/assets/多级缓存.html.ef484c28.js"><link rel="prefetch" href="/assets/RabbitMQ-高级篇.html.92e0e932.js"><link rel="prefetch" href="/assets/Mybatis第一天.html.32fa553b.js"><link rel="prefetch" href="/assets/Mybatis第二天.html.1520f9ca.js"><link rel="prefetch" href="/assets/移动web第一天.html.185c706b.js"><link rel="prefetch" href="/assets/移动Web第二天.html.e629a529.js"><link rel="prefetch" href="/assets/移动Web第三天.html.4847f02c.js"><link rel="prefetch" href="/assets/移动Web第四天.html.3a0294df.js"><link rel="prefetch" href="/assets/移动Web第五天.html.29106f91.js"><link rel="prefetch" href="/assets/JavaScript基础第一天.html.2ae59154.js"><link rel="prefetch" href="/assets/JavaScript基础第三天.html.6eec45f8.js"><link rel="prefetch" href="/assets/javascript基础第二天笔记.html.92ef5a75.js"><link rel="prefetch" href="/assets/JavaScript基础第五天.html.3a05ee93.js"><link rel="prefetch" href="/assets/JavaScript基础第四天.html.b0965889.js"><link rel="prefetch" href="/assets/index.html.3532905b.js"><link rel="prefetch" href="/assets/个人实战文档.html.1219b0c5.js"><link rel="prefetch" href="/assets/index.html.8ac87d00.js"><link rel="prefetch" href="/assets/index.html.833ddf1f.js"><link rel="prefetch" href="/assets/index.html.30fa6ee5.js"><link rel="prefetch" href="/assets/index.html.ffa1d9e6.js"><link rel="prefetch" href="/assets/index.html.256e1857.js"><link rel="prefetch" href="/assets/JavaScript进阶第一天.html.fd4dc190.js"><link rel="prefetch" href="/assets/day03.html.0fede3dc.js"><link rel="prefetch" href="/assets/day02.html.f0628b07.js"><link rel="prefetch" href="/assets/day04.html.6662bf39.js"><link rel="prefetch" href="/assets/笔记.html.ba7f84fe.js"><link rel="prefetch" href="/assets/笔记.html.405fd872.js"><link rel="prefetch" href="/assets/笔记.html.ff2cfadd.js"><link rel="prefetch" href="/assets/day01.html.05d34547.js"><link rel="prefetch" href="/assets/day02.html.7915261c.js"><link rel="prefetch" href="/assets/day03.html.e408c947.js"><link rel="prefetch" href="/assets/day04.html.8200ae76.js"><link rel="prefetch" href="/assets/day05.html.57f1c253.js"><link rel="prefetch" href="/assets/day06.html.fca25782.js"><link rel="prefetch" href="/assets/day07.html.caddaa6d.js"><link rel="prefetch" href="/assets/智慧商城项目.html.17d5c345.js"><link rel="prefetch" href="/assets/Vue3入门.html.6509aa8c.js"><link rel="prefetch" href="/assets/Pinia.html.9731a05b.js"><link rel="prefetch" href="/assets/大事件管理系统.html.2083634a.js"><link rel="prefetch" href="/assets/01-项目起步.html.82296ed4.js"><link rel="prefetch" href="/assets/02-首页模块.html.027baa52.js"><link rel="prefetch" href="/assets/03-推荐模块.html.1a8f7677.js"><link rel="prefetch" href="/assets/04-分类模块.html.00dccc34.js"><link rel="prefetch" href="/assets/05-详情模块.html.050a4cdf.js"><link rel="prefetch" href="/assets/06-登录模块.html.b3d03669.js"><link rel="prefetch" href="/assets/07-用户模块.html.a1cd89f0.js"><link rel="prefetch" href="/assets/08-地址模块.html.8523f29f.js"><link rel="prefetch" href="/assets/09-SKU模块.html.9e62e508.js"><link rel="prefetch" href="/assets/10-购物车模块.html.aa4ef1c9.js"><link rel="prefetch" href="/assets/11-订单模块.html.5c39dd64.js"><link rel="prefetch" href="/assets/12-项目打包.html.79bb2732.js"><link rel="prefetch" href="/assets/index.html.c2edc3d0.js"><link rel="prefetch" href="/assets/第1天.html.6724bab7.js"><link rel="prefetch" href="/assets/第2天.html.0189ab64.js"><link rel="prefetch" href="/assets/第3天.html.eabae459.js"><link rel="prefetch" href="/assets/第4天.html.feb9c93d.js"><link rel="prefetch" href="/assets/第5天.html.7eec068b.js"><link rel="prefetch" href="/assets/小程序自定义tabBar.html.877050c0.js"><link rel="prefetch" href="/assets/第6天.html.56404fba.js"><link rel="prefetch" href="/assets/Redis高级-分布式缓存.html.c0fef97b.js"><link rel="prefetch" href="/assets/Redis高级篇之最佳实践.html.d07579cb.js"><link rel="prefetch" href="/assets/多级缓存.html.3cfed601.js"><link rel="prefetch" href="/assets/Nacos安装指南.html.24a99942.js"><link rel="prefetch" href="/assets/Nacos集群搭建.html.f7992a9d.js"><link rel="prefetch" href="/assets/Centos7安装Docker.html.21528208.js"><link rel="prefetch" href="/assets/RabbitMQ部署指南.html.322eec03.js"><link rel="prefetch" href="/assets/安装elasticsearch.html.590faa07.js"><link rel="prefetch" href="/assets/Day01_AJAX入门.html.040ae3b9.js"><link rel="prefetch" href="/assets/Day02_AJAX综合案例.html.ccc4e15a.js"><link rel="prefetch" href="/assets/Day03_AJAX原理.html.9228fe0b.js"><link rel="prefetch" href="/assets/Day04_AJAX进阶.html.3e127c52.js"><link rel="prefetch" href="/assets/404.html.2052d23f.js"><link rel="prefetch" href="/assets/404.c9d416d2.js"><link rel="prefetch" href="/assets/Layout.33a11a1a.js"><link rel="prefetch" href="/assets/index.0e8935cb.js"><link rel="prefetch" href="/assets/giscus.15440425.js">
    <link rel="stylesheet" href="/assets/style.5869c25b.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/" class=""><img class="logo" src="/images/logo.png" alt="Hades"><span class="site-name can-hide">Hades</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><a href="/Android/" class="" aria-label="Android"><!--[--><!--]--> Android <!--[--><!--]--></a></div><div class="navbar-item"><a href="/Java后端/" class="" aria-label="Java后端"><!--[--><!--]--> Java后端 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/Web前端/" class="" aria-label="Web前端"><!--[--><!--]--> Web前端 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/数据库/" class="" aria-label="数据库"><!--[--><!--]--> 数据库 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/运维技术/" class="" aria-label="运维技术"><!--[--><!--]--> 运维技术 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/Tips/" class="" aria-label="Tips❤️‍"><!--[--><!--]--> Tips❤️‍ <!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="书签🔖"><span class="title">书签🔖</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="书签🔖"><span class="title">书签🔖</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>搜索</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a class="external-link" href="https://www.baidu.com" rel="noopener noreferrer" target="_blank" aria-label="百度一下"><!--[--><!--]--> 百度一下 <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>常用</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a class="external-link" href="http://gitee.com" rel="noopener noreferrer" target="_blank" aria-label="gitee"><!--[--><!--]--> gitee <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a class="external-link" href="http://bilibili.com" rel="noopener noreferrer" target="_blank" aria-label="哔哩哔哩"><!--[--><!--]--> 哔哩哔哩 <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/start/BuildError/README.md" class="" aria-label="Vuepress打包错误"><!--[--><!--]--> Vuepress打包错误 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><!--]--></nav><!--[--><!--]--><button class="toggle-color-mode-button" title="toggle color mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><div id="docsearch-container"></div></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><a href="/Android/" class="" aria-label="Android"><!--[--><!--]--> Android <!--[--><!--]--></a></div><div class="navbar-item"><a href="/Java后端/" class="" aria-label="Java后端"><!--[--><!--]--> Java后端 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/Web前端/" class="" aria-label="Web前端"><!--[--><!--]--> Web前端 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/数据库/" class="" aria-label="数据库"><!--[--><!--]--> 数据库 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/运维技术/" class="" aria-label="运维技术"><!--[--><!--]--> 运维技术 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/Tips/" class="" aria-label="Tips❤️‍"><!--[--><!--]--> Tips❤️‍ <!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="书签🔖"><span class="title">书签🔖</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="书签🔖"><span class="title">书签🔖</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>搜索</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a class="external-link" href="https://www.baidu.com" rel="noopener noreferrer" target="_blank" aria-label="百度一下"><!--[--><!--]--> 百度一下 <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>常用</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a class="external-link" href="http://gitee.com" rel="noopener noreferrer" target="_blank" aria-label="gitee"><!--[--><!--]--> gitee <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a class="external-link" href="http://bilibili.com" rel="noopener noreferrer" target="_blank" aria-label="哔哩哔哩"><!--[--><!--]--> 哔哩哔哩 <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/start/BuildError/README.md" class="" aria-label="Vuepress打包错误"><!--[--><!--]--> Vuepress打包错误 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><p tabindex="0" class="sidebar-item sidebar-heading">Spring-day03 <!----></p><ul style="display:none;" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/Java%E5%90%8E%E7%AB%AF/03SSM/01Spring/day03/Spring-day03.html#_1-aop简介" class="router-link-active router-link-exact-active sidebar-item" aria-label="1，AOP简介"><!--[--><!--]--> 1，AOP简介 <!--[--><!--]--></a><ul style="display:none;" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/Java%E5%90%8E%E7%AB%AF/03SSM/01Spring/day03/Spring-day03.html#_1-1-什么是aop" class="router-link-active router-link-exact-active sidebar-item" aria-label="1.1 什么是AOP"><!--[--><!--]--> 1.1 什么是AOP <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/Java%E5%90%8E%E7%AB%AF/03SSM/01Spring/day03/Spring-day03.html#_1-2-aop作用" class="router-link-active router-link-exact-active sidebar-item" aria-label="1.2 AOP作用"><!--[--><!--]--> 1.2 AOP作用 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/Java%E5%90%8E%E7%AB%AF/03SSM/01Spring/day03/Spring-day03.html#_1-3-aop核心概念" class="router-link-active router-link-exact-active sidebar-item" aria-label="1.3 AOP核心概念"><!--[--><!--]--> 1.3 AOP核心概念 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/Java%E5%90%8E%E7%AB%AF/03SSM/01Spring/day03/Spring-day03.html#_2-aop入门案例" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.AOP入门案例"><!--[--><!--]--> 2.AOP入门案例 <!--[--><!--]--></a><ul style="display:none;" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/Java%E5%90%8E%E7%AB%AF/03SSM/01Spring/day03/Spring-day03.html#_2-1-需求分析" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.1 需求分析"><!--[--><!--]--> 2.1 需求分析 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/Java%E5%90%8E%E7%AB%AF/03SSM/01Spring/day03/Spring-day03.html#_2-2-思路分析" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.2 思路分析"><!--[--><!--]--> 2.2 思路分析 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/Java%E5%90%8E%E7%AB%AF/03SSM/01Spring/day03/Spring-day03.html#_2-3-环境准备" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.3 环境准备"><!--[--><!--]--> 2.3 环境准备 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/Java%E5%90%8E%E7%AB%AF/03SSM/01Spring/day03/Spring-day03.html#_2-4-aop实现步骤" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.4 AOP实现步骤"><!--[--><!--]--> 2.4 AOP实现步骤 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/Java%E5%90%8E%E7%AB%AF/03SSM/01Spring/day03/Spring-day03.html#_3-aop工作流程" class="router-link-active router-link-exact-active sidebar-item" aria-label="3. AOP工作流程"><!--[--><!--]--> 3. AOP工作流程 <!--[--><!--]--></a><ul style="display:none;" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/Java%E5%90%8E%E7%AB%AF/03SSM/01Spring/day03/Spring-day03.html#_3-1-aop工作流程" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.1 AOP工作流程"><!--[--><!--]--> 3.1 AOP工作流程 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/Java%E5%90%8E%E7%AB%AF/03SSM/01Spring/day03/Spring-day03.html#_3-2-aop核心概念" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.2 AOP核心概念"><!--[--><!--]--> 3.2 AOP核心概念 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/Java%E5%90%8E%E7%AB%AF/03SSM/01Spring/day03/Spring-day03.html#_4-aop配置管理" class="router-link-active router-link-exact-active sidebar-item" aria-label="4. AOP配置管理"><!--[--><!--]--> 4. AOP配置管理 <!--[--><!--]--></a><ul style="display:none;" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/Java%E5%90%8E%E7%AB%AF/03SSM/01Spring/day03/Spring-day03.html#_4-1-aop切入点表达式" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.1 AOP切入点表达式"><!--[--><!--]--> 4.1 AOP切入点表达式 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/Java%E5%90%8E%E7%AB%AF/03SSM/01Spring/day03/Spring-day03.html#_4-2-aop通知类型" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.2 AOP通知类型"><!--[--><!--]--> 4.2 AOP通知类型 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/Java%E5%90%8E%E7%AB%AF/03SSM/01Spring/day03/Spring-day03.html#_4-3-统计方法万次执行时常" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.3 统计方法万次执行时常"><!--[--><!--]--> 4.3 统计方法万次执行时常 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/Java%E5%90%8E%E7%AB%AF/03SSM/01Spring/day03/Spring-day03.html#_4-4-aop通知获取数据" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.4 AOP通知获取数据"><!--[--><!--]--> 4.4 AOP通知获取数据 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/Java%E5%90%8E%E7%AB%AF/03SSM/01Spring/day03/Spring-day03.html#_4-5-百度网盘密码去空格处理" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.5 百度网盘密码去空格处理"><!--[--><!--]--> 4.5 百度网盘密码去空格处理 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/Java%E5%90%8E%E7%AB%AF/03SSM/01Spring/day03/Spring-day03.html#_5-aop总结" class="router-link-active router-link-exact-active sidebar-item" aria-label="5. AOP总结"><!--[--><!--]--> 5. AOP总结 <!--[--><!--]--></a><ul style="display:none;" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/Java%E5%90%8E%E7%AB%AF/03SSM/01Spring/day03/Spring-day03.html#_5-1-aop的核心概念" class="router-link-active router-link-exact-active sidebar-item" aria-label="5.1 AOP的核心概念"><!--[--><!--]--> 5.1 AOP的核心概念 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/Java%E5%90%8E%E7%AB%AF/03SSM/01Spring/day03/Spring-day03.html#_5-2-切入点表达式" class="router-link-active router-link-exact-active sidebar-item" aria-label="5.2 切入点表达式"><!--[--><!--]--> 5.2 切入点表达式 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/Java%E5%90%8E%E7%AB%AF/03SSM/01Spring/day03/Spring-day03.html#_5-3-五种通知类型" class="router-link-active router-link-exact-active sidebar-item" aria-label="5.3 五种通知类型"><!--[--><!--]--> 5.3 五种通知类型 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/Java%E5%90%8E%E7%AB%AF/03SSM/01Spring/day03/Spring-day03.html#_5-4-通知中获取参数" class="router-link-active router-link-exact-active sidebar-item" aria-label="5.4 通知中获取参数"><!--[--><!--]--> 5.4 通知中获取参数 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/Java%E5%90%8E%E7%AB%AF/03SSM/01Spring/day03/Spring-day03.html#_6-aop事务管理" class="router-link-active router-link-exact-active sidebar-item" aria-label="6. AOP事务管理"><!--[--><!--]--> 6. AOP事务管理 <!--[--><!--]--></a><ul style="display:none;" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/Java%E5%90%8E%E7%AB%AF/03SSM/01Spring/day03/Spring-day03.html#_6-1-spring事务简介" class="router-link-active router-link-exact-active sidebar-item" aria-label="6.1 Spring事务简介"><!--[--><!--]--> 6.1 Spring事务简介 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/Java%E5%90%8E%E7%AB%AF/03SSM/01Spring/day03/Spring-day03.html#_6-2-spring事务角色" class="router-link-active router-link-exact-active sidebar-item" aria-label="6.2 Spring事务角色"><!--[--><!--]--> 6.2 Spring事务角色 <!--[--><!--]--></a><ul style="display:none;" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/Java%E5%90%8E%E7%AB%AF/03SSM/01Spring/day03/Spring-day03.html#_6-3-spring事务属性" class="router-link-active router-link-exact-active sidebar-item" aria-label="6.3 Spring事务属性"><!--[--><!--]--> 6.3 Spring事务属性 <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><!--]--><div><h1 id="spring-day03" tabindex="-1"><a class="header-anchor" href="#spring-day03" aria-hidden="true">#</a> Spring-day03</h1><p><strong>今日目标</strong></p><blockquote><ul><li>理解并掌握AOP相关概念</li><li>能够说出AOP的工作流程</li><li>能运用AOP相关知识完成对应的案例编写</li><li>重点掌握Spring的声明式事务管理</li></ul></blockquote><h2 id="_1-aop简介" tabindex="-1"><a class="header-anchor" href="#_1-aop简介" aria-hidden="true">#</a> 1，AOP简介</h2><p>前面我们在介绍Spring的时候说过，Spring有两个核心的概念，一个是<code>IOC/DI</code>，一个是<code>AOP</code>。</p><p>前面已经对<code>IOC/DI</code>进行了系统的学习，接下来要学习它的另一个核心内容，就是<strong>AOP</strong>。</p><p>对于AOP,我们前面提过一句话是:<strong>AOP是在不改原有代码的前提下对其进行增强。</strong></p><p>对于下面的内容，我们主要就是围绕着这一句话进行展开学习，主要学习两方面内容<code>AOP核心概念</code>,<code>AOP作用</code>:</p><h3 id="_1-1-什么是aop" tabindex="-1"><a class="header-anchor" href="#_1-1-什么是aop" aria-hidden="true">#</a> 1.1 什么是AOP</h3><ul><li>AOP(Aspect Oriented Programming)面向切面编程，一种编程范式，指导开发者如何组织程序结构。 <ul><li>OOP(Object Oriented Programming)面向对象编程</li></ul></li></ul><p>我们都知道OOP是一种编程思想，那么AOP也是一种编程思想，编程思想主要的内容就是指导程序员该如何编写程序，所以它们两个是不同的<code>编程范式</code>。</p><h3 id="_1-2-aop作用" tabindex="-1"><a class="header-anchor" href="#_1-2-aop作用" aria-hidden="true">#</a> 1.2 AOP作用</h3><ul><li>作用:在不惊动原始设计的基础上为其进行功能增强，前面咱们有技术就可以实现这样的功能即代理模式。</li></ul><p>前面咱们有技术就可以实现这样的功能即<code>代理模式</code>。</p><h3 id="_1-3-aop核心概念" tabindex="-1"><a class="header-anchor" href="#_1-3-aop核心概念" aria-hidden="true">#</a> 1.3 AOP核心概念</h3><p>为了能更好的理解AOP的相关概念，我们准备了一个环境，整个环境的内容我们暂时可以不用关注，最主要的类为:<code>BookDaoImpl</code></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Repository</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BookDaoImpl</span> <span class="token keyword">implements</span> <span class="token class-name">BookDao</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//记录程序当前执行执行（开始时间）</span>
        <span class="token class-name">Long</span> startTime <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//业务执行万次</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">10000</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;book dao save ...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//记录程序当前执行时间（结束时间）</span>
        <span class="token class-name">Long</span> endTime <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//计算时间差</span>
        <span class="token class-name">Long</span> totalTime <span class="token operator">=</span> endTime<span class="token operator">-</span>startTime<span class="token punctuation">;</span>
        <span class="token comment">//输出信息</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;执行万次消耗时间：&quot;</span> <span class="token operator">+</span> totalTime <span class="token operator">+</span> <span class="token string">&quot;ms&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;book dao update ...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">delete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;book dao delete ...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">select</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;book dao select ...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>代码的内容相信大家都能够读懂，对于<code>save</code>方法中有计算万次执行消耗的时间。</p><p>当在App类中从容器中获取bookDao对象后，分别执行其<code>save</code>,<code>delete</code>,<code>update</code>和<code>select</code>方法后会有如下的打印结果:</p><p><img src="https://gitee.com/xiaweifeng/picgo/raw/master/images/202208241710780.png" alt="1630143927489"></p><p>这个时候，我们就应该有些疑问?</p><ul><li>对于计算万次执行消耗的时间只有save方法有，为什么delete和update方法也会有呢?</li><li>delete和update方法有，那什么select方法为什么又没有呢?</li></ul><p>这个案例中其实就使用了Spring的AOP，在不惊动(改动)原有设计(代码)的前提下，想给谁添加功能就给谁添加。这个也就是Spring的理念：</p><ul><li>无入侵式/无侵入式</li></ul><p>说了这么多，Spring到底是如何实现的呢?</p><p><img src="https://gitee.com/xiaweifeng/picgo/raw/master/images/202208241710781.png" alt="1630144353462"></p><h4 id="_1-3-1-核心概念" tabindex="-1"><a class="header-anchor" href="#_1-3-1-核心概念" aria-hidden="true">#</a> 1.3.1 核心概念</h4><ol><li><p>**连接点：**方法名就是连接点</p><ul><li>前面一直在强调，Spring的AOP是对一个类的方法在不进行任何修改的前提下实现增强。对于上面的案例中BookServiceImpl中有<code>save</code>,<code>update</code>,<code>delete</code>和<code>select</code>方法,这些方法我们给起了一个名字叫<strong>连接点</strong></li></ul></li><li><p>**切入点：**需要增强的方法就是切入点</p><ul><li>在BookServiceImpl的四个方法中，<code>update</code>和<code>delete</code>只有打印没有计算万次执行消耗时间，但是在运行的时候已经有该功能，那也就是说<code>update</code>和<code>delete</code>方法都已经被增强，所以对于需要增强的方法我们给起了一个名字叫<strong>切入点</strong></li></ul></li><li><p>**通知：**将共性功能抽取出来的方法叫通知</p><ul><li>执行BookServiceImpl的update和delete方法的时候都被添加了一个计算万次执行消耗时间的功能，将这个功能抽取到一个方法中，换句话说就是存放共性功能的方法，我们给起了个名字叫<strong>通知</strong></li></ul></li><li><p>**切面：**让抽取的共性方法<code>通知</code>和普通方法产生联系<code>切入点</code>的表达式</p><ul><li>通知是要增强的内容，会有多个，切入点是需要被增强的方法，也会有多个。</li><li>那哪个切入点需要添加哪个通知，就需要提前将它们之间的关系描述清楚，那么对于通知和切入点之间的关系描述，我们给起了个名字叫<strong>切面</strong></li></ul></li><li><p>**通知类：**用来定义共性<code>通知</code>方法的类</p><p>通知是一个方法，方法不能独立存在需要被写在一个类中，这个类我们也给起了个名字叫<strong>通知类</strong></p></li></ol><p><strong>至此AOP中的核心概念就已经介绍完了，总结下:</strong></p><ul><li>连接点(JoinPoint)：程序执行过程中的任意位置，粒度为执行方法、抛出异常、设置变量等 <ul><li>在SpringAOP中，理解为方法的执行</li></ul></li><li>切入点(Pointcut):匹配连接点的式子 <ul><li>在SpringAOP中，一个切入点可以描述一个具体方法，也可也匹配多个方法 <ul><li>一个具体的方法:如com.itheima.dao包下的BookDao接口中的无形参无返回值的save方法</li><li>匹配多个方法:所有的save方法，所有的get开头的方法，所有以Dao结尾的接口中的任意方法，所有带有一个参数的方法</li></ul></li><li>连接点范围要比切入点范围大，是切入点的方法也一定是连接点，但是是连接点的方法就不一定要被增强，所以可能不是切入点。</li></ul></li><li>通知(Advice):在切入点处执行的操作，也就是共性功能 <ul><li>在SpringAOP中，功能最终以方法的形式呈现</li></ul></li><li>通知类：定义通知的类</li><li>切面(Aspect):描述通知与切入点的对应关系。</li></ul><p><strong>小结</strong></p><p>这一节中主要讲解了AOP的概念与作用，以及AOP中的核心概念，学完以后大家需要能说出:</p><ul><li>什么是AOP?</li><li>AOP的作用是什么?</li><li>AOP中核心概念分别指的是什么? <ul><li>连接点</li><li>切入点</li><li>通知</li><li>通知类</li><li>切面</li></ul></li></ul><h2 id="_2-aop入门案例" tabindex="-1"><a class="header-anchor" href="#_2-aop入门案例" aria-hidden="true">#</a> 2.AOP入门案例</h2><h3 id="_2-1-需求分析" tabindex="-1"><a class="header-anchor" href="#_2-1-需求分析" aria-hidden="true">#</a> 2.1 需求分析</h3><p>案例设定：测算接口执行效率，但是这个案例稍微复杂了点，我们对其进行简化。</p><p>简化设定：在方法执行前输出当前系统时间。</p><p>对于SpringAOP的开发有两种方式，XML 和 <strong>注解</strong>，我们使用哪个呢?</p><p>因为现在注解使用的比较多，所以本次课程就采用注解完成AOP的开发。</p><p>总结需求为:使用SpringAOP的注解方式完成在方法执行的前打印出当前系统时间。</p><h3 id="_2-2-思路分析" tabindex="-1"><a class="header-anchor" href="#_2-2-思路分析" aria-hidden="true">#</a> 2.2 思路分析</h3><p>需求明确后，具体该如何实现，都有哪些步骤，我们先来分析下:</p><blockquote><p>1.导入坐标(pom.xml)</p><p>2.制作连接点(原始操作，Dao接口与实现类)</p><p>3.制作共性功能(通知类与通知)</p><p>4.定义切入点</p><p>5.绑定切入点与通知关系(切面)</p></blockquote><h3 id="_2-3-环境准备" tabindex="-1"><a class="header-anchor" href="#_2-3-环境准备" aria-hidden="true">#</a> 2.3 环境准备</h3><ul><li><p>创建一个Maven项目</p></li><li><p>pom.xml添加Spring依赖</p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-context<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>5.3.6<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>添加BookDao和BookDaoImpl类</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">BookDao</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@Repository</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BookDaoImpl</span> <span class="token keyword">implements</span> <span class="token class-name">BookDao</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;book dao save ...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;book dao update ...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>创建Spring的配置类</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@ComponentScan</span><span class="token punctuation">(</span><span class="token string">&quot;com.example&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SpringConfig</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>编写App运行类</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">ApplicationContext</span> ctx <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AnnotationConfigApplicationContext</span><span class="token punctuation">(</span><span class="token class-name">SpringConfig</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">BookDao</span> bookDao <span class="token operator">=</span> ctx<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token class-name">BookDao</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        bookDao<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        bookDao<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><p><strong>说明:</strong></p><ul><li>目前打印save方法的时候，因为方法中有打印系统时间，所以运行的时候是可以看到系统时间</li><li>对于update方法来说，就没有该功能</li><li>我们要使用SpringAOP的方式在不改变update方法的前提下让其具有打印系统时间的功能。</li></ul><h3 id="_2-4-aop实现步骤" tabindex="-1"><a class="header-anchor" href="#_2-4-aop实现步骤" aria-hidden="true">#</a> 2.4 AOP实现步骤</h3><ol><li><strong>添加依赖</strong></li></ol><p>pom.xml</p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.aspectj<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>aspectjweaver<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.9.4<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="https://gitee.com/xiaweifeng/picgo/raw/master/images/202208241710782.png" alt="1630146885493"></p><ul><li>因为<code>spring-context</code>中已经导入了<code>spring-aop</code>,所以不需要再单独导入<code>spring-aop</code></li><li>导入AspectJ的jar包,AspectJ是AOP思想的一个具体实现，Spring有自己的AOP实现，但是相比于AspectJ来说比较麻烦，所以我们直接采用Spring整合ApsectJ的方式进行AOP开发。</li></ul><ol start="2"><li><strong>定义通知类和通知</strong></li></ol><p>通知就是将共性功能抽取出来后形成的方法，共性功能指的就是当前系统时间的打印。</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyAdvice</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">method</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>类名和方法名没有要求，可以任意。</p><ol start="3"><li><p><strong>定义切入点方法</strong></p><p>BookDaoImpl中有两个方法，分别是save和update，我们要增强的是update方法，该如何定义呢?</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyAdvice</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Pointcut</span><span class="token punctuation">(</span><span class="token string">&quot;execution(void com.example.dao.BookDao.update())&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">pt</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">method</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>说明:</strong></p><ul><li>切入点定义依托一个不具有实际意义的方法进行，即无参数、无返回值、方法体无实际逻辑。</li><li>execution及后面编写的内容，后面会有章节专门去学习。</li></ul></li><li><p><strong>制作切面</strong></p><p>切面是用来描述通知和切入点之间的关系，如何进行关系的绑定?</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyAdvice</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Pointcut</span><span class="token punctuation">(</span><span class="token string">&quot;execution(void com.example.dao.BookDao.update())&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">pt</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Before</span><span class="token punctuation">(</span><span class="token string">&quot;MyAdvice.pt()&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">method</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>绑定切入点与通知关系，并指定通知添加到原始连接点的具体执行<strong>位置</strong></p><p><img src="https://gitee.com/xiaweifeng/picgo/raw/master/images/202208241710783.png" alt="1630148447689"></p><p><strong>说明:</strong>@Before翻译过来是之前，也就是说通知会在切入点方法执行之前执行，除此之前还有其他四种类型，后面会讲。</p></li><li><p><strong>将通知类配给容器并标识其为切面类</strong></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@Aspect</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyAdvice</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Pointcut</span><span class="token punctuation">(</span><span class="token string">&quot;execution(void com.example.dao.BookDao.update())&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">pt</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Before</span><span class="token punctuation">(</span><span class="token string">&quot;MyAdvice.pt()&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">method</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>开启注解格式AOP功能</strong></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@ComponentScan</span><span class="token punctuation">(</span><span class="token string">&quot;com.example&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@EnableAspectJAutoProxy</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SpringConfig</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>运行程序，可以看出update()也会执行获取系统时间方法</p></li></ol><hr><h4 id="_2-4-1-enableaspectjautoproxy" tabindex="-1"><a class="header-anchor" href="#_2-4-1-enableaspectjautoproxy" aria-hidden="true">#</a> 2.4.1@EnableAspectJAutoProxy</h4><table><thead><tr><th>名称</th><th>@EnableAspectJAutoProxy</th></tr></thead><tbody><tr><td>类型</td><td>配置类注解</td></tr><tr><td>位置</td><td>配置类定义上方</td></tr><tr><td>作用</td><td>开启注解格式AOP功能</td></tr></tbody></table><h4 id="_2-4-2-aspect" tabindex="-1"><a class="header-anchor" href="#_2-4-2-aspect" aria-hidden="true">#</a> 2.4.2 @Aspect</h4><table><thead><tr><th>名称</th><th>@Aspect</th></tr></thead><tbody><tr><td>类型</td><td>类注解</td></tr><tr><td>位置</td><td>切面类定义上方</td></tr><tr><td>作用</td><td>设置当前类为AOP切面类</td></tr></tbody></table><h4 id="_2-4-3-pointcut" tabindex="-1"><a class="header-anchor" href="#_2-4-3-pointcut" aria-hidden="true">#</a> 2.4.3 @Pointcut</h4><table><thead><tr><th>名称</th><th>@Pointcut</th></tr></thead><tbody><tr><td>类型</td><td>方法注解</td></tr><tr><td>位置</td><td>切入点方法定义上方</td></tr><tr><td>作用</td><td>设置切入点方法</td></tr><tr><td>属性</td><td>value（默认）：切入点表达式</td></tr></tbody></table><h4 id="_2-4-4-before" tabindex="-1"><a class="header-anchor" href="#_2-4-4-before" aria-hidden="true">#</a> 2.4.4 @Before</h4><table><thead><tr><th>名称</th><th>@Before</th></tr></thead><tbody><tr><td>类型</td><td>方法注解</td></tr><tr><td>位置</td><td>通知方法定义上方</td></tr><tr><td>作用</td><td>设置当前通知方法与切入点之间的绑定关系，当前通知方法在原始切入点方法前运行</td></tr></tbody></table><h2 id="_3-aop工作流程" tabindex="-1"><a class="header-anchor" href="#_3-aop工作流程" aria-hidden="true">#</a> 3. AOP工作流程</h2><p>AOP的入门案例已经完成，对于刚才案例的执行过程，我们就得来分析分析，这一节我们主要讲解两个知识点:<code>AOP工作流程</code>和<code>AOP核心概念</code>。其中核心概念是对前面核心概念的补充。</p><h3 id="_3-1-aop工作流程" tabindex="-1"><a class="header-anchor" href="#_3-1-aop工作流程" aria-hidden="true">#</a> 3.1 AOP工作流程</h3><p>由于AOP是基于Spring容器管理的bean做的增强，所以整个工作过程需要从Spring加载bean说起:</p><ol><li><strong>Spring容器启动</strong></li></ol><ul><li>容器启动就需要去加载bean,哪些类需要被加载呢?</li><li>需要被增强的类，如:BookServiceImpl</li><li>通知类，如:MyAdvice</li><li>注意此时bean对象还没有创建成功</li></ul><ol start="2"><li><strong>读取所有切面配置中的切入点</strong></li></ol><p><img src="https://gitee.com/xiaweifeng/picgo/raw/master/images/202208241710784.png" alt="1630151682428"></p><ul><li>上面这个例子中有两个切入点的配置，但是第一个<code>ptx()</code>并没有被使用，所以不会被读取。</li></ul><ol start="3"><li><strong>初始化bean</strong></li></ol><p>判定bean对应的类中的方法是否匹配到任意切入点</p><ul><li><p>注意第1步在容器启动的时候，bean对象还没有被创建成功。</p></li><li><p>要被实例化bean对象的类中的方法和切入点进行匹配</p><p><img src="https://gitee.com/xiaweifeng/picgo/raw/master/images/202208241710785.png" alt="1630152538083"></p><ul><li>匹配失败，创建原始对象,如<code>UserDao</code><ul><li>匹配失败说明不需要增强，直接调用原始对象的方法即可。</li></ul></li><li>匹配成功，创建原始对象（<strong>目标对象</strong>）的<strong>代理</strong>对象,如:<code>BookDao</code><ul><li>匹配成功说明需要对其进行增强</li><li>对哪个类做增强，这个类对应的对象就叫做目标对象</li><li>因为要对目标对象进行功能增强，而采用的技术是动态代理，所以会为其创建一个代理对象</li><li>最终运行的是代理对象的方法，在该方法中会对原始方法进行功能增强</li></ul></li></ul><ol start="4"><li><strong>获取bean执行方法</strong></li></ol><ul><li>获取的bean是原始对象时，调用方法并执行，完成操作</li><li>获取的bean是代理对象时，根据代理对象的运行模式运行原始方法与增强的内容，完成操作</li></ul><ol start="5"><li><strong>验证容器中是否为代理对象</strong></li></ol><p>为了验证IOC容器中创建的对象和我们刚才所说的结论是否一致，首先先把结论理出来:</p><ul><li><p>如果目标对象中的方法会被增强，那么容器中将存入的是目标对象的代理对象</p></li><li><p>如果目标对象中的方法不被增强，那么容器中将存入的是目标对象本身。</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">ApplicationContext</span> ctx <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AnnotationConfigApplicationContext</span><span class="token punctuation">(</span><span class="token class-name">SpringConfig</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">BookDao</span> bookDao <span class="token operator">=</span> ctx<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token class-name">BookDao</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        bookDao<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        bookDao<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>bookDao<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//验证是否是代理对象</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>bookDao<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>打印结果</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token number">1654000129135</span>
book dao save <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token number">1654000129137</span>
book dao update <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>dao<span class="token punctuation">.</span>impl<span class="token punctuation">.</span></span>BookDaoImpl</span><span class="token annotation punctuation">@79207381</span>
<span class="token keyword">class</span> com<span class="token punctuation">.</span>sun<span class="token punctuation">.</span>proxy<span class="token punctuation">.</span>$<span class="token class-name">Proxy20</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>至此对于刚才的结论，我们就得到了验证，这块大家需要注意的是:</p><p>不能直接打印对象，从上面两次结果中可以看出，直接打印对象走的是对象的toString方法，不管是不是代理对象打印的结果都是一样的，原因是内部对toString方法进行了重写。</p></li></ul></li></ul><h3 id="_3-2-aop核心概念" tabindex="-1"><a class="header-anchor" href="#_3-2-aop核心概念" aria-hidden="true">#</a> 3.2 AOP核心概念</h3><p>在上面介绍AOP的工作流程中，我们提到了两个核心概念，分别是:</p><ul><li>目标对象(Target)：原始功能去掉共性功能对应的类产生的对象，这种对象是无法直接完成最终工作的</li><li>代理(Proxy)：目标对象无法直接完成工作，需要对其进行功能回填，通过原始对象的代理对象实现</li></ul><p>上面这两个概念比较抽象，简单来说，</p><p>目标对象就是要增强的类[如:BookServiceImpl类]对应的对象，也叫原始对象，不能说它不能运行，只能说它在运行的过程中对于要增强的内容是缺失的。</p><p>SpringAOP是在不改变原有设计(代码)的前提下对其进行增强的，它的底层采用的是<strong>代理模式</strong>实现的，所以要对原始对象进行增强，就需要对原始对象创建代理对象，在代理对象中的方法把通知[如:MyAdvice中的method方法]内容加进去，就实现了增强,这就是我们所说的代理(Proxy)。</p><p><strong>小结</strong></p><p>通过这一节中，我们需要掌握的内容有：</p><ul><li>能说出AOP的工作流程</li><li>AOP的核心概念 <ul><li>目标对象、连接点、切入点</li><li>通知类、通知</li><li>切面</li><li>代理</li></ul></li><li><strong>SpringAOP的本质或者可以说底层实现是通过代理模式</strong>。</li></ul><h2 id="_4-aop配置管理" tabindex="-1"><a class="header-anchor" href="#_4-aop配置管理" aria-hidden="true">#</a> 4. AOP配置管理</h2><h3 id="_4-1-aop切入点表达式" tabindex="-1"><a class="header-anchor" href="#_4-1-aop切入点表达式" aria-hidden="true">#</a> 4.1 AOP切入点表达式</h3><p>前面的案例中，有涉及到如下内容:</p><p><img src="https://gitee.com/xiaweifeng/picgo/raw/master/images/202208241710786.png" alt="1630155937718"></p><p>对于AOP中切入点表达式，我们总共会学习三个内容，分别是<code>语法格式</code>、<code>通配符</code>和<code>书写技巧</code>。</p><p>对于AOP中切入点表达式，我们总共会学习三个内容，分别是<code>语法格式</code>、<code>通配符</code>和<code>书写技巧</code>。</p><h4 id="_4-1-1-语法格式" tabindex="-1"><a class="header-anchor" href="#_4-1-1-语法格式" aria-hidden="true">#</a> 4.1.1 语法格式</h4><p>首先我们先要明确两个概念:</p><ul><li>切入点:要进行增强的方法</li><li>切入点表达式:要进行增强的方法的描述方式</li></ul><p>对于切入点的描述，我们其实是有两中方式的，先来看下前面的例子</p><p><img src="https://gitee.com/xiaweifeng/picgo/raw/master/images/202208241710787.png" alt="1630156172790"></p><p>描述方式一：执行com.itheima.dao包下的BookDao接口中的无参数update方法</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token function">execution</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>dao<span class="token punctuation">.</span></span>BookDao</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>描述方式二：执行com.itheima.dao.impl包下的BookDaoImpl类中的无参数update方法</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token function">execution</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>dao<span class="token punctuation">.</span>impl<span class="token punctuation">.</span></span>BookDaoImpl</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>因为调用接口方法的时候最终运行的还是其实现类的方法，所以上面两种描述方式都是可以的。</p><p>对于切入点表达式的语法为:</p><ul><li>切入点表达式标准格式：动作关键字(访问修饰符 返回值 包名.类/接口名.方法名(参数) 异常名）</li></ul><p>对于这个格式，我们不需要硬记，通过一个例子，理解它:</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>execution(public User com.itheima.service.UserService.findById(int))
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>**execution：**动作关键字，描述切入点的行为动作，例如execution表示执行到指定切入点</li><li>**public:**访问修饰符,还可以是public，private等，可以省略</li><li>**User：**返回值，写返回值类型</li><li>**com.itheima.service：**包名，多级包使用点连接</li><li>**UserService:**类/接口名称</li><li>**findById：**方法名</li><li>**int:**参数，直接写参数的类型，多个类型用逗号隔开</li><li>**异常名：**方法定义中抛出指定异常，可以省略</li></ul><p>切入点表达式就是要找到需要增强的方法，所以它就是对一个具体方法的描述，但是方法的定义会有很多，所以如果每一个方法对应一个切入点表达式，想想这块就会觉得将来编写起来会比较麻烦，有没有更简单的方式呢?</p><p>就需要用到下面所学习的通配符。</p><h4 id="_4-1-2-通配符" tabindex="-1"><a class="header-anchor" href="#_4-1-2-通配符" aria-hidden="true">#</a> 4.1.2 通配符</h4><p>我们使用通配符描述切入点，主要的目的就是简化之前的配置，具体都有哪些通配符可以使用?</p><ul><li><p><code>*</code>:单个独立的任意符号，可以独立出现，也可以作为前缀或者后缀的匹配符出现</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>execution（public * com.itheima.*.UserService.find*(*))
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>匹配com.itheima包下的任意包中的UserService类或接口中所有find开头的带有一个参数的方法</p></li><li><p><code>..</code>：多个连续的任意符号，可以独立出现，常用于简化包名与参数的书写</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>execution（public User com..UserService.findById(..))
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>匹配com包下的任意包中的UserService类或接口中所有名称为findById的方法</p></li><li><p><code>+</code>：专用于匹配子类类型</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>execution(* *..*Service+.*(..))
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>这个使用率较低，描述子类的，咱们做JavaEE开发，继承机会就一次，使用都很慎重，所以很少用它。*Service+，表示所有以Service结尾的接口的子类。</p></li></ul><p>接下来，我们把案例中使用到的切入点表达式来分析下:</p><p><img src="https://gitee.com/xiaweifeng/picgo/raw/master/images/202208241710788.png" alt="1630163744963"></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token function">execution</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>dao<span class="token punctuation">.</span></span>BookDao</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
匹配接口，能匹配到
<span class="token function">execution</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>dao<span class="token punctuation">.</span>impl<span class="token punctuation">.</span></span>BookDaoImpl</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
匹配实现类，能匹配到
<span class="token function">execution</span><span class="token punctuation">(</span><span class="token operator">*</span> <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>dao<span class="token punctuation">.</span>impl<span class="token punctuation">.</span></span>BookDaoImpl</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
返回值任意，能匹配到
<span class="token function">execution</span><span class="token punctuation">(</span><span class="token operator">*</span> <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>dao<span class="token punctuation">.</span>impl<span class="token punctuation">.</span></span>BookDaoImpl</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
返回值任意，但是update方法必须要有一个参数，无法匹配，要想匹配需要在update接口和实现类添加参数
<span class="token function">execution</span><span class="token punctuation">(</span><span class="token keyword">void</span> com<span class="token punctuation">.</span>*<span class="token punctuation">.</span>*<span class="token punctuation">.</span>*<span class="token punctuation">.</span>*<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
返回值为<span class="token keyword">void</span><span class="token punctuation">,</span>com包下的任意包三层包下的任意类的update方法，匹配到的是实现类，能匹配
<span class="token function">execution</span><span class="token punctuation">(</span><span class="token keyword">void</span> com<span class="token punctuation">.</span>*<span class="token punctuation">.</span>*<span class="token punctuation">.</span>*<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
返回值为<span class="token keyword">void</span><span class="token punctuation">,</span>com包下的任意两层包下的任意类的update方法，匹配到的是接口，能匹配
<span class="token function">execution</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
返回值为<span class="token keyword">void</span>，方法名是update的任意包下的任意类，能匹配
<span class="token function">execution</span><span class="token punctuation">(</span><span class="token operator">*</span> <span class="token operator">*</span><span class="token punctuation">.</span><span class="token punctuation">.</span>*<span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
匹配项目中任意类的任意方法，能匹配，但是不建议使用这种方式，影响范围广
<span class="token function">execution</span><span class="token punctuation">(</span><span class="token operator">*</span> <span class="token operator">*</span><span class="token punctuation">.</span><span class="token punctuation">.</span>u<span class="token operator">*</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
匹配项目中任意包任意类下只要以u开头的方法，update方法能满足，能匹配
<span class="token function">execution</span><span class="token punctuation">(</span><span class="token operator">*</span> <span class="token operator">*</span><span class="token punctuation">.</span><span class="token punctuation">.</span>*<span class="token function">e</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
匹配项目中任意包任意类下只要以e结尾的方法，update和save方法能满足，能匹配
<span class="token function">execution</span><span class="token punctuation">(</span><span class="token keyword">void</span> com<span class="token punctuation">.</span><span class="token punctuation">.</span>*<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
返回值为<span class="token keyword">void</span>，com包下的任意包任意类任意方法，能匹配，<span class="token operator">*</span>代表的是方法
<span class="token function">execution</span><span class="token punctuation">(</span><span class="token operator">*</span> com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>*<span class="token punctuation">.</span>*<span class="token class-name">Service</span><span class="token punctuation">.</span>find<span class="token operator">*</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
将项目中所有业务层方法的以find开头的方法匹配
<span class="token function">execution</span><span class="token punctuation">(</span><span class="token operator">*</span> com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>*<span class="token punctuation">.</span>*<span class="token class-name">Service</span><span class="token punctuation">.</span>save<span class="token operator">*</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
将项目中所有业务层方法的以save开头的方法匹配
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>后面两种更符合我们平常切入点表达式的编写规则</strong></p><h4 id="_4-1-3-书写技巧" tabindex="-1"><a class="header-anchor" href="#_4-1-3-书写技巧" aria-hidden="true">#</a> 4.1.3 书写技巧</h4><p>对于切入点表达式的编写其实是很灵活的，那么在编写的时候，有没有什么好的技巧让我们参考呢:</p><ul><li>所有代码按照标准规范开发，否则以下技巧全部失效</li><li>描述切入点通常描述<strong>接口</strong>，而不描述实现类,如果描述到实现类，就出现紧耦合了</li><li>访问控制修饰符针对接口开发均采用public描述（<strong>可省略访问控制修饰符描述</strong>）</li><li>返回值类型对于增删改类使用精准类型加速匹配，对于查询类使用<code>*</code>通配快速描述</li><li><strong>包名</strong>书写<strong>尽量不使用..匹配</strong>，效率过低，常用*做单个包描述匹配，或精准匹配</li><li><strong>接口名/类名</strong>书写名称与模块相关的<strong>采用*匹配</strong>，例如UserService书写成*Service，绑定业务层接口名</li><li><strong>方法名</strong>书写以<strong>动词</strong>进行<strong>精准匹配</strong>，名词采用<em>匹配，例如getById书写成getBy</em>,selectAll书写成selectAll</li><li>参数规则较为复杂，根据业务方法灵活调整</li><li>通常<strong>不使用异常</strong>作为<strong>匹配</strong>规则**</li></ul><h3 id="_4-2-aop通知类型" tabindex="-1"><a class="header-anchor" href="#_4-2-aop通知类型" aria-hidden="true">#</a> 4.2 AOP通知类型</h3><p>前面的案例中，有涉及到如下内容:</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Before</span><span class="token punctuation">(</span><span class="token string">&quot;MyAdvice.pt()&quot;</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>它所代表的含义是将<code>通知</code>添加到<code>切入点</code>方法执行的<strong>前面</strong>。</p><p>除了这个注解外，还有没有其他的注解，换个问题就是除了可以在前面加，能不能在其他的地方加?</p><h4 id="_4-2-1-类型介绍" tabindex="-1"><a class="header-anchor" href="#_4-2-1-类型介绍" aria-hidden="true">#</a> 4.2.1 类型介绍</h4><p>我们先来回顾下AOP通知:</p><ul><li>AOP通知描述了抽取的<strong>共性功能</strong>，根据共性功能抽取的位置不同，最终运行代码时要将其加入到合理的位置</li></ul><p>通知具体要添加到切入点的哪里?</p><p>共提供了5种通知类型:</p><ul><li>前置通知</li><li>后置通知</li><li><strong>环绕通知(重点)</strong></li><li>返回后通知(了解)</li><li>抛出异常后通知(了解)</li></ul><p>为了更好的理解这几种通知类型，我们来看一张图</p><p><img src="https://gitee.com/xiaweifeng/picgo/raw/master/images/202208241710789.png" alt="1630166147697"></p><p>(1)<strong>前置通知</strong>，追加功能到方法执行前,类似于在代码1或者代码2添加内容</p><p>(2)<strong>后置通知</strong>,追加功能到方法执行后,不管方法执行的过程中有没有抛出异常都会执行，类似于在代码5添加内容</p><p>(3)<strong>返回后通知</strong>,追加功能到方法执行后，只有方法正常执行结束后才进行,类似于在代码3添加内容，如果方法执行抛出异常，返回后通知将不会被添加</p><p>(4)<strong>抛出异常后通知</strong>,追加功能到方法抛出异常后，只有方法执行出异常才进行,类似于在代码4添加内容，只有方法抛出异常后才会被添加</p><p>(5)<strong>环绕通知</strong>,环绕通知功能比较强大，它可以追加功能到方法执行的前后，这也是比较常用的方式，它可以实现其他四种通知类型的功能，具体是如何实现的，需要我们往下学习。</p><p><strong>环境准备，见<code>spring_20_aop_advice_type</code></strong></p><h4 id="_4-2-2-通知类型的使用" tabindex="-1"><a class="header-anchor" href="#_4-2-2-通知类型的使用" aria-hidden="true">#</a> 4.2.2 通知类型的使用</h4><p><strong>前置通知</strong></p><p>修改MyAdvice,在before方法上添加<code>@Before注解</code></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@Aspect</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyAdvice</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Pointcut</span><span class="token punctuation">(</span><span class="token string">&quot;execution(void com.example.dao.BookDao.update())&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">pt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
    
    <span class="token annotation punctuation">@Before</span><span class="token punctuation">(</span><span class="token string">&quot;pt()&quot;</span><span class="token punctuation">)</span>
    <span class="token comment">//此处也可以写成 @Before(&quot;MyAdvice.pt()&quot;),不建议</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">before</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;before advice ...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="https://gitee.com/xiaweifeng/picgo/raw/master/images/202208241710790.png" alt="1630167805723"></p><p><strong>后置通知</strong></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@Aspect</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyAdvice</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Pointcut</span><span class="token punctuation">(</span><span class="token string">&quot;execution(void com.example.dao.BookDao.update())&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">pt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
    
    <span class="token annotation punctuation">@Before</span><span class="token punctuation">(</span><span class="token string">&quot;pt()&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">before</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;before advice ...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@After</span><span class="token punctuation">(</span><span class="token string">&quot;pt()&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">after</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;after advice ...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="https://gitee.com/xiaweifeng/picgo/raw/master/images/202208241710791.png" alt="1630167887131"></p><p><strong>环绕通知</strong></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@Aspect</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyAdvice</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Pointcut</span><span class="token punctuation">(</span><span class="token string">&quot;execution(void com.example.dao.BookDao.update())&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">pt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
    
    <span class="token annotation punctuation">@Around</span><span class="token punctuation">(</span><span class="token string">&quot;pt()&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">around</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;around before advice ...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;around after advice ...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="https://gitee.com/xiaweifeng/picgo/raw/master/images/202208241713958.png" alt="1630167969051"></p><p>运行结果中，通知的内容打印出来，但是原始方法的内容却没有被执行。</p><p>因为环绕通知需要在原始方法的前后进行增强，所以环绕通知就必须要能对原始操作进行调用，具体如何实现?</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@Aspect</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyAdvice</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Pointcut</span><span class="token punctuation">(</span><span class="token string">&quot;execution(void com.example.dao.BookDao.update())&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">pt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
    
    <span class="token annotation punctuation">@Around</span><span class="token punctuation">(</span><span class="token string">&quot;pt()&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">around</span><span class="token punctuation">(</span><span class="token class-name">ProceedingJoinPoint</span> pjp<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span><span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;around before advice ...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//表示对原始操作的调用</span>
        pjp<span class="token punctuation">.</span><span class="token function">proceed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;around after advice ...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>注意事项</strong></p><p>(1)原始方法有返回值的处理</p><ul><li>修改MyAdvice,对BookDao中的select方法添加环绕通知，</li></ul><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@Aspect</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyAdvice</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Pointcut</span><span class="token punctuation">(</span><span class="token string">&quot;execution(void com.example.dao.BookDao.update())&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">pt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
    
    <span class="token annotation punctuation">@Pointcut</span><span class="token punctuation">(</span><span class="token string">&quot;execution(int com.example.dao.BookDao.select())&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">pt2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
    
    <span class="token annotation punctuation">@Around</span><span class="token punctuation">(</span><span class="token string">&quot;pt2()&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">aroundSelect</span><span class="token punctuation">(</span><span class="token class-name">ProceedingJoinPoint</span> pjp<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;around before advice ...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//表示对原始操作的调用</span>
        pjp<span class="token punctuation">.</span><span class="token function">proceed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;around after advice ...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>修改App类，调用select方法</li></ul><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">ApplicationContext</span> ctx <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AnnotationConfigApplicationContext</span><span class="token punctuation">(</span><span class="token class-name">SpringConfig</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">BookDao</span> bookDao <span class="token operator">=</span> ctx<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token class-name">BookDao</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> num <span class="token operator">=</span> bookDao<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>运行后会报错，错误内容为:</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">Exception</span> in thread <span class="token string">&quot;main&quot;</span> <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>aop<span class="token punctuation">.</span></span>AopInvocationException</span><span class="token operator">:</span> <span class="token class-name">Null</span> <span class="token keyword">return</span> value from advice does not match primitive <span class="token keyword">return</span> type <span class="token keyword">for</span><span class="token operator">:</span> <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">int</span> <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>dao<span class="token punctuation">.</span></span>BookDao</span><span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>aop<span class="token punctuation">.</span>framework<span class="token punctuation">.</span></span>JdkDynamicAopProxy</span><span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token class-name">JdkDynamicAopProxy</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">229</span><span class="token punctuation">)</span>
	at com<span class="token punctuation">.</span>sun<span class="token punctuation">.</span>proxy<span class="token punctuation">.</span>$<span class="token class-name">Proxy20</span><span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token class-name">Unknown</span> <span class="token class-name">Source</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span></span>App</span><span class="token punctuation">.</span><span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">App</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">13</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>错误大概的意思是:<code>空的返回不匹配原始方法的int返回</code></p><ul><li>void就是返回Null</li><li>原始方法就是BookDao下的select方法</li></ul><p>所以如果我们使用环绕通知的话，要根据原始方法的返回值来设置环绕通知的返回值，具体解决方案为:</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@Aspect</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyAdvice</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Pointcut</span><span class="token punctuation">(</span><span class="token string">&quot;execution(void com.example.dao.BookDao.update())&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">pt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
    
    <span class="token annotation punctuation">@Pointcut</span><span class="token punctuation">(</span><span class="token string">&quot;execution(int com.example.dao.BookDao.select())&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">pt2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
    
    <span class="token annotation punctuation">@Around</span><span class="token punctuation">(</span><span class="token string">&quot;pt2()&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">aroundSelect</span><span class="token punctuation">(</span><span class="token class-name">ProceedingJoinPoint</span> pjp<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;around before advice ...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//表示对原始操作的调用</span>
        <span class="token class-name">Object</span> ret <span class="token operator">=</span> pjp<span class="token punctuation">.</span><span class="token function">proceed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;around after advice ...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> ret<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>说明:</strong></p><p>​ 为什么返回的是Object而不是int的主要原因是Object类型更通用。</p><p>​ 在环绕通知中是可以对原始方法返回值就行修改的。</p><p><strong>返回后通知</strong></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@Aspect</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyAdvice</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Pointcut</span><span class="token punctuation">(</span><span class="token string">&quot;execution(void com.example.dao.BookDao.update())&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">pt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
    
    <span class="token annotation punctuation">@Pointcut</span><span class="token punctuation">(</span><span class="token string">&quot;execution(int com.example.dao.BookDao.select())&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">pt2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
    
    <span class="token annotation punctuation">@AfterReturning</span><span class="token punctuation">(</span><span class="token string">&quot;pt2()&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">afterReturning</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;afterReturning advice ...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="https://gitee.com/xiaweifeng/picgo/raw/master/images/202208241714920.png" alt="1630169124446"></p><p>**注意：**返回后通知是需要在原始方法<code>select</code>正常执行后才会被执行，如果<code>select()</code>方法执行的过程中出现了异常，那么返回后通知是不会被执行。后置通知是不管原始方法有没有抛出异常都会被执行。这个案例大家下去可以自己练习验证下。</p><p><strong>异常后通知</strong></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@Aspect</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyAdvice</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Pointcut</span><span class="token punctuation">(</span><span class="token string">&quot;execution(void com.example.dao.BookDao.update())&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">pt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
    
    <span class="token annotation punctuation">@Pointcut</span><span class="token punctuation">(</span><span class="token string">&quot;execution(int com.example.dao.BookDao.select())&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">pt2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
    
    <span class="token annotation punctuation">@AfterReturning</span><span class="token punctuation">(</span><span class="token string">&quot;pt2()&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">afterThrowing</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;afterThrowing advice ...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="https://gitee.com/xiaweifeng/picgo/raw/master/images/202208241710792.png" alt="1630169357146"></p><p>**注意：**异常后通知是需要原始方法抛出异常，可以在<code>select()</code>方法中添加一行代码<code>int i = 1/0</code>即可。如果没有抛异常，异常后通知将不会被执行。</p><p>学习完这5种通知类型，我们来思考下环绕通知是如何实现其他通知类型的功能的?</p><p>因为环绕通知是可以控制原始方法执行的，所以我们把增强的代码写在调用原始方法的不同位置就可以实现不同的通知类型的功能，如:</p><p><img src="https://gitee.com/xiaweifeng/picgo/raw/master/images/202208241710793.png" alt="1630170090945"></p><h5 id="_4-2-2-1-通知类型总结" tabindex="-1"><a class="header-anchor" href="#_4-2-2-1-通知类型总结" aria-hidden="true">#</a> 4.2.2.1 通知类型总结</h5><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@Aspect</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyAdvice</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Pointcut</span><span class="token punctuation">(</span><span class="token string">&quot;execution(void com.example.dao.BookDao.update())&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">pt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Pointcut</span><span class="token punctuation">(</span><span class="token string">&quot;execution(int com.example.dao.BookDao.select())&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">pt2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token comment">//    @Before(&quot;pt()&quot;)</span>
    <span class="token comment">//此处也可以写成 @Before(&quot;MyAdvice.pt()&quot;),不建议</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">before</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;before advice ...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token comment">//    @After(&quot;pt()&quot;)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">after</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;after advice ...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token comment">//    @Around(&quot;pt()&quot;)</span>
<span class="token comment">//    @Around(&quot;pt2()&quot;)</span>
    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">around</span><span class="token punctuation">(</span><span class="token class-name">ProceedingJoinPoint</span> pjp<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;around before advice ...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//表示对原始方法的调用</span>
        <span class="token class-name">Object</span> ret <span class="token operator">=</span> pjp<span class="token punctuation">.</span><span class="token function">proceed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;around after advice ...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> ret<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token comment">//    @AfterReturning(&quot;pt2()&quot;)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">afterReturning</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;afterReturning advice ...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@AfterThrowing</span><span class="token punctuation">(</span><span class="token string">&quot;pt2()&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">afterThrowing</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;afterThrowing advice ...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h6 id="before" tabindex="-1"><a class="header-anchor" href="#before" aria-hidden="true">#</a> @Before</h6><table><thead><tr><th>名称</th><th>@Before</th></tr></thead><tbody><tr><td>类型</td><td>方法注解</td></tr><tr><td>位置</td><td>通知方法定义上方</td></tr><tr><td>作用</td><td>设置当前通知方法与切入点之间的绑定关系，当前通知方法在原始切入点方法前运行</td></tr></tbody></table><h6 id="after" tabindex="-1"><a class="header-anchor" href="#after" aria-hidden="true">#</a> @After</h6><table><thead><tr><th>名称</th><th>@After</th></tr></thead><tbody><tr><td>类型</td><td>方法注解</td></tr><tr><td>位置</td><td>通知方法定义上方</td></tr><tr><td>作用</td><td>设置当前通知方法与切入点之间的绑定关系，当前通知方法在原始切入点方法后运行</td></tr></tbody></table><h6 id="afterreturning" tabindex="-1"><a class="header-anchor" href="#afterreturning" aria-hidden="true">#</a> @AfterReturning</h6><table><thead><tr><th>名称</th><th>@AfterReturning</th></tr></thead><tbody><tr><td>类型</td><td>方法注解</td></tr><tr><td>位置</td><td>通知方法定义上方</td></tr><tr><td>作用</td><td>设置当前通知方法与切入点之间绑定关系，当前通知方法在原始切入点方法正常执行完毕后执行</td></tr></tbody></table><h6 id="afterthrowing" tabindex="-1"><a class="header-anchor" href="#afterthrowing" aria-hidden="true">#</a> @AfterThrowing</h6><table><thead><tr><th>名称</th><th>@AfterThrowing</th></tr></thead><tbody><tr><td>类型</td><td>方法注解</td></tr><tr><td>位置</td><td>通知方法定义上方</td></tr><tr><td>作用</td><td>设置当前通知方法与切入点之间绑定关系，当前通知方法在原始切入点方法运行抛出异常后执行</td></tr></tbody></table><h6 id="around" tabindex="-1"><a class="header-anchor" href="#around" aria-hidden="true">#</a> @Around</h6><table><thead><tr><th>名称</th><th>@Around</th></tr></thead><tbody><tr><td>类型</td><td>方法注解</td></tr><tr><td>位置</td><td>通知方法定义上方</td></tr><tr><td>作用</td><td>设置当前通知方法与切入点之间的绑定关系，当前通知方法在原始切入点方法前后运行</td></tr></tbody></table><p><strong>环绕通知注意事项</strong></p><ol><li>环绕通知必须依赖形参ProceedingJoinPoint才能实现对原始方法的调用，进而实现原始方法调用前后同时添加通知</li><li>通知中如果未使用ProceedingJoinPoint对原始方法进行调用将跳过原始方法的执行</li><li>对原始方法的调用可以不接收返回值，通知方法设置成void即可，如果接收返回值，最好设定为Object类型</li><li>原始方法的返回值如果是void类型，通知方法的返回值类型可以设置成void,也可以设置成Object</li><li>由于无法预知原始方法运行后是否会抛出异常，因此环绕通知方法必须要处理Throwable异常</li></ol><p>介绍完这么多种通知类型，具体该选哪一种呢?</p><p>我们可以通过一些案例加深下对通知类型的学习。</p><h3 id="_4-3-统计方法万次执行时常" tabindex="-1"><a class="header-anchor" href="#_4-3-统计方法万次执行时常" aria-hidden="true">#</a> 4.3 统计方法万次执行时常</h3><h4 id="_4-3-1-需求分析" tabindex="-1"><a class="header-anchor" href="#_4-3-1-需求分析" aria-hidden="true">#</a> 4.3.1 需求分析</h4><p>这个需求也比较简单，前面我们在介绍AOP的时候已经演示过:</p><ul><li>需求:任意业务层接口执行均可显示其执行效率（执行时长）</li></ul><p>这个案例是对前面的演示<code>spring_17_aop_demo</code>具体实现。</p><h4 id="_4-3-2-环境准备" tabindex="-1"><a class="header-anchor" href="#_4-3-2-环境准备" aria-hidden="true">#</a> 4.3.2 环境准备</h4><ul><li><p>创建一个Maven项目<code>spring_21_case_interface_run_speed</code></p></li><li><p>pom.xml添加Spring依赖</p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-context<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>5.3.6<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.aspectj<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>aspectjweaver<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.9.4<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>添加<code>SpringConfig</code>配置类</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span><span class="token comment">//配置类</span>
<span class="token annotation punctuation">@ComponentScan</span><span class="token punctuation">(</span><span class="token string">&quot;com.example&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SpringConfig</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>添加<code>dao</code>层业务操作接口和实现类</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">BookDao</span> <span class="token punctuation">{</span>
    <span class="token keyword">void</span> <span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> <span class="token function">select</span><span class="token punctuation">(</span><span class="token keyword">int</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@Repository</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BookDaoImpl</span> <span class="token keyword">implements</span> <span class="token class-name">BookDao</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;save function&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">select</span><span class="token punctuation">(</span><span class="token keyword">int</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;select&quot;</span><span class="token operator">+</span>id<span class="token operator">+</span><span class="token string">&quot; function&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token number">100</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>编写app启动类</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">ApplicationContext</span> ctx <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AnnotationConfigApplicationContext</span><span class="token punctuation">(</span><span class="token class-name">SpringConfig</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">BookDao</span> bookDao <span class="token operator">=</span> ctx<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token class-name">BookDao</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        bookDao<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>以上案例环境准备好了</strong></p></li></ul><h4 id="_4-3-3-功能开发" tabindex="-1"><a class="header-anchor" href="#_4-3-3-功能开发" aria-hidden="true">#</a> 4.3.3 功能开发</h4><ul><li><p>添加通知类<code>MyAdvice</code>，并标记该类是个切面类</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@Aspect</span> <span class="token comment">//标识该类是一个AOP的切面类</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyAdvice</span> <span class="token punctuation">{</span>
    <span class="token comment">//制作切面:用来描述通知和切入点之间</span>
    <span class="token annotation punctuation">@Pointcut</span><span class="token punctuation">(</span><span class="token string">&quot;execution(* com.example.dao.BookDao.*(..))&quot;</span><span class="token punctuation">)</span>
    <span class="token comment">//定义切入点方法</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">pt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * 记录方法的万次执行耗时时间,使用环绕通知
     */</span>
    <span class="token annotation punctuation">@Around</span><span class="token punctuation">(</span><span class="token string">&quot;pt()&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Object</span> <span class="token function">functionMillionTime</span><span class="token punctuation">(</span><span class="token class-name">ProceedingJoinPoint</span> pjp<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;计时开始&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Long</span> startTime <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">;</span> i<span class="token operator">&lt;</span><span class="token number">10000</span> <span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">//调用原始操作</span>
            pjp<span class="token punctuation">.</span><span class="token function">proceed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">Long</span> endTime <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Long</span> totalTime <span class="token operator">=</span> endTime<span class="token operator">-</span>startTime<span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;计时结束&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;执行万次消耗时间：&quot;</span> <span class="token operator">+</span> totalTime <span class="token operator">+</span> <span class="token string">&quot;ms&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Object</span> result <span class="token operator">=</span> pjp<span class="token punctuation">.</span><span class="token function">proceed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//return 最后一次执行结果</span>
        <span class="token keyword">return</span> result<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>在配置类上开启AOP注解</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span><span class="token comment">//配置类</span>
<span class="token annotation punctuation">@ComponentScan</span><span class="token punctuation">(</span><span class="token string">&quot;com.example&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@EnableAspectJAutoProxy</span> <span class="token comment">//开启AOP</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SpringConfig</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><h5 id="_4-3-3-1-程序优化" tabindex="-1"><a class="header-anchor" href="#_4-3-3-1-程序优化" aria-hidden="true">#</a> 4.3.3.1 程序优化</h5><p>目前程序所面临的问题是，多个方法一起执行测试的时候，控制台都打印的是:</p><p><code>业务层接口万次执行时间:xxxms</code></p><p>我们没有办法区分到底是哪个接口的哪个方法执行的具体时间，具体如何优化?</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@Aspect</span> <span class="token comment">//标识该类是一个AOP的切面类</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyAdvice2</span> <span class="token punctuation">{</span>
    <span class="token comment">//制作切面:用来描述通知和切入点之间</span>
    <span class="token annotation punctuation">@Pointcut</span><span class="token punctuation">(</span><span class="token string">&quot;execution(* com.example.dao.BookDao.*(..))&quot;</span><span class="token punctuation">)</span>
    <span class="token comment">//定义切入点方法</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">pt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * 记录方法的万次执行耗时时间,使用环绕通知
     */</span>
    <span class="token annotation punctuation">@Around</span><span class="token punctuation">(</span><span class="token string">&quot;pt()&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Object</span> <span class="token function">functionMillionTime</span><span class="token punctuation">(</span><span class="token class-name">ProceedingJoinPoint</span> pjp<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">{</span>
        <span class="token comment">//获取执行签名信息</span>
        <span class="token class-name">Signature</span> signature <span class="token operator">=</span> pjp<span class="token punctuation">.</span><span class="token function">getSignature</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//通过签名获取执行操作名称(接口名)</span>
        <span class="token class-name">String</span> className <span class="token operator">=</span> signature<span class="token punctuation">.</span><span class="token function">getDeclaringTypeName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//通过签名获取执行操作名称(方法名)</span>
        <span class="token class-name">String</span> methodName <span class="token operator">=</span> signature<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>methodName<span class="token operator">+</span><span class="token string">&quot;()计时开始&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Long</span> startTime <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">;</span> i<span class="token operator">&lt;</span><span class="token number">10000</span> <span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">//调用原始操作</span>
            pjp<span class="token punctuation">.</span><span class="token function">proceed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">Long</span> endTime <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Long</span> totalTime <span class="token operator">=</span> endTime<span class="token operator">-</span>startTime<span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>methodName<span class="token operator">+</span><span class="token string">&quot;()计时结束&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>className<span class="token operator">+</span><span class="token string">&quot;.&quot;</span><span class="token operator">+</span>methodName<span class="token operator">+</span><span class="token string">&quot;执行万次消耗时间：&quot;</span> <span class="token operator">+</span> totalTime <span class="token operator">+</span> <span class="token string">&quot;ms&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Object</span> result <span class="token operator">=</span> pjp<span class="token punctuation">.</span><span class="token function">proceed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//return 最后一次执行结果</span>
        <span class="token keyword">return</span> result<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>补充说明</strong></p><p>通过上面案例发现，我们可以通过<code>ProceedingJoinPoint</code>获取切入点的方法以及类路径</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">//获取执行签名信息</span>
<span class="token class-name">Signature</span> signature <span class="token operator">=</span> pjp<span class="token punctuation">.</span><span class="token function">getSignature</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//通过签名获取执行操作名称(接口名)</span>
<span class="token class-name">String</span> className <span class="token operator">=</span> signature<span class="token punctuation">.</span><span class="token function">getDeclaringTypeName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//通过签名获取执行操作名称(方法名)</span>
<span class="token class-name">String</span> methodName <span class="token operator">=</span> signature<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-4-aop通知获取数据" tabindex="-1"><a class="header-anchor" href="#_4-4-aop通知获取数据" aria-hidden="true">#</a> 4.4 AOP通知获取数据</h3><p>目前我们写AOP仅仅是在原始方法前后追加一些操作，接下来我们要说说AOP中数据相关的内容，我们将从<code>获取参数</code>、<code>获取返回值</code>和<code>获取异常</code>三个方面来研究切入点的相关信息。</p><p>前面我们介绍通知类型的时候总共讲了五种，那么对于这五种类型都会有参数，返回值和异常吗?</p><p>我们先来一个个分析下:</p><ul><li>获取切入点方法的参数，所有的通知类型都可以获取参数 <ul><li>**JoinPoint：**适用于前置、后置、返回后、抛出异常后通知</li><li>**ProceedingJoinPoint：**适用于环绕通知</li></ul></li><li>获取切入点方法返回值，前置和抛出异常后通知是没有返回值，后置通知可有可无，所以不做研究 <ul><li>返回后通知</li><li>环绕通知</li></ul></li><li>获取切入点方法运行异常信息，前置和返回后通知是不会有，后置通知可有可无，所以不做研究 <ul><li>抛出异常后通知</li><li>环绕通知</li></ul></li></ul><p><strong>案例代码<code>spring_22_aop_advice_data</code></strong></p><h4 id="_4-4-1-获取参数" tabindex="-1"><a class="header-anchor" href="#_4-4-1-获取参数" aria-hidden="true">#</a> 4.4.1 获取参数</h4><p>我们主要看<code>MyAdvice</code>通知类</p><p><strong>非环绕通知获取方式</strong></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@Aspect</span> <span class="token comment">//标识该类是一个AOP的切面类</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyAdvice</span> <span class="token punctuation">{</span>
    <span class="token comment">//制作切面:用来描述通知和切入点之间</span>
    <span class="token annotation punctuation">@Pointcut</span><span class="token punctuation">(</span><span class="token string">&quot;execution(* com.example.dao.BookDao.*(..))&quot;</span><span class="token punctuation">)</span>
    <span class="token comment">//定义切入点方法</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">pt</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//非环绕通知获取方式</span>
    <span class="token annotation punctuation">@Before</span><span class="token punctuation">(</span><span class="token string">&quot;pt()&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">before</span><span class="token punctuation">(</span><span class="token class-name">JoinPoint</span> jp<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args <span class="token operator">=</span> jp<span class="token punctuation">.</span><span class="token function">getArgs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;before advice ...&quot;</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这样运行<code>BookDao</code>下面的方法，就可以获取方法下面的入参了</p><p>**说明：**因为参数的个数是不固定的，所以使用数组更通配些。</p><p>使用JoinPoint的方式获取参数适用于<code>前置</code>、<code>后置</code>、<code>返回后</code>、<code>抛出异常后</code>通知。剩下的大家自行去验证</p><p><strong>环绕通知获取方式</strong></p><p>环绕通知使用的是ProceedingJoinPoint，因为ProceedingJoinPoint是JoinPoint类的子类，所以对于ProceedingJoinPoint类中应该也会有对应的<code>getArgs()</code>方法，我们来看一下。</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Around</span><span class="token punctuation">(</span><span class="token string">&quot;pt()&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">around</span><span class="token punctuation">(</span><span class="token class-name">ProceedingJoinPoint</span> pjp<span class="token punctuation">)</span><span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">{</span>
        <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args <span class="token operator">=</span> pjp<span class="token punctuation">.</span><span class="token function">getArgs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">666</span><span class="token punctuation">;</span>
        <span class="token class-name">Object</span> ret <span class="token operator">=</span> pjp<span class="token punctuation">.</span><span class="token function">proceed</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> ret<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>注意:</strong></p><ul><li><p>pjp.proceed()方法是有两个构造方法，分别是:</p><p><img src="https://gitee.com/xiaweifeng/picgo/raw/master/images/202208241710795.png" alt="1630234756123"></p><ul><li><p>调用无参数的proceed，当原始方法有参数时，会在调用的过程中<strong>自动传入参数</strong></p></li><li><p>调用带参数的proceed，可以自己传入args，一般用于截断数据，处理完再传入</p></li><li><p>所以调用这两个方法的任意一个都可以完成功能</p></li><li><p>但是当需要修改原始方法的参数时，就只能采用带有参数的方法。</p></li></ul></li></ul><h4 id="_4-4-2-获取返回值" tabindex="-1"><a class="header-anchor" href="#_4-4-2-获取返回值" aria-hidden="true">#</a> 4.4.2 获取返回值</h4><p><strong>环绕通知获取返回值</strong></p><p>对于返回值，只有返回后<code>AfterReturing</code>和环绕<code>Around</code>这两个通知类型可以获取，具体如何获取?</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">Object</span> ret <span class="token operator">=</span> pjp<span class="token punctuation">.</span><span class="token function">proceed</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>上述代码中，<code>ret</code>就是方法的返回值，我们是可以直接获取，不但可以获取，如果需要还可以进行修改。</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">//我们看原始方法return 100</span>
<span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">select</span><span class="token punctuation">(</span><span class="token keyword">int</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;select &quot;</span><span class="token operator">+</span>id<span class="token operator">+</span><span class="token string">&quot; function&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token number">100</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token annotation punctuation">@Around</span><span class="token punctuation">(</span><span class="token string">&quot;pt()&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">around</span><span class="token punctuation">(</span><span class="token class-name">ProceedingJoinPoint</span> pjp<span class="token punctuation">)</span><span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">{</span>
        <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args <span class="token operator">=</span> pjp<span class="token punctuation">.</span><span class="token function">getArgs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">666</span><span class="token punctuation">;</span>
        <span class="token class-name">Object</span> ret <span class="token operator">=</span> pjp<span class="token punctuation">.</span><span class="token function">proceed</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> result <span class="token operator">=</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span>ret<span class="token operator">+</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> result<span class="token punctuation">;</span><span class="token comment">//这里返回100+1</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>返回后通知获取返回值</strong></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">//返回后通知获取返回值</span>
    <span class="token annotation punctuation">@AfterReturning</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;pt()&quot;</span><span class="token punctuation">,</span>returning <span class="token operator">=</span> <span class="token string">&quot;ret&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">afterReturning</span><span class="token punctuation">(</span><span class="token class-name">JoinPoint</span> ret<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;afterReturning advice ...&quot;</span><span class="token operator">+</span>ret<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>注意:</strong></p><p>(1)参数名的问题</p><p><img src="https://gitee.com/xiaweifeng/picgo/raw/master/images/202208241710796.png" alt="1630237320870"></p><p>(2)afterReturning方法参数类型的问题</p><p>参数类型可以写成String，但是为了能匹配更多的参数类型，建议写成Object类型</p><p>(3)afterReturning方法参数的顺序问题</p><p><img src="https://gitee.com/xiaweifeng/picgo/raw/master/images/202208241710797.png" alt="1630237586682"></p><h4 id="_4-4-3-获取异常" tabindex="-1"><a class="header-anchor" href="#_4-4-3-获取异常" aria-hidden="true">#</a> 4.4.3 获取异常</h4><p>对于获取抛出的异常，只有抛出异常后<code>AfterThrowing</code>和环绕<code>Around</code>这两个通知类型可以获取，具体如何获取?</p><p><strong>环绕通知获取异常</strong></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Around</span><span class="token punctuation">(</span><span class="token string">&quot;pt()&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">aroundThrowable</span><span class="token punctuation">(</span><span class="token class-name">ProceedingJoinPoint</span> pjp<span class="token punctuation">)</span><span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">{</span>
        <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args <span class="token operator">=</span> pjp<span class="token punctuation">.</span><span class="token function">getArgs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Object</span> ret <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            ret <span class="token operator">=</span> pjp<span class="token punctuation">.</span><span class="token function">proceed</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot; 捕获到异常信息&quot;</span><span class="token operator">+</span>e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> ret<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>抛出异常后通知获取异常</strong></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@Aspect</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyAdvice</span> <span class="token punctuation">{</span>
		<span class="token annotation punctuation">@Pointcut</span><span class="token punctuation">(</span><span class="token string">&quot;execution(* com.example.dao.BookDao.*(..))&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">pt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>

    <span class="token annotation punctuation">@AfterThrowing</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;pt()&quot;</span><span class="token punctuation">,</span>throwing <span class="token operator">=</span> <span class="token string">&quot;t&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">afterThrowing</span><span class="token punctuation">(</span><span class="token class-name">Throwable</span> t<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;afterThrowing advice ...&quot;</span><span class="token operator">+</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
	<span class="token comment">//其他的略</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>注意:</strong></p><p><img src="https://gitee.com/xiaweifeng/picgo/raw/master/images/202208241710798.png" alt="1630239939043"></p><p>至此，AOP通知如何获取数据就已经讲解完了，数据中包含<code>参数</code>、<code>返回值</code>、<code>异常(了解)</code>。</p><h3 id="_4-5-百度网盘密码去空格处理" tabindex="-1"><a class="header-anchor" href="#_4-5-百度网盘密码去空格处理" aria-hidden="true">#</a> 4.5 百度网盘密码去空格处理</h3><p>继上面的练习，我们再来做个案例，就不创建新的model了</p><p><strong>需求: 对百度网盘分享链接输入密码时尾部多输入的空格做兼容处理。</strong></p><p><img src="https://gitee.com/xiaweifeng/picgo/raw/master/images/202208241710799.png" alt="1630240203033"></p><ul><li><p>当我们从别人发给我们的内容中复制提取码的时候，有时候会多复制到一些空格，直接粘贴到百度的提取码输入框</p></li><li><p>但是百度那边记录的提取码是没有空格的</p></li><li><p>这个时候如果不做处理，直接对比的话，就会引发提取码不一致，导致无法访问百度盘上的内容</p></li><li><p>所以多输入一个空格可能会导致项目的功能无法正常使用。</p></li><li><p>此时我们就想能不能将输入的参数先帮用户去掉空格再操作呢?</p></li></ul><p>答案是可以的，我们只需要在业务方法执行之前对所有的输入参数进行格式处理——trim()</p><ul><li>是对所有的参数都需要去除空格么?</li></ul><p>也没有必要，一般只需要针对字符串处理即可。</p><ul><li>以后涉及到需要去除前后空格的业务可能会有很多，这个去空格的代码是每个业务都写么?</li></ul><p>可以考虑使用AOP来统一处理。</p><ul><li>AOP有五种通知类型，该使用哪种呢?</li></ul><p>我们的需求是将原始方法的参数处理后在参与原始方法的调用，能做这件事的就只有环绕通知。</p><p>综上所述，我们需要考虑两件事: ①：在业务方法执行之前对所有的输入参数进行格式处理——trim() ②：使用处理后的参数调用原始方法——环绕通知中存在对原始方法的调用</p><h4 id="_4-5-1-功能开发" tabindex="-1"><a class="header-anchor" href="#_4-5-1-功能开发" aria-hidden="true">#</a> 4.5.1 功能开发</h4><p><strong>service模拟数据</strong></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">ResourcesService</span> <span class="token punctuation">{</span>
    <span class="token keyword">boolean</span> <span class="token function">readResources</span><span class="token punctuation">(</span><span class="token class-name">String</span> url<span class="token punctuation">,</span> <span class="token class-name">String</span> password<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BaiduCloudDiskService</span> <span class="token keyword">implements</span> <span class="token class-name">ResourcesService</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">readResources</span><span class="token punctuation">(</span><span class="token class-name">String</span> url<span class="token punctuation">,</span> <span class="token class-name">String</span> password<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>password<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//模拟校验</span>
        <span class="token keyword">return</span> password<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">&quot;root&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>通知类编写</strong></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@Aspect</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DiskAdvice</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Pointcut</span><span class="token punctuation">(</span><span class="token string">&quot;execution(* com.example.services.ResourcesService.*(..))&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">pt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Around</span><span class="token punctuation">(</span><span class="token string">&quot;pt()&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">around</span><span class="token punctuation">(</span><span class="token class-name">ProceedingJoinPoint</span> pjp<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">{</span>
        <span class="token comment">//获取参数</span>
        <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args <span class="token operator">=</span> pjp<span class="token punctuation">.</span><span class="token function">getArgs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//去除前后空格</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> args<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">//判断参数是不是字符串</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>args<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                args<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> args<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//返回给原始方法</span>
        <span class="token class-name">Object</span> result <span class="token operator">=</span> pjp<span class="token punctuation">.</span><span class="token function">proceed</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> result<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>注意：</strong></p><p><img src="https://gitee.com/xiaweifeng/picgo/raw/master/images/202208241710800.png" alt="1630242491831"></p><p><strong>运行主方法</strong></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AppDisk</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">ApplicationContext</span> ctx <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AnnotationConfigApplicationContext</span><span class="token punctuation">(</span><span class="token class-name">SpringConfig</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ResourcesService</span> resourcesService <span class="token operator">=</span> ctx<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token class-name">ResourcesService</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">boolean</span> resources <span class="token operator">=</span> resourcesService<span class="token punctuation">.</span><span class="token function">readResources</span><span class="token punctuation">(</span><span class="token string">&quot;http://pan.baidu.com/haha&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;root &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;resources = &quot;</span> <span class="token operator">+</span> resources<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>**说明：**在<code>root </code>后面故意添加一个<code>空格</code>在通知的环绕方法里面处理掉。</p><h2 id="_5-aop总结" tabindex="-1"><a class="header-anchor" href="#_5-aop总结" aria-hidden="true">#</a> 5. AOP总结</h2><p>AOP的知识就已经讲解完了，接下来对于AOP的知识进行一个总结。</p><h3 id="_5-1-aop的核心概念" tabindex="-1"><a class="header-anchor" href="#_5-1-aop的核心概念" aria-hidden="true">#</a> 5.1 AOP的核心概念</h3><ul><li>概念：AOP(Aspect Oriented Programming)面向切面编程，一种编程范式</li><li>作用：在不惊动原始设计的基础上为方法进行功能<strong>增强</strong></li><li>核心概念 <ul><li>代理（Proxy）：SpringAOP的核心本质是采用代理模式实现的</li><li>连接点（JoinPoint）：在SpringAOP中，理解为任意方法的执行</li><li>切入点（Pointcut）：匹配连接点的式子，也是具有共性功能的方法描述</li><li>通知（Advice）：若干个方法的共性功能，在切入点处执行，最终体现为一个方法</li><li>切面（Aspect）：描述通知与切入点的对应关系</li><li>目标对象（Target）：被代理的原始对象成为目标对象</li></ul></li></ul><h3 id="_5-2-切入点表达式" tabindex="-1"><a class="header-anchor" href="#_5-2-切入点表达式" aria-hidden="true">#</a> 5.2 切入点表达式</h3><ul><li><p>切入点表达式标准格式：动作关键字(访问修饰符 返回值 包名.类/接口名.方法名（参数）异常名)</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token function">execution</span><span class="token punctuation">(</span><span class="token operator">*</span> com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>service<span class="token punctuation">.</span>*<span class="token class-name">Service</span><span class="token punctuation">.</span>*<span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>切入点表达式描述通配符：</p><ul><li>作用：用于快速描述，范围描述</li><li><code>*</code>：匹配任意符号（常用）</li><li><code>..</code> ：匹配多个连续的任意符号（常用）</li><li><code>+</code>：匹配子类类型</li></ul></li><li><p>切入点表达式书写技巧</p><p>1.按<strong>标准规范</strong>开发 2.查询操作的返回值建议使用*匹配 3.减少使用..的形式描述包 4.==对接口进行描述==，使用*表示模块名，例如UserService的匹配描述为*Service 5.方法名书写保留动词，例如get，使用*表示名词，例如getById匹配描述为getBy* 6.参数根据实际情况灵活调整</p></li></ul><h3 id="_5-3-五种通知类型" tabindex="-1"><a class="header-anchor" href="#_5-3-五种通知类型" aria-hidden="true">#</a> 5.3 五种通知类型</h3><ul><li>前置通知</li><li>后置通知</li><li>环绕通知（重点） <ul><li>环绕通知依赖形参ProceedingJoinPoint才能实现对原始方法的调用</li><li>环绕通知可以隔离原始方法的调用执行</li><li>环绕通知返回值设置为Object类型</li><li>环绕通知中可以对原始方法调用过程中出现的异常进行处理</li></ul></li><li>返回后通知</li><li>抛出异常后通知</li></ul><h3 id="_5-4-通知中获取参数" tabindex="-1"><a class="header-anchor" href="#_5-4-通知中获取参数" aria-hidden="true">#</a> 5.4 通知中获取参数</h3><ul><li>获取切入点方法的参数，所有的通知类型都可以获取参数 <ul><li>JoinPoint：适用于前置、后置、返回后、抛出异常后通知</li><li>ProceedingJoinPoint：适用于环绕通知</li></ul></li><li>获取切入点方法返回值，前置和抛出异常后通知是没有返回值，后置通知可有可无，所以不做研究 <ul><li>返回后通知</li><li>环绕通知</li></ul></li><li>获取切入点方法运行异常信息，前置和返回后通知是不会有，后置通知可有可无，所以不做研究 <ul><li>抛出异常后通知</li><li>环绕通知</li></ul></li></ul><h2 id="_6-aop事务管理" tabindex="-1"><a class="header-anchor" href="#_6-aop事务管理" aria-hidden="true">#</a> 6. AOP事务管理</h2><h3 id="_6-1-spring事务简介" tabindex="-1"><a class="header-anchor" href="#_6-1-spring事务简介" aria-hidden="true">#</a> 6.1 Spring事务简介</h3><h4 id="_6-1-1-相关概念介绍" tabindex="-1"><a class="header-anchor" href="#_6-1-1-相关概念介绍" aria-hidden="true">#</a> 6.1.1 相关概念介绍</h4><ul><li>事务作用：在数据层保障一系列的数据库操作同成功同失败</li><li>Spring事务作用：在数据层或<strong>业务层</strong>保障一系列的数据库操作同成功同失败</li></ul><p>数据层有事务我们可以理解，为什么业务层也需要处理事务呢?</p><p>举个简单的例子，</p><ul><li>转账业务会有两次数据层的调用，一次是加钱一次是减钱</li><li>把事务放在数据层，加钱和减钱就有两个事务</li><li>没办法保证加钱和减钱同时成功或者同时失败</li><li>这个时候就需要将事务放在业务层进行处理。</li></ul><p>Spring为了管理事务，提供了一个平台事务管理器<code>PlatformTransactionManager</code></p><p><img src="https://gitee.com/xiaweifeng/picgo/raw/master/images/202208241710801.png" alt="1630243651541"></p><p>commit是用来提交事务，rollback是用来回滚事务。</p><p>PlatformTransactionManager只是一个接口，Spring还为其提供了一个具体的实现:</p><p><img src="https://gitee.com/xiaweifeng/picgo/raw/master/images/202208241710802.png" alt="1630243993380"></p><p>从名称上可以看出，我们只需要给它一个DataSource对象，它就可以帮你去在业务层管理事务。其内部采用的是JDBC的事务。所以说如果你持久层采用的是JDBC相关的技术，就可以采用这个事务管理器来管理你的事务。而Mybatis内部采用的就是JDBC的事务，所以后期我们Spring整合Mybatis就采用的这个DataSourceTransactionManager事务管理器。</p><h4 id="_6-1-2-转账案例-需求分析" tabindex="-1"><a class="header-anchor" href="#_6-1-2-转账案例-需求分析" aria-hidden="true">#</a> 6.1.2 转账案例-需求分析</h4><p>接下来通过一个案例来学习下Spring是如何来管理事务的。</p><p>先来分析下需求:</p><p>需求: 实现任意两个账户间转账操作</p><p>需求微缩: A账户减钱，B账户加钱</p><p>为了实现上述的业务需求，我们可以按照下面步骤来实现下: ①：数据层提供基础操作，指定账户减钱（outMoney），指定账户加钱（inMoney）</p><p>②：业务层提供转账操作（transfer），调用减钱与加钱的操作</p><p>③：提供2个账号和操作金额执行转账操作</p><p>④：基于Spring整合MyBatis环境搭建上述操作</p><h4 id="_6-1-3-转账案例-环境搭建" tabindex="-1"><a class="header-anchor" href="#_6-1-3-转账案例-环境搭建" aria-hidden="true">#</a> 6.1.3 转账案例-环境搭建</h4><blockquote><p>整个环境搭建，就是之前我们学习使用Spring整合Mybatis。现在我们再来回顾一下。</p><p>创建项目<code>spring_23_case_transfer</code></p></blockquote><ol><li><p><strong>准备数据库</strong></p><div class="language-sql ext-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">create</span> <span class="token keyword">database</span> spring_db_transfer <span class="token keyword">character</span> <span class="token keyword">set</span> utf8<span class="token punctuation">;</span>
<span class="token keyword">use</span> spring_db<span class="token punctuation">;</span>
<span class="token keyword">create</span> <span class="token keyword">table</span> tbl_account<span class="token punctuation">(</span>
    id <span class="token keyword">int</span> <span class="token keyword">primary</span> <span class="token keyword">key</span> <span class="token keyword">auto_increment</span><span class="token punctuation">,</span>
    name <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">35</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    money <span class="token keyword">double</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> tbl_account <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">&#39;Tom&#39;</span><span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> tbl_account <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">&#39;Jerry&#39;</span><span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>添加pom.xml添加相关依赖</strong></p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-context<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>5.3.6<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.mybatis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mybatis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.5.5<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>mysql<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mysql-connector-java<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>8.0.23<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>druid<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.1.12<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token comment">&lt;!--Spring操作数据库需要该jar包--&gt;</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-jdbc<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>5.3.6<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token comment">&lt;!--
                Spring与Mybatis整合的jar包
                这个jar包mybatis在前面，是Mybatis提供的
            --&gt;</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.mybatis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mybatis-spring<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.0.5<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>根据表创建模型类</strong></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Account</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">Integer</span> id<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Double</span> money<span class="token punctuation">;</span>
	<span class="token comment">//setter...getter...toString...方法略    </span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>创建Dao接口</strong></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">AccountDao</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Update</span><span class="token punctuation">(</span><span class="token string">&quot;update tbl_account set money = money + #{money} where name = #{name}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">void</span> <span class="token function">inMoney</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">&quot;money&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Double</span> money<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Update</span><span class="token punctuation">(</span><span class="token string">&quot;update tbl_account set money = money - #{money} where name = #{name}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">void</span> <span class="token function">outMoney</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">&quot;money&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Double</span> money<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>创建Service接口和实现类</strong></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">AccountService</span> <span class="token punctuation">{</span>
    <span class="token doc-comment comment">/**
     * 转账操作
     * <span class="token keyword">@param</span> <span class="token parameter">out</span> 传出方
     * <span class="token keyword">@param</span> <span class="token parameter">in</span> 转入方
     * <span class="token keyword">@param</span> <span class="token parameter">money</span> 金额
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">transfer</span><span class="token punctuation">(</span><span class="token class-name">String</span> out<span class="token punctuation">,</span><span class="token class-name">String</span> in <span class="token punctuation">,</span><span class="token class-name">Double</span> money<span class="token punctuation">)</span> <span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AccountServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">AccountService</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">AccountDao</span> accountDao<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">transfer</span><span class="token punctuation">(</span><span class="token class-name">String</span> out<span class="token punctuation">,</span><span class="token class-name">String</span> in <span class="token punctuation">,</span><span class="token class-name">Double</span> money<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        accountDao<span class="token punctuation">.</span><span class="token function">outMoney</span><span class="token punctuation">(</span>out<span class="token punctuation">,</span>money<span class="token punctuation">)</span><span class="token punctuation">;</span>
        accountDao<span class="token punctuation">.</span><span class="token function">inMoney</span><span class="token punctuation">(</span>in<span class="token punctuation">,</span>money<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>添加jdbc.properties文件</strong></p><div class="language-properties ext-properties line-numbers-mode"><pre class="language-properties"><code><span class="token key attr-name">jdbc.driver</span><span class="token punctuation">=</span><span class="token value attr-value">com.mysql.cj.jdbc.Driver</span>
<span class="token key attr-name">jdbc.url</span><span class="token punctuation">=</span><span class="token value attr-value">jdbc:mysql://localhost:3306/spring_db_transfer?useSSL=false</span>
<span class="token key attr-name">jdbc.username</span><span class="token punctuation">=</span><span class="token value attr-value">root</span>
<span class="token key attr-name">jdbc.password</span><span class="token punctuation">=</span><span class="token value attr-value">1234</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>创建SpringConfig配置类</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">//配置类注解</span>
<span class="token annotation punctuation">@Configuration</span>
<span class="token comment">//包扫描，主要扫描的是项目中的AccountServiceImpl类</span>
<span class="token annotation punctuation">@ComponentScan</span><span class="token punctuation">(</span><span class="token string">&quot;com.example&quot;</span><span class="token punctuation">)</span>
<span class="token comment">//加载配置jdbc文件</span>
<span class="token annotation punctuation">@PropertySource</span><span class="token punctuation">(</span><span class="token string">&quot;classpath:jdbc.properties&quot;</span><span class="token punctuation">)</span>
<span class="token comment">//读取外部配置文件</span>
<span class="token annotation punctuation">@Import</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token class-name">JdbcConfig</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span><span class="token class-name">MybatisConfig</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SpringConfig</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>创建JdbcConfig配置类</strong></p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>public class JdbcConfig {
    @Value(&quot;${jdbc.driver}&quot;)
    private String driver;
    @Value(&quot;${jdbc.url}&quot;)
    private String url;
    @Value(&quot;${jdbc.username}&quot;)
    private String userName;
    @Value(&quot;${jdbc.password}&quot;)
    private String password;

    @Bean
    public DataSource dataSource(){
        DruidDataSource ds = new DruidDataSource();
        ds.setDriverClassName(driver);
        ds.setUrl(url);
        ds.setUsername(userName);
        ds.setPassword(password);
        return ds;
    }
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>创建MybatisConfig配置类</strong></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MybatisConfig</span> <span class="token punctuation">{</span>
    <span class="token comment">//定义bean，SqlSessionFactoryBean，用于产生SqlSessionFactory对象</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">SqlSessionFactoryBean</span> <span class="token function">sqlSessionFactory</span><span class="token punctuation">(</span><span class="token class-name">DataSource</span> dataSource<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">SqlSessionFactoryBean</span> ssfb <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SqlSessionFactoryBean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//设置模型类的别名扫描</span>
        ssfb<span class="token punctuation">.</span><span class="token function">setTypeAliasesPackage</span><span class="token punctuation">(</span><span class="token string">&quot;com.example.domain&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//设置数据源</span>
        ssfb<span class="token punctuation">.</span><span class="token function">setDataSource</span><span class="token punctuation">(</span>dataSource<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> ssfb<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//定义bean，返回MapperScannerConfigurer对象</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">MapperScannerConfigurer</span> <span class="token function">mapperScannerConfigurer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">MapperScannerConfigurer</span> msc <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MapperScannerConfigurer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        msc<span class="token punctuation">.</span><span class="token function">setBasePackage</span><span class="token punctuation">(</span><span class="token string">&quot;com.example.dao&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> msc<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>编写主程序</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">ApplicationContext</span> ctx <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AnnotationConfigApplicationContext</span><span class="token punctuation">(</span><span class="token class-name">SpringConfig</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">AccountService</span> accountService <span class="token operator">=</span> ctx<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token class-name">AccountService</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        accountService<span class="token punctuation">.</span><span class="token function">transfer</span><span class="token punctuation">(</span><span class="token string">&quot;Tom&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Jerry&quot;</span><span class="token punctuation">,</span> <span class="token number">100D</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><h4 id="_6-1-4-事务管理" tabindex="-1"><a class="header-anchor" href="#_6-1-4-事务管理" aria-hidden="true">#</a> 6.1.4 事务管理</h4><p>上述环境，运行程序，会执行转账操作，<code>Tom</code>的账户会减少100，<code>Jerry</code>的账户会加100。</p><p>这是正常情况下的运行结果，但是如果在转账的过程中出现了异常，如:</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AccountServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">AccountService</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">AccountDao</span> accountDao<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">transfer</span><span class="token punctuation">(</span><span class="token class-name">String</span> out<span class="token punctuation">,</span><span class="token class-name">String</span> in <span class="token punctuation">,</span><span class="token class-name">Double</span> money<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        accountDao<span class="token punctuation">.</span><span class="token function">outMoney</span><span class="token punctuation">(</span>out<span class="token punctuation">,</span>money<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token operator">/</span><span class="token number">0</span><span class="token punctuation">;</span>
        accountDao<span class="token punctuation">.</span><span class="token function">inMoney</span><span class="token punctuation">(</span>in<span class="token punctuation">,</span>money<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这个时候就模拟了转账过程中出现异常的情况，正确的操作应该是转账出问题了，<code>Tom</code>应该还是900，<code>Jerry</code>应该还是1100，但是真正运行后会发现，并没有像我们想象的那样，<code>Tom</code>账户为800而<code>Jerry</code>还是1100,100块钱凭空消失了，银行乐疯了。如果把转账换个顺序，银行就该哭了。</p><p>不管哪种情况，都是不允许出现的，对刚才的结果我们做一个分析:</p><p>①：程序正常执行时，账户金额A减B加，没有问题</p><p>②：程序出现异常后，转账失败，但是异常之前操作成功，异常之后操作失败，整体业务失败</p><p>当程序出问题后，我们需要让事务进行回滚，而且这个事务应该是加在业务层上，而Spring的事务管理就是用来解决这类问题的。</p><h5 id="_6-1-4-1事务管理开发步骤" tabindex="-1"><a class="header-anchor" href="#_6-1-4-1事务管理开发步骤" aria-hidden="true">#</a> 6.1.4.1事务管理开发步骤</h5><ol><li><p><strong>在需要被事务管理的方法上添加注解</strong></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">AccountService</span> <span class="token punctuation">{</span>
    <span class="token doc-comment comment">/**
     * 转账操作
     * <span class="token keyword">@param</span> <span class="token parameter">out</span> 传出方
     * <span class="token keyword">@param</span> <span class="token parameter">in</span> 转入方
     * <span class="token keyword">@param</span> <span class="token parameter">money</span> 金额
     */</span>
    <span class="token comment">//配置当前接口方法具有事务</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">transfer</span><span class="token punctuation">(</span><span class="token class-name">String</span> out<span class="token punctuation">,</span><span class="token class-name">String</span> in <span class="token punctuation">,</span><span class="token class-name">Double</span> money<span class="token punctuation">)</span> <span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AccountServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">AccountService</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">AccountDao</span> accountDao<span class="token punctuation">;</span>
  
		<span class="token annotation punctuation">@Transactional</span>
  	<span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">transfer</span><span class="token punctuation">(</span><span class="token class-name">String</span> out<span class="token punctuation">,</span><span class="token class-name">String</span> in <span class="token punctuation">,</span><span class="token class-name">Double</span> money<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        accountDao<span class="token punctuation">.</span><span class="token function">outMoney</span><span class="token punctuation">(</span>out<span class="token punctuation">,</span>money<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token operator">/</span><span class="token number">0</span><span class="token punctuation">;</span>
        accountDao<span class="token punctuation">.</span><span class="token function">inMoney</span><span class="token punctuation">(</span>in<span class="token punctuation">,</span>money<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>注意:</strong></p><p>@Transactional可以写在接口类上、接口方法上、实现类上和实现类方法上</p><ul><li>写在接口类上，该接口的所有实现类的所有方法都会有事务</li><li>写在接口方法上，该接口的所有实现类的该方法都会有事务</li><li>写在实现类上，该类中的所有方法都会有事务</li><li>写在实现类方法上，该方法上有事务</li><li><strong>建议写在实现类或实现类的方法上</strong></li></ul></li><li><p><strong>在JdbcConfig类中配置事务管理器</strong></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JdbcConfig</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;${jdbc.driver}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> driver<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;${jdbc.url}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> url<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;${jdbc.username}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> userName<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;${jdbc.password}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> password<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">DataSource</span> <span class="token function">dataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">DruidDataSource</span> ds <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DruidDataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ds<span class="token punctuation">.</span><span class="token function">setDriverClassName</span><span class="token punctuation">(</span>driver<span class="token punctuation">)</span><span class="token punctuation">;</span>
        ds<span class="token punctuation">.</span><span class="token function">setUrl</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
        ds<span class="token punctuation">.</span><span class="token function">setUsername</span><span class="token punctuation">(</span>userName<span class="token punctuation">)</span><span class="token punctuation">;</span>
        ds<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span>password<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> ds<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//配置事务管理器，mybatis使用的是jdbc事务</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">PlatformTransactionManager</span> <span class="token function">transactionManager</span><span class="token punctuation">(</span><span class="token class-name">DataSource</span> dataSource<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">DataSourceTransactionManager</span> transactionManager <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataSourceTransactionManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        transactionManager<span class="token punctuation">.</span><span class="token function">setDataSource</span><span class="token punctuation">(</span>dataSource<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> transactionManager<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>**注意：**事务管理器要根据使用技术进行选择，Mybatis框架使用的是JDBC事务，可以直接使用<code>DataSourceTransactionManager</code></p></li><li><p><strong>开启事务注解</strong></p><p>在SpringConfig的配置类中开启</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">//配置类注解</span>
<span class="token annotation punctuation">@Configuration</span>
<span class="token comment">//包扫描，主要扫描的是项目中的AccountServiceImpl类</span>
<span class="token annotation punctuation">@ComponentScan</span><span class="token punctuation">(</span><span class="token string">&quot;com.example&quot;</span><span class="token punctuation">)</span>
<span class="token comment">//加载配置jdbc文件</span>
<span class="token annotation punctuation">@PropertySource</span><span class="token punctuation">(</span><span class="token string">&quot;classpath:jdbc.properties&quot;</span><span class="token punctuation">)</span>
<span class="token comment">//读取外部配置文件</span>
<span class="token annotation punctuation">@Import</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token class-name">JdbcConfig</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span><span class="token class-name">MybatisConfig</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">//开启注解式事务驱动</span>
<span class="token annotation punctuation">@EnableTransactionManagement</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SpringConfig</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><p>再次运行，会发现在转换的业务出现错误后，事务就可以控制回滚，保证数据的正确性。</p><h5 id="enabletransactionmanagement" tabindex="-1"><a class="header-anchor" href="#enabletransactionmanagement" aria-hidden="true">#</a> @EnableTransactionManagement</h5><table><thead><tr><th>名称</th><th>@EnableTransactionManagement</th></tr></thead><tbody><tr><td>类型</td><td>配置类注解</td></tr><tr><td>位置</td><td>配置类定义上方</td></tr><tr><td>作用</td><td>设置当前Spring环境中开启注解式事务支持</td></tr></tbody></table><h5 id="transactional" tabindex="-1"><a class="header-anchor" href="#transactional" aria-hidden="true">#</a> @Transactional</h5><table><thead><tr><th>名称</th><th>@Transactional</th></tr></thead><tbody><tr><td>类型</td><td>接口注解 类注解 方法注解</td></tr><tr><td>位置</td><td>业务层接口上方 业务层实现类上方 业务方法上方</td></tr><tr><td>作用</td><td>为当前业务层方法添加事务（如果设置在类或接口上方则类或接口中所有方法均添加事务）</td></tr></tbody></table><h2 id="_6-2-spring事务角色" tabindex="-1"><a class="header-anchor" href="#_6-2-spring事务角色" aria-hidden="true">#</a> 6.2 Spring事务角色</h2><p>这节中我们重点要理解两个概念，分别是<code>事务管理员</code>和<code>事务协调员</code>。</p><ol><li><p>未开启Spring事务之前:</p><p><img src="https://gitee.com/xiaweifeng/picgo/raw/master/images/202208241710803.png" alt="1630248794837"></p><ul><li>AccountDao的outMoney因为是修改操作，会开启一个事务T1</li><li>AccountDao的inMoney因为是修改操作，会开启一个事务T2</li><li>AccountService的transfer没有事务， <ul><li>运行过程中如果没有抛出异常，则T1和T2都正常提交，数据正确</li><li>如果在两个方法中间抛出异常，T1因为执行成功提交事务，T2因为抛异常不会被执行</li><li>就会导致数据出现错误</li></ul></li></ul></li><li><p>开启Spring的事务管理后</p><p><img src="https://gitee.com/xiaweifeng/picgo/raw/master/images/202208241710804.png" alt="1630249111055"></p><ul><li>transfer上添加了@Transactional注解，在该方法上就会有一个事务T</li><li>AccountDao的outMoney方法的事务T1加入到transfer的事务T中</li><li>AccountDao的inMoney方法的事务T2加入到transfer的事务T中</li><li>这样就保证他们在同一个事务中，当业务层中出现异常，整个事务就会回滚，保证数据的准确性。</li></ul><p>通过上面例子的分析，我们就可以得到如下概念:</p><ul><li>事务管理员：发起事务方，在Spring中通常指代业务层开启事务的方法</li><li>事务协调员：加入事务方，在Spring中通常指代数据层方法，也可以是业务层方法</li></ul><p><strong>注意:</strong></p><p>目前的事务管理是基于<code>DataSourceTransactionManager</code>和<code>SqlSessionFactoryBean</code>使用的是同一个数据源。</p></li></ol><h3 id="_6-3-spring事务属性" tabindex="-1"><a class="header-anchor" href="#_6-3-spring事务属性" aria-hidden="true">#</a> 6.3 Spring事务属性</h3><p>上一节我们介绍了两个概念，事务的管理员和事务的协同员，对于这两个概念具体做什么的，我们待会通过案例来使用下。除了这两个概念，还有就是事务的其他相关配置都有哪些，就是我们接下来要学习的内容。</p><p>在这一节中，我们主要学习三部分内容<code>事务配置</code>、<code>转账业务追加日志</code>、<code>事务传播行为</code>。</p><h4 id="_6-3-1-事务配置" tabindex="-1"><a class="header-anchor" href="#_6-3-1-事务配置" aria-hidden="true">#</a> 6.3.1 事务配置</h4><p><img src="https://gitee.com/xiaweifeng/picgo/raw/master/images/202208241710805.png" alt="1630250069844"></p><p>上面这些属性都可以在<code>@Transactional</code>注解的参数上进行设置。</p><ul><li><p>readOnly：true只读事务，false读写事务，增删改要设为false,查询设为true。</p></li><li><p>timeout:设置超时时间单位秒，在多长时间之内事务没有提交成功就自动回滚，-1表示不设置超时时间。</p></li><li><p>rollbackFor:当出现指定异常进行事务回滚</p></li><li><p>noRollbackFor:当出现指定异常不进行事务回滚</p><ul><li><p>思考:出现异常事务会自动回滚，这个是我们之前就已经知道的</p></li><li><p>noRollbackFor是设定对于指定的异常不回滚，这个好理解</p></li><li><p>rollbackFor是指定回滚异常，对于异常事务不应该都回滚么，为什么还要指定?</p><ul><li><p>这块需要更正一个知识点，并不是所有的异常都会回滚事务，比如下面的代码就不会回滚</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">AccountService</span> <span class="token punctuation">{</span>
    <span class="token doc-comment comment">/**
     * 转账操作
     * <span class="token keyword">@param</span> <span class="token parameter">out</span> 传出方
     * <span class="token keyword">@param</span> <span class="token parameter">in</span> 转入方
     * <span class="token keyword">@param</span> <span class="token parameter">money</span> 金额
     */</span>
    <span class="token comment">//配置当前接口方法具有事务</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">transfer</span><span class="token punctuation">(</span><span class="token class-name">String</span> out<span class="token punctuation">,</span><span class="token class-name">String</span> in <span class="token punctuation">,</span><span class="token class-name">Double</span> money<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AccountServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">AccountService</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">AccountDao</span> accountDao<span class="token punctuation">;</span>
	<span class="token annotation punctuation">@Transactional</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">transfer</span><span class="token punctuation">(</span><span class="token class-name">String</span> out<span class="token punctuation">,</span><span class="token class-name">String</span> in <span class="token punctuation">,</span><span class="token class-name">Double</span> money<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">{</span>
        accountDao<span class="token punctuation">.</span><span class="token function">outMoney</span><span class="token punctuation">(</span>out<span class="token punctuation">,</span>money<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//int i = 1/0; //这个异常事务会回滚</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IOException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//这个异常事务就不会回滚</span>
        <span class="token punctuation">}</span>
        accountDao<span class="token punctuation">.</span><span class="token function">inMoney</span><span class="token punctuation">(</span>in<span class="token punctuation">,</span>money<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul></li></ul></li><li><p>出现这个问题的原因是，Spring的事务只会对<code>Error异常</code>和<code>RuntimeException异常</code>及其子类进行事务回顾，其他的异常类型是不会回滚的，对应IOException不符合上述条件所以不回滚</p><ul><li><p>此时就可以使用rollbackFor属性来设置出现IOException异常不回滚</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AccountServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">AccountService</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">AccountDao</span> accountDao<span class="token punctuation">;</span>
	 <span class="token annotation punctuation">@Transactional</span><span class="token punctuation">(</span>rollbackFor <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token class-name">IOException</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">transfer</span><span class="token punctuation">(</span><span class="token class-name">String</span> out<span class="token punctuation">,</span><span class="token class-name">String</span> in <span class="token punctuation">,</span><span class="token class-name">Double</span> money<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">{</span>
        accountDao<span class="token punctuation">.</span><span class="token function">outMoney</span><span class="token punctuation">(</span>out<span class="token punctuation">,</span>money<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//int i = 1/0; //这个异常事务会回滚</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IOException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//这个异常事务就不会回滚</span>
        <span class="token punctuation">}</span>
        accountDao<span class="token punctuation">.</span><span class="token function">inMoney</span><span class="token punctuation">(</span>in<span class="token punctuation">,</span>money<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul></li><li><p>rollbackForClassName等同于rollbackFor,只不过属性为异常的类全名字符串</p></li><li><p>noRollbackForClassName等同于noRollbackFor，只不过属性为异常的类全名字符串</p></li><li><p>isolation设置事务的隔离级别</p><ul><li>DEFAULT :默认隔离级别, 会采用数据库的隔离级别</li><li>READ_UNCOMMITTED : 读未提交</li><li>READ_COMMITTED : 读已提交</li><li>REPEATABLE_READ : 重复读取</li><li>SERIALIZABLE: 串行化</li></ul></li></ul><p>介绍完上述属性后，还有最后一个事务的传播行为，为了讲解该属性的设置，我们需要完成下面的案例。</p><h4 id="_6-3-2-转账业务追加日志案例" tabindex="-1"><a class="header-anchor" href="#_6-3-2-转账业务追加日志案例" aria-hidden="true">#</a> 6.3.2 转账业务追加日志案例</h4><h5 id="_6-3-2-1-需求分析" tabindex="-1"><a class="header-anchor" href="#_6-3-2-1-需求分析" aria-hidden="true">#</a> 6.3.2.1 需求分析</h5><p>在前面的转案例的基础上添加新的需求，完成转账后记录日志。</p><ul><li>需求：实现任意两个账户间转账操作，并对每次转账操作在数据库进行留痕</li><li>需求微缩：A账户减钱，B账户加钱，数据库记录日志</li></ul><p>基于上述的业务需求，我们来分析下该如何实现:</p><p>①：基于转账操作案例添加日志模块，实现数据库中记录日志</p><p>②：业务层转账操作（transfer），调用减钱、加钱与记录日志功能</p><p>需要注意一点就是，我们这个案例的预期效果为:</p><p><strong>无论转账操作是否成功，均进行转账操作的日志留痕</strong></p><h5 id="_6-3-2-2-环境准备" tabindex="-1"><a class="header-anchor" href="#_6-3-2-2-环境准备" aria-hidden="true">#</a> 6.3.2.2 环境准备</h5><p>该环境是基于转账环境来完成的，在其基础上，我们继续往下写</p><ol><li><strong>创建日志表</strong></li></ol><div class="language-sql ext-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">create</span> <span class="token keyword">table</span> tbl_log<span class="token punctuation">(</span>
   id <span class="token keyword">int</span> <span class="token keyword">primary</span> <span class="token keyword">key</span> <span class="token keyword">auto_increment</span><span class="token punctuation">,</span>
   info <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
   createDate <span class="token keyword">datetime</span>
<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li><strong>添加LogDao接口</strong></li></ol><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">LogDao</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Insert</span><span class="token punctuation">(</span><span class="token string">&quot;insert into tbl_log (info,createDate) values(#{info},now())&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">void</span> <span class="token function">log</span><span class="token punctuation">(</span><span class="token class-name">String</span> info<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="3"><li><strong>添加LogService接口与实现类</strong></li></ol><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">LogService</span> <span class="token punctuation">{</span>
    <span class="token keyword">void</span> <span class="token function">log</span><span class="token punctuation">(</span><span class="token class-name">String</span> out<span class="token punctuation">,</span> <span class="token class-name">String</span> in<span class="token punctuation">,</span> <span class="token class-name">Double</span> money<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LogServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">LogService</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">LogDao</span> logDao<span class="token punctuation">;</span>
	<span class="token annotation punctuation">@Transactional</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">log</span><span class="token punctuation">(</span><span class="token class-name">String</span> out<span class="token punctuation">,</span><span class="token class-name">String</span> in<span class="token punctuation">,</span><span class="token class-name">Double</span> money <span class="token punctuation">)</span> <span class="token punctuation">{</span>
        logDao<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;转账操作由&quot;</span><span class="token operator">+</span>out<span class="token operator">+</span><span class="token string">&quot;到&quot;</span><span class="token operator">+</span>in<span class="token operator">+</span><span class="token string">&quot;,金额：&quot;</span><span class="token operator">+</span>money<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="4"><li><strong>在转账的业务中添加记录日志</strong></li></ol><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">AccountService</span> <span class="token punctuation">{</span>
    <span class="token doc-comment comment">/**
     * 转账操作
     * <span class="token keyword">@param</span> <span class="token parameter">out</span> 传出方
     * <span class="token keyword">@param</span> <span class="token parameter">in</span> 转入方
     * <span class="token keyword">@param</span> <span class="token parameter">money</span> 金额
     */</span>
    <span class="token comment">//配置当前接口方法具有事务</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">transfer</span><span class="token punctuation">(</span><span class="token class-name">String</span> out<span class="token punctuation">,</span><span class="token class-name">String</span> in <span class="token punctuation">,</span><span class="token class-name">Double</span> money<span class="token punctuation">)</span><span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AccountServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">AccountService</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">AccountDao</span> accountDao<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">LogService</span> logService<span class="token punctuation">;</span>
	<span class="token annotation punctuation">@Transactional</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">transfer</span><span class="token punctuation">(</span><span class="token class-name">String</span> out<span class="token punctuation">,</span><span class="token class-name">String</span> in <span class="token punctuation">,</span><span class="token class-name">Double</span> money<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span><span class="token punctuation">{</span>
            accountDao<span class="token punctuation">.</span><span class="token function">outMoney</span><span class="token punctuation">(</span>out<span class="token punctuation">,</span>money<span class="token punctuation">)</span><span class="token punctuation">;</span>
            accountDao<span class="token punctuation">.</span><span class="token function">inMoney</span><span class="token punctuation">(</span>in<span class="token punctuation">,</span>money<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">finally</span> <span class="token punctuation">{</span>
            logService<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>out<span class="token punctuation">,</span>in<span class="token punctuation">,</span>money<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="5"><li>运行程序</li></ol><ul><li><p>当程序正常运行，tbl_account表中转账成功，tbl_log表中日志记录成功</p></li><li><p>当转账业务之间出现异常(int i =1/0),转账失败，tbl_account成功回滚，但是tbl_log表未添加数据</p></li><li><p>这个结果和我们想要的不一样，什么原因?该如何解决?</p></li><li><p>失败原因:<strong>日志的记录与转账操作隶属同一个事务，同成功同失败</strong></p></li><li><p>最终效果:无论转账操作是否成功，日志必须保留</p></li></ul><h4 id="_6-3-3-事务传播行为" tabindex="-1"><a class="header-anchor" href="#_6-3-3-事务传播行为" aria-hidden="true">#</a> 6.3.3 事务传播行为</h4><p><img src="https://gitee.com/xiaweifeng/picgo/raw/master/images/202208241710806.png" alt="1630253779575"></p><p>对于上述案例的分析:</p><ul><li>log方法、inMoney方法和outMoney方法都属于增删改，分别有事务T1,T2,T3</li><li>transfer因为加了@Transactional注解，也开启了事务T</li><li>前面我们讲过Spring事务会把T1,T2,T3都加入到事务T中</li><li>所以当转账失败后，所有的事务都回滚，导致日志没有记录下来</li><li>这和我们的需求不符，这个时候我们就想能不能让log方法单独是一个事务呢?</li></ul><p>要想解决这个问题，就需要用到事务传播行为，所谓的事务传播行为指的是:</p><p>事务传播行为：事务协调员对事务管理员所携带事务的处理态度。</p><p>具体如何解决，就需要用到之前我们没有说的<code>propagation属性</code>。</p><h5 id="改变事务的传播行为" tabindex="-1"><a class="header-anchor" href="#改变事务的传播行为" aria-hidden="true">#</a> 改变事务的传播行为</h5><p>修改logService改变事务的传播行为</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LogServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">LogService</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">LogDao</span> logDao<span class="token punctuation">;</span>
	<span class="token comment">//propagation设置事务属性：传播行为设置为当前操作需要新事务</span>
    <span class="token annotation punctuation">@Transactional</span><span class="token punctuation">(</span>propagation <span class="token operator">=</span> <span class="token class-name">Propagation</span><span class="token punctuation">.</span><span class="token constant">REQUIRES_NEW</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">log</span><span class="token punctuation">(</span><span class="token class-name">String</span> out<span class="token punctuation">,</span><span class="token class-name">String</span> in<span class="token punctuation">,</span><span class="token class-name">Double</span> money <span class="token punctuation">)</span> <span class="token punctuation">{</span>
        logDao<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;转账操作由&quot;</span><span class="token operator">+</span>out<span class="token operator">+</span><span class="token string">&quot;到&quot;</span><span class="token operator">+</span>in<span class="token operator">+</span><span class="token string">&quot;,金额：&quot;</span><span class="token operator">+</span>money<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>运行后，就能实现我们想要的结果，不管转账是否成功，都会记录日志。</p><h5 id="事务传播行为的可选值" tabindex="-1"><a class="header-anchor" href="#事务传播行为的可选值" aria-hidden="true">#</a> 事务传播行为的可选值</h5><p><img src="https://gitee.com/xiaweifeng/picgo/raw/master/images/202208241710807.png" alt="1630254257628"></p><p>对于我们开发实际中使用的话，因为默认值需要事务是常态的。根据开发过程选择其他的就可以了，例如案例中需要新事务就需要手工配置。其实入账和出账操作上也有事务，采用的就是默认值。</p></div><!--[--><!--]--></div><footer class="page-meta"><div class="meta-item edit-link"><a class="external-link meta-item-label" href="https://gitee.com/xiaweifeng/vuepress-source/edit/master/docs/Java后端/03SSM/01Spring/day03/Spring-day03.md" rel="noopener noreferrer" target="_blank" aria-label="在Gitee上编辑此页"><!--[--><!--]--> 在Gitee上编辑此页 <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><div class="meta-item last-updated"><span class="meta-item-label">上次更新: </span><!----></div><div class="meta-item contributors"><span class="meta-item-label">贡献者: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: xiaweifeng@live.cn">夏一次</span><!----><!--]--><!--]--></span></div></footer><!----><!--[--><!--[--><div class="giscus-wrapper input-top" style="display:block;"><div style="text-align:center">Loading...</div></div><!--]--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/assets/app.3924f47e.js" defer></script>
  </body>
</html>
