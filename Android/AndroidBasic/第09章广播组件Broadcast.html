<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.49">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <meta property="og:url" content="http://ahhwxx.51vip.biz:81/Android/AndroidBasic/%E7%AC%AC09%E7%AB%A0%E5%B9%BF%E6%92%AD%E7%BB%84%E4%BB%B6Broadcast.html"><meta property="og:site_name" content="Hades"><meta property="og:title" content="第 9 章　广播组件Broadcast"><meta property="og:type" content="article"><meta property="og:updated_time" content="2022-08-23T15:30:31.000Z"><meta property="og:locale" content="zh-CN"><meta property="article:modified_time" content="2022-08-23T15:30:31.000Z"><script>
      (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?c6cfefc03bedbb2803a5cad020e7faaa";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);})();
     </script><link rel="icon" type="image/png" sizes="16x16" href="/images/icons/favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/icons/favicon-32x32.png"><link rel="manifest" href="/manifest.webmanifest"><meta name="application-name" content="VuePress"><meta name="referrer" content="no-referrer"><meta name="apple-mobile-web-app-title" content="VuePress"><meta name="apple-mobile-web-app-status-bar-style" content="black"><link rel="apple-touch-icon" href="https://www.vuepress.cn/icons/apple-touch-icon-152x152.png"><link rel="mask-icon" href="/images/icons/safari-pinned-tab.svg" color="#3eaf7c"><meta name="msapplication-TileColor" content="#3eaf7c"><meta name="theme-color" content="#3eaf7c"><title>第 9 章　广播组件Broadcast | Hades</title><meta name="description" content="这是一本笔记，用于记录编程过程中的知识点">
    <link rel="modulepreload" href="/assets/app.166c275a.js"><link rel="modulepreload" href="/assets/第09章广播组件Broadcast.html.577b445d.js"><link rel="modulepreload" href="/assets/第09章广播组件Broadcast.html.55914a19.js"><link rel="prefetch" href="/assets/index.html.f8911b23.js"><link rel="prefetch" href="/assets/index.html.a9e81c7e.js"><link rel="prefetch" href="/assets/index.html.443d7f36.js"><link rel="prefetch" href="/assets/Mac下mongodb安装和配置.html.26410259.js"><link rel="prefetch" href="/assets/Mac下命令行配置环境变量.html.819e9133.js"><link rel="prefetch" href="/assets/Mac全自动安装brew一键配置国内镜像源.html.e772a006.js"><link rel="prefetch" href="/assets/Mac终端命令记录.html.7783b931.js"><link rel="prefetch" href="/assets/Nginx搭建HTTPS，并反向代理到web页面_mkcert生成本地SSL证书.html.2ec6bdb0.js"><link rel="prefetch" href="/assets/PDF转Markdown文件.html.8d6aa7c7.js"><link rel="prefetch" href="/assets/index.html.287a9117.js"><link rel="prefetch" href="/assets/VSCode使用记录.html.bda23559.js"><link rel="prefetch" href="/assets/docsearch全站搜索.html.49031418.js"><link rel="prefetch" href="/assets/idea插件分享.html.e58d2459.js"><link rel="prefetch" href="/assets/jetbrains全家桶激活策略.html.df8b794f.js"><link rel="prefetch" href="/assets/中华人民共和国劳动合同法.html.2b81f95a.js"><link rel="prefetch" href="/assets/浅谈文言文与英语语法的相似点.html.995d875f.js"><link rel="prefetch" href="/assets/面向AI开发.html.5b10e32c.js"><link rel="prefetch" href="/assets/鸿蒙3安装apk无须登录.html.022a3044.js"><link rel="prefetch" href="/assets/index.html.fada5771.js"><link rel="prefetch" href="/assets/index.html.991c904f.js"><link rel="prefetch" href="/assets/aboutme.html.69269699.js"><link rel="prefetch" href="/assets/FRP内网穿透搭建(无域名版).html.35eb25da.js"><link rel="prefetch" href="/assets/index.html.e05a7130.js"><link rel="prefetch" href="/assets/linux前端项目部署.html.c4bd21bc.js"><link rel="prefetch" href="/assets/linux环境变量配置错误后命令无法使用解决方案.html.c691ac65.js"><link rel="prefetch" href="/assets/内网穿透工具比较.html.d269d218.js"><link rel="prefetch" href="/assets/在CentOS上搭建Samba服务器.html.128449fb.js"><link rel="prefetch" href="/assets/index.html.f3e49817.js"><link rel="prefetch" href="/assets/第01章Android开发环境搭建.html.f46eddba.js"><link rel="prefetch" href="/assets/第02章AndroidApp开发基础.html.43b79d60.js"><link rel="prefetch" href="/assets/第03章简单控件.html.511eb9ca.js"><link rel="prefetch" href="/assets/第04章活动Activity.html.71c6fee4.js"><link rel="prefetch" href="/assets/第05章中级控件.html.0a00ebf3.js"><link rel="prefetch" href="/assets/第06章数据存储.html.269fd7a2.js"><link rel="prefetch" href="/assets/第07章内容共享.html.175369bb.js"><link rel="prefetch" href="/assets/第08章高级控件.html.445f1900.js"><link rel="prefetch" href="/assets/第10章自定义控件.html.91afbf6d.js"><link rel="prefetch" href="/assets/AndroidStudio代理问题Connect.html.dab34393.js"><link rel="prefetch" href="/assets/AndroidStudio打包aar丢失远程依赖问题解决.html.a115c6e1.js"><link rel="prefetch" href="/assets/AndroidStudio登录google账号失败问题.html.d8661fad.js"><link rel="prefetch" href="/assets/Apk应用重签名—使用AndroidStudio自带工具apksigner.html.46bf7dab.js"><link rel="prefetch" href="/assets/不常用的ADB命令.html.d0a649da.js"><link rel="prefetch" href="/assets/01MySQL精简笔记.html.f3b83ace.js"><link rel="prefetch" href="/assets/02JDBC.html.47dcd1b9.js"><link rel="prefetch" href="/assets/03Maven.html.a6a998b3.js"><link rel="prefetch" href="/assets/04Mybatis.html.4853489e.js"><link rel="prefetch" href="/assets/05网页三剑客.html.69ec6918.js"><link rel="prefetch" href="/assets/06HTTP_Tomcat_Servlet.html.0ba4a96a.js"><link rel="prefetch" href="/assets/07Request_Response.html.75d6284c.js"><link rel="prefetch" href="/assets/08JSP.html.35700bfa.js"><link rel="prefetch" href="/assets/09Cookie_Session.html.6aea4067.js"><link rel="prefetch" href="/assets/10Filter_Listener_Ajax.html.9dfbf7b9.js"><link rel="prefetch" href="/assets/11Vue_Element.html.1966c648.js"><link rel="prefetch" href="/assets/12综合案例.html.5f95bc3d.js"><link rel="prefetch" href="/assets/index.html.d212be0c.js"><link rel="prefetch" href="/assets/POM文件帮助文档.html.81be4d59.js"><link rel="prefetch" href="/assets/index.html.424f11e3.js"><link rel="prefetch" href="/assets/index.html.36a503c1.js"><link rel="prefetch" href="/assets/index.html.ceee3cb5.js"><link rel="prefetch" href="/assets/index.html.b0020a33.js"><link rel="prefetch" href="/assets/index.html.c810cee8.js"><link rel="prefetch" href="/assets/index.html.b5c28815.js"><link rel="prefetch" href="/assets/index.html.12a5c12e.js"><link rel="prefetch" href="/assets/index.html.776ff0eb.js"><link rel="prefetch" href="/assets/index.html.aae3b646.js"><link rel="prefetch" href="/assets/index.html.4167b5c2.js"><link rel="prefetch" href="/assets/request.getInputStream只能读取一次问题.html.bd2c58f7.js"><link rel="prefetch" href="/assets/程序包com.alibaba.fastjson不存在.html.6944a42c.js"><link rel="prefetch" href="/assets/错误集合.html.aa7ecbd5.js"><link rel="prefetch" href="/assets/index.html.d93e5d1b.js"><link rel="prefetch" href="/assets/index.html.6074a4b2.js"><link rel="prefetch" href="/assets/index.html.126230e0.js"><link rel="prefetch" href="/assets/index.html.d984d618.js"><link rel="prefetch" href="/assets/Node多版本管理.html.b9ac5171.js"><link rel="prefetch" href="/assets/index.html.1d6f705e.js"><link rel="prefetch" href="/assets/Web调试入门.html.19e0c86f.js"><link rel="prefetch" href="/assets/关于ESLInk配置问题.html.8fde72e0.js"><link rel="prefetch" href="/assets/index.html.80ab1fc5.js"><link rel="prefetch" href="/assets/MySQL-基础篇.html.983a0f90.js"><link rel="prefetch" href="/assets/Maven高级.html.b2a9f6f0.js"><link rel="prefetch" href="/assets/SpringBoot.html.4ff0296d.js"><link rel="prefetch" href="/assets/MyBatisPlus.html.142a22d5.js"><link rel="prefetch" href="/assets/RestTemplate.html.64604077.js"><link rel="prefetch" href="/assets/Dubbo详解.html.5962e998.js"><link rel="prefetch" href="/assets/Mac下ZooKeeper安装和使用.html.c1a51bab.js"><link rel="prefetch" href="/assets/Zookeeper集群搭建.html.0658289e.js"><link rel="prefetch" href="/assets/传智健康项目讲义（第10章）.html.9c4c35b4.js"><link rel="prefetch" href="/assets/传智健康项目讲义（第11章）.html.db35024a.js"><link rel="prefetch" href="/assets/传智健康项目讲义（第12章）.html.d8b70e69.js"><link rel="prefetch" href="/assets/传智健康项目讲义（第13章）.html.88609c9b.js"><link rel="prefetch" href="/assets/传智健康项目讲义（第1章）.html.ae3266c6.js"><link rel="prefetch" href="/assets/传智健康项目讲义（第2章）.html.f1261d89.js"><link rel="prefetch" href="/assets/传智健康项目讲义（第3章）.html.d3f7bede.js"><link rel="prefetch" href="/assets/传智健康项目讲义（第4章）.html.0858459d.js"><link rel="prefetch" href="/assets/传智健康项目讲义（第5章）.html.e5198ebf.js"><link rel="prefetch" href="/assets/传智健康项目讲义（第6章）.html.b8d47289.js"><link rel="prefetch" href="/assets/传智健康项目讲义（第7章）.html.f77134ee.js"><link rel="prefetch" href="/assets/传智健康项目讲义（第8章）.html.70dd80b1.js"><link rel="prefetch" href="/assets/传智健康项目讲义（第9章）.html.bfca520b.js"><link rel="prefetch" href="/assets/SpringBoot讲义.html.83e4fdfd.js"><link rel="prefetch" href="/assets/Linux-Day01.html.253e571d.js"><link rel="prefetch" href="/assets/Linux-Day02.html.63f777ab.js"><link rel="prefetch" href="/assets/Redis基础.html.f0710ded.js"><link rel="prefetch" href="/assets/Git课程讲义.html.fc0326a7.js"><link rel="prefetch" href="/assets/瑞吉外卖-Day01.html.344d54ae.js"><link rel="prefetch" href="/assets/瑞吉外卖-Day02.html.74ffa222.js"><link rel="prefetch" href="/assets/瑞吉外卖-Day03.html.4c736155.js"><link rel="prefetch" href="/assets/瑞吉外卖-Day04.html.8c5f7db1.js"><link rel="prefetch" href="/assets/瑞吉外卖-Day05.html.14d78f2f.js"><link rel="prefetch" href="/assets/瑞吉外卖-Day06.html.9125ab2f.js"><link rel="prefetch" href="/assets/瑞吉外卖优化-Day01.html.e9fc7f33.js"><link rel="prefetch" href="/assets/瑞吉外卖优化-Day02.html.74275047.js"><link rel="prefetch" href="/assets/瑞吉外卖优化-Day03.html.ce58aedd.js"><link rel="prefetch" href="/assets/微服务常见面试题.html.70a444e5.js"><link rel="prefetch" href="/assets/错误笔记.html.7f90044a.js"><link rel="prefetch" href="/assets/day01-HTML基础.html.83b374e8.js"><link rel="prefetch" href="/assets/day02-HTML进阶.html.4cf33ed8.js"><link rel="prefetch" href="/assets/day03-CSS基础.html.31fc73fd.js"><link rel="prefetch" href="/assets/day04-CSS进阶.html.16c20095.js"><link rel="prefetch" href="/assets/day05-盒子模型.html.961b8487.js"><link rel="prefetch" href="/assets/day06-Flex布局.html.75b59be8.js"><link rel="prefetch" href="/assets/day07-学成在线.html.a86b7b85.js"><link rel="prefetch" href="/assets/day08-CSS高级.html.27296862.js"><link rel="prefetch" href="/assets/day09-小兔鲜儿.html.1d86acad.js"><link rel="prefetch" href="/assets/day10-小兔鲜儿.html.d020dbbe.js"><link rel="prefetch" href="/assets/Day01-项目介绍及初始化-登录页面.html.e11fbd08.js"><link rel="prefetch" href="/assets/Day02-登录模块-主页鉴权.html.ead08a87.js"><link rel="prefetch" href="/assets/Day03-主页模块-修改密码.html.9b5309ed.js"><link rel="prefetch" href="/assets/Day04-组织架构.html.88c5500c.js"><link rel="prefetch" href="/assets/Day05-组织架构-角色管理.html.9fa7b208.js"><link rel="prefetch" href="/assets/Day06-角色管理-员工管理.html.dde328cc.js"><link rel="prefetch" href="/assets/Day07-员工管理-上传下载.html.06c2dac0.js"><link rel="prefetch" href="/assets/Day08-Cos上传和权限数据.html.bb1e1952.js"><link rel="prefetch" href="/assets/Day09-权限应用-首页.html.921e93d9.js"><link rel="prefetch" href="/assets/Day10-首页图表-Nginx上线.html.3d9cf349.js"><link rel="prefetch" href="/assets/1.Vue3入门.html.7a3e0d8a.js"><link rel="prefetch" href="/assets/10.购物车.html.20ea2ead.js"><link rel="prefetch" href="/assets/11.订单页.html.bc6d8649.js"><link rel="prefetch" href="/assets/12.支付页.html.d40cfeb4.js"><link rel="prefetch" href="/assets/13.会员中心.html.5fe719d8.js"><link rel="prefetch" href="/assets/14.拓展部分.html.035d5c83.js"><link rel="prefetch" href="/assets/2.Pinia入门.html.b2c06181.js"><link rel="prefetch" href="/assets/3.项目起步.html.dcb305d1.js"><link rel="prefetch" href="/assets/4.Layout页.html.05996fb4.js"><link rel="prefetch" href="/assets/5.Home页.html.d45d0a35.js"><link rel="prefetch" href="/assets/6.一级分类页.html.5eea439d.js"><link rel="prefetch" href="/assets/7.二级分类页.html.fe7411e1.js"><link rel="prefetch" href="/assets/8.商品详情.html.d409a15f.js"><link rel="prefetch" href="/assets/9.登录页.html.f44613c3.js"><link rel="prefetch" href="/assets/day01.html.fbe0c77d.js"><link rel="prefetch" href="/assets/day02.html.bf57e82f.js"><link rel="prefetch" href="/assets/day03.html.3f87b87d.js"><link rel="prefetch" href="/assets/index.html.ecf4772f.js"><link rel="prefetch" href="/assets/day01.html.351f5439.js"><link rel="prefetch" href="/assets/day02.html.9033a479.js"><link rel="prefetch" href="/assets/day03.html.bc46a39c.js"><link rel="prefetch" href="/assets/day04.html.32a035a0.js"><link rel="prefetch" href="/assets/index.html.13abadda.js"><link rel="prefetch" href="/assets/interview-base.html.d0e3b5ce.js"><link rel="prefetch" href="/assets/interview-enjoy-plus.html.b2fc38f7.js"><link rel="prefetch" href="/assets/课堂笔记.html.73cc0644.js"><link rel="prefetch" href="/assets/课堂笔记.html.3411ecb3.js"><link rel="prefetch" href="/assets/Redis基础篇.html.4f17ecfc.js"><link rel="prefetch" href="/assets/Redis快速入门.html.176c3209.js"><link rel="prefetch" href="/assets/Redis实战篇.html.c0446a1e.js"><link rel="prefetch" href="/assets/Redis原理篇.html.ff47cd6d.js"><link rel="prefetch" href="/assets/Spring-day01.html.2591c6f9.js"><link rel="prefetch" href="/assets/Spring-day02.html.a3938deb.js"><link rel="prefetch" href="/assets/Spring-day03.html.27a0461c.js"><link rel="prefetch" href="/assets/SpringMVC-day01.html.f39177c9.js"><link rel="prefetch" href="/assets/SpringMVC-day02.html.92cd2e7a.js"><link rel="prefetch" href="/assets/错误笔记.html.ce11b667.js"><link rel="prefetch" href="/assets/SpringBootStart.html.e28c8523.js"><link rel="prefetch" href="/assets/SpringBoot整合SSMP.html.0a5bad92.js"><link rel="prefetch" href="/assets/SpringBoot综合案例.html.d254b936.js"><link rel="prefetch" href="/assets/SpringBoot讲义.html.170aeb64.js"><link rel="prefetch" href="/assets/SpringBoot讲义.html.bf5adc8a.js"><link rel="prefetch" href="/assets/Centos8-stream在真机上安装排坑.html.c1b5bffc.js"><link rel="prefetch" href="/assets/Centos9安装mysql.html.97318a7b.js"><link rel="prefetch" href="/assets/SpringCloud01.html.4c0913ab.js"><link rel="prefetch" href="/assets/SpringCloud实用篇02.html.6748f69e.js"><link rel="prefetch" href="/assets/Docker实用篇.html.f390c0e6.js"><link rel="prefetch" href="/assets/RabbitMQ.html.34befdb9.js"><link rel="prefetch" href="/assets/分布式搜索引擎01.html.e99c3207.js"><link rel="prefetch" href="/assets/分布式搜索引擎02.html.298d8dd9.js"><link rel="prefetch" href="/assets/分布式搜索引擎03.html.8f8df2d8.js"><link rel="prefetch" href="/assets/微服务保护.html.fb6f3406.js"><link rel="prefetch" href="/assets/分布式事务.html.8d42dced.js"><link rel="prefetch" href="/assets/分布式缓存.html.e5b2328f.js"><link rel="prefetch" href="/assets/多级缓存.html.1109e04b.js"><link rel="prefetch" href="/assets/RabbitMQ-高级篇.html.068e81ba.js"><link rel="prefetch" href="/assets/Mybatis第一天.html.d17fcb40.js"><link rel="prefetch" href="/assets/Mybatis第二天.html.1b60549f.js"><link rel="prefetch" href="/assets/移动web第一天.html.5386e935.js"><link rel="prefetch" href="/assets/移动Web第二天.html.a21706f0.js"><link rel="prefetch" href="/assets/移动Web第三天.html.54675ebf.js"><link rel="prefetch" href="/assets/移动Web第四天.html.f0cfeb65.js"><link rel="prefetch" href="/assets/移动Web第五天.html.d8a669d2.js"><link rel="prefetch" href="/assets/JavaScript基础第一天.html.891495a2.js"><link rel="prefetch" href="/assets/JavaScript基础第三天.html.50e03400.js"><link rel="prefetch" href="/assets/javascript基础第二天笔记.html.651a1cce.js"><link rel="prefetch" href="/assets/JavaScript基础第五天.html.532055f8.js"><link rel="prefetch" href="/assets/JavaScript基础第四天.html.48f9f757.js"><link rel="prefetch" href="/assets/index.html.2ae2a053.js"><link rel="prefetch" href="/assets/个人实战文档.html.a215a567.js"><link rel="prefetch" href="/assets/index.html.a41e5068.js"><link rel="prefetch" href="/assets/index.html.a943c6ed.js"><link rel="prefetch" href="/assets/index.html.f484fa51.js"><link rel="prefetch" href="/assets/index.html.b30fb1f3.js"><link rel="prefetch" href="/assets/index.html.987f5152.js"><link rel="prefetch" href="/assets/JavaScript进阶第一天.html.ec2e3daf.js"><link rel="prefetch" href="/assets/day03.html.6267d184.js"><link rel="prefetch" href="/assets/day02.html.09d76878.js"><link rel="prefetch" href="/assets/day04.html.0b590623.js"><link rel="prefetch" href="/assets/笔记.html.c9d930a9.js"><link rel="prefetch" href="/assets/笔记.html.06ba9256.js"><link rel="prefetch" href="/assets/笔记.html.a54bfa16.js"><link rel="prefetch" href="/assets/day01.html.d79c2345.js"><link rel="prefetch" href="/assets/day02.html.f509e6ac.js"><link rel="prefetch" href="/assets/day03.html.921fa42c.js"><link rel="prefetch" href="/assets/day04.html.5429aced.js"><link rel="prefetch" href="/assets/day05.html.2ee35e36.js"><link rel="prefetch" href="/assets/day06.html.3e19a000.js"><link rel="prefetch" href="/assets/day07.html.701034e2.js"><link rel="prefetch" href="/assets/智慧商城项目.html.2d8a4342.js"><link rel="prefetch" href="/assets/Vue3入门.html.3a51fd0e.js"><link rel="prefetch" href="/assets/Pinia.html.8dd4c37f.js"><link rel="prefetch" href="/assets/大事件管理系统.html.3ae81f5c.js"><link rel="prefetch" href="/assets/01-项目起步.html.40242e6f.js"><link rel="prefetch" href="/assets/02-首页模块.html.5c3c430b.js"><link rel="prefetch" href="/assets/03-推荐模块.html.ee78b4d8.js"><link rel="prefetch" href="/assets/04-分类模块.html.0812086c.js"><link rel="prefetch" href="/assets/05-详情模块.html.b637efab.js"><link rel="prefetch" href="/assets/06-登录模块.html.baebe0ce.js"><link rel="prefetch" href="/assets/07-用户模块.html.9843276f.js"><link rel="prefetch" href="/assets/08-地址模块.html.768b97bc.js"><link rel="prefetch" href="/assets/09-SKU模块.html.fe99e19d.js"><link rel="prefetch" href="/assets/10-购物车模块.html.e30fddab.js"><link rel="prefetch" href="/assets/11-订单模块.html.8d760634.js"><link rel="prefetch" href="/assets/12-项目打包.html.8f746655.js"><link rel="prefetch" href="/assets/index.html.0ef7e9e2.js"><link rel="prefetch" href="/assets/第1天.html.5285f02c.js"><link rel="prefetch" href="/assets/第2天.html.a31747e8.js"><link rel="prefetch" href="/assets/第3天.html.d4a9e617.js"><link rel="prefetch" href="/assets/第4天.html.ae52fb77.js"><link rel="prefetch" href="/assets/第5天.html.05d1cc31.js"><link rel="prefetch" href="/assets/小程序自定义tabBar.html.ef7ea157.js"><link rel="prefetch" href="/assets/第6天.html.346be0e3.js"><link rel="prefetch" href="/assets/多级缓存.html.bc54879d.js"><link rel="prefetch" href="/assets/Redis高级篇之最佳实践.html.187c57dc.js"><link rel="prefetch" href="/assets/Redis高级-分布式缓存.html.d4751937.js"><link rel="prefetch" href="/assets/Nacos安装指南.html.7df3cc60.js"><link rel="prefetch" href="/assets/Nacos集群搭建.html.fbd16a6a.js"><link rel="prefetch" href="/assets/Centos7安装Docker.html.5181da35.js"><link rel="prefetch" href="/assets/RabbitMQ部署指南.html.f7286eb5.js"><link rel="prefetch" href="/assets/安装elasticsearch.html.c7bb5c77.js"><link rel="prefetch" href="/assets/Day02_AJAX综合案例.html.f2a65bb1.js"><link rel="prefetch" href="/assets/Day03_AJAX原理.html.d00ba48d.js"><link rel="prefetch" href="/assets/Day04_AJAX进阶.html.cac2ce24.js"><link rel="prefetch" href="/assets/Day01_AJAX入门.html.374298e3.js"><link rel="prefetch" href="/assets/404.html.81c07e69.js"><link rel="prefetch" href="/assets/index.html.92fbf6ff.js"><link rel="prefetch" href="/assets/index.html.e40858f0.js"><link rel="prefetch" href="/assets/index.html.ec1567cc.js"><link rel="prefetch" href="/assets/Mac下mongodb安装和配置.html.736342d9.js"><link rel="prefetch" href="/assets/Mac下命令行配置环境变量.html.7d720e53.js"><link rel="prefetch" href="/assets/Mac全自动安装brew一键配置国内镜像源.html.421fe805.js"><link rel="prefetch" href="/assets/Mac终端命令记录.html.5f155e25.js"><link rel="prefetch" href="/assets/Nginx搭建HTTPS，并反向代理到web页面_mkcert生成本地SSL证书.html.b4ebda6f.js"><link rel="prefetch" href="/assets/PDF转Markdown文件.html.638323fb.js"><link rel="prefetch" href="/assets/index.html.9e2c0472.js"><link rel="prefetch" href="/assets/VSCode使用记录.html.e1d97562.js"><link rel="prefetch" href="/assets/docsearch全站搜索.html.68ee7ee4.js"><link rel="prefetch" href="/assets/idea插件分享.html.99b11191.js"><link rel="prefetch" href="/assets/jetbrains全家桶激活策略.html.49a730a7.js"><link rel="prefetch" href="/assets/中华人民共和国劳动合同法.html.901cd5e5.js"><link rel="prefetch" href="/assets/浅谈文言文与英语语法的相似点.html.9f127ec3.js"><link rel="prefetch" href="/assets/面向AI开发.html.a0de42d8.js"><link rel="prefetch" href="/assets/鸿蒙3安装apk无须登录.html.9ba7e260.js"><link rel="prefetch" href="/assets/index.html.4646d1b3.js"><link rel="prefetch" href="/assets/index.html.ed5f40cf.js"><link rel="prefetch" href="/assets/aboutme.html.80c5e6fb.js"><link rel="prefetch" href="/assets/FRP内网穿透搭建(无域名版).html.ed427348.js"><link rel="prefetch" href="/assets/index.html.c96fd998.js"><link rel="prefetch" href="/assets/linux前端项目部署.html.4a9e37f3.js"><link rel="prefetch" href="/assets/linux环境变量配置错误后命令无法使用解决方案.html.91152588.js"><link rel="prefetch" href="/assets/内网穿透工具比较.html.da1da9c1.js"><link rel="prefetch" href="/assets/在CentOS上搭建Samba服务器.html.3868ccef.js"><link rel="prefetch" href="/assets/index.html.d39227bb.js"><link rel="prefetch" href="/assets/第01章Android开发环境搭建.html.68778f2a.js"><link rel="prefetch" href="/assets/第02章AndroidApp开发基础.html.fc16bfe6.js"><link rel="prefetch" href="/assets/第03章简单控件.html.cc1bfff5.js"><link rel="prefetch" href="/assets/第04章活动Activity.html.542e1777.js"><link rel="prefetch" href="/assets/第05章中级控件.html.c7e7c4be.js"><link rel="prefetch" href="/assets/第06章数据存储.html.4f083cd8.js"><link rel="prefetch" href="/assets/第07章内容共享.html.9e0c731b.js"><link rel="prefetch" href="/assets/第08章高级控件.html.947fa527.js"><link rel="prefetch" href="/assets/第10章自定义控件.html.b11d240c.js"><link rel="prefetch" href="/assets/AndroidStudio代理问题Connect.html.66ee72e9.js"><link rel="prefetch" href="/assets/AndroidStudio打包aar丢失远程依赖问题解决.html.ba40c91c.js"><link rel="prefetch" href="/assets/AndroidStudio登录google账号失败问题.html.9eadda3e.js"><link rel="prefetch" href="/assets/Apk应用重签名—使用AndroidStudio自带工具apksigner.html.9255d4fb.js"><link rel="prefetch" href="/assets/不常用的ADB命令.html.2301d76a.js"><link rel="prefetch" href="/assets/01MySQL精简笔记.html.35bb5798.js"><link rel="prefetch" href="/assets/02JDBC.html.7d234328.js"><link rel="prefetch" href="/assets/03Maven.html.de9c3774.js"><link rel="prefetch" href="/assets/04Mybatis.html.eb63e606.js"><link rel="prefetch" href="/assets/05网页三剑客.html.6b60e1a4.js"><link rel="prefetch" href="/assets/06HTTP_Tomcat_Servlet.html.38b1ef22.js"><link rel="prefetch" href="/assets/07Request_Response.html.e1b24e4e.js"><link rel="prefetch" href="/assets/08JSP.html.194b24dc.js"><link rel="prefetch" href="/assets/09Cookie_Session.html.d1824ae8.js"><link rel="prefetch" href="/assets/10Filter_Listener_Ajax.html.69e8ab71.js"><link rel="prefetch" href="/assets/11Vue_Element.html.79fd0c2f.js"><link rel="prefetch" href="/assets/12综合案例.html.63b7cac5.js"><link rel="prefetch" href="/assets/index.html.8b3c8919.js"><link rel="prefetch" href="/assets/POM文件帮助文档.html.097a5d72.js"><link rel="prefetch" href="/assets/index.html.2d04fed8.js"><link rel="prefetch" href="/assets/index.html.a9d0c572.js"><link rel="prefetch" href="/assets/index.html.ad6479e1.js"><link rel="prefetch" href="/assets/index.html.707aa31d.js"><link rel="prefetch" href="/assets/index.html.1843b5e9.js"><link rel="prefetch" href="/assets/index.html.01da62ec.js"><link rel="prefetch" href="/assets/index.html.7e228cd6.js"><link rel="prefetch" href="/assets/index.html.ce0aa146.js"><link rel="prefetch" href="/assets/index.html.ae66a602.js"><link rel="prefetch" href="/assets/index.html.23188331.js"><link rel="prefetch" href="/assets/request.getInputStream只能读取一次问题.html.94ef0144.js"><link rel="prefetch" href="/assets/程序包com.alibaba.fastjson不存在.html.adc40fbf.js"><link rel="prefetch" href="/assets/错误集合.html.1902771e.js"><link rel="prefetch" href="/assets/index.html.07cc1e7c.js"><link rel="prefetch" href="/assets/index.html.ed46d2b2.js"><link rel="prefetch" href="/assets/index.html.26154657.js"><link rel="prefetch" href="/assets/index.html.a89d59ab.js"><link rel="prefetch" href="/assets/Node多版本管理.html.23432454.js"><link rel="prefetch" href="/assets/index.html.3220da42.js"><link rel="prefetch" href="/assets/Web调试入门.html.32e31997.js"><link rel="prefetch" href="/assets/关于ESLInk配置问题.html.601c708b.js"><link rel="prefetch" href="/assets/index.html.81dd64a7.js"><link rel="prefetch" href="/assets/MySQL-基础篇.html.ea685d4e.js"><link rel="prefetch" href="/assets/Maven高级.html.f953be6e.js"><link rel="prefetch" href="/assets/SpringBoot.html.656f5974.js"><link rel="prefetch" href="/assets/MyBatisPlus.html.0618d8d7.js"><link rel="prefetch" href="/assets/RestTemplate.html.e4407e5b.js"><link rel="prefetch" href="/assets/Dubbo详解.html.b63868e7.js"><link rel="prefetch" href="/assets/Mac下ZooKeeper安装和使用.html.b7e9aa6d.js"><link rel="prefetch" href="/assets/Zookeeper集群搭建.html.8710cb4e.js"><link rel="prefetch" href="/assets/传智健康项目讲义（第10章）.html.866d0852.js"><link rel="prefetch" href="/assets/传智健康项目讲义（第11章）.html.fe6fc07f.js"><link rel="prefetch" href="/assets/传智健康项目讲义（第12章）.html.dfedc3a4.js"><link rel="prefetch" href="/assets/传智健康项目讲义（第13章）.html.c08efd79.js"><link rel="prefetch" href="/assets/传智健康项目讲义（第1章）.html.fa66e48b.js"><link rel="prefetch" href="/assets/传智健康项目讲义（第2章）.html.4dfeadd4.js"><link rel="prefetch" href="/assets/传智健康项目讲义（第3章）.html.63143093.js"><link rel="prefetch" href="/assets/传智健康项目讲义（第4章）.html.d0567d09.js"><link rel="prefetch" href="/assets/传智健康项目讲义（第5章）.html.8af710b1.js"><link rel="prefetch" href="/assets/传智健康项目讲义（第6章）.html.3c364cc8.js"><link rel="prefetch" href="/assets/传智健康项目讲义（第7章）.html.72ba46fc.js"><link rel="prefetch" href="/assets/传智健康项目讲义（第8章）.html.c8118794.js"><link rel="prefetch" href="/assets/传智健康项目讲义（第9章）.html.a0407ad1.js"><link rel="prefetch" href="/assets/SpringBoot讲义.html.25cc4594.js"><link rel="prefetch" href="/assets/Linux-Day01.html.116cbab9.js"><link rel="prefetch" href="/assets/Linux-Day02.html.7ba3c82c.js"><link rel="prefetch" href="/assets/Redis基础.html.8ccd3a80.js"><link rel="prefetch" href="/assets/Git课程讲义.html.9a252ae7.js"><link rel="prefetch" href="/assets/瑞吉外卖-Day01.html.3ef486ec.js"><link rel="prefetch" href="/assets/瑞吉外卖-Day02.html.15ded454.js"><link rel="prefetch" href="/assets/瑞吉外卖-Day03.html.11e5154d.js"><link rel="prefetch" href="/assets/瑞吉外卖-Day04.html.843344a7.js"><link rel="prefetch" href="/assets/瑞吉外卖-Day05.html.38768af1.js"><link rel="prefetch" href="/assets/瑞吉外卖-Day06.html.bdbf82e0.js"><link rel="prefetch" href="/assets/瑞吉外卖优化-Day01.html.78bb75f4.js"><link rel="prefetch" href="/assets/瑞吉外卖优化-Day02.html.5292a2ce.js"><link rel="prefetch" href="/assets/瑞吉外卖优化-Day03.html.68069b64.js"><link rel="prefetch" href="/assets/微服务常见面试题.html.a4dc3b89.js"><link rel="prefetch" href="/assets/错误笔记.html.da1c139d.js"><link rel="prefetch" href="/assets/day01-HTML基础.html.34459185.js"><link rel="prefetch" href="/assets/day02-HTML进阶.html.c9732cc4.js"><link rel="prefetch" href="/assets/day03-CSS基础.html.1a5a9f88.js"><link rel="prefetch" href="/assets/day04-CSS进阶.html.d7898ffc.js"><link rel="prefetch" href="/assets/day05-盒子模型.html.a326bf54.js"><link rel="prefetch" href="/assets/day06-Flex布局.html.cb931421.js"><link rel="prefetch" href="/assets/day07-学成在线.html.4b5d140d.js"><link rel="prefetch" href="/assets/day08-CSS高级.html.1e1fd381.js"><link rel="prefetch" href="/assets/day09-小兔鲜儿.html.483fba8f.js"><link rel="prefetch" href="/assets/day10-小兔鲜儿.html.0af78916.js"><link rel="prefetch" href="/assets/Day01-项目介绍及初始化-登录页面.html.5583346a.js"><link rel="prefetch" href="/assets/Day02-登录模块-主页鉴权.html.4c64d2f9.js"><link rel="prefetch" href="/assets/Day03-主页模块-修改密码.html.5438e16a.js"><link rel="prefetch" href="/assets/Day04-组织架构.html.05f70f07.js"><link rel="prefetch" href="/assets/Day05-组织架构-角色管理.html.5d7edd53.js"><link rel="prefetch" href="/assets/Day06-角色管理-员工管理.html.7c82720b.js"><link rel="prefetch" href="/assets/Day07-员工管理-上传下载.html.f70ad5c9.js"><link rel="prefetch" href="/assets/Day08-Cos上传和权限数据.html.05a8a948.js"><link rel="prefetch" href="/assets/Day09-权限应用-首页.html.d6031099.js"><link rel="prefetch" href="/assets/Day10-首页图表-Nginx上线.html.64d67e52.js"><link rel="prefetch" href="/assets/1.Vue3入门.html.2f2fdbe0.js"><link rel="prefetch" href="/assets/10.购物车.html.02817c2d.js"><link rel="prefetch" href="/assets/11.订单页.html.bd292f6f.js"><link rel="prefetch" href="/assets/12.支付页.html.2c4eff75.js"><link rel="prefetch" href="/assets/13.会员中心.html.e4a42cd2.js"><link rel="prefetch" href="/assets/14.拓展部分.html.ca945d4b.js"><link rel="prefetch" href="/assets/2.Pinia入门.html.801fa8da.js"><link rel="prefetch" href="/assets/3.项目起步.html.702da6da.js"><link rel="prefetch" href="/assets/4.Layout页.html.193b1e52.js"><link rel="prefetch" href="/assets/5.Home页.html.bc87f5f6.js"><link rel="prefetch" href="/assets/6.一级分类页.html.20d3fdc1.js"><link rel="prefetch" href="/assets/7.二级分类页.html.628a82da.js"><link rel="prefetch" href="/assets/8.商品详情.html.3ee47103.js"><link rel="prefetch" href="/assets/9.登录页.html.cee6b53d.js"><link rel="prefetch" href="/assets/day01.html.44284e1b.js"><link rel="prefetch" href="/assets/day02.html.682f4e8c.js"><link rel="prefetch" href="/assets/day03.html.fc7e734f.js"><link rel="prefetch" href="/assets/index.html.d8ca12a6.js"><link rel="prefetch" href="/assets/day01.html.06b72e68.js"><link rel="prefetch" href="/assets/day02.html.e3155d4f.js"><link rel="prefetch" href="/assets/day03.html.d55bece0.js"><link rel="prefetch" href="/assets/day04.html.06703f2b.js"><link rel="prefetch" href="/assets/index.html.1db7cafe.js"><link rel="prefetch" href="/assets/interview-base.html.f0d9d148.js"><link rel="prefetch" href="/assets/interview-enjoy-plus.html.c5a4a893.js"><link rel="prefetch" href="/assets/课堂笔记.html.90350a6a.js"><link rel="prefetch" href="/assets/课堂笔记.html.c8eb77be.js"><link rel="prefetch" href="/assets/Redis基础篇.html.8d198d08.js"><link rel="prefetch" href="/assets/Redis快速入门.html.29627213.js"><link rel="prefetch" href="/assets/Redis实战篇.html.ea9a5e16.js"><link rel="prefetch" href="/assets/Redis原理篇.html.1c41beff.js"><link rel="prefetch" href="/assets/Spring-day01.html.1ddd29f9.js"><link rel="prefetch" href="/assets/Spring-day02.html.2cd4228e.js"><link rel="prefetch" href="/assets/Spring-day03.html.25153ee8.js"><link rel="prefetch" href="/assets/SpringMVC-day01.html.d00e8d3b.js"><link rel="prefetch" href="/assets/SpringMVC-day02.html.053ca17e.js"><link rel="prefetch" href="/assets/错误笔记.html.478ae0f3.js"><link rel="prefetch" href="/assets/SpringBootStart.html.ecdea1c3.js"><link rel="prefetch" href="/assets/SpringBoot整合SSMP.html.1fc33c49.js"><link rel="prefetch" href="/assets/SpringBoot综合案例.html.35be3f27.js"><link rel="prefetch" href="/assets/SpringBoot讲义.html.5aa6947a.js"><link rel="prefetch" href="/assets/SpringBoot讲义.html.2ff98050.js"><link rel="prefetch" href="/assets/Centos8-stream在真机上安装排坑.html.78cc33ff.js"><link rel="prefetch" href="/assets/Centos9安装mysql.html.7b62ca1b.js"><link rel="prefetch" href="/assets/SpringCloud01.html.60050f3f.js"><link rel="prefetch" href="/assets/SpringCloud实用篇02.html.3c26a7b2.js"><link rel="prefetch" href="/assets/Docker实用篇.html.faaf4482.js"><link rel="prefetch" href="/assets/RabbitMQ.html.3f620ea8.js"><link rel="prefetch" href="/assets/分布式搜索引擎01.html.2f9ec22c.js"><link rel="prefetch" href="/assets/分布式搜索引擎02.html.451e3843.js"><link rel="prefetch" href="/assets/分布式搜索引擎03.html.50a52a2a.js"><link rel="prefetch" href="/assets/微服务保护.html.42915502.js"><link rel="prefetch" href="/assets/分布式事务.html.6dd52011.js"><link rel="prefetch" href="/assets/分布式缓存.html.085c2312.js"><link rel="prefetch" href="/assets/多级缓存.html.e75749e3.js"><link rel="prefetch" href="/assets/RabbitMQ-高级篇.html.ad030046.js"><link rel="prefetch" href="/assets/Mybatis第一天.html.674d710d.js"><link rel="prefetch" href="/assets/Mybatis第二天.html.3121ba02.js"><link rel="prefetch" href="/assets/移动web第一天.html.b943ad87.js"><link rel="prefetch" href="/assets/移动Web第二天.html.30ef3091.js"><link rel="prefetch" href="/assets/移动Web第三天.html.06469be6.js"><link rel="prefetch" href="/assets/移动Web第四天.html.2aed5da8.js"><link rel="prefetch" href="/assets/移动Web第五天.html.d67549b0.js"><link rel="prefetch" href="/assets/JavaScript基础第一天.html.ede8ef34.js"><link rel="prefetch" href="/assets/JavaScript基础第三天.html.35d7938f.js"><link rel="prefetch" href="/assets/javascript基础第二天笔记.html.3fd96f35.js"><link rel="prefetch" href="/assets/JavaScript基础第五天.html.f0a8a230.js"><link rel="prefetch" href="/assets/JavaScript基础第四天.html.7135850d.js"><link rel="prefetch" href="/assets/index.html.5f5e0b19.js"><link rel="prefetch" href="/assets/个人实战文档.html.631875c9.js"><link rel="prefetch" href="/assets/index.html.1a1f6afc.js"><link rel="prefetch" href="/assets/index.html.4a8ed58a.js"><link rel="prefetch" href="/assets/index.html.6a243c14.js"><link rel="prefetch" href="/assets/index.html.0a7c4cfb.js"><link rel="prefetch" href="/assets/index.html.c428b37f.js"><link rel="prefetch" href="/assets/JavaScript进阶第一天.html.96e2d1af.js"><link rel="prefetch" href="/assets/day03.html.9eb0747e.js"><link rel="prefetch" href="/assets/day02.html.de03ec98.js"><link rel="prefetch" href="/assets/day04.html.b94fedb2.js"><link rel="prefetch" href="/assets/笔记.html.28579a85.js"><link rel="prefetch" href="/assets/笔记.html.d087f52f.js"><link rel="prefetch" href="/assets/笔记.html.08daabb2.js"><link rel="prefetch" href="/assets/day01.html.e54967f4.js"><link rel="prefetch" href="/assets/day02.html.2eb76045.js"><link rel="prefetch" href="/assets/day03.html.da3117e6.js"><link rel="prefetch" href="/assets/day04.html.8b76ea5b.js"><link rel="prefetch" href="/assets/day05.html.51c17e4d.js"><link rel="prefetch" href="/assets/day06.html.e573259d.js"><link rel="prefetch" href="/assets/day07.html.01aa477e.js"><link rel="prefetch" href="/assets/智慧商城项目.html.a2e62d32.js"><link rel="prefetch" href="/assets/Vue3入门.html.50761508.js"><link rel="prefetch" href="/assets/Pinia.html.4cfdc328.js"><link rel="prefetch" href="/assets/大事件管理系统.html.27717e98.js"><link rel="prefetch" href="/assets/01-项目起步.html.ad05a9a8.js"><link rel="prefetch" href="/assets/02-首页模块.html.b669b0bb.js"><link rel="prefetch" href="/assets/03-推荐模块.html.80203d9c.js"><link rel="prefetch" href="/assets/04-分类模块.html.7c5363b4.js"><link rel="prefetch" href="/assets/05-详情模块.html.bc4b3b74.js"><link rel="prefetch" href="/assets/06-登录模块.html.0aa33139.js"><link rel="prefetch" href="/assets/07-用户模块.html.a050825a.js"><link rel="prefetch" href="/assets/08-地址模块.html.5bf806c9.js"><link rel="prefetch" href="/assets/09-SKU模块.html.a08cd14a.js"><link rel="prefetch" href="/assets/10-购物车模块.html.78de12f9.js"><link rel="prefetch" href="/assets/11-订单模块.html.35819573.js"><link rel="prefetch" href="/assets/12-项目打包.html.58acec07.js"><link rel="prefetch" href="/assets/index.html.f91c372f.js"><link rel="prefetch" href="/assets/第1天.html.b5d1fd3e.js"><link rel="prefetch" href="/assets/第2天.html.8cc04eac.js"><link rel="prefetch" href="/assets/第3天.html.9d71fe8e.js"><link rel="prefetch" href="/assets/第4天.html.41bcc93c.js"><link rel="prefetch" href="/assets/第5天.html.a2468669.js"><link rel="prefetch" href="/assets/小程序自定义tabBar.html.b065556c.js"><link rel="prefetch" href="/assets/第6天.html.42dedd3e.js"><link rel="prefetch" href="/assets/多级缓存.html.f46bfabf.js"><link rel="prefetch" href="/assets/Redis高级篇之最佳实践.html.6124e0fe.js"><link rel="prefetch" href="/assets/Redis高级-分布式缓存.html.fe280cae.js"><link rel="prefetch" href="/assets/Nacos安装指南.html.42bd9daf.js"><link rel="prefetch" href="/assets/Nacos集群搭建.html.b1e61de8.js"><link rel="prefetch" href="/assets/Centos7安装Docker.html.63397394.js"><link rel="prefetch" href="/assets/RabbitMQ部署指南.html.7a82d766.js"><link rel="prefetch" href="/assets/安装elasticsearch.html.db2054a0.js"><link rel="prefetch" href="/assets/Day02_AJAX综合案例.html.b24bf7ed.js"><link rel="prefetch" href="/assets/Day03_AJAX原理.html.934584d6.js"><link rel="prefetch" href="/assets/Day04_AJAX进阶.html.af5a3f0d.js"><link rel="prefetch" href="/assets/Day01_AJAX入门.html.57fb7c06.js"><link rel="prefetch" href="/assets/404.html.143a0abb.js"><link rel="prefetch" href="/assets/404.af3fcab4.js"><link rel="prefetch" href="/assets/Layout.96a35c1f.js"><link rel="prefetch" href="/assets/index.0e8935cb.js"><link rel="prefetch" href="/assets/giscus.15440425.js">
    <link rel="stylesheet" href="/assets/style.5869c25b.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/" class=""><img class="logo" src="/images/logo.png" alt="Hades"><span class="site-name can-hide">Hades</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><a href="/Android/" class="router-link-active" aria-label="Android"><!--[--><!--]--> Android <!--[--><!--]--></a></div><div class="navbar-item"><a href="/Java后端/" class="" aria-label="Java后端"><!--[--><!--]--> Java后端 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/Web前端/" class="" aria-label="Web前端"><!--[--><!--]--> Web前端 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/数据库/" class="" aria-label="数据库"><!--[--><!--]--> 数据库 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/运维技术/" class="" aria-label="运维技术"><!--[--><!--]--> 运维技术 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/Tips/" class="" aria-label="Tips❤️‍"><!--[--><!--]--> Tips❤️‍ <!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="书签🔖"><span class="title">书签🔖</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="书签🔖"><span class="title">书签🔖</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>搜索</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a class="external-link" href="https://www.baidu.com" rel="noopener noreferrer" target="_blank" aria-label="百度一下"><!--[--><!--]--> 百度一下 <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>常用</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a class="external-link" href="http://gitee.com" rel="noopener noreferrer" target="_blank" aria-label="gitee"><!--[--><!--]--> gitee <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a class="external-link" href="http://bilibili.com" rel="noopener noreferrer" target="_blank" aria-label="哔哩哔哩"><!--[--><!--]--> 哔哩哔哩 <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/start/BuildError/README.md" class="" aria-label="Vuepress打包错误"><!--[--><!--]--> Vuepress打包错误 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><!--]--></nav><!--[--><!--]--><button class="toggle-color-mode-button" title="toggle color mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><div id="docsearch-container"></div></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><a href="/Android/" class="router-link-active" aria-label="Android"><!--[--><!--]--> Android <!--[--><!--]--></a></div><div class="navbar-item"><a href="/Java后端/" class="" aria-label="Java后端"><!--[--><!--]--> Java后端 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/Web前端/" class="" aria-label="Web前端"><!--[--><!--]--> Web前端 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/数据库/" class="" aria-label="数据库"><!--[--><!--]--> 数据库 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/运维技术/" class="" aria-label="运维技术"><!--[--><!--]--> 运维技术 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/Tips/" class="" aria-label="Tips❤️‍"><!--[--><!--]--> Tips❤️‍ <!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="书签🔖"><span class="title">书签🔖</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="书签🔖"><span class="title">书签🔖</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>搜索</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a class="external-link" href="https://www.baidu.com" rel="noopener noreferrer" target="_blank" aria-label="百度一下"><!--[--><!--]--> 百度一下 <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>常用</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a class="external-link" href="http://gitee.com" rel="noopener noreferrer" target="_blank" aria-label="gitee"><!--[--><!--]--> gitee <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a class="external-link" href="http://bilibili.com" rel="noopener noreferrer" target="_blank" aria-label="哔哩哔哩"><!--[--><!--]--> 哔哩哔哩 <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/start/BuildError/README.md" class="" aria-label="Vuepress打包错误"><!--[--><!--]--> Vuepress打包错误 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><p tabindex="0" class="sidebar-item sidebar-heading">第 9 章　广播组件Broadcast <!----></p><ul style="display:none;" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/Android/AndroidBasic/%E7%AC%AC09%E7%AB%A0%E5%B9%BF%E6%92%AD%E7%BB%84%E4%BB%B6Broadcast.html#_9-1-收发应用广播" class="router-link-active router-link-exact-active sidebar-item" aria-label="9.1　收发应用广播"><!--[--><!--]--> 9.1　收发应用广播 <!--[--><!--]--></a><ul style="display:none;" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/Android/AndroidBasic/%E7%AC%AC09%E7%AB%A0%E5%B9%BF%E6%92%AD%E7%BB%84%E4%BB%B6Broadcast.html#_9-1-1-收发标准广播" class="router-link-active router-link-exact-active sidebar-item" aria-label="9.1.1　收发标准广播"><!--[--><!--]--> 9.1.1　收发标准广播 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/Android/AndroidBasic/%E7%AC%AC09%E7%AB%A0%E5%B9%BF%E6%92%AD%E7%BB%84%E4%BB%B6Broadcast.html#_9-1-2-收发有序广播" class="router-link-active router-link-exact-active sidebar-item" aria-label="9.1.2　收发有序广播"><!--[--><!--]--> 9.1.2　收发有序广播 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/Android/AndroidBasic/%E7%AC%AC09%E7%AB%A0%E5%B9%BF%E6%92%AD%E7%BB%84%E4%BB%B6Broadcast.html#_9-1-3-收发静态广播" class="router-link-active router-link-exact-active sidebar-item" aria-label="9.1.3　收发静态广播"><!--[--><!--]--> 9.1.3　收发静态广播 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/Android/AndroidBasic/%E7%AC%AC09%E7%AB%A0%E5%B9%BF%E6%92%AD%E7%BB%84%E4%BB%B6Broadcast.html#_9-2-监听系统广播" class="router-link-active router-link-exact-active sidebar-item" aria-label="9.2　监听系统广播"><!--[--><!--]--> 9.2　监听系统广播 <!--[--><!--]--></a><ul style="display:none;" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/Android/AndroidBasic/%E7%AC%AC09%E7%AB%A0%E5%B9%BF%E6%92%AD%E7%BB%84%E4%BB%B6Broadcast.html#_9-2-1-接收分钟到达广播" class="router-link-active router-link-exact-active sidebar-item" aria-label="9.2.1　接收分钟到达广播"><!--[--><!--]--> 9.2.1　接收分钟到达广播 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/Android/AndroidBasic/%E7%AC%AC09%E7%AB%A0%E5%B9%BF%E6%92%AD%E7%BB%84%E4%BB%B6Broadcast.html#_9-2-2-接收网络变更广播" class="router-link-active router-link-exact-active sidebar-item" aria-label="9.2.2　接收网络变更广播"><!--[--><!--]--> 9.2.2　接收网络变更广播 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/Android/AndroidBasic/%E7%AC%AC09%E7%AB%A0%E5%B9%BF%E6%92%AD%E7%BB%84%E4%BB%B6Broadcast.html#_9-2-3-定时管理器alarmmanager" class="router-link-active router-link-exact-active sidebar-item" aria-label="9.2.3　定时管理器AlarmManager"><!--[--><!--]--> 9.2.3　定时管理器AlarmManager <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/Android/AndroidBasic/%E7%AC%AC09%E7%AB%A0%E5%B9%BF%E6%92%AD%E7%BB%84%E4%BB%B6Broadcast.html#_9-3-捕获屏幕的变更事件" class="router-link-active router-link-exact-active sidebar-item" aria-label="9.3　捕获屏幕的变更事件"><!--[--><!--]--> 9.3　捕获屏幕的变更事件 <!--[--><!--]--></a><ul style="display:none;" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/Android/AndroidBasic/%E7%AC%AC09%E7%AB%A0%E5%B9%BF%E6%92%AD%E7%BB%84%E4%BB%B6Broadcast.html#_9-3-1-竖屏与横屏切换" class="router-link-active router-link-exact-active sidebar-item" aria-label="9.3.1　竖屏与横屏切换"><!--[--><!--]--> 9.3.1　竖屏与横屏切换 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/Android/AndroidBasic/%E7%AC%AC09%E7%AB%A0%E5%B9%BF%E6%92%AD%E7%BB%84%E4%BB%B6Broadcast.html#_9-3-2-回到桌面与切换到任务列表" class="router-link-active router-link-exact-active sidebar-item" aria-label="9.3.2　回到桌面与切换到任务列表"><!--[--><!--]--> 9.3.2　回到桌面与切换到任务列表 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/Android/AndroidBasic/%E7%AC%AC09%E7%AB%A0%E5%B9%BF%E6%92%AD%E7%BB%84%E4%BB%B6Broadcast.html#_9-4-小结" class="router-link-active router-link-exact-active sidebar-item" aria-label="9.4　小结"><!--[--><!--]--> 9.4　小结 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/Android/AndroidBasic/%E7%AC%AC09%E7%AB%A0%E5%B9%BF%E6%92%AD%E7%BB%84%E4%BB%B6Broadcast.html#_9-5-课后练习题" class="router-link-active router-link-exact-active sidebar-item" aria-label="9.5　课后练习题"><!--[--><!--]--> 9.5　课后练习题 <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><!--]--><div><h1 id="第-9-章-广播组件broadcast" tabindex="-1"><a class="header-anchor" href="#第-9-章-广播组件broadcast" aria-hidden="true">#</a> 第 9 章　广播组件Broadcast</h1><p>本章介绍Android4大组件之一Broadcast的基本概念和常见用法。主要包括如何发送和接收应用自身的广播、如何监听和处理设备发出来的系统广播、如何监听因为屏幕变更导致App界面改变的状态事件。</p><h2 id="_9-1-收发应用广播" tabindex="-1"><a class="header-anchor" href="#_9-1-收发应用广播" aria-hidden="true">#</a> 9.1　收发应用广播</h2><p>本节介绍应用广播的几种收发形式，包括如何收发标准广播、如何收发有序广播、如何收发静态广播等。</p><h3 id="_9-1-1-收发标准广播" tabindex="-1"><a class="header-anchor" href="#_9-1-1-收发标准广播" aria-hidden="true">#</a> 9.1.1　收发标准广播</h3><p>App在运行的时候有各种各样的数据流转，有的数据从上一个页面流向下一个页面，此时可通过意图在活动之间传递包裹；有的数据从应用内存流向存储卡，此时可进行文件读写操作。还有的数据流向千奇百怪，比如活动页面向碎片传递数据，按照“8.4.2　碎片的动态注册”小节的描述，尚可调用setArguments和getArguments方法存取参数；然而若是由碎片向活动页面传递数据，就没有类似setResult这样回馈结果的方法了。</p><p>随着App工程的代码量日益增长，承载数据流通的管道会越发不够用，好比装修房子的时候，给每个房间都预留了网线插口，只有插上网线才能上网。可是现在联网设备越来越多，除了电脑之外，电视也要联网，平板也要联网，乃至空调都要联网，如此一来网口早就不够用了。那怎样解决众多设备的联网问题呢？原来家家户户都配了无线路由器，路由器向四周发射WiFi信号，各设备只要安装了无线网卡，就能接收WiFi信号从而连接上网。于是“发射器+接收器”的模式另辟蹊径，比起网线这种固定管道要灵活得多，无须拉线即可随时随地传输数据。</p><p>Android的广播机制正是借鉴了WiFi的通信原理，不必搭建专门的通路，就能在发送方与接收方之间建立连接。同时广播（Broadcast）也是Android的四大组件之一，它用于Android各组件之间的灵活通信，与活动的区别在于：</p><p>（ 1 ）活动只能一对一通信；而广播可以一对多，一人发送广播，多人接收处理。</p><p>（ 2 ）对于发送方来说，广播不需要考虑接收方有没有在工作，接收方在工作就接收广播，不在工作就丢弃广播。</p><p>（ 3 ）对于接收方来说，因为可能会收到各式各样的广播，所以接收方要自行过滤符合条件的广播，之后再解包处理。</p><p>与广播有关的方法主要有以下 3 个。</p><ul><li><p>sendBroadcast：发送广播。</p></li><li><p>registerReceiver：注册广播的接收器，可在onStart或onResume方法中注册接收器。</p></li><li><p>unregisterReceiver：注销广播的接收器，可在onStop或onPause方法中注销接收器。</p></li></ul><p>具体到编码实现上，广播的收发过程可分为 3 个步骤：发送标准广播、定义广播接收器、开关广播接收器，分别说明如下。</p><p><strong>1 ．发送标准广播</strong></p><p>广播的发送操作很简单，一共只有两步：先创建意图对象，再调用sendBroadcast方法发送广播即可。 不过要注意，意图对象需要指定广播的动作名称，如同每个路由器都得给自己的WiFi起个名称一般，这样接收方才能根据动作名称判断来的是李逵而不是李鬼。下面是通过点击按钮发送广播的活动页面代码：</p><p>（完整代码见chapter09\src\main\java\com\example\chapter09\BroadStandardActivity.java）</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BroadStandardActivity</span> <span class="token keyword">extends</span> <span class="token class-name">AppCompatActivity</span> <span class="token keyword">implements</span> 
<span class="token class-name">View<span class="token punctuation">.</span>OnClickListener</span> <span class="token punctuation">{</span>
   <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token constant">TAG</span> <span class="token operator">=</span> <span class="token string">&quot;BroadStandardActivity&quot;</span><span class="token punctuation">;</span> 
   <span class="token comment">// 这是广播的动作名称，发送广播和接收广播都以它作为接头暗号</span>
   <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token constant">STANDARD_ACTION</span> <span class="token operator">=</span> 
<span class="token string">&quot;com.example.chapter09.standard&quot;</span><span class="token punctuation">;</span>
   <span class="token keyword">private</span> <span class="token class-name">TextView</span> tv_standard<span class="token punctuation">;</span> <span class="token comment">// 声明一个文本视图对象</span>
   <span class="token keyword">private</span> <span class="token class-name">String</span> mDesc <span class="token operator">=</span> <span class="token string">&quot;这里查看标准广播的收听信息&quot;</span><span class="token punctuation">;</span>
   <span class="token annotation punctuation">@Override</span>
   <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">onCreate</span><span class="token punctuation">(</span><span class="token class-name">Bundle</span> savedInstanceState<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token function">setContentView</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>layout<span class="token punctuation">.</span>activity_broad_standard<span class="token punctuation">)</span><span class="token punctuation">;</span>
       tv_standard <span class="token operator">=</span> <span class="token function">findViewById</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>tv_standard<span class="token punctuation">)</span><span class="token punctuation">;</span>
       tv_standard<span class="token punctuation">.</span><span class="token function">setText</span><span class="token punctuation">(</span>mDesc<span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token function">findViewById</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>btn_send_standard<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setOnClickListener</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
   <span class="token annotation punctuation">@Override</span>
   <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onClick</span><span class="token punctuation">(</span><span class="token class-name">View</span> v<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">if</span> <span class="token punctuation">(</span>v<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>btn_send_standard<span class="token punctuation">)</span> <span class="token punctuation">{</span>
           <span class="token class-name">Intent</span> intent <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Intent</span><span class="token punctuation">(</span><span class="token constant">STANDARD_ACTION</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 创建指定动作的意图</span>
           <span class="token function">sendBroadcast</span><span class="token punctuation">(</span>intent<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 发送标准广播</span>
    <span class="token punctuation">}</span>
 <span class="token punctuation">}</span> 
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>2 ．定义广播接收器</strong></p><p>广播发出来之后，还得有设备去接收广播，也就是需要广播接收器。接收器主要规定两个事情，一个是接收什么样的广播，另一个是收到广播以后要做什么。由于接收器的处理逻辑大同小异，因此Android提供了抽象之后的接收器基类BroadcastReceiver，开发者自定义的接收器都从BroadcastReceiver派生而来。新定义的接收器需要重写onReceive方法，方法内部先判断当前广播是否符合待接收的广播名称，校验通过再开展后续的业务逻辑。下面是广播接收器的一个定义代码例子：</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 定义一个标准广播的接收器</span>
<span class="token keyword">private</span> <span class="token keyword">class</span> <span class="token class-name">StandardReceiver</span> <span class="token keyword">extends</span> <span class="token class-name">BroadcastReceiver</span> <span class="token punctuation">{</span> 
   <span class="token comment">// 一旦接收到标准广播，马上触发接收器的onReceive方法</span>
   <span class="token annotation punctuation">@Override</span>
   <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onReceive</span><span class="token punctuation">(</span><span class="token class-name">Context</span> context<span class="token punctuation">,</span> <span class="token class-name">Intent</span> intent<span class="token punctuation">)</span> <span class="token punctuation">{</span> 
       <span class="token comment">// 广播意图非空，且接头暗号正确</span>
       <span class="token keyword">if</span> <span class="token punctuation">(</span>intent <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> intent<span class="token punctuation">.</span><span class="token function">getAction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token constant">STANDARD_ACTION</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
           mDesc <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">&quot;%s\n%s 收到一个标准广播&quot;</span><span class="token punctuation">,</span> mDesc<span class="token punctuation">,</span>
<span class="token class-name">DateUtil</span><span class="token punctuation">.</span><span class="token function">getNowTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           tv_standard<span class="token punctuation">.</span><span class="token function">setText</span><span class="token punctuation">(</span>mDesc<span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token punctuation">}</span>
 <span class="token punctuation">}</span> 
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>3 ．开关广播接收器</strong></p><p>为了避免资源浪费，还要求合理使用接收器。就像WiFi上网，需要上网时才打开WiFi，不需要上网时就关闭WiFi。广播接收器也是如此，活动页面启动之后才注册接收器，活动页面停止之际就注销接收器。在注册接收器的时候，允许事先指定只接收某种类型的广播，即通过意图过滤器挑选动作名称一致的广播。接收器的注册与注销代码示例如下：</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token class-name">StandardReceiver</span> standardReceiver<span class="token punctuation">;</span> <span class="token comment">// 声明一个标准广播的接收器实例 </span>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">onStart</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
   <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onStart</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   standardReceiver <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StandardReceiver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 创建一个标准广播的接收器 </span>
   <span class="token comment">// 创建一个意图过滤器，只处理STANDARD_ACTION的广播</span>
   <span class="token class-name">IntentFilter</span> filter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IntentFilter</span><span class="token punctuation">(</span><span class="token constant">STANDARD_ACTION</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">registerReceiver</span><span class="token punctuation">(</span>standardReceiver<span class="token punctuation">,</span> filter<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 注册接收器，注册之后才能正常接收广播 </span>
<span class="token punctuation">}</span>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">onStop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
   <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onStop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">unregisterReceiver</span><span class="token punctuation">(</span>standardReceiver<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 注销接收器，注销之后就不再接收广播 </span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>完成上述 3 个步骤后，便构建了广播从发送到接收的完整流程。运行测试App，初始的广播界面如图9-1所示，点击发送按钮触发广播，界面下方立刻刷新广播日志，如图9-2所示，可见接收器正确收到广播并成功打印日志。</p><img src="https://gitee.com/xiaweifeng/picgo/raw/master/images/202207112022846.png" alt="image-20220711202259772" style="zoom:50%;"><p>图9-1　准备接收标准广播</p><img src="https://gitee.com/xiaweifeng/picgo/raw/master/images/202207112023868.png" alt="image-20220711202326800" style="zoom:50%;"><p>图9-2　收听到了标准广播</p><h3 id="_9-1-2-收发有序广播" tabindex="-1"><a class="header-anchor" href="#_9-1-2-收发有序广播" aria-hidden="true">#</a> 9.1.2　收发有序广播</h3><p>由于广播没指定唯一的接收者，因此可能存在多个接收器，每个接收器都拥有自己的处理逻辑。这种机制固然灵活，却不够严谨，因为不同接收器之间也许有矛盾。比如只要办了借书证，大家都能借阅图书馆的藏书，不过一本书被读者甲借出去之后，读者乙就不能再借这本书了，必须等到读者甲归还了该书之后，读者乙方可继续借阅此书。这个借书场景体现了一种有序性，即图书是轮流借阅着的，且同时刻仅能借给一位读者，只有前面的读者借完归还，才轮到后面的读者借阅。另外，读者甲一定会归还此书吗？可能读者甲对该书爱不释手，从图书馆高价买断了这本书；也可能读者甲粗心大意，不小心弄丢了这本书。不管是哪种情况，读者甲都无法还书，导致正在排队的读者乙无书可借。这种借不到书的场景体现了一种依赖关系，即使读者乙迫不及待地想借到书，也得看读者甲的心情，要是读者甲因为各种理由没能还书，那么读者乙就白白排队了。上述的借书业务对应到广播的接收功能，则要求实现下列的处理逻辑：</p><p>（ 1 ）一个广播存在多个接收器，这些接收器需要排队收听广播，这意味着该广播是条有序广播。</p><p>（ 2 ）先收到广播的接收器A，既可以让其他接收器继续收听广播，也可以中断广播不让其他接收器收听。</p><p>至于如何实现有序广播的收发，则需完成以下的 3 个编码步骤：</p><p><strong>1 ．发送广播时要注明这是个有序广播</strong></p><p>之前发送标准广播用到了sendBroadcast方法，可是该方法发出来的广播是无序的。只有调用sendOrderedBroadcast方法才能发送有序广播，具体的发送代码示例如下：</p><p>（完整代码见chapter09\src\main\java\com\example\chapter09\BroadOrderActivity.java）</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">Intent</span> intent <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Intent</span><span class="token punctuation">(</span><span class="token constant">ORDER_ACTION</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 创建一个指定动作的意图 </span>
<span class="token function">sendOrderedBroadcast</span><span class="token punctuation">(</span>intent<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 发送有序广播</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>2 ．定义有序广播的接收器</strong></p><p>接收器的定义代码基本不变，也要从BroadcastReceiver继承而来，唯一的区别是有序广播的接收器允许中断广播。倘若在接收器的内部代码调用abortBroadcast方法，就会中断有序广播，使得后面的接收器不能再接收该广播。下面是有序广播的两个接收器代码例子：</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token class-name">OrderAReceiver</span> orderAReceiver<span class="token punctuation">;</span> <span class="token comment">// 声明有序广播接收器A的实例 </span>
<span class="token comment">// 定义一个有序广播的接收器A</span>
<span class="token keyword">private</span> <span class="token keyword">class</span> <span class="token class-name">OrderAReceiver</span> <span class="token keyword">extends</span> <span class="token class-name">BroadcastReceiver</span> <span class="token punctuation">{</span> 
   <span class="token comment">// 一旦接收到有序广播，马上触发接收器的onReceive方法</span>
   <span class="token annotation punctuation">@Override</span>
   <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onReceive</span><span class="token punctuation">(</span><span class="token class-name">Context</span> context<span class="token punctuation">,</span> <span class="token class-name">Intent</span> intent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">if</span> <span class="token punctuation">(</span>intent <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> intent<span class="token punctuation">.</span><span class="token function">getAction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token constant">ORDER_ACTION</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
           <span class="token class-name">String</span> desc <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">&quot;%s%s 接收器A收到一个有序广播\n&quot;</span><span class="token punctuation">,</span>
                                       tv_order<span class="token punctuation">.</span><span class="token function">getText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
<span class="token class-name">DateUtil</span><span class="token punctuation">.</span><span class="token function">getNowTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           tv_order<span class="token punctuation">.</span><span class="token function">setText</span><span class="token punctuation">(</span>desc<span class="token punctuation">)</span><span class="token punctuation">;</span> 
           <span class="token keyword">if</span> <span class="token punctuation">(</span>ck_abort<span class="token punctuation">.</span><span class="token function">isChecked</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
               <span class="token function">abortBroadcast</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 中断广播，此时后面的接收器无法收到该广播 </span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> 
 <span class="token punctuation">}</span> 
<span class="token punctuation">}</span>
<span class="token keyword">private</span> <span class="token class-name">OrderBReceiver</span> orderBReceiver<span class="token punctuation">;</span> <span class="token comment">// 声明有序广播接收器B的实例 </span>
<span class="token comment">// 定义一个有序广播的接收器B</span>
<span class="token keyword">private</span> <span class="token keyword">class</span> <span class="token class-name">OrderBReceiver</span> <span class="token keyword">extends</span> <span class="token class-name">BroadcastReceiver</span> <span class="token punctuation">{</span> 
   <span class="token comment">// 一旦接收到有序广播B，马上触发接收器的onReceive方法</span>
   <span class="token annotation punctuation">@Override</span>
   <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onReceive</span><span class="token punctuation">(</span><span class="token class-name">Context</span> context<span class="token punctuation">,</span> <span class="token class-name">Intent</span> intent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">if</span> <span class="token punctuation">(</span>intent <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> intent<span class="token punctuation">.</span><span class="token function">getAction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token constant">ORDER_ACTION</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
           <span class="token class-name">String</span> desc <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">&quot;%s%s 接收器B收到一个有序广播\n&quot;</span><span class="token punctuation">,</span> 
                                       tv_order<span class="token punctuation">.</span><span class="token function">getText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
<span class="token class-name">DateUtil</span><span class="token punctuation">.</span><span class="token function">getNowTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           tv_order<span class="token punctuation">.</span><span class="token function">setText</span><span class="token punctuation">(</span>desc<span class="token punctuation">)</span><span class="token punctuation">;</span> 
           <span class="token keyword">if</span> <span class="token punctuation">(</span>ck_abort<span class="token punctuation">.</span><span class="token function">isChecked</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
               <span class="token function">abortBroadcast</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 中断广播，此时后面的接收器无法收到该广播 </span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> 
 <span class="token punctuation">}</span> 
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>3 ．注册有序广播的多个接收器</strong></p><p>接收器的注册操作同样调用registerReceiver方法，为了给接收器排队，还需调用意图过滤器的setPriority方法设置优先级，优先级越大的接收器，越先收到有序广播。如果不设置优先级，或者两个接收器的优先级相等，那么越早注册的接收器，会越先收到有序广播。譬如以下的广播注册代码，尽管接收器A更早注册，但接收器B的优先级更高，结果先收到广播的应当是接收器B。</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>orderAReceiver <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OrderAReceiver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 创建一个有序广播的接收器A </span>
<span class="token comment">// 创建一个意图过滤器A，只处理ORDER_ACTION的广播</span>
<span class="token class-name">IntentFilter</span> filterA <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IntentFilter</span><span class="token punctuation">(</span><span class="token constant">ORDER_ACTION</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
filterA<span class="token punctuation">.</span><span class="token function">setPriority</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 设置过滤器A的优先级，数值越大优先级越高</span>
<span class="token function">registerReceiver</span><span class="token punctuation">(</span>orderAReceiver<span class="token punctuation">,</span> filterA<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 注册接收器A，注册之后才能正常接收广播 </span>
orderBReceiver <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OrderBReceiver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 创建一个有序广播的接收器B</span>
<span class="token comment">// 创建一个意图过滤器A，只处理ORDER_ACTION的广播</span>
<span class="token class-name">IntentFilter</span> filterB <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IntentFilter</span><span class="token punctuation">(</span><span class="token constant">ORDER_ACTION</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
filterB<span class="token punctuation">.</span><span class="token function">setPriority</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 设置过滤器B的优先级，数值越大优先级越高</span>
<span class="token function">registerReceiver</span><span class="token punctuation">(</span>orderBReceiver<span class="token punctuation">,</span> filterB<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 注册接收器B，注册之后才能正常接收广播</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>接下来通过测试页面演示有序广播的收发，如果没要求中断广播，则有序广播的接收界面如图9-3所示，此时接收器B和接收器A依次收到了广播；如果要求中断广播，则有序广播的接收界面如图9-4所示，此时只有接收器B收到了广播。</p><img src="https://gitee.com/xiaweifeng/picgo/raw/master/images/202207112028025.png" alt="image-20220711202806950" style="zoom:50%;"><p>图9-3　依次接收有序广播</p><img src="https://gitee.com/xiaweifeng/picgo/raw/master/images/202207112028438.png" alt="image-20220711202819353" style="zoom:50%;"><p>图9-4　中途打断有序广播</p><h3 id="_9-1-3-收发静态广播" tabindex="-1"><a class="header-anchor" href="#_9-1-3-收发静态广播" aria-hidden="true">#</a> 9.1.3　收发静态广播</h3><p>前面几节使用广播之时，无一例外在代码中注册接收器。可是同为 4 大组件，活动（activity）、服务（service）、内容提供器（provider）都能在AndroidManifest.xml注册，为啥广播只能在代码中注册呢？其实广播接收器也能在AndroidManifest.xml注册，并且注册时候的节点名为receiver，一旦接收器在AndroidManifest.xml注册，就无须在代码中注册了。在AndroidManifest.xml中注册接收器，该方式被称作静态注册；而在代码中注册接收器，该方式被称作动态注册。之所以罕见静态注册，是因为静态注册容易导致安全问题，故而Android 8.0之后废弃了大多数静态注册。话虽如此，Android倒也没有彻底禁止静态注册，只要满足特定的编码条件，那么依然能够通过静态方式注册接收器。具体注册步骤说明如下。</p><p>首先右击当前模块的默认包，依次选择右键菜单的New→Package，创建名为receiver的新包，用于存放静态注册的接收器代码。其次右击刚创建的receiver包，依次选择右键菜单的New→Other→Broadcast Receiver，弹出如图9-5所示的组件创建对话框。</p><img src="https://gitee.com/xiaweifeng/picgo/raw/master/images/202207112058872.png" alt="image-20220711205854786" style="zoom:70%;"><p>图9-5　广播组件的创建对话框</p><p>在组件创建对话框的Class Name一栏填写接收器的类名，比如ShockReceiver，再单击对话框右下角的Finish按钮。之后Android Studio自动在receiver包内创建代码文件ShockReceiver.java，且接收器的默认代码如下所示：</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ShockReceiver</span> <span class="token keyword">extends</span> <span class="token class-name">BroadcastReceiver</span> <span class="token punctuation">{</span> 
   <span class="token annotation punctuation">@Override</span>
   <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onReceive</span><span class="token punctuation">(</span><span class="token class-name">Context</span> context<span class="token punctuation">,</span> <span class="token class-name">Intent</span> intent<span class="token punctuation">)</span> <span class="token punctuation">{</span>         
 <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>同时AndroidManifest.xml自动添加接收器的节点配置，默认的receiver配置如下所示：</p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>receiver</span>
<span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>.receiver.ShockReceiver<span class="token punctuation">&quot;</span></span>
<span class="token attr-name"><span class="token namespace">android:</span>enabled</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span>
<span class="token attr-name"><span class="token namespace">android:</span>exported</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>receiver</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>然而自动生成的接收器不仅啥都没干，还丢出一个异常UnsupportedOperationException。明显这个接收器没法用，为了感知到接收器正在工作，可以考虑在onReceive方法中记录日志，也可在该方法中震动手机。因为ShockReceiver未依附于任何活动，自然无法直接操作界面控件，所以只能观察程序日志，或者干脆让手机摇晃起来。实现手机震动之时，要调用getSystemService方法，先从系统服务VIBRATOR_SERVICE获取震动管理器Vibrator，再调用震动管理器的vibrate方法震动手机。包含手机震动功能的接收器代码示例如下：</p><p>（完整代码见chapter09\src\main\java\com\example\chapter09\receiver\ShockReceiver.java）</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ShockReceiver</span> <span class="token keyword">extends</span> <span class="token class-name">BroadcastReceiver</span> <span class="token punctuation">{</span>
   <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">TAG</span> <span class="token operator">=</span> <span class="token string">&quot;ShockReceiver&quot;</span><span class="token punctuation">;</span>
   <span class="token comment">// 静态注册时候的action、发送广播时的action、接收广播时的action，三者需要保持一致</span>
   <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">SHOCK_ACTION</span> <span class="token operator">=</span> <span class="token string">&quot;com.example.chapter09.shock&quot;</span><span class="token punctuation">;</span>
   <span class="token annotation punctuation">@Override</span>
   <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onReceive</span><span class="token punctuation">(</span><span class="token class-name">Context</span> context<span class="token punctuation">,</span> <span class="token class-name">Intent</span> intent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span><span class="token constant">TAG</span><span class="token punctuation">,</span> <span class="token string">&quot;onReceive&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token keyword">if</span> <span class="token punctuation">(</span>intent<span class="token punctuation">.</span><span class="token function">getAction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token class-name">ShockReceiver</span><span class="token punctuation">.</span><span class="token constant">SHOCK_ACTION</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
           <span class="token comment">// 从系统服务中获取震动管理器</span>
           <span class="token class-name">Vibrator</span> vb <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Vibrator</span><span class="token punctuation">)</span>
context<span class="token punctuation">.</span><span class="token function">getSystemService</span><span class="token punctuation">(</span><span class="token class-name">Context</span><span class="token punctuation">.</span><span class="token constant">VIBRATOR_SERVICE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           vb<span class="token punctuation">.</span><span class="token function">vibrate</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 命令震动器吱吱个若干秒，这里的500表示500毫秒 </span>
    <span class="token punctuation">}</span>
 <span class="token punctuation">}</span> 
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>由于震动手机需要申请对应的权限，因此打开AndroidManifest.xml添加以下的权限申请配置：</p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token comment">&lt;!-- 震动 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>uses-permission</span> <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>android.permission.VIBRATE<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span> 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>此外，接收器代码定义了一个动作名称，其值为“com.example.chapter09.shock”，表示onReceive方法只处理过滤该动作之后的广播，从而提高接收效率。除了在代码中过滤之外，还能修改AndroidManifest.xml，在receiver节点内部增加intent-filter标签加以过滤，添加过滤配置后的receiver节点信息如下所示：</p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>receiver</span>
<span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>.receiver.ShockReceiver<span class="token punctuation">&quot;</span></span>
<span class="token attr-name"><span class="token namespace">android:</span>enabled</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span>
<span class="token attr-name"><span class="token namespace">android:</span>exported</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span> 
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>intent-filter</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>action</span> <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.example.chapter09.shock<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span> 
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>intent-filter</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>receiver</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>终于到了发送广播这步，由于Android 8.0之后删除了大部分静态注册，防止App退出后仍在收听广播，因此为了让应用能够继续接收静态广播，需要给静态广播指定包名，也就是调用意图对象的setComponent方法设置组件路径。详细的静态广播发送代码示例如下：</p><p>（完整代码见chapter09\src\main\java\com\example\chapter09\BroadStaticActivity.java）</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">String</span> receiverPath <span class="token operator">=</span> <span class="token string">&quot;com.example.chapter09.receiver.ShockReceiver&quot;</span><span class="token punctuation">;</span>
<span class="token class-name">Intent</span> intent <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Intent</span><span class="token punctuation">(</span><span class="token class-name">ShockReceiver</span><span class="token punctuation">.</span><span class="token constant">SHOCK_ACTION</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 创建一个指定动作的意图 </span>
<span class="token comment">// 发送静态广播之时，需要通过setComponent方法指定接收器的完整路径</span>
<span class="token class-name">ComponentName</span> componentName  <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ComponentName</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> receiverPath<span class="token punctuation">)</span><span class="token punctuation">;</span> 
intent<span class="token punctuation">.</span><span class="token function">setComponent</span><span class="token punctuation">(</span>componentName<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 设置意图的组件信息 </span>
<span class="token function">sendBroadcast</span><span class="token punctuation">(</span>intent<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 发送静态广播</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>经过上述的编码以及配置工作，总算完成了静态广播的发送与接收流程。特别注意，经过整改的静态注册只适用于接收App自身的广播，不能接收系统广播，也不能接收其他应用的广播。运行测试App，初始的广播发送界面如图9-6所示，点击发送按钮触发静态广播，接着接收器收到广播信息，手机随之震动了若干时间，说明静态注册的接收器奏效了。</p><img src="https://gitee.com/xiaweifeng/picgo/raw/master/images/202207112104771.png" alt="image-20220711210456686" style="zoom:50%;"><p>图9-6　收到静态注册的震动广播</p><h2 id="_9-2-监听系统广播" tabindex="-1"><a class="header-anchor" href="#_9-2-监听系统广播" aria-hidden="true">#</a> 9.2　监听系统广播</h2><p>本节介绍了几种系统广播的监听办法，包括如何接收分钟到达广播、如何接收网络变更广播、如何监听定时管理器发出的系统闹钟广播等。</p><h3 id="_9-2-1-接收分钟到达广播" tabindex="-1"><a class="header-anchor" href="#_9-2-1-接收分钟到达广播" aria-hidden="true">#</a> 9.2.1　接收分钟到达广播</h3><p>除了应用自身的广播，系统也会发出各式各样的广播，通过监听这些系统广播，App能够得知周围环境发生了什么变化，从而按照最新环境调整运行逻辑。分钟到达广播便是系统广播之一，每当时钟到达某分零秒，也就是跳到新的分钟时刻，系统就通过全局大喇叭播报分钟广播。App只要在运行时侦听分钟广播Intent.ACTION_TIME_TICK，即可在分钟切换之际收到广播信息。由于分钟广播属于系统广播，发送操作已经交给系统了，因此若要侦听分钟广播，App只需实现该广播的接收操作。具体到编码上，接收分钟广播可分解为下面 3 个步骤：</p><p>步骤一，定义一个分钟广播的接收器，并重写接收器的onReceive方法，补充收到广播之后的处理逻辑。</p><p>步骤二，重写活动页面的onStart方法，添加广播接收器的注册代码，注意要让接收器过滤分钟到达广播Intent.ACTION_TIME_TICK。</p><p>步骤三，重写活动页面的onStop方法，添加广播接收器的注销代码。</p><p>根据上述逻辑编写活动代码，使之监听系统发来的分钟广播，下面是演示页面的活动代码例子：</p><p>（完整代码见chapter09\src\main\java\com\example\chapter09\SystemMinuteActivity.java）</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SystemMinuteActivity</span> <span class="token keyword">extends</span> <span class="token class-name">AppCompatActivity</span> <span class="token punctuation">{</span>
   <span class="token keyword">private</span> <span class="token class-name">TextView</span> tv_minute<span class="token punctuation">;</span> <span class="token comment">// 声明一个文本视图对象</span>
   <span class="token keyword">private</span> <span class="token class-name">String</span> desc <span class="token operator">=</span> <span class="token string">&quot;开始侦听分钟广播，请稍等。注意要保持屏幕亮着，才能正常收到广播&quot;</span><span class="token punctuation">;</span>
   <span class="token annotation punctuation">@Override</span>
   <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">onCreate</span><span class="token punctuation">(</span><span class="token class-name">Bundle</span> savedInstanceState<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token function">setContentView</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>layout<span class="token punctuation">.</span>activity_system_minute<span class="token punctuation">)</span><span class="token punctuation">;</span>
       tv_minute <span class="token operator">=</span> <span class="token function">findViewById</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>tv_minute<span class="token punctuation">)</span><span class="token punctuation">;</span>
       tv_minute<span class="token punctuation">.</span><span class="token function">setText</span><span class="token punctuation">(</span>desc<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
   <span class="token annotation punctuation">@Override</span>
   <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">onStart</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onStart</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       timeReceiver <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TimeReceiver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 创建一个分钟变更的广播接收器</span>
       <span class="token comment">// 创建一个意图过滤器，只处理系统分钟变化的广播</span>
       <span class="token class-name">IntentFilter</span> filter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IntentFilter</span><span class="token punctuation">(</span><span class="token class-name">Intent</span><span class="token punctuation">.</span><span class="token constant">ACTION_TIME_TICK</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token function">registerReceiver</span><span class="token punctuation">(</span>timeReceiver<span class="token punctuation">,</span> filter<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 注册接收器，注册之后才能正常接收广播</span>
 <span class="token punctuation">}</span>
   <span class="token annotation punctuation">@Override</span>
   <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">onStop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onStop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token function">unregisterReceiver</span><span class="token punctuation">(</span>timeReceiver<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 注销接收器，注销之后就不再接收广播</span>
 <span class="token punctuation">}</span>
   <span class="token keyword">private</span> <span class="token class-name">TimeReceiver</span> timeReceiver<span class="token punctuation">;</span> <span class="token comment">// 声明一个分钟广播的接收器实例</span>
   <span class="token comment">// 定义一个分钟广播的接收器</span>
   <span class="token keyword">private</span> <span class="token keyword">class</span> <span class="token class-name">TimeReceiver</span> <span class="token keyword">extends</span> <span class="token class-name">BroadcastReceiver</span> <span class="token punctuation">{</span>
       <span class="token comment">// 一旦接收到分钟变更的广播，马上触发接收器的onReceive方法</span>
       <span class="token annotation punctuation">@Override</span>
       <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onReceive</span><span class="token punctuation">(</span><span class="token class-name">Context</span> context<span class="token punctuation">,</span> <span class="token class-name">Intent</span> intent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
           <span class="token keyword">if</span> <span class="token punctuation">(</span>intent <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
               desc <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">&quot;%s\n%s 收到一个分钟到达广播%s&quot;</span><span class="token punctuation">,</span> desc<span class="token punctuation">,</span>
                       <span class="token class-name">DateUtil</span><span class="token punctuation">.</span><span class="token function">getNowTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> intent<span class="token punctuation">.</span><span class="token function">getAction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
               tv_minute<span class="token punctuation">.</span><span class="token function">setText</span><span class="token punctuation">(</span>desc<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
 <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>运行测试App，初始界面如图9-7所示，稍等片刻直到下一分钟到来，界面马上多了广播日志，如图9-8所示，可见此时准点收到了系统发出的分钟到达广播。</p><img src="https://gitee.com/xiaweifeng/picgo/raw/master/images/202207120945614.png" alt="image-20220712094555507" style="zoom:50%;"><p>图9-7　准备接收分钟广播</p><img src="https://gitee.com/xiaweifeng/picgo/raw/master/images/202207120946514.png" alt="image-20220712094619433" style="zoom:50%;"><p>图9-8　收听到了分钟广播</p><h3 id="_9-2-2-接收网络变更广播" tabindex="-1"><a class="header-anchor" href="#_9-2-2-接收网络变更广播" aria-hidden="true">#</a> 9.2.2　接收网络变更广播</h3><p>除了分钟广播，网络变更广播也很常见，因为手机可能使用WiFi上网，也可能使用数据连接上网，而后者会产生流量费用，所以手机浏览器都提供了“智能无图”的功能，连上WiFi网络时才显示网页上的图片，没连上WiFi就不显示图片。这类业务场景就要求侦听网络变更广播，对于当前网络变成WiFi连接、变成数据连接的两种情况，需要分别判断并加以处理。</p><p>接收网络变更广播可分解为下面 3 个步骤：</p><p>步骤一，定义一个网络广播的接收器，并重写接收器的onReceive方法，补充收到广播之后的处理逻辑。</p><p>步骤二，重写活动页面的onStart方法，添加广播接收器的注册代码，注意要让接收器过滤网络变更广播 android.net.conn.CONNECTIVITY_CHANGE。</p><p>步骤三，重写活动页面的onStop方法，添加广播接收器的注销代码。</p><p>上述 3 个步骤中，尤为注意第一步骤，因为onReceive方法只表示收到了网络广播，至于变成哪种网络，还得把广播消息解包才知道是怎么回事。网络广播携带的包裹中有个名为networkInfo的对象，其数据类型为NetworkInfo，于是调用NetworkInfo对象的相关方法，即可获取详细的网络信息。下面是NetworkInfo的常用方法说明：</p><ul><li><p>getType：获取网络类型。网络类型的取值说明见表9-1。</p><p><img src="https://gitee.com/xiaweifeng/picgo/raw/master/images/202207120949439.png" alt="image-20220712094927352"></p></li><li><p>getTypeName：获取网络类型的名称。</p></li><li><p>getSubtype：获取网络子类型。当网络类型为数据连接时，子类型为2G/3G/4G的细分类型，如CDMA、EVDO、HSDPA、LTE等。网络子类型的取值说明见表9-2。</p><p><img src="https://gitee.com/xiaweifeng/picgo/raw/master/images/image-20220712094957631.png" alt=""></p></li><li><p>getSubtypeName：获取网络子类型的名称。</p></li><li><p>getState：获取网络状态。网络状态的取值说明见表9-3。</p><p><img src="https://gitee.com/xiaweifeng/picgo/raw/master/images/202207120951303.png" alt="image-20220712095128207"></p><p>根据梳理后的解包逻辑编写活动代码，使之监听系统发来的网络变更广播，下面是演示页面的代码片段：</p><p>（完整代码见chapter09\src\main\java\com\example\chapter09\SystemNetworkActivity.java）</p></li></ul><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">onStart</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
   <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onStart</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   networkReceiver <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NetworkReceiver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 创建一个网络变更的广播接收器 </span>
   <span class="token comment">// 创建一个意图过滤器，只处理网络状态变化的广播</span>
   <span class="token class-name">IntentFilter</span> filter <span class="token operator">=</span> <span class="token keyword">new</span>
<span class="token class-name">IntentFilter</span><span class="token punctuation">(</span><span class="token string">&quot;android.net.conn.CONNECTIVITY_CHANGE&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">registerReceiver</span><span class="token punctuation">(</span>networkReceiver<span class="token punctuation">,</span> filter<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 注册接收器，注册之后才能正常接收广播 </span>
<span class="token punctuation">}</span>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">onStop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
   <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onStop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">unregisterReceiver</span><span class="token punctuation">(</span>networkReceiver<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 注销接收器，注销之后就不再接收广播 </span>
<span class="token punctuation">}</span>
<span class="token keyword">private</span> <span class="token class-name">NetworkReceiver</span> networkReceiver<span class="token punctuation">;</span> <span class="token comment">// 声明一个网络变更的广播接收器实例 </span>
<span class="token comment">// 定义一个网络变更的广播接收器</span>
<span class="token keyword">private</span> <span class="token keyword">class</span> <span class="token class-name">NetworkReceiver</span> <span class="token keyword">extends</span> <span class="token class-name">BroadcastReceiver</span> <span class="token punctuation">{</span> 
   <span class="token comment">// 一旦接收到网络变更的广播，马上触发接收器的onReceive方法 </span>
   <span class="token annotation punctuation">@Override</span>
   <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onReceive</span><span class="token punctuation">(</span><span class="token class-name">Context</span> context<span class="token punctuation">,</span> <span class="token class-name">Intent</span> intent<span class="token punctuation">)</span> <span class="token punctuation">{</span> 
       <span class="token keyword">if</span> <span class="token punctuation">(</span>intent <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
           <span class="token class-name">NetworkInfo</span> networkInfo <span class="token operator">=</span> intent<span class="token punctuation">.</span><span class="token function">getParcelableExtra</span><span class="token punctuation">(</span><span class="token string">&quot;networkInfo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
           <span class="token class-name">String</span> networkClass <span class="token operator">=</span>
<span class="token class-name">NetworkUtil</span><span class="token punctuation">.</span><span class="token function">getNetworkClass</span><span class="token punctuation">(</span>networkInfo<span class="token punctuation">.</span><span class="token function">getSubtype</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           desc <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">&quot;%s\n%s 收到一个网络变更广播，网络大类为%s，&quot;</span> <span class="token operator">+</span> 
                                <span class="token string">&quot;网络小类为%s，网络制式为%s，网络状态为%s&quot;</span><span class="token punctuation">,</span> 
                                desc<span class="token punctuation">,</span> <span class="token class-name">DateUtil</span><span class="token punctuation">.</span><span class="token function">getNowTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
networkInfo<span class="token punctuation">.</span><span class="token function">getTypeName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                                networkInfo<span class="token punctuation">.</span><span class="token function">getSubtypeName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> networkClass<span class="token punctuation">,</span> 
                                networkInfo<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           tv_network<span class="token punctuation">.</span><span class="token function">setText</span><span class="token punctuation">(</span>desc<span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token punctuation">}</span>
 <span class="token punctuation">}</span> 
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>运行测试App，初始界面如图9-9所示，说明手机正在使用数据连接。然后关闭数据连接，再开启WLAN，此时界面日志如图9-10所示，可见App果然收到了网络广播，并且正确从广播信息中得知已经切换到了WiFi网络。</p><img src="https://gitee.com/xiaweifeng/picgo/raw/master/images/202207120955124.png" alt="image-20220712095514037" style="zoom:50%;"><p>图9-9　收到数据连接的网络广播</p><img src="https://gitee.com/xiaweifeng/picgo/raw/master/images/202207120955229.png" alt="image-20220712095528133" style="zoom:50%;"><p>图9-10　切换到WiFi的网络广播</p><h3 id="_9-2-3-定时管理器alarmmanager" tabindex="-1"><a class="header-anchor" href="#_9-2-3-定时管理器alarmmanager" aria-hidden="true">#</a> 9.2.3　定时管理器AlarmManager</h3><p>尽管系统的分钟广播能够实现定时功能（每分钟一次），但是这种定时功能太低级了，既不能定制可长可短的时间间隔，也不能限制定时广播的次数。为此Android提供了专门的定时管理器AlarmManager，它利用系统闹钟定时发送广播，比分钟广播拥有更强大的功能。由于闹钟与震动器同属系统服务，且闹钟的服务名称为ALARM_SERVICE，因此依然调用getSystemService方法获取闹钟管理器的实例，下面是从系统服务中获取闹钟管理器的代码：</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 从系统服务中获取闹钟管理器</span>
<span class="token class-name">AlarmManager</span> alarmMgr <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">AlarmManager</span><span class="token punctuation">)</span> <span class="token function">getSystemService</span><span class="token punctuation">(</span><span class="token constant">ALARM_SERVICE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>得到闹钟实例后，即可调用它的各种方法设置闹钟规则了，AlarmManager的常见方法说明如下：</p><ul><li><p>set：设置一次性定时器。第一个参数为定时器类型，通常填AlarmManager.RTC_WAKEUP；第二个参数为期望的执行时刻（单位为毫秒）；第三个参数为待执行的延迟意图（PendingIntent类型）。</p></li><li><p>setAndAllowWhileIdle：设置一次性定时器，参数说明同set方法，不同之处在于：即使设备处于空闲状态，也会保证执行定时器。因为从Android 6.0开始，set方法在暗屏时不保证发送广播，必须调用setAndAllowWhileIdle方法才能保证发送广播。</p></li><li><p>setRepeating：设置重复定时器。第一个参数为定时器类型；第二个参数为首次执行时间（单位为毫秒）；第三个参数为下次执行的间隔时间（单位为毫秒）；第四个参数为待执行的延迟意图（PendingIntent类型）。然而从Android 4.4开始，setRepeating方法不保证按时发送广播，只能通过setAndAllowWhileIdle方法间接实现重复定时功能。</p></li><li><p>cancel：取消指定延迟意图的定时器。</p></li></ul><p>以上的方法说明出现了新名词—延迟意图，它是PendingIntent类型，顾名思义，延迟意图不是马上执行的意图，而是延迟若干时间才执行的意图。像之前的活动页面跳转，调用startActivity方法跳到下个页面，此时跳转动作是立刻发生的，所以要传入Intent对象。由于定时器的广播不是立刻发送的，而是时刻到达了才发送广播，因此不能传Intent对象只能传PendingIntent对象。当然意图与延迟意图不止一处区别，它们的差异主要有下列 3 点：</p><p>（ 1 ）PendingIntent代表延迟的意图，它指向的组件不会马上激活；而Intent代表实时的意图，一旦被启动，它指向的组件就会马上激活。</p><p>（ 2 ）PendingIntent是一类消息的组合，不但包含目标的Intent对象，还包含请求代码、请求方式等信息。</p><p>（ 3 ）PendingIntent对象在创建之时便已知晓将要用于活动还是广播，例如调用getActivity方法得到的是活动跳转的延迟意图，调用getBroadcast方法得到的是广播发送的延迟意图。</p><p>就闹钟广播的收发过程而言，需要实现 3 个编码步骤：定义定时器的广播接收器、开关定时器的广播接收器、设置定时器的播报规则，分别叙述如下。</p><p><strong>1 ．定义定时器的广播接收器</strong></p><p>闹钟广播的接收器采用动态注册方式，它的实现途径与标准广播类似，都要从BroadcastReceiver派生新的接收器，并重写onReceive方法。闹钟广播接收器的定义代码示例如下：</p><p>（完整代码见chapter09\src\main\java\com\example\chapter09\AlarmActivity.java）</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 声明一个闹钟广播事件的标识串</span>
<span class="token keyword">private</span> <span class="token class-name">String</span> <span class="token constant">ALARM_ACTION</span> <span class="token operator">=</span> <span class="token string">&quot;com.example.chapter09.alarm&quot;</span><span class="token punctuation">;</span> 
<span class="token keyword">private</span> <span class="token class-name">String</span> mDesc <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span> <span class="token comment">// 闹钟时间到达的述</span>
<span class="token comment">// 定义一个闹钟广播的接收器</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AlarmReceiver</span> <span class="token keyword">extends</span> <span class="token class-name">BroadcastReceiver</span> <span class="token punctuation">{</span> 
   <span class="token comment">// 一旦接收到闹钟时间到达的广播，马上触发接收器的onReceive方法 </span>
   <span class="token annotation punctuation">@Override</span>
   <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onReceive</span><span class="token punctuation">(</span><span class="token class-name">Context</span> context<span class="token punctuation">,</span> <span class="token class-name">Intent</span> intent<span class="token punctuation">)</span> <span class="token punctuation">{</span> 
       <span class="token keyword">if</span> <span class="token punctuation">(</span>intent <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
           mDesc <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">&quot;%s\n%s 闹钟时间到达&quot;</span><span class="token punctuation">,</span> mDesc<span class="token punctuation">,</span> 
<span class="token class-name">DateUtil</span><span class="token punctuation">.</span><span class="token function">getNowTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           tv_alarm<span class="token punctuation">.</span><span class="token function">setText</span><span class="token punctuation">(</span>mDesc<span class="token punctuation">)</span><span class="token punctuation">;</span> 
           <span class="token comment">// 从系统服务中获取震动管理器 </span>
           <span class="token class-name">Vibrator</span> vb <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Vibrator</span><span class="token punctuation">)</span>
context<span class="token punctuation">.</span><span class="token function">getSystemService</span><span class="token punctuation">(</span><span class="token class-name">Context</span><span class="token punctuation">.</span><span class="token constant">VIBRATOR_SERVICE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           vb<span class="token punctuation">.</span><span class="token function">vibrate</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 命令震动器吱吱个若干秒             </span>
    <span class="token punctuation">}</span>
 <span class="token punctuation">}</span> 
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>2 ．开关定时器的广播接收器</strong></p><p>定时接收器的开关流程参照标准广播，可以在活动页面的onStart方法中注册接收器，在活动页面的onStop方法中注销接收器。相应的接收器开关代码如下所示：</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token class-name">AlarmReceiver</span> alarmReceiver<span class="token punctuation">;</span> <span class="token comment">// 声明一个闹钟的广播接收器 </span>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onStart</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
   <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onStart</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   alarmReceiver <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AlarmReceiver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 创建一个闹钟的广播接收器 </span>
   <span class="token comment">// 创建一个意图过滤器，只处理指定事件来源的广播</span>
   <span class="token class-name">IntentFilter</span> filter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IntentFilter</span><span class="token punctuation">(</span><span class="token constant">ALARM_ACTION</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">registerReceiver</span><span class="token punctuation">(</span>alarmReceiver<span class="token punctuation">,</span> filter<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 注册接收器，注册之后才能正常接收广播 </span>
<span class="token punctuation">}</span>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onStop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
   <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onStop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">unregisterReceiver</span><span class="token punctuation">(</span>alarmReceiver<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 注销接收器，注销之后就不再接收广播 </span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>3 ．设置定时器的播报规则</strong></p><p>首先从系统服务中获取闹钟管理器，然后调用管理器的set***方法，把事先创建的延迟意图填到播报规则当中。下面是发送闹钟广播的代码例子：</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 发送闹钟广播</span>
<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">sendAlarm</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token class-name">Intent</span> intent <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Intent</span><span class="token punctuation">(</span><span class="token constant">ALARM_ACTION</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 创建一个广播事件的意图 </span>
   <span class="token comment">// 创建一个用于广播的延迟意图</span>
   <span class="token class-name">PendingIntent</span> pIntent <span class="token operator">=</span> <span class="token class-name">PendingIntent</span><span class="token punctuation">.</span><span class="token function">getBroadcast</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> 
                                                      intent<span class="token punctuation">,</span> 
<span class="token class-name">PendingIntent</span><span class="token punctuation">.</span><span class="token constant">FLAG_UPDATE_CURRENT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token comment">// 从系统服务中获取闹钟管理器</span>
   <span class="token class-name">AlarmManager</span> alarmMgr <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">AlarmManager</span><span class="token punctuation">)</span> <span class="token function">getSystemService</span><span class="token punctuation">(</span><span class="token constant">ALARM_SERVICE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">long</span> delayTime <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> mDelay<span class="token operator">*</span><span class="token number">1000</span><span class="token punctuation">;</span> <span class="token comment">// 给当前时间加上若干 </span>
秒
   <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Build</span><span class="token punctuation">.</span><span class="token constant">VERSION</span><span class="token punctuation">.</span><span class="token constant">SDK_INT</span> <span class="token operator">&gt;=</span> <span class="token class-name">Build<span class="token punctuation">.</span>VERSION_CODES<span class="token punctuation">.</span>M</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
       <span class="token comment">// 允许在空闲时发送广播，Android6.0之后新增的方法</span>
       alarmMgr<span class="token punctuation">.</span><span class="token function">setAndAllowWhileIdle</span><span class="token punctuation">(</span><span class="token class-name">AlarmManager</span><span class="token punctuation">.</span><span class="token constant">RTC_WAKEUP</span><span class="token punctuation">,</span> delayTime<span class="token punctuation">,</span> 
pIntent<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
       <span class="token comment">// 设置一次性闹钟，延迟若干秒后，携带延迟意图发送闹钟广播（但Android6.0之后，set方法在暗屏时不保证发送广播，必须调用setAndAllowWhileIdle方法）</span>
       alarmMgr<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token class-name">AlarmManager</span><span class="token punctuation">.</span><span class="token constant">RTC_WAKEUP</span><span class="token punctuation">,</span> delayTime<span class="token punctuation">,</span> pIntent<span class="token punctuation">)</span><span class="token punctuation">;</span> 
 <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>完成上述的 3 个步骤之后，运行测试App，点击“设置闹钟”按钮，界面下方回显闹钟的设置信息，如图9-11 所示。稍等片刻，发现回显文本多了一行日志，如图9-12所示，同时手机也嗡嗡震动了一会，对比日志时间可知，闹钟广播果然在设定的时刻触发且收听了。</p><img src="https://gitee.com/xiaweifeng/picgo/raw/master/images/202207121001426.png" alt="image-20220712100153332" style="zoom:50%;"><p>图9-11 刚刚设置闹钟</p><img src="https://gitee.com/xiaweifeng/picgo/raw/master/images/202207121002297.png" alt="image-20220712100214203" style="zoom:50%;"><p>图9-12 收到闹钟广播</p><p>至于闹钟的重复播报问题，因为setRepeating方法不再可靠，所以要修改闹钟的收听逻辑，在onReceive末尾补充调用sendAlarm方法，确保每次收到广播之后立即准备下一个广播。调整以后的onReceive方法代码示例如下：</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onReceive</span><span class="token punctuation">(</span><span class="token class-name">Context</span> context<span class="token punctuation">,</span> <span class="token class-name">Intent</span> intent<span class="token punctuation">)</span> <span class="token punctuation">{</span> 
   <span class="token keyword">if</span> <span class="token punctuation">(</span>intent <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        
       <span class="token keyword">if</span> <span class="token punctuation">(</span>ck_repeate<span class="token punctuation">.</span><span class="token function">isChecked</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 需要重复闹钟广播 </span>
           <span class="token function">sendAlarm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 发送闹钟广播</span>
    <span class="token punctuation">}</span> 
 <span class="token punctuation">}</span> 
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_9-3-捕获屏幕的变更事件" tabindex="-1"><a class="header-anchor" href="#_9-3-捕获屏幕的变更事件" aria-hidden="true">#</a> 9.3　捕获屏幕的变更事件</h2><p>本节介绍几种屏幕变更事件的捕获办法，包括如何监听竖屏与横屏之间的切换事件、如何监听从App界面回到桌面的事件、如何监听从App界面切换到任务列表的事件等。</p><h3 id="_9-3-1-竖屏与横屏切换" tabindex="-1"><a class="header-anchor" href="#_9-3-1-竖屏与横屏切换" aria-hidden="true">#</a> 9.3.1　竖屏与横屏切换</h3><p>除了系统广播之外，App所处的环境也会影响运行，比如手机有竖屏与横屏两种模式，竖屏时水平方向较短而垂直方向较长，横屏时水平方向较长而垂直方向较短。两种屏幕方向不但造成App界面的展示差异，而且竖屏和横屏切换之际，甚至会打乱App的生命周期。</p><p>接下来做个实验观察屏幕方向切换给生命周期带来的影响，现有一个测试页面ActTestActivity.java，参考第 4 章的“4.1.2 Activity的生命周期”，它的活动代码重写了主要的生命周期方法，在每个周期方法中都打印状态日志，完整代码见chapter09\src\main\java\com\example\chapter09\ActTestActivity.java。运行测试App，初始的竖屏界面如图9-13所示；接着旋转手机使之处于横屏，测试App也跟着转过来，此时横屏界面如图9-14所示。</p><img src="https://gitee.com/xiaweifeng/picgo/raw/master/images/202207121004688.png" alt="image-20220712100446593" style="zoom:50%;"><p>图9-13　初始的竖屏界面</p><img src="https://gitee.com/xiaweifeng/picgo/raw/master/images/202207121005914.png" alt="image-20220712100507818" style="zoom:50%;"><p>图9-14　切换到横屏界面</p><p>对比图9-13的竖屏界面和图9-14的横屏界面，发现二者打印的生命周期时间居然是不一样的，而且横屏界面的日志时间全部在竖屏界面的日志时间后面，说明App从竖屏变为横屏的时候，整个活动页面又重头创建了一遍。可是这个逻辑明显不对劲啊，从竖屏变为横屏，App界面就得重新加载；再从横屏变回竖屏，App界面又得重新加载，如此反复重启页面，无疑非常浪费系统资源。</p><p>为了避免横竖屏切换时重新加载界面的情况，Android设计了一种配置变更机制，在指定的环境配置发生变更之时，无须重启活动页面，只需执行特定的变更行为。该机制的编码过程分为两步：修改</p><p>AndroidManifest.xml、修改活动页面的Java代码，详细说明如下。</p><p>1 ．修改AndroidManifest.xml</p><p>首先创建新的活动页面ChangeDirectionActivity，再打开AndroidManifest.xml，看到该活动对应的节点配置是下面这样的：</p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>activity</span> <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>.ChangeDirectionActivity<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>给这个activity节点增加android:configChanges属性，并将属性值设“orientation|screenLayout|screenSize”，修改后的节点配置如下所示：</p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>activity</span>
<span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>.ChangeDirectionActivity<span class="token punctuation">&quot;</span></span>
<span class="token attr-name"><span class="token namespace">android:</span>configChanges</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>orientation|screenLayout|screenSize<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>新属性configChanges的意思是，在某些情况之下，配置项变更不用重启活动页面，只需调用onConfigurationChanged方法重新设定显示方式。故而只要给该属性指定若干豁免情况，就能避免无谓的页面重启操作了，配置变更豁免情况的取值说明见表9-4。</p><p><img src="https://gitee.com/xiaweifeng/picgo/raw/master/images/202207121007164.png" alt="image-20220712100709066"></p><p>2 ．修改活动页面的Java代码</p><p>打开ChangeDirectionActivity的Java代码，重写活动的onConfigurationChanged方法，该方法的输入参数为Configuration类型的配置对象，根据配置对象的orientation属性，即可判断屏幕的当前方向是竖屏还是横屏，再补充对应的代码处理逻辑。下面是重写了onConfigurationChanged方法的活动代码例子：</p><p>（完整代码见chapter09\src\main\java\com\example\chapter09\ChangeDirectionActivity.java）</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ChangeDirectionActivity</span> <span class="token keyword">extends</span> <span class="token class-name">AppCompatActivity</span> <span class="token punctuation">{</span>
   <span class="token keyword">private</span> <span class="token class-name">TextView</span> tv_monitor<span class="token punctuation">;</span> <span class="token comment">// 声明一个文本视图对象</span>
   <span class="token keyword">private</span> <span class="token class-name">String</span> mDesc <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span> <span class="token comment">// 屏幕变更的述说明</span>
   <span class="token annotation punctuation">@Override</span>
   <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">onCreate</span><span class="token punctuation">(</span><span class="token class-name">Bundle</span> savedInstanceState<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token function">setContentView</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>layout<span class="token punctuation">.</span>activity_change_direction<span class="token punctuation">)</span><span class="token punctuation">;</span>
       tv_monitor <span class="token operator">=</span> <span class="token function">findViewById</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>tv_monitor<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
   <span class="token comment">// 在配置项变更时触发。比如屏幕方向发生变更等等</span>
   <span class="token comment">// 有的手机需要在系统的“设置→显示”菜单开启“自动旋转屏幕”，或者从顶部下拉，找到“自动旋转”图标并开启</span>
   <span class="token annotation punctuation">@Override</span>
   <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onConfigurationChanged</span><span class="token punctuation">(</span><span class="token class-name">Configuration</span> newConfig<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onConfigurationChanged</span><span class="token punctuation">(</span>newConfig<span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token keyword">switch</span> <span class="token punctuation">(</span>newConfig<span class="token punctuation">.</span>orientation<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 判断当前的屏幕方向</span>
           <span class="token keyword">case</span> <span class="token class-name">Configuration</span><span class="token punctuation">.</span><span class="token constant">ORIENTATION_PORTRAIT</span><span class="token operator">:</span> <span class="token comment">// 切换到竖屏</span>
               mDesc <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">&quot;%s%s %s\n&quot;</span><span class="token punctuation">,</span> mDesc<span class="token punctuation">,</span>
                       <span class="token class-name">DateUtil</span><span class="token punctuation">.</span><span class="token function">getNowTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;当前屏幕为竖屏方向&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
               tv_monitor<span class="token punctuation">.</span><span class="token function">setText</span><span class="token punctuation">(</span>mDesc<span class="token punctuation">)</span><span class="token punctuation">;</span>
               <span class="token keyword">break</span><span class="token punctuation">;</span>
           <span class="token keyword">case</span> <span class="token class-name">Configuration</span><span class="token punctuation">.</span><span class="token constant">ORIENTATION_LANDSCAPE</span><span class="token operator">:</span> <span class="token comment">// 切换到横屏</span>
               mDesc <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">&quot;%s%s %s\n&quot;</span><span class="token punctuation">,</span> mDesc<span class="token punctuation">,</span>
                       <span class="token class-name">DateUtil</span><span class="token punctuation">.</span><span class="token function">getNowTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;当前屏幕为横屏方向&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
               tv_monitor<span class="token punctuation">.</span><span class="token function">setText</span><span class="token punctuation">(</span>mDesc<span class="token punctuation">)</span><span class="token punctuation">;</span>
               <span class="token keyword">break</span><span class="token punctuation">;</span>
           <span class="token keyword">default</span><span class="token operator">:</span>
               <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
 <span class="token punctuation">}</span> 
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>运行测试App，一开始手机处于竖屏界面，旋转手机使之切为横屏状态，此时App界面如图9-15所示，可见App成功获知了变更后的屏幕方向。反向旋转手机使之切回竖屏状态，此时App界面如图9-16所示，可见App同样监听到了最新的屏幕方向。</p><p><img src="https://gitee.com/xiaweifeng/picgo/raw/master/images/202207121008387.png" alt="image-20220712100808285"></p><p>图9-15　切为横屏状态的界面</p><p><img src="https://gitee.com/xiaweifeng/picgo/raw/master/images/202207121008993.png" alt="image-20220712100814893"></p><p>图9-16　切回竖屏状态的界面</p><p>经过上述两个步骤的改造，每次横竖屏的切换操作都不再重启界面，只会执行onConfigurationChanged方法的代码逻辑，从而节省了系统的资源开销。如果希望App始终保持竖屏界面，即使手机旋转为横屏也不改变App的界面方向，可以修改 AndroidManifest.xml，给activity节点添加android:screenOrientation属性，并将该属性设置为portrait表示垂直方向，也就是保持竖屏界面；若该属性为landscape则表示水平方向，也就是保持横屏界面。修改后的activity节点示例如下：</p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>activity</span> <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>.ActTestActivity<span class="token punctuation">&quot;</span></span>
           <span class="token attr-name"><span class="token namespace">android:</span>screenOrientation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>portrait<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_9-3-2-回到桌面与切换到任务列表" tabindex="-1"><a class="header-anchor" href="#_9-3-2-回到桌面与切换到任务列表" aria-hidden="true">#</a> 9.3.2　回到桌面与切换到任务列表</h3><p>App不但能监测手机屏幕的方向变更，还能获知回到桌面的事件，连打开任务列表的事件也能实时得知。回到桌面与打开任务列表都由按键触发，例如按下主页键会回到桌面，按下任务键会打开任务列表。虽然这两个操作看起来属于按键事件，但系统并未提供相应的按键处理方法，而是通过广播发出事件信息。因此，若想知晓是否回到桌面，以及是否打开任务列表，均需收听系统广播Intent.ACTION_CLOSE_SYSTEM_DIALOGS。至于如何区分当前广播究竟是回到桌面还是打开任务列表，则要从广播意图中获取原因reason字段，该字段值为homekey时表示回到桌面，值为recentapps时表示打开任务列表。接下来演示一下此类广播的接收过程。首先定义一个广播接收器，只处理动作为Intent.ACTION_CLOSE_SYSTEM_DIALOGS的系统广播，并判断它是主页键来源还是任务键来源。该接收器的代码定义示例如下：</p><p>（完整代码见chapter09\src\main\java\com\example\chapter09\ReturnDesktopActivity.java）</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 定义一个返回到桌面的广播接收器</span>
<span class="token keyword">private</span> <span class="token keyword">class</span> <span class="token class-name">DesktopRecevier</span> <span class="token keyword">extends</span> <span class="token class-name">BroadcastReceiver</span> <span class="token punctuation">{</span>
   <span class="token comment">// 在收到返回桌面广播时触发</span>
   <span class="token annotation punctuation">@Override</span>
   <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onReceive</span><span class="token punctuation">(</span><span class="token class-name">Context</span> context<span class="token punctuation">,</span> <span class="token class-name">Intent</span> intent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">if</span> <span class="token punctuation">(</span>intent<span class="token punctuation">.</span><span class="token function">getAction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token class-name">Intent</span><span class="token punctuation">.</span><span class="token constant">ACTION_CLOSE_SYSTEM_DIALOGS</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
           <span class="token class-name">String</span> reason <span class="token operator">=</span> intent<span class="token punctuation">.</span><span class="token function">getStringExtra</span><span class="token punctuation">(</span><span class="token string">&quot;reason&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 获取变更原因</span>
           <span class="token comment">// 按下了主页键或者任务键</span>
           <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">TextUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>reason<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>reason<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">&quot;homekey&quot;</span><span class="token punctuation">)</span>
                                              <span class="token operator">||</span> reason<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">&quot;recentapps&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 
<span class="token punctuation">{</span>
               <span class="token function">showChangeStatus</span><span class="token punctuation">(</span>reason<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 显示变更的状态 </span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> 
 <span class="token punctuation">}</span> 
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>接着在活动页面的onCreate方法中注册接收器，在onDestroy方法中注销接收器，其中接收器的注册代码如下所示：</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token class-name">DesktopRecevier</span> desktopRecevier<span class="token punctuation">;</span> <span class="token comment">// 声明一个返回桌面的广播接收器对象 </span>
<span class="token comment">// 初始化桌面广播</span>
<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">initDesktopRecevier</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   desktopRecevier <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DesktopRecevier</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 创建一个返回桌面的广播接收器 </span>
   <span class="token comment">// 创建一个意图过滤器，只接收关闭系统对话框（即返回桌面）的广播</span>
   <span class="token class-name">IntentFilter</span> intentFilter <span class="token operator">=</span> <span class="token keyword">new</span>
<span class="token class-name">IntentFilter</span><span class="token punctuation">(</span><span class="token class-name">Intent</span><span class="token punctuation">.</span><span class="token constant">ACTION_CLOSE_SYSTEM_DIALOGS</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">registerReceiver</span><span class="token punctuation">(</span>desktopRecevier<span class="token punctuation">,</span> intentFilter<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 注册接收器，注册之后才能正常接收广播</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>可是监听回到桌面的广播能用来干什么呢？一种用处是开启App的画中画模式，比如原先应用正在播放视频，回到桌面时势必要暂停播放，有了画中画模式之后，可将播放界面缩小为屏幕上的一个小方块，这样即使回到桌面也能继续观看视频。注意从Android 8.0开始才提供画中画模式，故而代码需要判断系统版本，下面是进入画中画模式的代码例子：</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 显示变更的状态</span>
<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">showChangeStatus</span><span class="token punctuation">(</span><span class="token class-name">String</span> reason<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   mDesc <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">&quot;%s%s 按下了%s键\n&quot;</span><span class="token punctuation">,</span> mDesc<span class="token punctuation">,</span> <span class="token class-name">DateUtil</span><span class="token punctuation">.</span><span class="token function">getNowTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
reason<span class="token punctuation">)</span><span class="token punctuation">;</span>
   tv_monitor<span class="token punctuation">.</span><span class="token function">setText</span><span class="token punctuation">(</span>mDesc<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Build</span><span class="token punctuation">.</span><span class="token constant">VERSION</span><span class="token punctuation">.</span><span class="token constant">SDK_INT</span> <span class="token operator">&gt;=</span> <span class="token class-name">Build<span class="token punctuation">.</span>VERSION_CODES<span class="token punctuation">.</span>O</span>
       <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">isInPictureInPictureMode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 当前未开启画中画，则开启画中画模式 </span>
       <span class="token comment">// 创建画中画模式的参数构建器</span>
       <span class="token class-name">PictureInPictureParams<span class="token punctuation">.</span>Builder</span> builder <span class="token operator">=</span> <span class="token keyword">new</span> 
<span class="token class-name">PictureInPictureParams<span class="token punctuation">.</span>Builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token comment">// 设置宽高比例值，第一个参数表示分子，第二个参数表示分母 </span>
       <span class="token comment">// 下面的10/5=2，表示画中画窗口的宽度是高度的两倍</span>
       <span class="token class-name">Rational</span> aspectRatio <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Rational</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       builder<span class="token punctuation">.</span><span class="token function">setAspectRatio</span><span class="token punctuation">(</span>aspectRatio<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 设置画中画窗口的宽高比例</span>
       <span class="token comment">// 进入画中画模式，注意enterPictureInPictureMode是Android8.0之后新增的方法 </span>
       <span class="token function">enterPictureInPictureMode</span><span class="token punctuation">(</span>builder<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span> 
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>以上代码用于开启画中画模式，但有时希望在进入画中画之际调整界面，则需重写活动的onPictureInPictureModeChanged方法，该方法在应用进入画中画模式或退出画中画模式时触发，在此可补充相应的处理逻辑。重写后的方法代码示例如下：</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 在进入画中画模式或退出画中画模式时触发</span>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onPictureInPictureModeChanged</span><span class="token punctuation">(</span><span class="token keyword">boolean</span> isInPicInPicMode<span class="token punctuation">,</span> 
<span class="token class-name">Configuration</span> newConfig<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span><span class="token constant">TAG</span><span class="token punctuation">,</span> &quot;onPictureInPictureModeChanged 
isInPicInPicMode<span class="token operator">=</span>&quot;<span class="token operator">+</span>isInPicInPicMode<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onPictureInPictureModeChanged</span><span class="token punctuation">(</span>isInPicInPicMode<span class="token punctuation">,</span> newConfig<span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token keyword">if</span> <span class="token punctuation">(</span>isInPicInPicMode<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 进入画中画模式</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token comment">// 退出画中画模式 </span>
 <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>另外，画中画模式要求在AndroidManifest.xml中开启画中画支持，也就是给activity节点添加supportsPictureInPicture属性并设为true，添加新属性之后的activity配置示例如下：</p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>activity</span>
         <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>.ReturnDesktopActivity<span class="token punctuation">&quot;</span></span>
         <span class="token attr-name"><span class="token namespace">android:</span>configChanges</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>orientation|screenLayout|screenSize<span class="token punctuation">&quot;</span></span> 
         <span class="token attr-name"><span class="token namespace">android:</span>supportsPictureInPicture</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span>
         <span class="token attr-name"><span class="token namespace">android:</span>theme</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>@style/AppCompatTheme<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>运行测试App，正常的竖屏界面如图9-17所示。</p><img src="https://gitee.com/xiaweifeng/picgo/raw/master/images/202207121013193.png" alt="image-20220712101349084" style="zoom:50%;"><p>图9-17 App正常的竖屏界面</p><p>然后按下主页键，在回到桌面的同时，该应用自动开启画中画模式，变成悬浮于桌面的小窗，如图9-18所示。点击小窗会变成大窗，如图9-19所示，再次点击大窗才退出画中画模式，重新打开应用的完整界面。</p><img src="https://gitee.com/xiaweifeng/picgo/raw/master/images/202207121014426.png" alt="image-20220712101400317" style="zoom:50%;"><p>图9-18　开启了画中画模式的小窗</p><img src="https://gitee.com/xiaweifeng/picgo/raw/master/images/202207121014447.png" alt="image-20220712101414334" style="zoom:50%;"><p>图9-19　点击小窗变成大窗</p><h2 id="_9-4-小结" tabindex="-1"><a class="header-anchor" href="#_9-4-小结" aria-hidden="true">#</a> 9.4　小结</h2><p>本章主要介绍广播组件—Broadcast的常见用法，包括：正确收发应用广播（收发标准广播、收发有序广播、收发静态广播）、正确监听系统广播（接收分钟到达广播、接收网络变更广播、定时管理器AlarmManager）、正确捕获屏幕的变更事件（竖屏与横屏切换、回到桌面与切到任务列表）。</p><p>通过本章的学习，我们应该能掌握以下 3 种开发技能：</p><p>（ 1 ）了解广播的应用场景，并学会正确收发应用广播。</p><p>（ 2 ）了解常见的系统广播，并学会正确监听系统广播。</p><p>（ 3 ）了解屏幕变更的产生条件，并学会捕捉屏幕变更事件。</p><h2 id="_9-5-课后练习题" tabindex="-1"><a class="header-anchor" href="#_9-5-课后练习题" aria-hidden="true">#</a> 9.5　课后练习题</h2><p>一、填空题</p><p>1 ．活动只能一对一通信，而广播可以_通信。</p><p>2 ．通过静态方式注册广播，就要在AndroidManifest.xml中添加名为—的接收器标签。</p><p>3 ．—代表延迟的意图，它指向的组件不会马上激活。</p><p>4 ．手机的屏幕方向默认是—。</p><p>5 ．开启—模式之后，可将App界面缩小为屏幕上的一个方块。</p><p>二、判断题（正确打√，错误打×）</p><p>1 ．标准广播是无序的，有可能后面注册的接收器反而比前面注册的接收器先收到广播。（　　）</p><p>2 ．通过setPriority方法设置优先级，优先级越小的接收器，越先收到有序广播。（　　）</p><p>3 ．普通应用能够通过静态注册方式来监听系统广播。（　　）</p><p>4 ．闹钟管理器AlarmManager的setRepeating方法保证能够按时发送广播。（　　）</p><p>5 ．旋转手机使得屏幕由竖屏变为横屏，App默认会重新加载整个页面（先销毁原页面再创建新页面）。</p><p>（　　）</p><p>三、选择题</p><p>1 ．在接收器内部调用（　　）方法，就会中断有序广播。</p><p>A．abortBroadcast</p><p>B．cancelBroadcast</p><p>C．interrupt</p><p>D．sendBroadcast</p><p>2 ．android.permission.VIBRATE表达的是（　　）权限。</p><p>A．呼吸灯</p><p>B．麦克风</p><p>C．闹钟</p><p>D．震动器</p><p>3 ．网络类型（　　）表示手机的数据连接（含2G/3G/4G/5G）。</p><p>A．TYPE_WIFI</p><p>B．TYPE_MOBILE</p><p>C．TYPE_WIMAX</p><p>D．TYPE_ETHERNET</p><p>4 ．网络状态（　　）表示已经连接。</p><p>A．CONNECTING</p><p>B．CONNECTED</p><p>C．SUSPENDED</p><p>D．DISCONNECTED</p><p>5 ．（　　）属于configChanges属性配置的显示变更豁免情况。</p><p>A．orientation</p><p>B．screenLayout</p><p>C．screenSize</p><p>D．keyboard</p><p>四、简答题</p><p>请简要描述收发标准广播的主要步骤。</p><p>五、动手练习</p><p>请上机实验下列 3 项练习：</p><p>1 ．通过设置不同的优先级，实现有序广播的正确收发。</p><p>2 ．通过监听网络变更广播，判断当前位于哪种网络。</p><p>3 ．通过监听回到桌面广播，实现App的画中画模式。</p></div><!--[--><!--]--></div><footer class="page-meta"><div class="meta-item edit-link"><a class="external-link meta-item-label" href="https://gitee.com/xiaweifeng/vuepress-source/edit/master/docs/Android/AndroidBasic/第09章广播组件Broadcast.md" rel="noopener noreferrer" target="_blank" aria-label="在Gitee上编辑此页"><!--[--><!--]--> 在Gitee上编辑此页 <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><div class="meta-item last-updated"><span class="meta-item-label">上次更新: </span><!----></div><div class="meta-item contributors"><span class="meta-item-label">贡献者: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: xiaweifeng@live.cn">夏一次</span><!----><!--]--><!--]--></span></div></footer><!----><!--[--><!--[--><div class="giscus-wrapper input-top" style="display:block;"><div style="text-align:center">Loading...</div></div><!--]--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/assets/app.166c275a.js" defer></script>
  </body>
</html>
