<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.49">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <meta property="og:url" content="https://tommyi.netlify.app/Android/AndroidBasic/%E7%AC%AC06%E7%AB%A0%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8.html"><meta property="og:site_name" content="Hades"><meta property="og:title" content="第 6 章　数据存储"><meta property="og:type" content="article"><meta property="og:updated_time" content="2022-08-23T15:30:31.000Z"><meta property="og:locale" content="zh-CN"><meta property="article:modified_time" content="2022-08-23T15:30:31.000Z"><script>
      (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?c6cfefc03bedbb2803a5cad020e7faaa";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);})();
     </script><link rel="icon" type="image/png" sizes="16x16" href="/images/icons/favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/icons/favicon-32x32.png"><link rel="manifest" href="/manifest.webmanifest"><meta name="application-name" content="VuePress"><meta name="referrer" content="no-referrer"><meta name="apple-mobile-web-app-title" content="VuePress"><meta name="apple-mobile-web-app-status-bar-style" content="black"><link rel="apple-touch-icon" href="https://www.vuepress.cn/icons/apple-touch-icon-152x152.png"><link rel="mask-icon" href="/images/icons/safari-pinned-tab.svg" color="#3eaf7c"><meta name="msapplication-TileColor" content="#3eaf7c"><meta name="theme-color" content="#3eaf7c"><title>第 6 章　数据存储 | Hades</title><meta name="description" content="这是一本笔记，用于记录编程过程中的知识点">
    <link rel="modulepreload" href="/assets/app.3222cd28.js"><link rel="modulepreload" href="/assets/第06章数据存储.html.fc4b6bd1.js"><link rel="modulepreload" href="/assets/第06章数据存储.html.c29220e0.js"><link rel="prefetch" href="/assets/index.html.3fba8fa2.js"><link rel="prefetch" href="/assets/index.html.4d596f1b.js"><link rel="prefetch" href="/assets/index.html.ac0d3ff8.js"><link rel="prefetch" href="/assets/Mac下mongodb安装和配置.html.19173e70.js"><link rel="prefetch" href="/assets/Mac下命令行配置环境变量.html.c2873a5f.js"><link rel="prefetch" href="/assets/Mac全自动安装brew一键配置国内镜像源.html.8866f2df.js"><link rel="prefetch" href="/assets/Mac终端命令记录.html.75e46e91.js"><link rel="prefetch" href="/assets/Nginx搭建HTTPS，并反向代理到web页面_mkcert生成本地SSL证书.html.f67c5203.js"><link rel="prefetch" href="/assets/PDF转Markdown文件.html.dc7ca7bb.js"><link rel="prefetch" href="/assets/index.html.f2e8c2ba.js"><link rel="prefetch" href="/assets/VSCode使用记录.html.3b0db4ce.js"><link rel="prefetch" href="/assets/docsearch全站搜索.html.105a6071.js"><link rel="prefetch" href="/assets/idea插件分享.html.841f8833.js"><link rel="prefetch" href="/assets/jetbrains全家桶激活策略.html.daa401c8.js"><link rel="prefetch" href="/assets/中华人民共和国劳动合同法.html.6b4a5117.js"><link rel="prefetch" href="/assets/浅谈文言文与英语语法的相似点.html.96535ae8.js"><link rel="prefetch" href="/assets/面向AI开发.html.06a44d4c.js"><link rel="prefetch" href="/assets/鸿蒙3安装apk无须登录.html.7ceb3fbf.js"><link rel="prefetch" href="/assets/index.html.f4857994.js"><link rel="prefetch" href="/assets/aboutme.html.03b08c9b.js"><link rel="prefetch" href="/assets/index.html.7d5c183e.js"><link rel="prefetch" href="/assets/index.html.62929ac9.js"><link rel="prefetch" href="/assets/FRP内网穿透搭建(无域名版).html.6029f667.js"><link rel="prefetch" href="/assets/index.html.5fd246dd.js"><link rel="prefetch" href="/assets/linux前端项目部署.html.0029fa36.js"><link rel="prefetch" href="/assets/linux环境变量配置错误后命令无法使用解决方案.html.e194e944.js"><link rel="prefetch" href="/assets/内网穿透工具比较.html.a6564717.js"><link rel="prefetch" href="/assets/在CentOS上搭建Samba服务器.html.5dc34a00.js"><link rel="prefetch" href="/assets/第01章Android开发环境搭建.html.4ea72447.js"><link rel="prefetch" href="/assets/第02章AndroidApp开发基础.html.24ac8732.js"><link rel="prefetch" href="/assets/第03章简单控件.html.3128fa37.js"><link rel="prefetch" href="/assets/第04章活动Activity.html.9169add5.js"><link rel="prefetch" href="/assets/第05章中级控件.html.75bd951e.js"><link rel="prefetch" href="/assets/第07章内容共享.html.ef3fb778.js"><link rel="prefetch" href="/assets/第08章高级控件.html.a4ef2f0d.js"><link rel="prefetch" href="/assets/第09章广播组件Broadcast.html.7130bec3.js"><link rel="prefetch" href="/assets/第10章自定义控件.html.1c777745.js"><link rel="prefetch" href="/assets/AndroidStudio代理问题Connect.html.357fa090.js"><link rel="prefetch" href="/assets/AndroidStudio打包aar丢失远程依赖问题解决.html.26db85ab.js"><link rel="prefetch" href="/assets/AndroidStudio登录google账号失败问题.html.60601dbe.js"><link rel="prefetch" href="/assets/Apk应用重签名—使用AndroidStudio自带工具apksigner.html.be412465.js"><link rel="prefetch" href="/assets/不常用的ADB命令.html.162faa7e.js"><link rel="prefetch" href="/assets/01MySQL精简笔记.html.b6c76536.js"><link rel="prefetch" href="/assets/02JDBC.html.cd83be25.js"><link rel="prefetch" href="/assets/03Maven.html.2826552b.js"><link rel="prefetch" href="/assets/04Mybatis.html.e3b26918.js"><link rel="prefetch" href="/assets/05网页三剑客.html.7eb4fd73.js"><link rel="prefetch" href="/assets/06HTTP_Tomcat_Servlet.html.e72ce829.js"><link rel="prefetch" href="/assets/07Request_Response.html.dbb06678.js"><link rel="prefetch" href="/assets/08JSP.html.9fe6edfb.js"><link rel="prefetch" href="/assets/09Cookie_Session.html.a6775789.js"><link rel="prefetch" href="/assets/10Filter_Listener_Ajax.html.ca49deec.js"><link rel="prefetch" href="/assets/11Vue_Element.html.13f1ff54.js"><link rel="prefetch" href="/assets/12综合案例.html.0e382c65.js"><link rel="prefetch" href="/assets/index.html.145fbfc9.js"><link rel="prefetch" href="/assets/POM文件帮助文档.html.71fe5a3a.js"><link rel="prefetch" href="/assets/index.html.4c10d115.js"><link rel="prefetch" href="/assets/index.html.8002c9df.js"><link rel="prefetch" href="/assets/index.html.456530ad.js"><link rel="prefetch" href="/assets/index.html.a6dacb19.js"><link rel="prefetch" href="/assets/index.html.155f6415.js"><link rel="prefetch" href="/assets/index.html.ddabe501.js"><link rel="prefetch" href="/assets/index.html.85baad59.js"><link rel="prefetch" href="/assets/index.html.b4cc03cf.js"><link rel="prefetch" href="/assets/index.html.781336e1.js"><link rel="prefetch" href="/assets/index.html.61a0c47f.js"><link rel="prefetch" href="/assets/request.getInputStream只能读取一次问题.html.b885ecdb.js"><link rel="prefetch" href="/assets/程序包com.alibaba.fastjson不存在.html.271dbf39.js"><link rel="prefetch" href="/assets/错误集合.html.7aaff025.js"><link rel="prefetch" href="/assets/index.html.bbbe52d8.js"><link rel="prefetch" href="/assets/index.html.a8875e4a.js"><link rel="prefetch" href="/assets/index.html.500a4c6c.js"><link rel="prefetch" href="/assets/index.html.e490b0a7.js"><link rel="prefetch" href="/assets/index.html.7c8a7fda.js"><link rel="prefetch" href="/assets/MySQL-基础篇.html.72f3c6e1.js"><link rel="prefetch" href="/assets/Node多版本管理.html.323287ed.js"><link rel="prefetch" href="/assets/index.html.0e0c40e6.js"><link rel="prefetch" href="/assets/Web调试入门.html.779c051c.js"><link rel="prefetch" href="/assets/关于ESLInk配置问题.html.813173ed.js"><link rel="prefetch" href="/assets/Maven高级.html.88e987e2.js"><link rel="prefetch" href="/assets/SpringBoot.html.900a4e3a.js"><link rel="prefetch" href="/assets/RestTemplate.html.e8ab904e.js"><link rel="prefetch" href="/assets/MyBatisPlus.html.f232bc92.js"><link rel="prefetch" href="/assets/Dubbo详解.html.99b80cf1.js"><link rel="prefetch" href="/assets/Mac下ZooKeeper安装和使用.html.6c1f13af.js"><link rel="prefetch" href="/assets/Zookeeper集群搭建.html.52dab835.js"><link rel="prefetch" href="/assets/传智健康项目讲义（第10章）.html.e13e9f83.js"><link rel="prefetch" href="/assets/传智健康项目讲义（第11章）.html.f5126906.js"><link rel="prefetch" href="/assets/传智健康项目讲义（第12章）.html.44d84044.js"><link rel="prefetch" href="/assets/传智健康项目讲义（第13章）.html.a07d7436.js"><link rel="prefetch" href="/assets/传智健康项目讲义（第1章）.html.a4da5427.js"><link rel="prefetch" href="/assets/传智健康项目讲义（第2章）.html.2fefeebf.js"><link rel="prefetch" href="/assets/传智健康项目讲义（第3章）.html.027ab944.js"><link rel="prefetch" href="/assets/传智健康项目讲义（第4章）.html.0dbf7d93.js"><link rel="prefetch" href="/assets/传智健康项目讲义（第5章）.html.fdc355fa.js"><link rel="prefetch" href="/assets/传智健康项目讲义（第6章）.html.cfd20322.js"><link rel="prefetch" href="/assets/传智健康项目讲义（第7章）.html.b3623f0b.js"><link rel="prefetch" href="/assets/传智健康项目讲义（第8章）.html.9d9da6cc.js"><link rel="prefetch" href="/assets/传智健康项目讲义（第9章）.html.90642054.js"><link rel="prefetch" href="/assets/SpringBoot讲义.html.7a7d55bb.js"><link rel="prefetch" href="/assets/Linux-Day01.html.fdebd37c.js"><link rel="prefetch" href="/assets/Linux-Day02.html.7812a3ac.js"><link rel="prefetch" href="/assets/Redis基础.html.601c5b80.js"><link rel="prefetch" href="/assets/Git课程讲义.html.ebe75592.js"><link rel="prefetch" href="/assets/瑞吉外卖-Day01.html.f58e19c2.js"><link rel="prefetch" href="/assets/瑞吉外卖-Day02.html.4ded6959.js"><link rel="prefetch" href="/assets/瑞吉外卖-Day03.html.c35f1242.js"><link rel="prefetch" href="/assets/瑞吉外卖-Day04.html.3d44fe14.js"><link rel="prefetch" href="/assets/瑞吉外卖-Day05.html.3f4ef4e7.js"><link rel="prefetch" href="/assets/瑞吉外卖-Day06.html.9cd411dc.js"><link rel="prefetch" href="/assets/瑞吉外卖优化-Day01.html.78783912.js"><link rel="prefetch" href="/assets/瑞吉外卖优化-Day02.html.cb2d7616.js"><link rel="prefetch" href="/assets/瑞吉外卖优化-Day03.html.6076c5a3.js"><link rel="prefetch" href="/assets/微服务常见面试题.html.a5dcd6ba.js"><link rel="prefetch" href="/assets/错误笔记.html.ed3ccb3a.js"><link rel="prefetch" href="/assets/day01-HTML基础.html.a6ab2338.js"><link rel="prefetch" href="/assets/day02-HTML进阶.html.6a75b495.js"><link rel="prefetch" href="/assets/day04-CSS进阶.html.691a9b64.js"><link rel="prefetch" href="/assets/day03-CSS基础.html.42169736.js"><link rel="prefetch" href="/assets/day05-盒子模型.html.4992e05c.js"><link rel="prefetch" href="/assets/day06-Flex布局.html.c0632a9a.js"><link rel="prefetch" href="/assets/day07-学成在线.html.31966167.js"><link rel="prefetch" href="/assets/day08-CSS高级.html.7139befe.js"><link rel="prefetch" href="/assets/day09-小兔鲜儿.html.a4f48ad2.js"><link rel="prefetch" href="/assets/day10-小兔鲜儿.html.58643326.js"><link rel="prefetch" href="/assets/Day01-项目介绍及初始化-登录页面.html.1162a8bc.js"><link rel="prefetch" href="/assets/Day02-登录模块-主页鉴权.html.8dfc8019.js"><link rel="prefetch" href="/assets/Day03-主页模块-修改密码.html.011cdd7f.js"><link rel="prefetch" href="/assets/Day04-组织架构.html.5275e26a.js"><link rel="prefetch" href="/assets/Day05-组织架构-角色管理.html.ced63442.js"><link rel="prefetch" href="/assets/Day06-角色管理-员工管理.html.6caefea8.js"><link rel="prefetch" href="/assets/Day07-员工管理-上传下载.html.e3f31d8e.js"><link rel="prefetch" href="/assets/Day08-Cos上传和权限数据.html.20830962.js"><link rel="prefetch" href="/assets/Day09-权限应用-首页.html.da56bbaa.js"><link rel="prefetch" href="/assets/Day10-首页图表-Nginx上线.html.d3348164.js"><link rel="prefetch" href="/assets/1.Vue3入门.html.03fe22ad.js"><link rel="prefetch" href="/assets/10.购物车.html.471b3316.js"><link rel="prefetch" href="/assets/11.订单页.html.f7fcb785.js"><link rel="prefetch" href="/assets/12.支付页.html.7e26fb78.js"><link rel="prefetch" href="/assets/13.会员中心.html.b90bf2e3.js"><link rel="prefetch" href="/assets/14.拓展部分.html.0d32fa78.js"><link rel="prefetch" href="/assets/2.Pinia入门.html.e8abdd29.js"><link rel="prefetch" href="/assets/3.项目起步.html.498101f0.js"><link rel="prefetch" href="/assets/4.Layout页.html.0c374127.js"><link rel="prefetch" href="/assets/5.Home页.html.a6e30fe0.js"><link rel="prefetch" href="/assets/6.一级分类页.html.f6efdd5c.js"><link rel="prefetch" href="/assets/7.二级分类页.html.01823995.js"><link rel="prefetch" href="/assets/8.商品详情.html.5c665585.js"><link rel="prefetch" href="/assets/9.登录页.html.35d98706.js"><link rel="prefetch" href="/assets/day01.html.8ffdb6de.js"><link rel="prefetch" href="/assets/day02.html.43bccf1f.js"><link rel="prefetch" href="/assets/day03.html.191e82ec.js"><link rel="prefetch" href="/assets/index.html.f947a12b.js"><link rel="prefetch" href="/assets/day01.html.de22280d.js"><link rel="prefetch" href="/assets/day02.html.37fef858.js"><link rel="prefetch" href="/assets/day03.html.b3311c03.js"><link rel="prefetch" href="/assets/day04.html.14ed5a97.js"><link rel="prefetch" href="/assets/index.html.ea0c61d2.js"><link rel="prefetch" href="/assets/interview-base.html.b48b64bf.js"><link rel="prefetch" href="/assets/interview-enjoy-plus.html.8071948e.js"><link rel="prefetch" href="/assets/Redis基础篇.html.a0667b10.js"><link rel="prefetch" href="/assets/Redis快速入门.html.d25877b5.js"><link rel="prefetch" href="/assets/Redis实战篇.html.9a5d06d2.js"><link rel="prefetch" href="/assets/课堂笔记.html.6422e94e.js"><link rel="prefetch" href="/assets/Redis原理篇.html.4f69d42d.js"><link rel="prefetch" href="/assets/课堂笔记.html.3b96b75e.js"><link rel="prefetch" href="/assets/Spring-day01.html.e68ec110.js"><link rel="prefetch" href="/assets/Spring-day02.html.59a1d60e.js"><link rel="prefetch" href="/assets/Spring-day03.html.7c161a28.js"><link rel="prefetch" href="/assets/SpringMVC-day01.html.457335ff.js"><link rel="prefetch" href="/assets/SpringMVC-day02.html.031f2edf.js"><link rel="prefetch" href="/assets/SpringBootStart.html.105a81fc.js"><link rel="prefetch" href="/assets/SpringBoot整合SSMP.html.e9ae476c.js"><link rel="prefetch" href="/assets/SpringBoot综合案例.html.0b423631.js"><link rel="prefetch" href="/assets/错误笔记.html.62610a4e.js"><link rel="prefetch" href="/assets/SpringBoot讲义.html.ab71429a.js"><link rel="prefetch" href="/assets/SpringBoot讲义.html.985d261c.js"><link rel="prefetch" href="/assets/Centos8-stream在真机上安装排坑.html.6126641d.js"><link rel="prefetch" href="/assets/Centos9安装mysql.html.2e8a0e74.js"><link rel="prefetch" href="/assets/SpringCloud01.html.7e4ce9d2.js"><link rel="prefetch" href="/assets/SpringCloud实用篇02.html.96a09c5c.js"><link rel="prefetch" href="/assets/Docker实用篇.html.a17cc52f.js"><link rel="prefetch" href="/assets/RabbitMQ.html.bd4e2cf4.js"><link rel="prefetch" href="/assets/分布式搜索引擎01.html.4e38b9ff.js"><link rel="prefetch" href="/assets/分布式搜索引擎02.html.57698f1d.js"><link rel="prefetch" href="/assets/分布式搜索引擎03.html.28ba2809.js"><link rel="prefetch" href="/assets/微服务保护.html.62adb493.js"><link rel="prefetch" href="/assets/分布式事务.html.e90c30b9.js"><link rel="prefetch" href="/assets/分布式缓存.html.01435b66.js"><link rel="prefetch" href="/assets/多级缓存.html.4a5cc484.js"><link rel="prefetch" href="/assets/RabbitMQ-高级篇.html.0c480ed8.js"><link rel="prefetch" href="/assets/Mybatis第一天.html.a3edd17b.js"><link rel="prefetch" href="/assets/Mybatis第二天.html.802a2571.js"><link rel="prefetch" href="/assets/移动web第一天.html.2e8f46f4.js"><link rel="prefetch" href="/assets/移动Web第二天.html.8226f808.js"><link rel="prefetch" href="/assets/移动Web第三天.html.11831bcd.js"><link rel="prefetch" href="/assets/移动Web第四天.html.6547a63e.js"><link rel="prefetch" href="/assets/移动Web第五天.html.d74bd617.js"><link rel="prefetch" href="/assets/JavaScript基础第一天.html.cff4e109.js"><link rel="prefetch" href="/assets/JavaScript基础第三天.html.f99eff7e.js"><link rel="prefetch" href="/assets/javascript基础第二天笔记.html.aebc5333.js"><link rel="prefetch" href="/assets/JavaScript基础第五天.html.e35620d6.js"><link rel="prefetch" href="/assets/JavaScript基础第四天.html.958a84e6.js"><link rel="prefetch" href="/assets/index.html.ef8647c7.js"><link rel="prefetch" href="/assets/个人实战文档.html.1743365c.js"><link rel="prefetch" href="/assets/index.html.c647080e.js"><link rel="prefetch" href="/assets/index.html.04decc95.js"><link rel="prefetch" href="/assets/index.html.dbce89c2.js"><link rel="prefetch" href="/assets/index.html.850a5fdc.js"><link rel="prefetch" href="/assets/index.html.c1ac903f.js"><link rel="prefetch" href="/assets/JavaScript进阶第一天.html.1df28442.js"><link rel="prefetch" href="/assets/day03.html.c7bd1e6a.js"><link rel="prefetch" href="/assets/day02.html.d4b18232.js"><link rel="prefetch" href="/assets/day04.html.c85f4095.js"><link rel="prefetch" href="/assets/笔记.html.f18bcd72.js"><link rel="prefetch" href="/assets/笔记.html.cc5e606b.js"><link rel="prefetch" href="/assets/笔记.html.9b36d8a2.js"><link rel="prefetch" href="/assets/day01.html.afa0570c.js"><link rel="prefetch" href="/assets/day02.html.cc0ddb05.js"><link rel="prefetch" href="/assets/day03.html.66b1101e.js"><link rel="prefetch" href="/assets/day04.html.d57e8ef7.js"><link rel="prefetch" href="/assets/day05.html.be548191.js"><link rel="prefetch" href="/assets/day06.html.9d2732e7.js"><link rel="prefetch" href="/assets/day07.html.e2014f42.js"><link rel="prefetch" href="/assets/智慧商城项目.html.b037ba30.js"><link rel="prefetch" href="/assets/Vue3入门.html.1dddd2c1.js"><link rel="prefetch" href="/assets/Pinia.html.d1f7ef83.js"><link rel="prefetch" href="/assets/大事件管理系统.html.a9636e94.js"><link rel="prefetch" href="/assets/01-项目起步.html.82651da2.js"><link rel="prefetch" href="/assets/02-首页模块.html.6f46afbf.js"><link rel="prefetch" href="/assets/03-推荐模块.html.b6efbf66.js"><link rel="prefetch" href="/assets/04-分类模块.html.89b1138d.js"><link rel="prefetch" href="/assets/05-详情模块.html.e88ab276.js"><link rel="prefetch" href="/assets/06-登录模块.html.277d50c6.js"><link rel="prefetch" href="/assets/07-用户模块.html.925b2d13.js"><link rel="prefetch" href="/assets/08-地址模块.html.f75d39b9.js"><link rel="prefetch" href="/assets/09-SKU模块.html.397ec6ac.js"><link rel="prefetch" href="/assets/10-购物车模块.html.813ab58c.js"><link rel="prefetch" href="/assets/11-订单模块.html.26617e36.js"><link rel="prefetch" href="/assets/12-项目打包.html.bcb19f5b.js"><link rel="prefetch" href="/assets/index.html.0ad324c8.js"><link rel="prefetch" href="/assets/多级缓存.html.bffd36ce.js"><link rel="prefetch" href="/assets/Redis高级-分布式缓存.html.3b0165ff.js"><link rel="prefetch" href="/assets/Redis高级篇之最佳实践.html.7874bd22.js"><link rel="prefetch" href="/assets/第1天.html.2a9a1263.js"><link rel="prefetch" href="/assets/第2天.html.f92837a4.js"><link rel="prefetch" href="/assets/第3天.html.8346e116.js"><link rel="prefetch" href="/assets/第4天.html.64ba4427.js"><link rel="prefetch" href="/assets/第5天.html.aa93a841.js"><link rel="prefetch" href="/assets/小程序自定义tabBar.html.efad290d.js"><link rel="prefetch" href="/assets/第6天.html.44cac1f7.js"><link rel="prefetch" href="/assets/Nacos安装指南.html.39daa776.js"><link rel="prefetch" href="/assets/Nacos集群搭建.html.568d560d.js"><link rel="prefetch" href="/assets/Centos7安装Docker.html.b0ad27b4.js"><link rel="prefetch" href="/assets/RabbitMQ部署指南.html.1ab7fab6.js"><link rel="prefetch" href="/assets/安装elasticsearch.html.81544b59.js"><link rel="prefetch" href="/assets/Day01_AJAX入门.html.2b734238.js"><link rel="prefetch" href="/assets/Day02_AJAX综合案例.html.afc30063.js"><link rel="prefetch" href="/assets/Day03_AJAX原理.html.099c6350.js"><link rel="prefetch" href="/assets/Day04_AJAX进阶.html.54ac1199.js"><link rel="prefetch" href="/assets/404.html.65323de0.js"><link rel="prefetch" href="/assets/index.html.d35904fe.js"><link rel="prefetch" href="/assets/index.html.fd023679.js"><link rel="prefetch" href="/assets/index.html.df12bfb4.js"><link rel="prefetch" href="/assets/Mac下mongodb安装和配置.html.301a2aea.js"><link rel="prefetch" href="/assets/Mac下命令行配置环境变量.html.1d4d6e41.js"><link rel="prefetch" href="/assets/Mac全自动安装brew一键配置国内镜像源.html.a1acc4ea.js"><link rel="prefetch" href="/assets/Mac终端命令记录.html.48c62f0e.js"><link rel="prefetch" href="/assets/Nginx搭建HTTPS，并反向代理到web页面_mkcert生成本地SSL证书.html.fe7d31c9.js"><link rel="prefetch" href="/assets/PDF转Markdown文件.html.cb87284b.js"><link rel="prefetch" href="/assets/index.html.2514289c.js"><link rel="prefetch" href="/assets/VSCode使用记录.html.5fff25d5.js"><link rel="prefetch" href="/assets/docsearch全站搜索.html.0b5e6df6.js"><link rel="prefetch" href="/assets/idea插件分享.html.4589edb2.js"><link rel="prefetch" href="/assets/jetbrains全家桶激活策略.html.b628297e.js"><link rel="prefetch" href="/assets/中华人民共和国劳动合同法.html.0f5bee03.js"><link rel="prefetch" href="/assets/浅谈文言文与英语语法的相似点.html.63856966.js"><link rel="prefetch" href="/assets/面向AI开发.html.a61b1470.js"><link rel="prefetch" href="/assets/鸿蒙3安装apk无须登录.html.505d6071.js"><link rel="prefetch" href="/assets/index.html.a10f47f9.js"><link rel="prefetch" href="/assets/aboutme.html.262718de.js"><link rel="prefetch" href="/assets/index.html.ae7dbfa2.js"><link rel="prefetch" href="/assets/index.html.852eb6a4.js"><link rel="prefetch" href="/assets/FRP内网穿透搭建(无域名版).html.4d0cea9f.js"><link rel="prefetch" href="/assets/index.html.7560b640.js"><link rel="prefetch" href="/assets/linux前端项目部署.html.7b00f51c.js"><link rel="prefetch" href="/assets/linux环境变量配置错误后命令无法使用解决方案.html.50e9cdb4.js"><link rel="prefetch" href="/assets/内网穿透工具比较.html.70accdbf.js"><link rel="prefetch" href="/assets/在CentOS上搭建Samba服务器.html.44d49a23.js"><link rel="prefetch" href="/assets/第01章Android开发环境搭建.html.5ef4b16c.js"><link rel="prefetch" href="/assets/第02章AndroidApp开发基础.html.cb7a53b0.js"><link rel="prefetch" href="/assets/第03章简单控件.html.fa6260dc.js"><link rel="prefetch" href="/assets/第04章活动Activity.html.2c162812.js"><link rel="prefetch" href="/assets/第05章中级控件.html.cc08f24d.js"><link rel="prefetch" href="/assets/第07章内容共享.html.3a0fcce0.js"><link rel="prefetch" href="/assets/第08章高级控件.html.b38fd3b5.js"><link rel="prefetch" href="/assets/第09章广播组件Broadcast.html.bfd475b5.js"><link rel="prefetch" href="/assets/第10章自定义控件.html.7b8cb776.js"><link rel="prefetch" href="/assets/AndroidStudio代理问题Connect.html.2e9e37ad.js"><link rel="prefetch" href="/assets/AndroidStudio打包aar丢失远程依赖问题解决.html.f62ce461.js"><link rel="prefetch" href="/assets/AndroidStudio登录google账号失败问题.html.5e5e82c9.js"><link rel="prefetch" href="/assets/Apk应用重签名—使用AndroidStudio自带工具apksigner.html.e3098467.js"><link rel="prefetch" href="/assets/不常用的ADB命令.html.f7e286b9.js"><link rel="prefetch" href="/assets/01MySQL精简笔记.html.51e97c50.js"><link rel="prefetch" href="/assets/02JDBC.html.143f8699.js"><link rel="prefetch" href="/assets/03Maven.html.041954b1.js"><link rel="prefetch" href="/assets/04Mybatis.html.0c028c47.js"><link rel="prefetch" href="/assets/05网页三剑客.html.02a927b7.js"><link rel="prefetch" href="/assets/06HTTP_Tomcat_Servlet.html.b03a5cbe.js"><link rel="prefetch" href="/assets/07Request_Response.html.75b01386.js"><link rel="prefetch" href="/assets/08JSP.html.11699958.js"><link rel="prefetch" href="/assets/09Cookie_Session.html.f33cb93b.js"><link rel="prefetch" href="/assets/10Filter_Listener_Ajax.html.5b19ad2e.js"><link rel="prefetch" href="/assets/11Vue_Element.html.0ed9ded6.js"><link rel="prefetch" href="/assets/12综合案例.html.e15ac32f.js"><link rel="prefetch" href="/assets/index.html.d12bf505.js"><link rel="prefetch" href="/assets/POM文件帮助文档.html.68aa0e0d.js"><link rel="prefetch" href="/assets/index.html.fbd520a5.js"><link rel="prefetch" href="/assets/index.html.1b901660.js"><link rel="prefetch" href="/assets/index.html.83290ef7.js"><link rel="prefetch" href="/assets/index.html.a01449a9.js"><link rel="prefetch" href="/assets/index.html.49f29dd8.js"><link rel="prefetch" href="/assets/index.html.0c9d89e6.js"><link rel="prefetch" href="/assets/index.html.771a0849.js"><link rel="prefetch" href="/assets/index.html.931ddf30.js"><link rel="prefetch" href="/assets/index.html.83def820.js"><link rel="prefetch" href="/assets/index.html.19922c66.js"><link rel="prefetch" href="/assets/request.getInputStream只能读取一次问题.html.c34b4ad6.js"><link rel="prefetch" href="/assets/程序包com.alibaba.fastjson不存在.html.53a076a6.js"><link rel="prefetch" href="/assets/错误集合.html.b49f0ee0.js"><link rel="prefetch" href="/assets/index.html.4b882c0c.js"><link rel="prefetch" href="/assets/index.html.5d8450dc.js"><link rel="prefetch" href="/assets/index.html.cdc4465a.js"><link rel="prefetch" href="/assets/index.html.166a39ec.js"><link rel="prefetch" href="/assets/index.html.270fb1df.js"><link rel="prefetch" href="/assets/MySQL-基础篇.html.6c075b7f.js"><link rel="prefetch" href="/assets/Node多版本管理.html.8bbd0854.js"><link rel="prefetch" href="/assets/index.html.c3770570.js"><link rel="prefetch" href="/assets/Web调试入门.html.bd7644a8.js"><link rel="prefetch" href="/assets/关于ESLInk配置问题.html.8d585e62.js"><link rel="prefetch" href="/assets/Maven高级.html.df063b50.js"><link rel="prefetch" href="/assets/SpringBoot.html.9c026723.js"><link rel="prefetch" href="/assets/RestTemplate.html.81424d94.js"><link rel="prefetch" href="/assets/MyBatisPlus.html.5156fad2.js"><link rel="prefetch" href="/assets/Dubbo详解.html.a88aa8e4.js"><link rel="prefetch" href="/assets/Mac下ZooKeeper安装和使用.html.3de130d6.js"><link rel="prefetch" href="/assets/Zookeeper集群搭建.html.18398d7c.js"><link rel="prefetch" href="/assets/传智健康项目讲义（第10章）.html.aee4445f.js"><link rel="prefetch" href="/assets/传智健康项目讲义（第11章）.html.83a05a5d.js"><link rel="prefetch" href="/assets/传智健康项目讲义（第12章）.html.81ad609c.js"><link rel="prefetch" href="/assets/传智健康项目讲义（第13章）.html.cda181a7.js"><link rel="prefetch" href="/assets/传智健康项目讲义（第1章）.html.f5bee726.js"><link rel="prefetch" href="/assets/传智健康项目讲义（第2章）.html.27034da0.js"><link rel="prefetch" href="/assets/传智健康项目讲义（第3章）.html.d3a4419d.js"><link rel="prefetch" href="/assets/传智健康项目讲义（第4章）.html.6ac4d30b.js"><link rel="prefetch" href="/assets/传智健康项目讲义（第5章）.html.a6b72869.js"><link rel="prefetch" href="/assets/传智健康项目讲义（第6章）.html.b3c1f012.js"><link rel="prefetch" href="/assets/传智健康项目讲义（第7章）.html.7ed3e2ec.js"><link rel="prefetch" href="/assets/传智健康项目讲义（第8章）.html.2e845277.js"><link rel="prefetch" href="/assets/传智健康项目讲义（第9章）.html.d9fda0b5.js"><link rel="prefetch" href="/assets/SpringBoot讲义.html.0e58c23a.js"><link rel="prefetch" href="/assets/Linux-Day01.html.f7ed7535.js"><link rel="prefetch" href="/assets/Linux-Day02.html.e0127077.js"><link rel="prefetch" href="/assets/Redis基础.html.a64b37e3.js"><link rel="prefetch" href="/assets/Git课程讲义.html.7e0f3772.js"><link rel="prefetch" href="/assets/瑞吉外卖-Day01.html.9464a5df.js"><link rel="prefetch" href="/assets/瑞吉外卖-Day02.html.45884790.js"><link rel="prefetch" href="/assets/瑞吉外卖-Day03.html.19be6c08.js"><link rel="prefetch" href="/assets/瑞吉外卖-Day04.html.a55511e6.js"><link rel="prefetch" href="/assets/瑞吉外卖-Day05.html.c8d5d2ec.js"><link rel="prefetch" href="/assets/瑞吉外卖-Day06.html.9dbbe9f4.js"><link rel="prefetch" href="/assets/瑞吉外卖优化-Day01.html.e670be9e.js"><link rel="prefetch" href="/assets/瑞吉外卖优化-Day02.html.36d00a62.js"><link rel="prefetch" href="/assets/瑞吉外卖优化-Day03.html.580a113e.js"><link rel="prefetch" href="/assets/微服务常见面试题.html.d9885008.js"><link rel="prefetch" href="/assets/错误笔记.html.7b8e22bd.js"><link rel="prefetch" href="/assets/day01-HTML基础.html.11954ea5.js"><link rel="prefetch" href="/assets/day02-HTML进阶.html.f8ea5d06.js"><link rel="prefetch" href="/assets/day04-CSS进阶.html.959f42d7.js"><link rel="prefetch" href="/assets/day03-CSS基础.html.be06d435.js"><link rel="prefetch" href="/assets/day05-盒子模型.html.dc398017.js"><link rel="prefetch" href="/assets/day06-Flex布局.html.28d20a28.js"><link rel="prefetch" href="/assets/day07-学成在线.html.7c72e01f.js"><link rel="prefetch" href="/assets/day08-CSS高级.html.21209494.js"><link rel="prefetch" href="/assets/day09-小兔鲜儿.html.3dbc4f3a.js"><link rel="prefetch" href="/assets/day10-小兔鲜儿.html.c5cb13d3.js"><link rel="prefetch" href="/assets/Day01-项目介绍及初始化-登录页面.html.746c66d7.js"><link rel="prefetch" href="/assets/Day02-登录模块-主页鉴权.html.41a10631.js"><link rel="prefetch" href="/assets/Day03-主页模块-修改密码.html.49ef3b40.js"><link rel="prefetch" href="/assets/Day04-组织架构.html.25f660d2.js"><link rel="prefetch" href="/assets/Day05-组织架构-角色管理.html.90602422.js"><link rel="prefetch" href="/assets/Day06-角色管理-员工管理.html.cd0d3627.js"><link rel="prefetch" href="/assets/Day07-员工管理-上传下载.html.285c77ee.js"><link rel="prefetch" href="/assets/Day08-Cos上传和权限数据.html.9ccdcbbe.js"><link rel="prefetch" href="/assets/Day09-权限应用-首页.html.e3ebdf3e.js"><link rel="prefetch" href="/assets/Day10-首页图表-Nginx上线.html.95ddc52d.js"><link rel="prefetch" href="/assets/1.Vue3入门.html.10bb6d69.js"><link rel="prefetch" href="/assets/10.购物车.html.3c7cfec8.js"><link rel="prefetch" href="/assets/11.订单页.html.e997abda.js"><link rel="prefetch" href="/assets/12.支付页.html.985ae92e.js"><link rel="prefetch" href="/assets/13.会员中心.html.fee07265.js"><link rel="prefetch" href="/assets/14.拓展部分.html.7d352ea1.js"><link rel="prefetch" href="/assets/2.Pinia入门.html.845f58af.js"><link rel="prefetch" href="/assets/3.项目起步.html.e65702ec.js"><link rel="prefetch" href="/assets/4.Layout页.html.432847ae.js"><link rel="prefetch" href="/assets/5.Home页.html.3a774b52.js"><link rel="prefetch" href="/assets/6.一级分类页.html.201e02bb.js"><link rel="prefetch" href="/assets/7.二级分类页.html.0fc2ae43.js"><link rel="prefetch" href="/assets/8.商品详情.html.9b499ef8.js"><link rel="prefetch" href="/assets/9.登录页.html.60e1ee60.js"><link rel="prefetch" href="/assets/day01.html.bbc0a088.js"><link rel="prefetch" href="/assets/day02.html.72ed2fe6.js"><link rel="prefetch" href="/assets/day03.html.bee6c3fc.js"><link rel="prefetch" href="/assets/index.html.09257f7e.js"><link rel="prefetch" href="/assets/day01.html.ab3747f1.js"><link rel="prefetch" href="/assets/day02.html.89ec1bee.js"><link rel="prefetch" href="/assets/day03.html.d5ec2aa6.js"><link rel="prefetch" href="/assets/day04.html.56433ccb.js"><link rel="prefetch" href="/assets/index.html.e4b84db4.js"><link rel="prefetch" href="/assets/interview-base.html.e9eabf58.js"><link rel="prefetch" href="/assets/interview-enjoy-plus.html.6c9247b8.js"><link rel="prefetch" href="/assets/Redis基础篇.html.08c34b8a.js"><link rel="prefetch" href="/assets/Redis快速入门.html.cf6cb13d.js"><link rel="prefetch" href="/assets/Redis实战篇.html.f372dc0c.js"><link rel="prefetch" href="/assets/课堂笔记.html.62fad0c1.js"><link rel="prefetch" href="/assets/Redis原理篇.html.2a7ef6e3.js"><link rel="prefetch" href="/assets/课堂笔记.html.85eb8328.js"><link rel="prefetch" href="/assets/Spring-day01.html.63e58b9e.js"><link rel="prefetch" href="/assets/Spring-day02.html.376435c2.js"><link rel="prefetch" href="/assets/Spring-day03.html.0e29094b.js"><link rel="prefetch" href="/assets/SpringMVC-day01.html.87e47178.js"><link rel="prefetch" href="/assets/SpringMVC-day02.html.a4b28c77.js"><link rel="prefetch" href="/assets/SpringBootStart.html.de571df2.js"><link rel="prefetch" href="/assets/SpringBoot整合SSMP.html.43f6b9c4.js"><link rel="prefetch" href="/assets/SpringBoot综合案例.html.221fa49f.js"><link rel="prefetch" href="/assets/错误笔记.html.e82c55b7.js"><link rel="prefetch" href="/assets/SpringBoot讲义.html.578f2ac6.js"><link rel="prefetch" href="/assets/SpringBoot讲义.html.61a4873c.js"><link rel="prefetch" href="/assets/Centos8-stream在真机上安装排坑.html.550f1d67.js"><link rel="prefetch" href="/assets/Centos9安装mysql.html.80214017.js"><link rel="prefetch" href="/assets/SpringCloud01.html.12bb1f52.js"><link rel="prefetch" href="/assets/SpringCloud实用篇02.html.d45505f0.js"><link rel="prefetch" href="/assets/Docker实用篇.html.74e1975a.js"><link rel="prefetch" href="/assets/RabbitMQ.html.f11b02a4.js"><link rel="prefetch" href="/assets/分布式搜索引擎01.html.71bc535b.js"><link rel="prefetch" href="/assets/分布式搜索引擎02.html.952438e2.js"><link rel="prefetch" href="/assets/分布式搜索引擎03.html.085884cc.js"><link rel="prefetch" href="/assets/微服务保护.html.05b1962c.js"><link rel="prefetch" href="/assets/分布式事务.html.a8f848db.js"><link rel="prefetch" href="/assets/分布式缓存.html.0d991e8c.js"><link rel="prefetch" href="/assets/多级缓存.html.f6efcf35.js"><link rel="prefetch" href="/assets/RabbitMQ-高级篇.html.5475292f.js"><link rel="prefetch" href="/assets/Mybatis第一天.html.74106e69.js"><link rel="prefetch" href="/assets/Mybatis第二天.html.ad5fd614.js"><link rel="prefetch" href="/assets/移动web第一天.html.212d3d77.js"><link rel="prefetch" href="/assets/移动Web第二天.html.25b71c4a.js"><link rel="prefetch" href="/assets/移动Web第三天.html.bc0f9ffd.js"><link rel="prefetch" href="/assets/移动Web第四天.html.105bec04.js"><link rel="prefetch" href="/assets/移动Web第五天.html.d246536f.js"><link rel="prefetch" href="/assets/JavaScript基础第一天.html.6749bf6f.js"><link rel="prefetch" href="/assets/JavaScript基础第三天.html.b9c7d35b.js"><link rel="prefetch" href="/assets/javascript基础第二天笔记.html.ef83735d.js"><link rel="prefetch" href="/assets/JavaScript基础第五天.html.b791755b.js"><link rel="prefetch" href="/assets/JavaScript基础第四天.html.4771ab3b.js"><link rel="prefetch" href="/assets/index.html.b83a5020.js"><link rel="prefetch" href="/assets/个人实战文档.html.984244e3.js"><link rel="prefetch" href="/assets/index.html.6415facf.js"><link rel="prefetch" href="/assets/index.html.1e434b24.js"><link rel="prefetch" href="/assets/index.html.7dc183ed.js"><link rel="prefetch" href="/assets/index.html.f37a33bc.js"><link rel="prefetch" href="/assets/index.html.7d4ee43b.js"><link rel="prefetch" href="/assets/JavaScript进阶第一天.html.000f25ff.js"><link rel="prefetch" href="/assets/day03.html.db51cbbc.js"><link rel="prefetch" href="/assets/day02.html.d66fd875.js"><link rel="prefetch" href="/assets/day04.html.b8a7f063.js"><link rel="prefetch" href="/assets/笔记.html.818a38a3.js"><link rel="prefetch" href="/assets/笔记.html.36b76043.js"><link rel="prefetch" href="/assets/笔记.html.26fe9e7f.js"><link rel="prefetch" href="/assets/day01.html.c47cd770.js"><link rel="prefetch" href="/assets/day02.html.397bfdbd.js"><link rel="prefetch" href="/assets/day03.html.93fc55fd.js"><link rel="prefetch" href="/assets/day04.html.070fd4a4.js"><link rel="prefetch" href="/assets/day05.html.bd82f3d8.js"><link rel="prefetch" href="/assets/day06.html.17d00c13.js"><link rel="prefetch" href="/assets/day07.html.e7bbdf6d.js"><link rel="prefetch" href="/assets/智慧商城项目.html.af5f40a4.js"><link rel="prefetch" href="/assets/Vue3入门.html.7fcc1386.js"><link rel="prefetch" href="/assets/Pinia.html.1da61f9f.js"><link rel="prefetch" href="/assets/大事件管理系统.html.7f4fa6e3.js"><link rel="prefetch" href="/assets/01-项目起步.html.e62172f5.js"><link rel="prefetch" href="/assets/02-首页模块.html.69fde283.js"><link rel="prefetch" href="/assets/03-推荐模块.html.4426873e.js"><link rel="prefetch" href="/assets/04-分类模块.html.1cbda2ee.js"><link rel="prefetch" href="/assets/05-详情模块.html.0e1c5ef3.js"><link rel="prefetch" href="/assets/06-登录模块.html.64931e2c.js"><link rel="prefetch" href="/assets/07-用户模块.html.b812d4aa.js"><link rel="prefetch" href="/assets/08-地址模块.html.9c01d1e1.js"><link rel="prefetch" href="/assets/09-SKU模块.html.84a4889e.js"><link rel="prefetch" href="/assets/10-购物车模块.html.6688a027.js"><link rel="prefetch" href="/assets/11-订单模块.html.2f3d83d3.js"><link rel="prefetch" href="/assets/12-项目打包.html.91368063.js"><link rel="prefetch" href="/assets/index.html.42f6ba28.js"><link rel="prefetch" href="/assets/多级缓存.html.29a0512b.js"><link rel="prefetch" href="/assets/Redis高级-分布式缓存.html.8e9eb1a4.js"><link rel="prefetch" href="/assets/Redis高级篇之最佳实践.html.61b375ef.js"><link rel="prefetch" href="/assets/第1天.html.24b6cbc8.js"><link rel="prefetch" href="/assets/第2天.html.6a1d49a9.js"><link rel="prefetch" href="/assets/第3天.html.ef5bdd2c.js"><link rel="prefetch" href="/assets/第4天.html.f2dd6af1.js"><link rel="prefetch" href="/assets/第5天.html.3bbb5261.js"><link rel="prefetch" href="/assets/小程序自定义tabBar.html.5d994ae6.js"><link rel="prefetch" href="/assets/第6天.html.97ffacd5.js"><link rel="prefetch" href="/assets/Nacos安装指南.html.e9959e6d.js"><link rel="prefetch" href="/assets/Nacos集群搭建.html.d1d2d3f4.js"><link rel="prefetch" href="/assets/Centos7安装Docker.html.499dd207.js"><link rel="prefetch" href="/assets/RabbitMQ部署指南.html.2c223352.js"><link rel="prefetch" href="/assets/安装elasticsearch.html.9de8319c.js"><link rel="prefetch" href="/assets/Day01_AJAX入门.html.d3038205.js"><link rel="prefetch" href="/assets/Day02_AJAX综合案例.html.bc86a8e2.js"><link rel="prefetch" href="/assets/Day03_AJAX原理.html.0f23d8cc.js"><link rel="prefetch" href="/assets/Day04_AJAX进阶.html.70a798a7.js"><link rel="prefetch" href="/assets/404.html.6483ccdc.js"><link rel="prefetch" href="/assets/404.25c65b32.js"><link rel="prefetch" href="/assets/Layout.041a9450.js"><link rel="prefetch" href="/assets/index.0e8935cb.js"><link rel="prefetch" href="/assets/giscus.15440425.js">
    <link rel="stylesheet" href="/assets/style.5869c25b.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/" class=""><img class="logo" src="/images/logo.png" alt="Hades"><span class="site-name can-hide">Hades</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><a href="/Android/" class="router-link-active" aria-label="Android"><!--[--><!--]--> Android <!--[--><!--]--></a></div><div class="navbar-item"><a href="/Java后端/" class="" aria-label="Java后端"><!--[--><!--]--> Java后端 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/Web前端/" class="" aria-label="Web前端"><!--[--><!--]--> Web前端 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/数据库/" class="" aria-label="数据库"><!--[--><!--]--> 数据库 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/运维技术/" class="" aria-label="运维技术"><!--[--><!--]--> 运维技术 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/Tips/" class="" aria-label="Tips❤️‍"><!--[--><!--]--> Tips❤️‍ <!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="书签🔖"><span class="title">书签🔖</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="书签🔖"><span class="title">书签🔖</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>搜索</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a class="external-link" href="https://www.baidu.com" rel="noopener noreferrer" target="_blank" aria-label="百度一下"><!--[--><!--]--> 百度一下 <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>常用</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a class="external-link" href="http://gitee.com" rel="noopener noreferrer" target="_blank" aria-label="gitee"><!--[--><!--]--> gitee <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a class="external-link" href="http://bilibili.com" rel="noopener noreferrer" target="_blank" aria-label="哔哩哔哩"><!--[--><!--]--> 哔哩哔哩 <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/start/BuildError/README.md" class="" aria-label="Vuepress打包错误"><!--[--><!--]--> Vuepress打包错误 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><!--]--></nav><!--[--><!--]--><button class="toggle-color-mode-button" title="toggle color mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><div id="docsearch-container"></div></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><a href="/Android/" class="router-link-active" aria-label="Android"><!--[--><!--]--> Android <!--[--><!--]--></a></div><div class="navbar-item"><a href="/Java后端/" class="" aria-label="Java后端"><!--[--><!--]--> Java后端 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/Web前端/" class="" aria-label="Web前端"><!--[--><!--]--> Web前端 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/数据库/" class="" aria-label="数据库"><!--[--><!--]--> 数据库 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/运维技术/" class="" aria-label="运维技术"><!--[--><!--]--> 运维技术 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/Tips/" class="" aria-label="Tips❤️‍"><!--[--><!--]--> Tips❤️‍ <!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="书签🔖"><span class="title">书签🔖</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="书签🔖"><span class="title">书签🔖</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>搜索</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a class="external-link" href="https://www.baidu.com" rel="noopener noreferrer" target="_blank" aria-label="百度一下"><!--[--><!--]--> 百度一下 <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>常用</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a class="external-link" href="http://gitee.com" rel="noopener noreferrer" target="_blank" aria-label="gitee"><!--[--><!--]--> gitee <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a class="external-link" href="http://bilibili.com" rel="noopener noreferrer" target="_blank" aria-label="哔哩哔哩"><!--[--><!--]--> 哔哩哔哩 <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/start/BuildError/README.md" class="" aria-label="Vuepress打包错误"><!--[--><!--]--> Vuepress打包错误 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><p tabindex="0" class="sidebar-item sidebar-heading">第 6 章　数据存储 <!----></p><ul style="display:none;" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/Android/AndroidBasic/%E7%AC%AC06%E7%AB%A0%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8.html#_6-1-sharedpreferences" class="router-link-active router-link-exact-active sidebar-item" aria-label="6.1 SharedPreferences"><!--[--><!--]--> 6.1 SharedPreferences <!--[--><!--]--></a><ul style="display:none;" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/Android/AndroidBasic/%E7%AC%AC06%E7%AB%A0%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8.html#_6-1-1-共享参数的用法" class="router-link-active router-link-exact-active sidebar-item" aria-label="6.1.1　共享参数的用法"><!--[--><!--]--> 6.1.1　共享参数的用法 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/Android/AndroidBasic/%E7%AC%AC06%E7%AB%A0%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8.html#_6-1-2-实现记住密码功能" class="router-link-active router-link-exact-active sidebar-item" aria-label="6.1.2　实现记住密码功能"><!--[--><!--]--> 6.1.2　实现记住密码功能 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/Android/AndroidBasic/%E7%AC%AC06%E7%AB%A0%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8.html#_6-1-3-利用设备浏览器寻找共享参数文件" class="router-link-active router-link-exact-active sidebar-item" aria-label="6.1.3　利用设备浏览器寻找共享参数文件"><!--[--><!--]--> 6.1.3　利用设备浏览器寻找共享参数文件 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/Android/AndroidBasic/%E7%AC%AC06%E7%AB%A0%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8.html#_6-2-数据库sqlite" class="router-link-active router-link-exact-active sidebar-item" aria-label="6.2　数据库SQLite"><!--[--><!--]--> 6.2　数据库SQLite <!--[--><!--]--></a><ul style="display:none;" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/Android/AndroidBasic/%E7%AC%AC06%E7%AB%A0%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8.html#_6-2-1-sql的基本语法" class="router-link-active router-link-exact-active sidebar-item" aria-label="6.2.1 SQL的基本语法"><!--[--><!--]--> 6.2.1 SQL的基本语法 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/Android/AndroidBasic/%E7%AC%AC06%E7%AB%A0%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8.html#_6-2-2-数据库管理器sqlitedatabase" class="router-link-active router-link-exact-active sidebar-item" aria-label="6.2.2　数据库管理器SQLiteDatabase"><!--[--><!--]--> 6.2.2　数据库管理器SQLiteDatabase <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/Android/AndroidBasic/%E7%AC%AC06%E7%AB%A0%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8.html#_6-2-3-数据库帮助器sqliteopenhelper" class="router-link-active router-link-exact-active sidebar-item" aria-label="6.2.3　数据库帮助器SQLiteOpenHelper"><!--[--><!--]--> 6.2.3　数据库帮助器SQLiteOpenHelper <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/Android/AndroidBasic/%E7%AC%AC06%E7%AB%A0%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8.html#_6-2-4-优化记住密码功能" class="router-link-active router-link-exact-active sidebar-item" aria-label="6.2.4　优化记住密码功能"><!--[--><!--]--> 6.2.4　优化记住密码功能 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/Android/AndroidBasic/%E7%AC%AC06%E7%AB%A0%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8.html#_6-3-存储卡的文件操作" class="router-link-active router-link-exact-active sidebar-item" aria-label="6.3　存储卡的文件操作"><!--[--><!--]--> 6.3　存储卡的文件操作 <!--[--><!--]--></a><ul style="display:none;" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/Android/AndroidBasic/%E7%AC%AC06%E7%AB%A0%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8.html#_6-3-1-私有存储空间与公共存储空间" class="router-link-active router-link-exact-active sidebar-item" aria-label="6.3.1　私有存储空间与公共存储空间"><!--[--><!--]--> 6.3.1　私有存储空间与公共存储空间 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/Android/AndroidBasic/%E7%AC%AC06%E7%AB%A0%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8.html#_6-3-2-在存储卡上读写文本文件" class="router-link-active router-link-exact-active sidebar-item" aria-label="6.3.2　在存储卡上读写文本文件"><!--[--><!--]--> 6.3.2　在存储卡上读写文本文件 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/Android/AndroidBasic/%E7%AC%AC06%E7%AB%A0%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8.html#_6-3-3-在存储卡上读写图片文件" class="router-link-active router-link-exact-active sidebar-item" aria-label="6.3.3　在存储卡上读写图片文件"><!--[--><!--]--> 6.3.3　在存储卡上读写图片文件 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/Android/AndroidBasic/%E7%AC%AC06%E7%AB%A0%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8.html#_6-4-应用组件application" class="router-link-active router-link-exact-active sidebar-item" aria-label="6.4　应用组件Application"><!--[--><!--]--> 6.4　应用组件Application <!--[--><!--]--></a><ul style="display:none;" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/Android/AndroidBasic/%E7%AC%AC06%E7%AB%A0%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8.html#_6-4-1-application的生命周期" class="router-link-active router-link-exact-active sidebar-item" aria-label="6.4.1 Application的生命周期"><!--[--><!--]--> 6.4.1 Application的生命周期 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/Android/AndroidBasic/%E7%AC%AC06%E7%AB%A0%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8.html#_6-4-2-application操作全局变量" class="router-link-active router-link-exact-active sidebar-item" aria-label="6.4.2 Application操作全局变量"><!--[--><!--]--> 6.4.2 Application操作全局变量 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/Android/AndroidBasic/%E7%AC%AC06%E7%AB%A0%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8.html#_6-4-3-利用room简化数据库操作" class="router-link-active router-link-exact-active sidebar-item" aria-label="6.4.3　利用Room简化数据库操作"><!--[--><!--]--> 6.4.3　利用Room简化数据库操作 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/Android/AndroidBasic/%E7%AC%AC06%E7%AB%A0%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8.html#_6-5-实战项目-购物车" class="router-link-active router-link-exact-active sidebar-item" aria-label="6.5　实战项目：购物车"><!--[--><!--]--> 6.5　实战项目：购物车 <!--[--><!--]--></a><ul style="display:none;" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/Android/AndroidBasic/%E7%AC%AC06%E7%AB%A0%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8.html#_6-5-1-需求描述" class="router-link-active router-link-exact-active sidebar-item" aria-label="6.5.1　需求描述"><!--[--><!--]--> 6.5.1　需求描述 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/Android/AndroidBasic/%E7%AC%AC06%E7%AB%A0%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8.html#_6-5-2-界面设计" class="router-link-active router-link-exact-active sidebar-item" aria-label="6.5.2　界面设计"><!--[--><!--]--> 6.5.2　界面设计 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/Android/AndroidBasic/%E7%AC%AC06%E7%AB%A0%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8.html#_6-5-3-关键代码" class="router-link-active router-link-exact-active sidebar-item" aria-label="6.5.3　关键代码"><!--[--><!--]--> 6.5.3　关键代码 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/Android/AndroidBasic/%E7%AC%AC06%E7%AB%A0%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8.html#_6-6-小结" class="router-link-active router-link-exact-active sidebar-item" aria-label="6.6　小结"><!--[--><!--]--> 6.6　小结 <!--[--><!--]--></a><ul style="display:none;" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/Android/AndroidBasic/%E7%AC%AC06%E7%AB%A0%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8.html#_6-7-课后练习题" class="router-link-active router-link-exact-active sidebar-item" aria-label="6.7　课后练习题"><!--[--><!--]--> 6.7　课后练习题 <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><!--]--><div><h1 id="第-6-章-数据存储" tabindex="-1"><a class="header-anchor" href="#第-6-章-数据存储" aria-hidden="true">#</a> 第 6 章　数据存储</h1><p>本章介绍Android 4种存储方式的用法，包括共享参数SharedPreferences、数据库SQLite、存储卡文件、App的全局内存，另外介绍Android重要组件—应用Application的基本概念与常见用法。最后，结合本章所学的知识演示实战项目“购物车”的设计与实现。</p><h2 id="_6-1-sharedpreferences" tabindex="-1"><a class="header-anchor" href="#_6-1-sharedpreferences" aria-hidden="true">#</a> 6.1 SharedPreferences</h2><p>本节介绍Android的键值对存储方式——共享参数SharedPreferences的使用方法，包括：如何将数据保存到共享参数，如何从共享参数读取数据，如何使用共享参数实现登录页面的记住密码功能，如何利用设备浏览器找到共享参数文件。</p><h3 id="_6-1-1-共享参数的用法" tabindex="-1"><a class="header-anchor" href="#_6-1-1-共享参数的用法" aria-hidden="true">#</a> 6.1.1　共享参数的用法</h3><p>SharedPreferences是Android的一个轻量级存储工具，它采用的存储结构是Key-Value的键值对方式，类似于Java的Properties，二者都是把Key-Value的键值对保存在配置文件中。不同的是，Properties的文件内容形如Key=Value，而SharedPreferences的存储介质是XML文件，且以XML标记保存键值对。保存共享参数键值对信息的文件路径为：/data/data/应用包名/shared_prefs/文件名.xml。下面是一个共享参数的XML文件例子：</p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&#39;1.0&#39; encoding=&#39;utf-8&#39; standalone=&#39;yes&#39; ?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>map</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>string</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>name<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Mr Lee<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>string</span><span class="token punctuation">&gt;</span></span> 
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>int</span> <span class="token attr-name">nane</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>age<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>30<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>boolean</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>married<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span> 
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>float</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>weight<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>100.0<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>map</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>基于XML格式的特点，共享参数主要用于如下场合：</p><p>（ 1 ）简单且孤立的数据。若是复杂且相互关联的数据，则要保存于关系数据库。</p><p>（ 2 ）文本形式的数据。若是二进制数据，则要保存至文件。</p><p>（ 3 ）需要持久化存储的数据。App退出后再次启动时，之前保存的数据仍然有效。</p><p>实际开发中，共享参数经常存储的数据包括：App的个性化配置信息、用户使用App的行为信息、临时需要保存的片段信息等。</p><p>共享参数对数据的存储和读取操作类似于Map，也有存储数据的put方法，以及读取数据的get方法。调用getSharedPreferences方法可以获得共享参数实例，获取代码示例如下：</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 从share.xml获取共享参数实例</span>
<span class="token class-name">SharedPreferences</span> shared <span class="token operator">=</span> <span class="token function">getSharedPreferences</span><span class="token punctuation">(</span><span class="token string">&quot;share&quot;</span><span class="token punctuation">,</span> <span class="token constant">MODE_PRIVATE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>由以上代码可知，getSharedPreferences方法的第一个参数是文件名，填share表示共享参数的文件名是share.xml；第二个参数是操作模式，填MODE_PRIVATE表示私有模式。往共享参数存储数据要借助于Editor类，保存数据的代码示例如下：</p><p>（完整代码见chapter06\src\main\java\com\example\chapter06\ShareWriteActivity.java）</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">SharedPreferences<span class="token punctuation">.</span>Editor</span> editor <span class="token operator">=</span> shared<span class="token punctuation">.</span><span class="token function">edit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 获得编辑器的对象</span>
editor<span class="token punctuation">.</span><span class="token function">putString</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Mr Lee&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 添加一个名为name的字符串参数</span>
editor<span class="token punctuation">.</span><span class="token function">putInt</span><span class="token punctuation">(</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 添加一个名为age的整型参数</span>
editor<span class="token punctuation">.</span><span class="token function">putBoolean</span><span class="token punctuation">(</span><span class="token string">&quot;married&quot;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 添加一个名为married的布尔型参数</span>
editor<span class="token punctuation">.</span><span class="token function">putFloat</span><span class="token punctuation">(</span><span class="token string">&quot;weight&quot;</span><span class="token punctuation">,</span> <span class="token number">100f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 添加一个名为weight的浮点数参数</span>
editor<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 交编辑器中的修改</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>从共享参数读取数据相对简单，直接调用共享参数实例的get * * * 方法即可读取键值，注意 get***方法的第二个参数表示默认值，读取数据的代码示例如下：</p><p>（完整代码见chapter06\src\main\java\com\example\chapter06\ShareReadActivity.java）</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">String</span> name <span class="token operator">=</span> shared<span class="token punctuation">.</span>getString <span class="token punctuation">(</span> <span class="token string">&quot;name.&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//从共享参数获取名为name的字符串 </span>
<span class="token keyword">int</span> age <span class="token operator">=</span> shared<span class="token punctuation">.</span>getInt <span class="token punctuation">(</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 从共享参数获取名为age 的整型数</span>
<span class="token keyword">boolean</span> married <span class="token operator">=</span> shared<span class="token punctuation">.</span>getBoolean <span class="token punctuation">(</span> <span class="token string">&quot;married&quot;</span>， <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//从共享参数获取名为married </span>
的布尔数
<span class="token keyword">float</span> weight <span class="token operator">=</span> shared<span class="token punctuation">.</span>getFloat <span class="token punctuation">(</span> <span class="token string">&quot;weight&quot;</span>，<span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//从共享参数获取名为weight的浮点数</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>下面通过测试页面演示共享参数的存取过程，先在编辑页面录入用户注册信息，点击保存按钮把数据提交至共享参数，如图6-1所示。再到查看页面浏览用户注册信息，App从共享参数中读取各项数据，并将 注册信息显示在页面上，如图6-2所示。</p><pre><code>															![Image From 笔记-Android 开发从入门到实战](https://gitee.com/xiaweifeng/picgo/raw/master/images/202207061642827.png)
</code></pre><img src="https://gitee.com/xiaweifeng/picgo/raw/master/images/202207061642546.png" alt="Image From 笔记-Android 开发从入门到实战" style="zoom:67%;"><h3 id="_6-1-2-实现记住密码功能" tabindex="-1"><a class="header-anchor" href="#_6-1-2-实现记住密码功能" aria-hidden="true">#</a> 6.1.2　实现记住密码功能</h3><p>上一章末尾的实战项目，登录页面下方有一个“记住密码”复选框，当时只是为了演示控件的用法，并未真正记住密码。因为用户退出后重新进入登录页面，App没有回忆起上次的登录密码。现在利用共享参数改造该项目，使之实现记住密码的功能。</p><p>改造内容主要有下列 3 处：</p><p>（ 1 ）声明一个共享参数对象，并在onCreate中调用getSharedPreferences方法获取共享参数的实例。</p><p>（ 2 ）登录成功时，如果用户勾选了“记住密码”，就使用共享参数保存手机号码与密码。也就是在loginSuccess方法中增加以下代码：</p><p>（完整代码见chapter06\src\main\java\com\example\chapter06\LoginShareActivity.java）</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 如果勾选了“记住密码”，就把手机号码和密码都保存到共享参数中 </span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>isRemember<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token class-name">SharedPreferences<span class="token punctuation">.</span>Editor</span> editor <span class="token operator">=</span> mShared<span class="token punctuation">.</span><span class="token function">edit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 获得编辑器的对象</span>
   editor<span class="token punctuation">.</span><span class="token function">putString</span><span class="token punctuation">(</span><span class="token string">&quot;phone&quot;</span><span class="token punctuation">,</span> et_phone<span class="token punctuation">.</span><span class="token function">getText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 添加名叫phone的手机号码</span>
   editor<span class="token punctuation">.</span><span class="token function">putString</span><span class="token punctuation">(</span><span class="token string">&quot;password&quot;</span><span class="token punctuation">,</span> et_password<span class="token punctuation">.</span><span class="token function">getText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 添加名叫 </span>
password的密码
   editor<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 交编辑器中的修改 </span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>（ 3 ）再次打开登录页面时，App从共享参数读取手机号码与密码，并自动填入编辑框。也就是在onCreate方法中增加以下代码：</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 从share_login.xml获取共享参数对象</span>
mShared <span class="token operator">=</span> <span class="token function">getSharedPreferences</span><span class="token punctuation">(</span><span class="token string">&quot;share_login&quot;</span><span class="token punctuation">,</span> <span class="token constant">MODE_PRIVATE</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">// 获取共享参数保存的手机号码</span>
<span class="token class-name">String</span> phone <span class="token operator">=</span> mShared<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">&quot;phone&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">// 获取共享参数保存的密码</span>
<span class="token class-name">String</span> password <span class="token operator">=</span> mShared<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">&quot;password&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
et_phone<span class="token punctuation">.</span><span class="token function">setText</span><span class="token punctuation">(</span>phone<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 往手机号码编辑框填写上次保存的手机号 </span>
et_password<span class="token punctuation">.</span><span class="token function">setText</span><span class="token punctuation">(</span>password<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 往密码编辑框填写上次保存的密码</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>代码修改完毕，只要用户上次登录成功时勾选“记住密码”，下次进入登录页面后App就会自动填写上次登录的手机号码与密码。具体的效果如图6-3和图6-4所示。其中，图6-3为用户首次登录成功的界面，此时勾选了“记住密码”；图6-4为用户再次进入登录的界面，因为上次登录成功时已经记住密码，所以这次页面会自动填充保存的登录信息。</p><p><img src="https://gitee.com/xiaweifeng/picgo/raw/master/images/202207061647750.png" alt="Image From 笔记-Android 开发从入门到实战"></p><p><img src="https://gitee.com/xiaweifeng/picgo/raw/master/images/202207061647433.png" alt="Image From 笔记-Android 开发从入门到实战"></p><h3 id="_6-1-3-利用设备浏览器寻找共享参数文件" tabindex="-1"><a class="header-anchor" href="#_6-1-3-利用设备浏览器寻找共享参数文件" aria-hidden="true">#</a> 6.1.3　利用设备浏览器寻找共享参数文件</h3><p>前面的“6.1.1　共享参数的基本用法”提到，参数文件的路径为“/data/data/应用包名/shared_prefs/xxx.xml”，然而使用手机自带的文件管理器却找不到该路径，data下面只有空目录而已。这是因为手机厂商加了层保护，不让用户查看App的核心文件，否则万一不小心误删了，App岂不是运行报错了？当然作为开发者，只要打开了手机的USB调试功能，还是有办法拿到测试应用的数据文件。首先打开Android Studio，依次选择菜单Run→Run &#39;***&#39;，把测试应用比如chapter06安装到手机上。接着单击Android Studio左下角的logcat标签，找到已连接的手机设备和测试应用，如图6-5所示。注意到logcat窗口的右边，也就是Android Studio右下角有个竖排标签“Device File Explorer”，翻译过来叫设备文件浏览器。单击该标签按钮，此时主界面右边弹出名为“Device File Explorer”的窗口，如图6-6</p><p><img src="https://gitee.com/xiaweifeng/picgo/raw/master/images/202207061650804.png" alt="Image From 笔记-Android 开发从入门到实战"></p><p>在图6-6的窗口中依次展开各级目录，进到/data/data/com.example.chapter06/shared_prefs目录，在该目录下看到了参数文件share.xml。右击share.xml，并在右键菜单中选择“Save As”，把该文件保存到电脑中，之后就能查看详细的文件内容了。不仅参数文件，凡是保存在“/data/data/应用包名/”下面的所有文件，均可利用设备浏览器导出至电脑，下一节将要介绍的数据库db文件也可按照以上步骤导出。</p><h2 id="_6-2-数据库sqlite" tabindex="-1"><a class="header-anchor" href="#_6-2-数据库sqlite" aria-hidden="true">#</a> 6.2　数据库SQLite</h2><p>本节介绍Android的数据库存储方式—SQLite的使用方法，包括：SQLite用到了哪些SQL语法，如何使用数据库管理器操纵SQLite，如何使用数据库帮助器简化数据库操作等，以及如何利用SQLite改进登录页面的记住密码功能。</p><h3 id="_6-2-1-sql的基本语法" tabindex="-1"><a class="header-anchor" href="#_6-2-1-sql的基本语法" aria-hidden="true">#</a> 6.2.1 SQL的基本语法</h3><p>SQL本质上是一种编程语言，它的学名叫作“结构化查询语言”（全称为Structured Query Language，简称SQL）。不过SQL语言并非通用的编程语言，它专用于数据库的访问和处理，更像是一种<strong>操作命令</strong>，所以常说SQL语句而不说SQL代码。标准的SQL语句分为 3 类：数据定义、数据操纵和数据控制，但不同的数据库往往有自己的实现。SQLite是一种小巧的嵌入式数据库，使用方便、开发简单。如同MySQL、Oracle那样，SQLite也采用SQL语句管理数据，由于它属于轻型数据库，不涉及复杂的数据控制操作，因此App开发只用到数据定义和数据操纵两类SQL。此外，SQLite的SQL语法与通用的SQL语法略有不同，接下来介绍的两类SQL语 法全部基于SQLite。</p><p><strong>1 ．数据定义语言</strong></p><p>数据定义语言全称Data Definition Language，简称DDL，它描述了怎样变更数据实体的框架结构。就SQLite而言，DDL语言主要包括 3 种操作：创建表格、删除表格、修改表结构，分别说明如下。</p><p>（ 1 ）创建表格</p><p>表格的创建动作由create命令完成，格式为“CREATE TABLE IF NOT EXISTS　表格名称（以逗号分隔的各字段定义）；”。以用户信息表为例，它的建表语句如下所示：</p><div class="language-sqlite ext-sqlite line-numbers-mode"><pre class="language-sqlite"><code>CREATE TABLE IF NOT EXISTS user_info (
_id INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, 
  name VARCHAR NOT NULL,
  age INTEGER NOT NULL, 
  height LONG NOT NULL, 
  weight FLOAT NOT NULL,
married INTEGER NOT NULL,
  update_time VARCHAR NOT NULL);
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上面的SQL语法与其他数据库的SQL语法有所出入，相关的注意点说明见下：</p><p>①SQL语句不区分大小写，无论是create与table这类关键词，还是表格名称、字段名称，都不区分大小写。唯一区分大小写的是被单引号括起来的字符串值。</p><p>②为避免重复建表，应加上IF NOT EXISTS关键词，例如CREATE TABLE IF NOT EXISTS　表格名称......</p><p>③SQLite支持整型INTEGER、长整型LONG、字符串VARCHAR、浮点数FLOAT，但<strong>不支持布尔类型</strong>。布尔类型的数据要使用整型保存，如果直接保存布尔数据，在入库时SQLite会自动将它转为 0 或 1 ，其中 0 表示false， 1 表示true。</p><p>④建表时需要唯一标识字段，它的字段名为 id 。创建新表都要加上该字段定义，例如id INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL。</p><p>（ 2 ）删除表格</p><p>表格的删除动作由drop命令完成，格式为“DROP TABLE IF EXISTS　表格名称;”。下面是删除用户</p><p>信息表的SQL语句例子：</p><div class="language-sqlite ext-sqlite line-numbers-mode"><pre class="language-sqlite"><code>DROP TABLE IF EXISTS user_info; 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>（ 3 ）修改表结构</p><p>表格的修改动作由alter命令完成，格式为“ALTER TABLE　表格名称　修改操作;”。不过SQLite 只支持增加字段 ，不支持修改字段，也不支持删除字段。对于字段增加操作，需要在alter之后补充add命令，具体格式如“ALTER TABLE　表格名称　ADD COLUMN　字段名称　字段类型;”。下面是给用户信息表增加手机号字段的SQL语句例子：</p><div class="language-sqlite ext-sqlite line-numbers-mode"><pre class="language-sqlite"><code>ALTER TABLE user_info ADD COLUMN phone VARCHAR;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>注意，SQLite的ALTER语句每次只能添加一列字段，若要添加多列，就得分多次添加。</p><p><strong>2 ．数据操纵语言</strong></p><p>数据操纵语言全称Data Manipulation Language，简称DML，它描述了怎样处理数据实体的内部记录。表格记录的操作类型包括添加、删除、修改、查询 4 类，分别说明如下：</p><p>（ 1 ）添加记录</p><p>记录的添加动作由insert命令完成，格式为“INSERT INTO　表格名称（以逗号分隔的字段名列表）VALUES　（以逗号分隔的字段值列表）；”。下面是往用户信息表插入一条记录的SQL语句例子：</p><div class="language-sqlite ext-sqlite line-numbers-mode"><pre class="language-sqlite"><code>INSERT INTO user_info (name,age,height,weight,married,update_time) 
VALUES (&#39;张三&#39;,20,170,50,0,&#39;20200504&#39;);
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>（ 2 ）删除记录</p><p>记录的删除动作由delete命令完成，格式为“DELETE FROM　表格名称　WHERE　查询条件;”，其中查询条件的表达式形如“字段名=字段值”，多个字段的条件交集通过“AND”连接，条件并集通过“OR”连接。下面是从用户信息表删除指定记录的SQL语句例子：</p><div class="language-sqlite ext-sqlite line-numbers-mode"><pre class="language-sqlite"><code>DELETE FROM user_info WHERE name=&#39;张三&#39;;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>（ 3 ）修改记录</p><p>记录的修改动作由update命令完成，格式为“UPDATE　表格名称　SET　字段名=字段值 WHERE　查询条件;”。下面是对用户信息表更新指定记录的SQL语句例子：</p><div class="language-sqlite ext-sqlite line-numbers-mode"><pre class="language-sqlite"><code>UPDATE user_info SET married=1 WHERE name=&#39;张三&#39;;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>（ 4 ）查询记录</p><p>记录的查询动作由select命令完成，格式为“SELECT　以逗号分隔的字段名列表　FROM　表格名称WHERE　查询条件;”。如果字段名列表填星号“*”，则表示查询该表的所有字段。下面是从用户信息表查询指定记录的SQL语句例子：</p><div class="language-sqlite ext-sqlite line-numbers-mode"><pre class="language-sqlite"><code>SELECT name FROM user_info WHERE name=&#39;张三&#39;;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>查询操作除了比较字段值条件之外，常常需要对查询结果排序，此时要在查询条件后面添加排序条件，对应的表达式为“ORDER BY　字段名　ASC或者DESC”，意指对查询结果按照某个字段排序，其中ASC代表升序，DESC代表降序。下面是查询记录并对结果排序的SQL语句例子：</p><div class="language-sqlite ext-sqlite line-numbers-mode"><pre class="language-sqlite"><code>SELECT * FROM user_info ORDER BY age ASC;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>如果读者之前不熟悉SQL语法，建议下载一个SQLite管理软件，譬如SQLiteStudio，先在电脑上多加练习SQLite的常见操作语句。</p><h3 id="_6-2-2-数据库管理器sqlitedatabase" tabindex="-1"><a class="header-anchor" href="#_6-2-2-数据库管理器sqlitedatabase" aria-hidden="true">#</a> 6.2.2　数据库管理器SQLiteDatabase</h3><p>SQL语句毕竟只是SQL命令，若要在Java代码中操纵SQLite，还需专门的工具类。SQLiteDatabase便是Android提供的SQLite数据库管理器，开发者可以在活动页面代码调用openOrCreateDatabase方法获取数据库实例，参考代码如下：</p><p>（完整代码见chapter06\src\main\java\com\example\chapter06\DatabaseActivity.java）</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 创建名为test.db的数据库。数据库如果不存在就创建它，如果存在就打开它 </span>
<span class="token class-name">SQLiteDatabase</span> db <span class="token operator">=</span> <span class="token function">openOrCreateDatabase</span><span class="token punctuation">(</span><span class="token function">getFilesDir</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;/test.db&quot;</span><span class="token punctuation">,</span> 
<span class="token class-name">Context</span><span class="token punctuation">.</span><span class="token constant">MODE_PRIVATE</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> desc <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">&quot;数据库%s创建%s&quot;</span><span class="token punctuation">,</span> db<span class="token punctuation">.</span><span class="token function">getPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>db<span class="token operator">!=</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token string">&quot;成功&quot;</span><span class="token operator">:</span>&quot;失 
败&quot;<span class="token punctuation">)</span><span class="token punctuation">;</span>
tv_database<span class="token punctuation">.</span><span class="token function">setText</span><span class="token punctuation">(</span>desc<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// deleteDatabase(getFilesDir() + &quot;/test.db&quot;); // 删除名为test.db数据库</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>首次运行测试App，调用openOrCreateDatabase方法会自动创建数据库，并返回该数据库的管理器实例，创建结果如图6-7所示。</p><img src="https://gitee.com/xiaweifeng/picgo/raw/master/images/202207061718642.png" alt="Image From 笔记-Android 开发从入门到实战" style="zoom:67%;"><p>获得数据库实例之后，就能对该数据库开展各项操作了。数据库管理器SQLiteDatabase提供了若干操作数据表的API，常用的方法有 3 类，列举如下：</p><p><strong>1 ．管理类，用于数据库层面的操作</strong></p><ul><li><p>openDatabase：打开指定路径的数据库。</p></li><li><p>isOpen：判断数据库是否已打开。</p></li><li><p>close：关闭数据库。</p></li><li><p>getVersion：获取数据库的版本号。</p></li><li><p>setVersion：设置数据库的版本号。</p><p><strong>2 ．事务类，用于事务层面的操作</strong></p></li><li><p>beginTransaction：开始事务。</p></li><li><p>setTransactionSuccessful：设置事务的成功标志。</p></li><li><p>endTransaction：结束事务。执行本方法时，系统会判断之前是否调用了</p></li><li><p>setTransactionSuccessful方法，如果之前已调用该方法就提交事务，如果没有调用该方法就回滚事务。</p><p><strong>3 ．数据处理类，用于数据表层面的操作</strong></p></li><li><p>execSQL：执行拼接好的SQL控制语句。一般用于建表、删表、变更表结构。</p></li><li><p>delete：删除符合条件的记录。</p></li><li><p>update：更新符合条件的记录信息。</p></li><li><p>insert：插入一条记录。</p></li><li><p>query：执行查询操作，并返回结果集的游标。</p></li><li><p>rawQuery：执行拼接好的SQL查询语句，并返回结果集的游标。</p><p>在实际开发中，比较经常用到的是查询语句，建议先写好查询操作的select语句，再调用rawQuery方法</p><p>执行查询语句。</p></li></ul><h3 id="_6-2-3-数据库帮助器sqliteopenhelper" tabindex="-1"><a class="header-anchor" href="#_6-2-3-数据库帮助器sqliteopenhelper" aria-hidden="true">#</a> 6.2.3　数据库帮助器SQLiteOpenHelper</h3><p>由于SQLiteDatabase存在局限性，一不小心就会重复打开数据库，处理数据库的升级也不方便；因此Android提供了数据库帮助器SQLiteOpenHelper，帮助开发者合理使用SQLite。</p><p>SQLiteOpenHelper的具体使用步骤如下：</p><p><strong>步骤一</strong>，新建一个继承自SQLiteOpenHelper的数据库操作类，按提示重写onCreate和onUpgrade两个方法。其中，onCreate方法只在第一次打开数据库时执行，在此可以创建表结构；而onUpgrade方法在数据库版本升高时执行，在此可以根据新旧版本号变更表结构。</p><p><strong>步骤二</strong>，为保证数据库安全使用，需要封装几个必要方法，包括获取单例对象、打开数据库连接、关闭数据库连接，说明如下：</p><ul><li><p>获取单例对象：确保在App运行过程中数据库只会打开一次，避免重复打开引起错误。</p></li><li><p>打开数据库连接：SQLite有锁机制，即读锁和写锁的处理；故而数据库连接也分两种，读连接可调用getReadableDatabase方法获得，写连接可调用getWritableDatabase获得。</p></li><li><p>关闭数据库连接：数据库操作完毕，调用数据库实例的close方法关闭连接。</p></li></ul><p><strong>步骤三</strong>， 提供对表记录增加、删除、修改、查询的操作方法。 能被SQLite直接使用的数据结构是ContentValues类，它类似于映射Map，也提供了put和get方法存取键值对。区别之处在于：ContentValues的键只能是字符串，不能是其他类型。ContentValues主要用于增加记录和更新记录，对应数据库的insert和update方法。记录的查询操作用到了游标类Cursor，调用query和rawQuery方法返回的都是Cursor对象，若要获取全部的查询结果，则需根据游标的指示一条一条遍历结果集合。Cursor的常用方法可分为 3 类，说明如下：</p><p><strong>1 ．游标控制类方法，用于指定游标的状态</strong></p><ul><li><p>close：关闭游标。</p></li><li><p>isClosed：判断游标是否关闭。</p></li><li><p>isFirst：判断游标是否在开头。</p></li><li><p>isLast：判断游标是否在末尾。</p></li></ul><p><strong>2 ．游标移动类方法，把游标移动到指定位置</strong></p><ul><li><p>moveToFirst：移动游标到开头。</p></li><li><p>moveToLast：移动游标到末尾。</p></li><li><p>moveToNext：移动游标到下一条记录。</p></li><li><p>moveToPrevious：移动游标到上一条记录。</p></li><li><p>move：往后移动游标若干条记录。</p></li><li><p>moveToPosition：移动游标到指定位置的记录。</p></li></ul><p><strong>3 ．获取记录类方法，可获取记录的数量、类型以及取值</strong></p><ul><li><p>getCount：获取结果记录的数量。</p></li><li><p>getInt：获取指定字段的整型值。</p></li><li><p>getLong：获取指定字段的长整型值。</p></li><li><p>getFloat：获取指定字段的浮点数值。</p></li><li><p>getString：获取指定字段的字符串值。</p></li><li><p>getType：获取指定字段的字段类型。</p></li></ul><p>鉴于数据库操作的特殊性，不方便单独演示某个功能，接下来从创建数据库开始介绍，完整演示一下数据库的读写操作。用户注册信息的演示页面包括两个，分别是记录保存页面和记录读取页面，其中记录保存页面通过insert方法向数据库添加用户信息，完整代码见 chapter06\src\main\java\com\example\chapter06\SQLiteHelperActivity.java；而记录读取页面通过query方法从数据库读取用户信息，完整代码见chapter06\src\main\java\com\example\chapter06\SQLiteHelperActivity.java。运行测试App，先打开记录保存页面，依次录入并将两个用户的注册信息保存至数据库，如图6-8和图6-9 所示。再打开记录读取页面，从数据库读取用户注册信息并展示在页面上，如图6-10所示。</p><img src="https://gitee.com/xiaweifeng/picgo/raw/master/images/202207061730004.png" alt="Image From 笔记-Android 开发从入门到实战" style="zoom:67%;"><img src="https://gitee.com/xiaweifeng/picgo/raw/master/images/202207061730447.png" alt="Image From 笔记-Android 开发从入门到实战" style="zoom:67%;"><p>上述演示页面主要用到了数据库记录的添加、查询和删除操作，对应的数据库帮助器关键代码如下所示，尤其关注里面的insert、delete、update和query方法：</p><p>（完整代码见chapter06\src\main\java\com\example\chapter06\database\UserDBHelper.java）</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>dongnaoedu<span class="token punctuation">.</span>chapter06<span class="token punctuation">.</span>database</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">android<span class="token punctuation">.</span>content<span class="token punctuation">.</span></span><span class="token class-name">ContentValues</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">android<span class="token punctuation">.</span>content<span class="token punctuation">.</span></span><span class="token class-name">Context</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">android<span class="token punctuation">.</span>database<span class="token punctuation">.</span></span><span class="token class-name">Cursor</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">android<span class="token punctuation">.</span>database<span class="token punctuation">.</span>sqlite<span class="token punctuation">.</span></span><span class="token class-name">SQLiteDatabase</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">android<span class="token punctuation">.</span>database<span class="token punctuation">.</span>sqlite<span class="token punctuation">.</span></span><span class="token class-name">SQLiteOpenHelper</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">android<span class="token punctuation">.</span>view<span class="token punctuation">.</span></span><span class="token class-name">WindowAnimationFrameStats</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>dongnaoedu<span class="token punctuation">.</span>chapter06<span class="token punctuation">.</span>enity<span class="token punctuation">.</span></span><span class="token class-name">User</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">ArrayList</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserDBHelper</span> <span class="token keyword">extends</span> <span class="token class-name">SQLiteOpenHelper</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">DB_NAME</span> <span class="token operator">=</span> <span class="token string">&quot;user.db&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">TABLE_NAME</span> <span class="token operator">=</span> <span class="token string">&quot;user_info&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token constant">DB_VERSION</span> <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">UserDBHelper</span> mHelper <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">SQLiteDatabase</span> mRDB <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">SQLiteDatabase</span> mWDB <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">UserDBHelper</span><span class="token punctuation">(</span><span class="token class-name">Context</span> context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> <span class="token constant">DB_NAME</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token constant">DB_VERSION</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 利用单例模式获取数据库帮助器的唯一实例</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">UserDBHelper</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token class-name">Context</span> context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>mHelper <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            mHelper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UserDBHelper</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> mHelper<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 打开数据库的读连接</span>
    <span class="token keyword">public</span> <span class="token class-name">SQLiteDatabase</span> <span class="token function">openReadLink</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>mRDB <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> <span class="token operator">!</span>mRDB<span class="token punctuation">.</span><span class="token function">isOpen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            mRDB <span class="token operator">=</span> mHelper<span class="token punctuation">.</span><span class="token function">getReadableDatabase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> mRDB<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 打开数据库的写连接</span>
    <span class="token keyword">public</span> <span class="token class-name">SQLiteDatabase</span> <span class="token function">openWriteLink</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>mWDB <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> <span class="token operator">!</span>mWDB<span class="token punctuation">.</span><span class="token function">isOpen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            mWDB <span class="token operator">=</span> mHelper<span class="token punctuation">.</span><span class="token function">getWritableDatabase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> mWDB<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 关闭数据库连接</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">closeLink</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>mRDB <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> mRDB<span class="token punctuation">.</span><span class="token function">isOpen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            mRDB<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            mRDB <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>mWDB <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> mWDB<span class="token punctuation">.</span><span class="token function">isOpen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            mWDB<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            mWDB <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 创建数据库，执行建表语句</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onCreate</span><span class="token punctuation">(</span><span class="token class-name">SQLiteDatabase</span> db<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> sql <span class="token operator">=</span> <span class="token string">&quot;CREATE TABLE IF NOT EXISTS &quot;</span> <span class="token operator">+</span> <span class="token constant">TABLE_NAME</span> <span class="token operator">+</span> <span class="token string">&quot; (&quot;</span> <span class="token operator">+</span>
                <span class="token string">&quot;_id INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL,&quot;</span> <span class="token operator">+</span>
                <span class="token string">&quot; name VARCHAR NOT NULL,&quot;</span> <span class="token operator">+</span>
                <span class="token string">&quot; age INTEGER NOT NULL,&quot;</span> <span class="token operator">+</span>
                <span class="token string">&quot; height LONG NOT NULL,&quot;</span> <span class="token operator">+</span>
                <span class="token string">&quot; weight FLOAT NOT NULL,&quot;</span> <span class="token operator">+</span>
                <span class="token string">&quot; married INTEGER NOT NULL);&quot;</span><span class="token punctuation">;</span>
        db<span class="token punctuation">.</span><span class="token function">execSQL</span><span class="token punctuation">(</span>sql<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//升级数据库会执行</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onUpgrade</span><span class="token punctuation">(</span><span class="token class-name">SQLiteDatabase</span> db<span class="token punctuation">,</span> <span class="token keyword">int</span> oldVersion<span class="token punctuation">,</span> <span class="token keyword">int</span> newVersion<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> sql <span class="token operator">=</span> <span class="token string">&quot;ALTER TABLE &quot;</span> <span class="token operator">+</span> <span class="token constant">TABLE_NAME</span> <span class="token operator">+</span> <span class="token string">&quot; ADD COLUMN phone VARCHAR;&quot;</span><span class="token punctuation">;</span>
        db<span class="token punctuation">.</span><span class="token function">execSQL</span><span class="token punctuation">(</span>sql<span class="token punctuation">)</span><span class="token punctuation">;</span>
        sql <span class="token operator">=</span> <span class="token string">&quot;ALTER TABLE &quot;</span> <span class="token operator">+</span> <span class="token constant">TABLE_NAME</span> <span class="token operator">+</span> <span class="token string">&quot; ADD COLUMN password VARCHAR;&quot;</span><span class="token punctuation">;</span>
        db<span class="token punctuation">.</span><span class="token function">execSQL</span><span class="token punctuation">(</span>sql<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">long</span> <span class="token function">insert</span><span class="token punctuation">(</span><span class="token class-name">User</span> user<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">ContentValues</span> values <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ContentValues</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        values<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> user<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        values<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">,</span> user<span class="token punctuation">.</span>age<span class="token punctuation">)</span><span class="token punctuation">;</span>
        values<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;height&quot;</span><span class="token punctuation">,</span> user<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>
        values<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;weight&quot;</span><span class="token punctuation">,</span> user<span class="token punctuation">.</span>weight<span class="token punctuation">)</span><span class="token punctuation">;</span>
        values<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;married&quot;</span><span class="token punctuation">,</span> user<span class="token punctuation">.</span>married<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 执行插入记录动作，该语句返回插入记录的行号</span>
        <span class="token comment">// 如果第三个参数values 为Null或者元素个数为0， 由于insert()方法要求必须添加一条除了主键之外其它字段为Null值的记录，</span>
        <span class="token comment">// 为了满足SQL语法的需要， insert语句必须给定一个字段名 ，如：insert into person(name) values(NULL)，</span>
        <span class="token comment">// 倘若不给定字段名 ， insert语句就成了这样： insert into person() values()，显然这不满足标准SQL的语法。</span>
        <span class="token comment">// 如果第三个参数values 不为Null并且元素的个数大于0 ，可以把第二个参数设置为null 。</span>
        <span class="token comment">//return mWDB.insert(TABLE_NAME, null, values);</span>

        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            mWDB<span class="token punctuation">.</span><span class="token function">beginTransaction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            mWDB<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token constant">TABLE_NAME</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> values<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//int i = 10 / 0;</span>
            mWDB<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token constant">TABLE_NAME</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> values<span class="token punctuation">)</span><span class="token punctuation">;</span>
            mWDB<span class="token punctuation">.</span><span class="token function">setTransactionSuccessful</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
            mWDB<span class="token punctuation">.</span><span class="token function">endTransaction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">long</span> <span class="token function">deleteByName</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//删除所有</span>
        <span class="token comment">//mWDB.delete(TABLE_NAME, &quot;1=1&quot;, null);</span>
        <span class="token keyword">return</span> mWDB<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token constant">TABLE_NAME</span><span class="token punctuation">,</span> <span class="token string">&quot;name=?&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span>name<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">long</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token class-name">User</span> user<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">ContentValues</span> values <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ContentValues</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        values<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> user<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        values<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">,</span> user<span class="token punctuation">.</span>age<span class="token punctuation">)</span><span class="token punctuation">;</span>
        values<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;height&quot;</span><span class="token punctuation">,</span> user<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>
        values<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;weight&quot;</span><span class="token punctuation">,</span> user<span class="token punctuation">.</span>weight<span class="token punctuation">)</span><span class="token punctuation">;</span>
        values<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;married&quot;</span><span class="token punctuation">,</span> user<span class="token punctuation">.</span>married<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> mWDB<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token constant">TABLE_NAME</span><span class="token punctuation">,</span> values<span class="token punctuation">,</span> <span class="token string">&quot;name=?&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span>user<span class="token punctuation">.</span>name<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> <span class="token function">queryAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 执行记录查询动作，该语句返回结果集的游标</span>
        <span class="token class-name">Cursor</span> cursor <span class="token operator">=</span> mRDB<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token constant">TABLE_NAME</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 循环取出游标指向的每条记录</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span>cursor<span class="token punctuation">.</span><span class="token function">moveToNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            user<span class="token punctuation">.</span>id <span class="token operator">=</span> cursor<span class="token punctuation">.</span><span class="token function">getInt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            user<span class="token punctuation">.</span>name <span class="token operator">=</span> cursor<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            user<span class="token punctuation">.</span>age <span class="token operator">=</span> cursor<span class="token punctuation">.</span><span class="token function">getInt</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            user<span class="token punctuation">.</span>height <span class="token operator">=</span> cursor<span class="token punctuation">.</span><span class="token function">getLong</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            user<span class="token punctuation">.</span>weight <span class="token operator">=</span> cursor<span class="token punctuation">.</span><span class="token function">getFloat</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//SQLite没有布尔型，用0表示false，用1表示true</span>
            user<span class="token punctuation">.</span>married <span class="token operator">=</span> <span class="token punctuation">(</span>cursor<span class="token punctuation">.</span><span class="token function">getInt</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token boolean">false</span> <span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> list<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> <span class="token function">queryByName</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 执行记录查询动作，该语句返回结果集的游标</span>
        <span class="token class-name">Cursor</span> cursor <span class="token operator">=</span> mRDB<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token constant">TABLE_NAME</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">&quot;name=?&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span>name<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 循环取出游标指向的每条记录</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span>cursor<span class="token punctuation">.</span><span class="token function">moveToNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            user<span class="token punctuation">.</span>id <span class="token operator">=</span> cursor<span class="token punctuation">.</span><span class="token function">getInt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            user<span class="token punctuation">.</span>name <span class="token operator">=</span> cursor<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            user<span class="token punctuation">.</span>age <span class="token operator">=</span> cursor<span class="token punctuation">.</span><span class="token function">getInt</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            user<span class="token punctuation">.</span>height <span class="token operator">=</span> cursor<span class="token punctuation">.</span><span class="token function">getLong</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            user<span class="token punctuation">.</span>weight <span class="token operator">=</span> cursor<span class="token punctuation">.</span><span class="token function">getFloat</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//SQLite没有布尔型，用0表示false，用1表示true</span>
            user<span class="token punctuation">.</span>married <span class="token operator">=</span> <span class="token punctuation">(</span>cursor<span class="token punctuation">.</span><span class="token function">getInt</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token boolean">false</span> <span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> list<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_6-2-4-优化记住密码功能" tabindex="-1"><a class="header-anchor" href="#_6-2-4-优化记住密码功能" aria-hidden="true">#</a> 6.2.4　优化记住密码功能</h3><p>在“6.1.2　实现记住密码功能”中，虽然使用共享参数实现了记住密码功能，但是该方案只能记住一个用户的登录信息，并且手机号码跟密码没有对应关系，如果换个手机号码登录，前一个用户的登录信息就被覆盖了。真正的记住密码功能应当是这样的：先输入手机号码，然后根据手机号码匹配保存的密码，一个手机号码对应一个密码，从而实现具体手机号码的密码记忆功能。现在运用数据库技术分条存储各用户的登录信息，并支持根据手机号查找登录信息，从而同时记住多个手机号的密码。具体的改造主要有下列 3 点：</p><p>（ 1 ）声明一个数据库的帮助器对象，然后在活动页面的onResume方法中打开数据库连接，在onPasue方法中关闭数据库连接，示例代码如下：</p><p>（完整代码见chapter06\src\main\java\com\example\chapter06\LoginSQLiteActivity.java）</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token class-name">UserDBHelper</span> mHelper<span class="token punctuation">;</span> <span class="token comment">// 声明一个用户数据库的帮助器对象 </span>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">onResume</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
   <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onResume</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   mHelper <span class="token operator">=</span> <span class="token class-name">UserDBHelper</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 获得用户数据库帮助器的实例 </span>
   mHelper<span class="token punctuation">.</span><span class="token function">openWriteLink</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 恢复页面，则打开数据库连接</span>
<span class="token punctuation">}</span>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">onPause</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
   <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onPause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   mHelper<span class="token punctuation">.</span><span class="token function">closeLink</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 暂停页面，则关闭数据库连接 </span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>（ 2 ）登录成功时，如果用户勾选了“记住密码”，就将手机号码及其密码保存至数据库。也就是在loginSuccess方法中增加如下代码：</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 如果勾选了“记住密码”，则把手机号码和密码保存为数据库的用户表记录 </span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>isRemember<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token class-name">UserInfo</span> info <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UserInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 创建一个用户信息对象 </span>
   info<span class="token punctuation">.</span>phone <span class="token operator">=</span> et_phone<span class="token punctuation">.</span><span class="token function">getText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   info<span class="token punctuation">.</span>password <span class="token operator">=</span> et_password<span class="token punctuation">.</span><span class="token function">getText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   info<span class="token punctuation">.</span>update_time <span class="token operator">=</span> <span class="token class-name">DateUtil</span><span class="token punctuation">.</span><span class="token function">getNowDateTime</span><span class="token punctuation">(</span><span class="token string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
   mHelper<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>info<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 往用户数据库添加登录成功的用户信息</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>（ 3 ）再次打开登录页面，用户输入手机号再点击密码框的时候，App根据手机号到数据库查找登录信息，并将记录结果中的密码填入密码框。其中根据手机号码查找登录信息，要求在帮助器代码中添加以下方法，用于找到指定手机的登录密码：</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 根据手机号码查询指定记录</span>
<span class="token keyword">public</span> <span class="token class-name">UserInfo</span> <span class="token function">queryByPhone</span><span class="token punctuation">(</span><span class="token class-name">String</span> phone<span class="token punctuation">)</span> <span class="token punctuation">{</span> 
   <span class="token class-name">UserInfo</span> info <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
   <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">UserInfo</span><span class="token punctuation">&gt;</span></span> infoList <span class="token operator">=</span> <span class="token function">query</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">&quot;phone=&#39;%s&#39;&quot;</span><span class="token punctuation">,</span> phone<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token keyword">if</span> <span class="token punctuation">(</span>infoList<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 存在该号码的登录信息</span>
       info <span class="token operator">=</span> infoList<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
 <span class="token punctuation">}</span>
   <span class="token keyword">return</span> info<span class="token punctuation">;</span> 
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>此外，上面第 3 点的点击密码框触发查询操作，用到了编辑框的焦点变更事件，有关焦点变更监听器的详细用法参见第 5 章的“5.3.2　焦点变更监听器”。就本案例而言，光标切到密码框触发焦点变更事件，具体处理逻辑要求重写监听器的onFocusChange方法，重写后的方法代码如下所示：</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onFocusChange</span><span class="token punctuation">(</span><span class="token class-name">View</span> v<span class="token punctuation">,</span> <span class="token keyword">boolean</span> hasFocus<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token class-name">String</span> phone <span class="token operator">=</span> et_phone<span class="token punctuation">.</span><span class="token function">getText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token comment">// 判断是否是密码编辑框发生焦点变化</span>
   <span class="token keyword">if</span> <span class="token punctuation">(</span>v<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>et_password<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token comment">// 用户已输入手机号码，且密码框获得焦点</span>
       <span class="token keyword">if</span> <span class="token punctuation">(</span>phone<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> hasFocus<span class="token punctuation">)</span> <span class="token punctuation">{</span>
           <span class="token comment">// 根据手机号码到数据库中查询用户记录</span>
           <span class="token class-name">UserInfo</span> info <span class="token operator">=</span> mHelper<span class="token punctuation">.</span><span class="token function">queryByPhone</span><span class="token punctuation">(</span>phone<span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token keyword">if</span> <span class="token punctuation">(</span>info <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
               <span class="token comment">// 找到用户记录，则自动在密码框中填写该用户的密码</span>
               et_password<span class="token punctuation">.</span><span class="token function">setText</span><span class="token punctuation">(</span>info<span class="token punctuation">.</span>password<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
 <span class="token punctuation">}</span> 
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>重新运行测试App，先打开登录页面，勾选“记住密码”，并确保本次登录成功。然后再次进入登录页面，输入手机号码后光标还停留在手机框，如图6-11所示。接着点击密码框，光标随之跳到密码框，此时密码框自动填入了该号码对应的密码串，如图6-12所示。由效果图可见，这次实现了真正意义上的记住密码功能。</p><p><img src="https://gitee.com/xiaweifeng/picgo/raw/master/images/202207061753565.png" alt="Image From 笔记-Android 开发从入门到实战"></p><p><img src="https://gitee.com/xiaweifeng/picgo/raw/master/images/202207061753193.png" alt="Image From 笔记-Android 开发从入门到实战"></p><h2 id="_6-3-存储卡的文件操作" tabindex="-1"><a class="header-anchor" href="#_6-3-存储卡的文件操作" aria-hidden="true">#</a> 6.3　存储卡的文件操作</h2><p>本节介绍Android的文件存储方式—在存储卡上读写文件，包括：公有存储空间与私有存储空间有什么区别、如何利用存储卡读写文本文件、如何利用存储卡读写图片文件等。</p><h3 id="_6-3-1-私有存储空间与公共存储空间" tabindex="-1"><a class="header-anchor" href="#_6-3-1-私有存储空间与公共存储空间" aria-hidden="true">#</a> 6.3.1　私有存储空间与公共存储空间</h3><p>为了更规范地管理手机存储空间，<strong>Android从7.0开始将存储卡划分为私有存储和公共存储</strong>两大部分，也就是分区存储方式，系统给每个App都分配了默认的私有存储空间。App在私有空间上读写文件无须任何授权，但是若想在公共空间读写文件，则要在AndroidManifest.xml里面添加下述的权限配置。</p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token comment">&lt;!-- 存储卡读写 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>uses-permission</span> <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>android.permission.WRITE_EXTERNAL_STORAGE<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span> 
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>uses-permission</span> <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>android.permission.READ_EXTERNAL_STORAG<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>但是即使App声明了完整的存储卡操作权限，系统仍然默认禁止该App访问公共空间。打开手机的系统设置界面，进入到具体应用的管理页面，会发现该应用的存储访问权限被禁止了。当然禁止访问只是不让访问存储卡的公共空间，App自身的私有空间依旧可以正常读写。这缘于Android把存储卡分成了两块区域，一块是所有应用均可访问的公共空间，另一块是只有应用自己才可访问的专享空间。虽然Android给每个应用都分配了单独的安装目录，但是安装目录的空间很紧张，所以Android在存储卡的“Android/data”目录下给<strong>每个应用又单独建了一个文件目录</strong>，用来保存应用自己需要处理的临时文件。这个目录只有当前应用才能够读写文件，其他应用是不允许读写的。由于私有空间本身已经加了访问权限控制，因此它不受系统禁止访问的影响，应用操作自己的文件目录自然不成问题。因为私有的文件目录只有属主应用才能访问，所以一旦属主应用被卸载，那么对应的目录也会被删掉。</p><p>既然存储卡分为公共空间和私有空间两部分，它们的空间路径获取也就有所不同。若想获取公共空间的存储路径，调用的是<strong>Environment.getExternalStoragePublicDirectory</strong>方法；若想获取应用私有空间的存储路径，调用的是<strong>getExternalFilesDir</strong>方法。下面是分别获取两个空间路径的代码例子：</p><p>（完整代码见chapter06\src\main\java\com\example\chapter06\FilePathActivity.java）</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 获取系统的公共存储路径 </span>
<span class="token class-name">String</span> publicPath <span class="token operator">=</span>
<span class="token class-name">Environment</span><span class="token punctuation">.</span><span class="token function">getExternalStoragePublicDirectory</span><span class="token punctuation">(</span><span class="token class-name">Environment</span><span class="token punctuation">.</span><span class="token constant">DIRECTORY_DOWNLOADS</span><span class="token punctuation">)</span><span class="token punctuation">.</span>t 
<span class="token function">oString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 获取当前App的私有存储路径 </span>
<span class="token class-name">String</span> privatePath <span class="token operator">=</span>
<span class="token function">getExternalFilesDir</span><span class="token punctuation">(</span><span class="token class-name">Environment</span><span class="token punctuation">.</span><span class="token constant">DIRECTORY_DOWNLOADS</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token keyword">boolean</span> isLegacy <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Build</span><span class="token punctuation">.</span><span class="token constant">VERSION</span><span class="token punctuation">.</span><span class="token constant">SDK_INT</span> <span class="token operator">&gt;=</span> <span class="token class-name">Build<span class="token punctuation">.</span>VERSION_CODES<span class="token punctuation">.</span>Q</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token comment">// Android10的存储空间默认采取分区方式，此处判断是传统方式还是分区方式 </span>
   isLegacy <span class="token operator">=</span> <span class="token class-name">Environment</span><span class="token punctuation">.</span><span class="token function">isExternalStorageLegacy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token class-name">String</span> desc <span class="token operator">=</span> <span class="token string">&quot;系统的公共存储路径位于&quot;</span> <span class="token operator">+</span> publicPath <span class="token operator">+</span> 
   <span class="token string">&quot;\n\n当前App的私有存储路径位于&quot;</span> <span class="token operator">+</span> privatePath <span class="token operator">+</span> 
   <span class="token string">&quot;\n\nAndroid7.0之后默认禁止访问公共存储目录&quot;</span> <span class="token operator">+</span>
   <span class="token string">&quot;\n\n当前App的存储空间采取&quot;</span> <span class="token operator">+</span> <span class="token punctuation">(</span>isLegacy<span class="token operator">?</span><span class="token string">&quot;传统方式&quot;</span><span class="token operator">:</span><span class="token string">&quot;分区方式&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
tv_path<span class="token punctuation">.</span><span class="token function">setText</span><span class="token punctuation">(</span>desc<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>该例子运行之后获得的路径信息如图6-14所示，可见应用的私有空间路径位于“存储卡根目录/Android/data/应用包名/files/Download”这个目录中。</p><img src="https://gitee.com/xiaweifeng/picgo/raw/master/images/202207061803776.png" alt="Image From 笔记-Android 开发从入门到实战" style="zoom:67%;"><h3 id="_6-3-2-在存储卡上读写文本文件" tabindex="-1"><a class="header-anchor" href="#_6-3-2-在存储卡上读写文本文件" aria-hidden="true">#</a> 6.3.2　在存储卡上读写文本文件</h3><p>文本文件的读写借助于文件IO流FileOutputStream和FileInputStream。其中，FileOutputStream用于写文件，FileInputStream用于读文件，它们读写文件的代码例子如下：</p><p>（完整代码见chapter06\src\main\java\com\example\chapter06\util\FileUtil.java）</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 把字符串保存到指定路径的文本文件</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">saveText</span><span class="token punctuation">(</span><span class="token class-name">String</span> path<span class="token punctuation">,</span> <span class="token class-name">String</span> txt<span class="token punctuation">)</span> <span class="token punctuation">{</span> 
   <span class="token comment">// 根据指定的文件路径构建文件输出流对象</span>
   <span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">FileOutputStream</span> fos <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileOutputStream</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
       fos<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>txt<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 把字符串写入文件输出流</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span> 
       e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
 <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// 从指定路径的文本文件中读取内容字符串</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">openText</span><span class="token punctuation">(</span><span class="token class-name">String</span> path<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token class-name">String</span> readStr <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
   <span class="token comment">// 根据指定的文件路径构建文件输入流对象</span>
   <span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">FileInputStream</span> fis <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> b <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span>fis<span class="token punctuation">.</span><span class="token function">available</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
       fis<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 从文件输入流读取字节数组</span>
       readStr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 把字节数组转换为字符串</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
   <span class="token keyword">return</span> readStr<span class="token punctuation">;</span> <span class="token comment">// 返回文本文件中的文本字符串 </span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>方式二：使用字符流存储读取文件</strong></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 把字符串保存到指定路径的文本文件</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">saveText</span><span class="token punctuation">(</span><span class="token class-name">String</span> path<span class="token punctuation">,</span> <span class="token class-name">String</span> txt<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">BufferedWriter</span> os <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            os <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BufferedWriter</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FileWriter</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            os<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>txt<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>os <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    os<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 从指定路径的文本文件中读取内容字符串</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">openText</span><span class="token punctuation">(</span><span class="token class-name">String</span> path<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">BufferedReader</span> is <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token class-name">StringBuilder</span> sb <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            is <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BufferedReader</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FileReader</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">String</span> line <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>line <span class="token operator">=</span> is<span class="token punctuation">.</span><span class="token function">readLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                sb<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>line<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>is <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    is<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> sb<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>接着分别创建写文件页面和读文件页面，其中写文件页面调用saveText方法保存文本，完整代码见chapter06\src\main\java\com\example\chapter06\FileWriteActivity.java；而读文件页面调用readText方法从指定路径的文件中读取文本内容，完整代码见chapter06\src\main\java\com\example\chapter06\FileReadActivity.java。然后运行测试App，先打开文本写入页面，录入注册信息后保存为私有目录里的文本文件，此时写入界面如图6-15所示。再打开文本读取页面，App自动在私有目录下找到文本文件列表，并展示其中一个文件的文本内容，此时读取界面如图6-16所示。</p><img src="https://gitee.com/xiaweifeng/picgo/raw/master/images/202207061810868.png" alt="Image From 笔记-Android 开发从入门到实战" style="zoom:67%;"><img src="https://gitee.com/xiaweifeng/picgo/raw/master/images/202207061810074.png" alt="Image From 笔记-Android 开发从入门到实战" style="zoom:67%;"><h3 id="_6-3-3-在存储卡上读写图片文件" tabindex="-1"><a class="header-anchor" href="#_6-3-3-在存储卡上读写图片文件" aria-hidden="true">#</a> 6.3.3　在存储卡上读写图片文件</h3><p>文本文件读写可以转换为对字符串的读写，而图片文件保存的是图像数据，需要专门的位图工具Bitmap处理。位图对象依据来源不同又分成 3 种获取方式，分别对应位图工厂BitmapFactory的下列 3 种方法：</p><ul><li>decodeResource：从指定的资源文件中获取位图数据。例如下面代码表示从资源文件huawei.png获取位图对象：</li></ul><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">Bitmap</span> bitmap <span class="token operator">=</span> <span class="token class-name">BitmapFactory</span><span class="token punctuation">.</span><span class="token function">decodeResource</span><span class="token punctuation">(</span><span class="token function">getResources</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token class-name">R</span><span class="token punctuation">.</span>drawable<span class="token punctuation">.</span>huawei<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li><p>decodeFile：从指定路径的文件中获取位图数据。注意从Android 10开始，该方法只适用于私有目录下的图片，不适用公共空间下的图片。</p></li><li><p>decodeStream：从指定的输入流中获取位图数据。比如使用IO流打开图片文件，此时文件输入流</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 从指定路径的图片文件中读取位图数据</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Bitmap</span> <span class="token function">openImage</span><span class="token punctuation">(</span><span class="token class-name">String</span> path<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Bitmap</span> bitmap <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token class-name">FileInputStream</span> fis <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            fis <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>
            bitmap <span class="token operator">=</span> <span class="token class-name">BitmapFactory</span><span class="token punctuation">.</span><span class="token function">decodeStream</span><span class="token punctuation">(</span>fis<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>fis <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    fis<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> bitmap<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>对象即可作为decodeStream方法的入参，相应的图片读取代码如下：</p><p>（完整代码见chapter06\src\main\java\com\example\chapter06\util\FileUtil.java）</p></li></ul><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 从指定路径的图片文件中读取位图数据</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Bitmap</span> <span class="token function">openImage</span><span class="token punctuation">(</span><span class="token class-name">String</span> path<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token class-name">Bitmap</span> bitmap <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token comment">// 声明一个位图对象</span>
   <span class="token comment">// 根据指定的文件路径构建文件输入流对象</span>
   <span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">FileInputStream</span> fis <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       bitmap <span class="token operator">=</span> <span class="token class-name">BitmapFactory</span><span class="token punctuation">.</span><span class="token function">decodeStream</span><span class="token punctuation">(</span>fis<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 从文件输入流中解码位图数据</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
   <span class="token keyword">return</span> bitmap<span class="token punctuation">;</span> <span class="token comment">// 返回图片文件中的位图数据 </span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>得到位图对象之后，就能在图像视图上显示位图。图像视图ImageView提供了下列方法显示各种来源的图片：</p><ul><li><p>setImageResource：设置图像视图的图片资源，该方法的入参为资源图片的编号，形如</p></li><li><p>“R.drawable.去掉扩展名的图片名称”。</p></li><li><p>setImageBitmap：设置图像视图的位图对象，该方法的入参为Bitmap类型。</p></li><li><p>setImageURI：设置图像视图的路径对象，该方法的入参为Uri类型。字符串格式的文件路径可通过代码“Uri.parse(file_path)”转换成路径对象。读取图片文件的花样倒是挺多，把位图数据写入图片文件却只有一种，即通过位图对象的compress方法将位图数据压缩到文件输出流。具体的图片写入代码如下所示：</p></li></ul><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 把位图数据保存到指定路径的图片文件</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">saveImage</span><span class="token punctuation">(</span><span class="token class-name">String</span> path<span class="token punctuation">,</span> <span class="token class-name">Bitmap</span> bitmap<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">FileOutputStream</span> fos <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            fos <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileOutputStream</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 把位图数据压缩到文件输出流中</span>
            bitmap<span class="token punctuation">.</span><span class="token function">compress</span><span class="token punctuation">(</span><span class="token class-name">Bitmap<span class="token punctuation">.</span>CompressFormat</span><span class="token punctuation">.</span><span class="token constant">JPEG</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> fos<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>fos <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    fos<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>接下来完整演示一遍图片文件的读写操作，首先创建图片写入页面，从某个资源图片读取位图数据，再把位图数据保存为私有目录的图片文件，相关代码示例如下：</p><p>（完整代码见chapter06\src\main\java\com\example\chapter06\ImageWriteActivity.java）</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 获取当前App的私有下载目录</span>
<span class="token class-name">String</span> path <span class="token operator">=</span> <span class="token function">getExternalFilesDir</span><span class="token punctuation">(</span><span class="token class-name">Environment</span><span class="token punctuation">.</span><span class="token constant">DIRECTORY_DOWNLOADS</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> 
<span class="token string">&quot;/&quot;</span><span class="token punctuation">;</span>
<span class="token comment">// 从指定的资源文件中获取位图对象</span>
<span class="token class-name">Bitmap</span> bitmap <span class="token operator">=</span> <span class="token class-name">BitmapFactory</span><span class="token punctuation">.</span><span class="token function">decodeResource</span><span class="token punctuation">(</span><span class="token function">getResources</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">R</span><span class="token punctuation">.</span>drawable<span class="token punctuation">.</span>huawei<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token class-name">String</span> file_path <span class="token operator">=</span> path <span class="token operator">+</span> <span class="token class-name">DateUtil</span><span class="token punctuation">.</span><span class="token function">getNowDateTime</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;.jpeg&quot;</span><span class="token punctuation">;</span>
<span class="token class-name">FileUtil</span><span class="token punctuation">.</span><span class="token function">saveImage</span><span class="token punctuation">(</span>file_path<span class="token punctuation">,</span> bitmap<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 把位图对象保存为图片文件 </span>
tv_path<span class="token punctuation">.</span><span class="token function">setText</span><span class="token punctuation">(</span><span class="token string">&quot;图片文件的保存路径为：\n&quot;</span> <span class="token operator">+</span> file_path<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>然后创建图片读取页面，从私有目录找到图片文件，并挑出一张在图像视图上显示，相关代码示例如下：</p><p>（完整代码见chapter06\src\main\java\com\example\chapter06\ImageReadActivity.java）</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 获取当前App的私有下载目录</span>
mPath <span class="token operator">=</span> <span class="token function">getExternalFilesDir</span><span class="token punctuation">(</span><span class="token class-name">Environment</span><span class="token punctuation">.</span><span class="token constant">DIRECTORY_DOWNLOADS</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;/&quot;</span><span class="token punctuation">;</span> 
<span class="token comment">// 获得指定目录下面的所有图片文件</span>
mFilelist <span class="token operator">=</span> <span class="token class-name">FileUtil</span><span class="token punctuation">.</span><span class="token function">getFileList</span><span class="token punctuation">(</span>mPath<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token string">&quot;.jpeg&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token keyword">if</span> <span class="token punctuation">(</span>mFilelist<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token comment">// 打开并显示选中的图片文件内容</span>
   <span class="token class-name">String</span> file_path <span class="token operator">=</span> mFilelist<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAbsolutePath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   tv_content<span class="token punctuation">.</span><span class="token function">setText</span><span class="token punctuation">(</span><span class="token string">&quot;找到最新的图片文件，路径为&quot;</span><span class="token operator">+</span>file_path<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token comment">// 显示存储卡图片文件的第一种方式：直接调用setImageURI方法</span>
   <span class="token comment">//iv_content.setImageURI(Uri.parse(file_path)); // 设置图像视图的路径对象</span>
   <span class="token comment">// 第二种方式：先调用BitmapFactory.decodeFile获得位图，再调用setImageBitmap方法</span>
   <span class="token comment">//Bitmap bitmap = BitmapFactory.decodeFile(file_path);</span>
   <span class="token comment">//iv_content.setImageBitmap(bitmap); // 设置图像视图的位图对象</span>
   <span class="token comment">// 第三种方式：先调用FileUtil.openImage获得位图，再调用setImageBitmap方法</span>
   <span class="token class-name">Bitmap</span> bitmap <span class="token operator">=</span> <span class="token class-name">FileUtil</span><span class="token punctuation">.</span><span class="token function">openImage</span><span class="token punctuation">(</span>file_path<span class="token punctuation">)</span><span class="token punctuation">;</span>
   iv_content<span class="token punctuation">.</span><span class="token function">setImageBitmap</span><span class="token punctuation">(</span>bitmap<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 设置图像视图的位图对象 </span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>运行测试App，先打开图片写入页面，点击保存按钮把资源图片保存到存储卡，此时写入界面如图6-17所示。再打开图片读取页面，App自动在私有目录下找到图片文件列表，并展示其中一张图片，此时读取界面如图6-18所示。</p><p><img src="https://gitee.com/xiaweifeng/picgo/raw/master/images/202207061822363.png" alt="Image From 笔记-Android 开发从入门到实战"></p><p><img src="https://gitee.com/xiaweifeng/picgo/raw/master/images/202207061823764.png" alt="Image From 笔记-Android 开发从入门到实战"></p><h2 id="_6-4-应用组件application" tabindex="-1"><a class="header-anchor" href="#_6-4-应用组件application" aria-hidden="true">#</a> 6.4　应用组件Application</h2><p>本节介绍Android重要组件Application的基本概念和常见用法。首先说明Application的生命周期贯穿了App的整个运行过程，接着利用Application实现App全局变量的读写，然后阐述了如何借助App实例来操作Room数据库框架。</p><h3 id="_6-4-1-application的生命周期" tabindex="-1"><a class="header-anchor" href="#_6-4-1-application的生命周期" aria-hidden="true">#</a> 6.4.1 Application的生命周期</h3><p>Application是Android的一大组件，在App运行过程中有且仅有一个Application对象贯穿应用的整个生命周期。打开AndroidManifest.xml，发现activity节点的上级正是application节点，不过该节点并未指定name属性，此时App采用默认的Application实例。注意到每个activity节点都指定了name属性，譬如常见的name属性值为.MainActivity，让人知晓该activity的入口代码是MainActivity.java。现在尝试给application节点加上name属性，看看其庐山真面目，具体步骤说明如下：</p><p>（ 1 ）打开AndroidManifest.xml，给application节点加上name属性，表示application的入口代码是MainApplication.java。修改后的application节点示例如下：</p><p>（完整代码见chapter06\src\main\AndroidManifest.xml）</p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>application</span>
       <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>.MainApplication<span class="token punctuation">&quot;</span></span> 
       <span class="token attr-name"><span class="token namespace">android:</span>icon</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>@mipmap/ic_launcher<span class="token punctuation">&quot;</span></span> 
       <span class="token attr-name"><span class="token namespace">android:</span>label</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>@string/app_name<span class="token punctuation">&quot;</span></span> 
       <span class="token attr-name"><span class="token namespace">android:</span>theme</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>@style/AppTheme<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>（ 2 ）在Java代码的包名目录下创建MainApplication.java，要求该类继承Application，继承之后可供重写的方法主要有以下 3 个。</p><ul><li><p>onCreate：在App启动时调用。</p></li><li><p>onTerminate：在App终止时调用（按字面意思）。</p></li><li><p>onConfigurationChanged：在配置改变时调用，例如从竖屏变为横屏。</p></li></ul><p>光看字面意思的话，与生命周期有关的方法是onCreate和onTerminate，那么重写这两个方法，并在重写后的方法中打印日志，修改后的Java代码如下所示：</p><p>（完整代码见chapter06\src\main\java\com\example\chapter06\MainApplication.java）</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MainApplication</span> <span class="token keyword">extends</span> <span class="token class-name">Application</span> <span class="token punctuation">{</span>
   <span class="token annotation punctuation">@Override</span>
   <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onCreate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onCreate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span><span class="token constant">TAG</span><span class="token punctuation">,</span> <span class="token string">&quot;onCreate&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
   <span class="token annotation punctuation">@Override</span>
   <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onTerminate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onTerminate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span><span class="token constant">TAG</span><span class="token punctuation">,</span> <span class="token string">&quot;onTerminate&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span> 
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>（ 3 ）运行测试App，在logcat窗口观察应用日志。但是只在启动一开始看到MainApplication的onCreate日志（该日志先于MainActivity的onCreate日志），却始终无法看到它的onTerminate日志，无论是自行退出App还是强行杀掉App，日志都不会打印onTerminate。无论你怎么折腾，这个onTerminate日志都不会出来。Android明明提供了这个方法，同时提供了关于该方法的解释，说明文字如下：This method is for use in emulated process environments．It will never be called on a production Android device, where processes are removed by simply killing them; no user code (including this callback) is executed when doing so。这段话的意思是：该方法供模拟环境使用，它在真机上永远不会被调用，无论是直接杀进程还是代码退出；执行该操作时，不会执行任何用户代码。现在很明确了，onTerminate方法就是个摆设，中看不中用。如果读者想在App退出前回收系统资源，就不能指望onTerminate方法的回调了。</p><h3 id="_6-4-2-application操作全局变量" tabindex="-1"><a class="header-anchor" href="#_6-4-2-application操作全局变量" aria-hidden="true">#</a> 6.4.2 Application操作全局变量</h3><p>C/C++有全局变量的概念，因为全局变量保存在内存中，所以操作全局变量就是操作内存，显然内存的读写速度远比读写数据库或读写文件快得多。所谓全局，指的是其他代码都可以引用该变量，因此全局变量是共享数据和消息传递的好帮手。不过Java没有全局变量的概念，与之比较接近的是类里面的静态成员变量，该变量不但能被外部直接引用，而且它在不同地方引用的值是一样的（前提是在引用期间不能改动变量值），所以借助静态成员变量也能实现类似全局变量的功能。根据上一小节的介绍可知，Application的生命周期覆盖了App运行的全过程。不像短暂的Activity生命周期，一旦退出该页面，Activity实例就被销毁。因此，利用Application的全生命特性，能够在Application实例中保存全局变量。</p><p>适合在Application中保存的全局变量主要有下面 3 类数据：</p><p>（ 1 ）会频繁读取的信息，例如用户名、手机号码等。</p><p>（ 2 ）不方便由意图传递的数据，例如位图对象、非字符串类型的集合对象等。</p><p>（ 3 ）容易因频繁分配内存而导致内存泄漏的对象，例如Handler处理器实例等。</p><p>要想通过Application实现全局内存的读写，得完成以下 3 项工作：</p><p>（ 1 ）编写一个继承自Application的新类MainApplication。该类采用单例模式，内部先声明自身类的一个静态成员对象，在创建App时把自身赋值给这个静态对象，然后提供该对象的获取方法getInstance。</p><p>具体实现代码示例如下：</p><p>（完整代码见chapter06\src\main\java\com\example\chapter06\MainApplication.java）</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MainApplication</span> <span class="token keyword">extends</span> <span class="token class-name">Application</span> <span class="token punctuation">{</span>
   <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token constant">TAG</span> <span class="token operator">=</span> <span class="token string">&quot;MainApplication&quot;</span><span class="token punctuation">;</span>
   <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">MainApplication</span> mApp<span class="token punctuation">;</span> <span class="token comment">// 声明一个当前应用的静态实例</span>
   <span class="token comment">// 声明一个公共的信息映射对象，可当作全局变量使用</span>
   <span class="token keyword">public</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> infoMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token comment">// 利用单例模式获取当前应用的唯一实例</span>
   <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">MainApplication</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">return</span> mApp<span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
   <span class="token annotation punctuation">@Override</span>
   <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onCreate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onCreate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span><span class="token constant">TAG</span><span class="token punctuation">,</span> <span class="token string">&quot;onCreate&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       mApp <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span> <span class="token comment">// 在打开应用时对静态的应用实例赋值</span>
 <span class="token punctuation">}</span> 
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>（ 2 ）在活动页面代码中调用MainApplication的getInstance方法，获得它的一个静态对象，再通过该对象访问MainApplication的公共变量和公共方法。</p><p>（ 3 ）不要忘了在AndroidManifest.xml中注册新定义的Application类名，也就是给application节点增加android:name属性，其值为.MainApplication。接下来演示如何读写内存中的全局变量，首先分别创建写内存页面和读内存页面，其中写内存页面把用户的注册信息保存到全局变量infoMap，完整代码见 chapter06\src\main\java\com\example\chapter06\AppWriteActivity.java；</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">String</span> name <span class="token operator">=</span> et_name<span class="token punctuation">.</span><span class="token function">getText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> age <span class="token operator">=</span> et_age<span class="token punctuation">.</span><span class="token function">getText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> height <span class="token operator">=</span> et_height<span class="token punctuation">.</span><span class="token function">getText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> weight <span class="token operator">=</span> et_weight<span class="token punctuation">.</span><span class="token function">getText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        app <span class="token operator">=</span> <span class="token class-name">MyApplication</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        app<span class="token punctuation">.</span>infoMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        app<span class="token punctuation">.</span>infoMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">,</span> age<span class="token punctuation">)</span><span class="token punctuation">;</span>
        app<span class="token punctuation">.</span>infoMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;height&quot;</span><span class="token punctuation">,</span> height<span class="token punctuation">)</span><span class="token punctuation">;</span>
        app<span class="token punctuation">.</span>infoMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;weight&quot;</span><span class="token punctuation">,</span> weight<span class="token punctuation">)</span><span class="token punctuation">;</span>
        app<span class="token punctuation">.</span>infoMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;married&quot;</span><span class="token punctuation">,</span> ck_married<span class="token punctuation">.</span><span class="token function">isChecked</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token string">&quot;是&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;否&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>而读内存页面从全局变量infoMap读取用户的注册信息，完整代码见chapter06\src\main\java\com\example\chapter06\AppReadActivity.java。</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">reload</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> name <span class="token operator">=</span> app<span class="token punctuation">.</span>infoMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>name <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">String</span> age <span class="token operator">=</span> app<span class="token punctuation">.</span>infoMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> height <span class="token operator">=</span> app<span class="token punctuation">.</span>infoMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;height&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> weight <span class="token operator">=</span> app<span class="token punctuation">.</span>infoMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;weight&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> married <span class="token operator">=</span> app<span class="token punctuation">.</span>infoMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;married&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        et_name<span class="token punctuation">.</span><span class="token function">setText</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        et_age<span class="token punctuation">.</span><span class="token function">setText</span><span class="token punctuation">(</span>age<span class="token punctuation">)</span><span class="token punctuation">;</span>
        et_height<span class="token punctuation">.</span><span class="token function">setText</span><span class="token punctuation">(</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>
        et_weight<span class="token punctuation">.</span><span class="token function">setText</span><span class="token punctuation">(</span>weight<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">&quot;是&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>married<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            ck_married<span class="token punctuation">.</span><span class="token function">setChecked</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            ck_married<span class="token punctuation">.</span><span class="token function">setChecked</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>然后运行测试App，先打开内存写入页面，录入注册信息后保存至全局变量，此时写入界面如图6-19所示。再打开内存读取页面，App自动从全局变量获取注册信息，并展示拼接后的信息文本，此时读取界面如图6-20所示。</p><h3 id="_6-4-3-利用room简化数据库操作" tabindex="-1"><a class="header-anchor" href="#_6-4-3-利用room简化数据库操作" aria-hidden="true">#</a> 6.4.3　利用Room简化数据库操作</h3><p>虽然Android提供了数据库帮助器，但是开发者在进行数据库编程时仍有诸多不便，比如每次增加一张新表，开发者都得手工实现以下代码逻辑：</p><p>（ 1 ）重写数据库帮助器的onCreate方法，添加该表的建表语句。</p><p>（ 2 ）在插入记录之时，必须将数据实例的属性值逐一赋给该表的各字段。</p><p>（ 3 ）在查询记录之时，必须遍历结果集游标，把各字段值逐一赋给数据实例。</p><p>（ 4 ）每次读写操作之前，都要先开启数据库连接；读写操作之后，又要关闭数据库连接。</p><p>上述的处理操作无疑存在不少重复劳动，数年来引得开发者叫苦连连。为此各类数据库处理框架纷纷涌现，包括GreenDao、OrmLite、Realm等，可谓百花齐放。眼见SQLite渐渐乏人问津，谷歌公司干脆整了个自己的数据库框架—Room，该框架同样基于SQLite，但它通过注解技术极大地简化了数据库操作，减少了原来相当一部分编码工作量。由于Room并未集成到SDK中，而是作为第三方框架提供，因此要修改模块的build.gradle文件，往dependencies节点添加下面两行配置，表示导入指定版本的Room库：</p><div class="language-groovy ext-groovy line-numbers-mode"><pre class="language-groovy"><code>implementation <span class="token string">&#39;androidx.room:room-runtime:2.2.5&#39;</span> 
annotationProcessor <span class="token string">&#39;androidx.room:room-compiler:2.2.5&#39;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>导入Room库之后，还要编写若干对应的代码文件。以录入图书信息为例，此时要对图书信息表进行增删改查，则具体的编码过程分为下列 5 个步骤：</p><p><strong>1 ．编写图书信息表对应的实体类</strong></p><p>假设图书信息类名为BookInfo，且它的各属性与图书信息表的各字段一一对应，那么要给该类添加“@Entity”注解，表示该类是Room专用的数据类型，对应的表名称也叫BookInfo。如果BookInfo表的name字段是该表的主键，则需给BookInfo类的name属性添加“@PrimaryKey”与“@NonNull”两个注解，表示该字段是个非空的主键。下面是BookInfo类的定义代码例子：</p><p>（完整代码见chapter06\src\main\java\com\example\chapter06\entity\BookInfo.java）</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">//书籍信息</span>
<span class="token annotation punctuation">@Entity</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BookInfo</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@PrimaryKey</span><span class="token punctuation">(</span>autoGenerate <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> id<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span> <span class="token comment">// 书籍名称</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> author<span class="token punctuation">;</span> <span class="token comment">// 作者</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> press<span class="token punctuation">;</span> <span class="token comment">// 出版社</span>
    <span class="token keyword">private</span> <span class="token keyword">double</span> price<span class="token punctuation">;</span> <span class="token comment">// 价格</span>

    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> id<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setId</span><span class="token punctuation">(</span><span class="token keyword">int</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>id <span class="token operator">=</span> id<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> name<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setName</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getAuthor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> author<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setAuthor</span><span class="token punctuation">(</span><span class="token class-name">String</span> author<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>author <span class="token operator">=</span> author<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getPress</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> press<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setPress</span><span class="token punctuation">(</span><span class="token class-name">String</span> press<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>press <span class="token operator">=</span> press<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">double</span> <span class="token function">getPrice</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> price<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setPrice</span><span class="token punctuation">(</span><span class="token keyword">double</span> price<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>price <span class="token operator">=</span> price<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&quot;BookInfo{&quot;</span> <span class="token operator">+</span>
                <span class="token string">&quot;id=&quot;</span> <span class="token operator">+</span> id <span class="token operator">+</span>
                <span class="token string">&quot;, name=&#39;&quot;</span> <span class="token operator">+</span> name <span class="token operator">+</span> <span class="token char">&#39;\&#39;&#39;</span> <span class="token operator">+</span>
                <span class="token string">&quot;, author=&#39;&quot;</span> <span class="token operator">+</span> author <span class="token operator">+</span> <span class="token char">&#39;\&#39;&#39;</span> <span class="token operator">+</span>
                <span class="token string">&quot;, press=&#39;&quot;</span> <span class="token operator">+</span> press <span class="token operator">+</span> <span class="token char">&#39;\&#39;&#39;</span> <span class="token operator">+</span>
                <span class="token string">&quot;, price=&quot;</span> <span class="token operator">+</span> price <span class="token operator">+</span>
                <span class="token char">&#39;}&#39;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>2 ．编写图书信息表对应的持久化类</strong></p><p>所谓持久化，指的是将数据保存到磁盘而非内存，其实等同于增删改等SQL语句。假设图书信息表的持久化类名叫作BookDao，那么该类必须添加“@Dao”注解，内部的记录查询方法必须添加“@Query”注解，记录插入方法必须添加“@Insert”注解，记录更新方法必须添加“@Update”注解，记录删除方法必须添加“@Delete”注解（带条件的删除方法除外）。对于记录查询方法，允许在@Query之后补充具体的查询语句以及查询条件；对于记录插入方法与记录更新方法，需明确出现重复记录时要采取哪种处理策略。下面是BookDao类的定义代码例子：</p><p>（完整代码见chapter06\src\main\java\com\example\chapter06\dao\BookDao.java）</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Dao</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">BookDao</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Insert</span>
    <span class="token keyword">void</span> <span class="token function">insert</span><span class="token punctuation">(</span><span class="token class-name">BookInfo</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> book<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Delete</span>
    <span class="token keyword">void</span> <span class="token function">delete</span><span class="token punctuation">(</span><span class="token class-name">BookInfo</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> book<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 删除所有书籍信息</span>
    <span class="token annotation punctuation">@Query</span><span class="token punctuation">(</span><span class="token string">&quot;DELETE FROM BookInfo&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">void</span> <span class="token function">deleteAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Update</span>
    <span class="token keyword">int</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token class-name">BookInfo</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> book<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 加载所有书籍信息</span>
    <span class="token annotation punctuation">@Query</span><span class="token punctuation">(</span><span class="token string">&quot;SELECT * FROM BookInfo&quot;</span><span class="token punctuation">)</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">BookInfo</span><span class="token punctuation">&gt;</span></span> <span class="token function">queryAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 根据名字加载书籍</span>
    <span class="token annotation punctuation">@Query</span><span class="token punctuation">(</span><span class="token string">&quot;SELECT * FROM BookInfo WHERE name = :name ORDER BY id DESC limit 1&quot;</span><span class="token punctuation">)</span>
    <span class="token class-name">BookInfo</span> <span class="token function">queryByName</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>3 ．编写图书信息表对应的数据库类</strong></p><p>因为先有数据库然后才有表，所以图书信息表还得放到某个数据库里，这个默认的图书数据库要从RoomDatabase派生而来，并添加“@Database”注解。下面是数据库类BookDatabase的定义代码例子： （完整代码见chapter06\src\main\java\com\example\chapter06\database\BookDatabase.java）</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">//entities表示该数据库有哪些表，version表示数据库的版本号</span>
<span class="token comment">//exportSchema表示是否导出数据库信息的json串，建议设为false，若设为true还需指定json文件的保存路径</span>
<span class="token annotation punctuation">@Database</span><span class="token punctuation">(</span>entities <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token class-name">BookInfo</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">}</span><span class="token punctuation">,</span> version <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> exportSchema <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">BookDatabase</span> <span class="token keyword">extends</span> <span class="token class-name">RoomDatabase</span> <span class="token punctuation">{</span>
    <span class="token comment">// 获取该数据库中某张表的持久化对象</span>
    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token class-name">BookDao</span> <span class="token function">bookDao</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>4 ．在自定义的Application类中声明图书数据库的唯一实例</strong></p><p>为了避免重复打开数据库造成的内存泄漏问题，每个数据库在App运行过程中理应只有一个实例，此时要求开发者自定义新的Application类，在该类中声明并获取图书数据库的实例，并将自定义的Application类设为单例模式，保证App运行之时有且仅有一个应用实例。下面是自定义Application类的代码例子：</p><p>（完整代码见chapter06\src\main\java\com\example\chapter06\MainApplication.java）</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MainApplication</span> <span class="token keyword">extends</span> <span class="token class-name">Application</span> <span class="token punctuation">{</span>
   <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token constant">TAG</span> <span class="token operator">=</span> <span class="token string">&quot;MainApplication&quot;</span><span class="token punctuation">;</span>
   <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">MainApplication</span> mApp<span class="token punctuation">;</span> <span class="token comment">// 声明一个当前应用的静态实例</span>
   <span class="token keyword">private</span> <span class="token class-name">BookDatabase</span> bookDatabase<span class="token punctuation">;</span> <span class="token comment">// 声明一个书籍数据库对象</span>
   <span class="token comment">// 利用单例模式获取当前应用的唯一实例</span>
   <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">MainApplication</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">return</span> mApp<span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
   <span class="token annotation punctuation">@Override</span>
   <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onCreate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onCreate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span><span class="token constant">TAG</span><span class="token punctuation">,</span> <span class="token string">&quot;onCreate&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       mApp <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span> <span class="token comment">// 在打开应用时对静态的应用实例赋值</span>
       <span class="token comment">// 构建书籍数据库的实例</span>
       bookDatabase <span class="token operator">=</span> <span class="token class-name">Room</span><span class="token punctuation">.</span><span class="token function">databaseBuilder</span><span class="token punctuation">(</span>mApp<span class="token punctuation">,</span> <span class="token class-name">BookDatabase</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span><span class="token string">&quot;book&quot;</span><span class="token punctuation">)</span>
              <span class="token punctuation">.</span><span class="token function">addMigrations</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 允许迁移数据库（发生数据库变更时，Room默认删除原数据库再创建新数据库。如此一来原来的记录会丢失，故而要改为迁移方式以便保存原有记录）</span>
              <span class="token punctuation">.</span><span class="token function">allowMainThreadQueries</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 允许在主线程中操作数据库（Room默认不能在主线程中操作数据库）</span>
              <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
 <span class="token punctuation">}</span>
   <span class="token comment">// 获取书籍数据库的实例</span>
   <span class="token keyword">public</span> <span class="token class-name">BookDatabase</span> <span class="token function">getBookDB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> 
       <span class="token keyword">return</span> bookDatabase<span class="token punctuation">;</span>
 <span class="token punctuation">}</span> 
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>5 ．在操作图书信息表的地方获取数据表的持久化对象</strong></p><p>持久化对象的获取代码很简单，只需下面一行代码就够了：</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 从App实例中获取唯一的图书持久化对象</span>
<span class="token class-name">BookDao</span> bookDao <span class="token operator">=</span> <span class="token class-name">MainApplication</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBookDB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">bookDao</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>完成以上 5 个编码步骤之后，接着调用持久化对象的queryXXX、insertXXX、updateXXX、deleteXXX等方法，就能实现图书信息的增删改查操作了。例程的图书信息演示页面有两个，分别是记录保存页面和记录读取页面，其中记录保存页面通过insertOneBook方法向数据库添加图书信息，完整代码见chapter06\src\main\java\com\example\chapter06\RoomWriteActivity.java；而记录读取页面通过queryAllBook方法从数据库读取图书信息，完整代码见chapter06\src\main\java\com\example\chapter06\RoomReadActivity.java。</p><p>运行测试App，先打开记录保存页面，依次录入两本图书信息并保存至数据库，如图6-21和图6-22所示。再打开记录读取页面，从数据库读取图书信息并展示在页面上，如图6-23所示。</p><p><img src="https://gitee.com/xiaweifeng/picgo/raw/master/images/202207062136090.png" alt="Image From 笔记-Android 开发从入门到实战"></p><p><img src="https://gitee.com/xiaweifeng/picgo/raw/master/images/202207062137111.png" alt="Image From 笔记-Android 开发从入门到实战"></p><p><img src="https://gitee.com/xiaweifeng/picgo/raw/master/images/202207062137916.png" alt="Image From 笔记-Android 开发从入门到实战"></p><h2 id="_6-5-实战项目-购物车" tabindex="-1"><a class="header-anchor" href="#_6-5-实战项目-购物车" aria-hidden="true">#</a> 6.5　实战项目：购物车</h2><p>购物车的应用面很广，凡是电商App都可以看到它的身影，之所以选择购物车作为本章的实战项目，除了它使用广泛的特点，更因为它用到了多种存储方式。现在就让我们开启电商购物车的体验之旅吧。</p><h3 id="_6-5-1-需求描述" tabindex="-1"><a class="header-anchor" href="#_6-5-1-需求描述" aria-hidden="true">#</a> 6.5.1　需求描述</h3><p>电商App的购物车可谓是司空见惯了，以京东商城的购物车为例，一开始没有添加任何商品，此时空购物车如图6-24所示，而且提示去逛秒杀商场；加入几件商品之后，购物车页面如图6-25所示。</p><img src="https://gitee.com/xiaweifeng/picgo/raw/master/images/202207062143868.png" alt="Image From 笔记-Android 开发从入门到实战" style="zoom:67%;"><p>图6-24　京东App购物车的初始页面</p><p><img src="https://gitee.com/xiaweifeng/picgo/raw/master/images/202207062143613.png" alt="Image From 笔记-Android 开发从入门到实战"></p><p>图6-25　京东App购物车加了几件商品</p><p>可见购物车除了底部有个结算行，其余部分主要是已加入购物车的商品列表，然后每个商品行左边是商品小图，右边是商品名称及其价格。据此仿照本项目的购物车功能，第一次进入购物车页面，购物车里面是空的，同时提示去逛手机商场， 如图6-26所示。接着去商场页面选购手机，随便挑了几部手机加入购物车，再返回购物车页面，即可看到购物车的商品列表，如图6-27所示，有商品图片、名称、数量、单价、总价等等信息。当然购物车并不仅仅只是展示待购买的商品，还要支持最终购买的结算操作、支持清空购物车等功能。</p><img src="https://gitee.com/xiaweifeng/picgo/raw/master/images/202207062145081.png" alt="Image From 笔记-Android 开发从入门到实战" style="zoom:80%;"><p>图6-26　首次打开购物车页面</p><img src="https://gitee.com/xiaweifeng/picgo/raw/master/images/202207062146818.png" alt="Image From 笔记-Android 开发从入门到实战" style="zoom:80%;"><p>图6-27　选购商品后的购物车</p><p>购物车的存在感很强，不仅仅在购物车页面才能看到购物车。往往在商场页面，甚至商品详情页面，都会看到某个角落冒出购物车图标。一旦有新商品加入购物车，购物车图标上的商品数量立马加一。当然，用户也能点击购物车图标直接跳到购物车页面。商场页面除了商品列表之外，页面右上角还有一个购物车图标，如图6-28所示，有时这个图标会在页面右下角。商品详情页面通常也有购物车图标，如图6-29所示，倘使用户在详情页面把商品加入购物车，那么图标上的数字也会加一。</p><p><img src="https://gitee.com/xiaweifeng/picgo/raw/master/images/202207062148610.png" alt="Image From 笔记-Android 开发从入门到实战"></p><p><img src="https://gitee.com/xiaweifeng/picgo/raw/master/images/202207062148206.png" alt="Image From 笔记-Android 开发从入门到实战"></p><p>图6-29　手机详情页面</p><p>至此大概过了一遍购物车需要实现的基本功能，提需求总是很简单的，真正落到实处还得开发者发挥想象力，把购物车做成一个功能完备的模块。</p><h3 id="_6-5-2-界面设计" tabindex="-1"><a class="header-anchor" href="#_6-5-2-界面设计" aria-hidden="true">#</a> 6.5.2　界面设计</h3><p>首先找找看，购物车使用了哪些Android控件：</p><ul><li><p>线性布局LinearLayout：购物车界面从上往下排列，用到了垂直方向的线性布局。</p></li><li><p>网格布局GridLayout：商场页面的陈列橱柜，允许分行分列展示商品。</p></li><li><p>相对布局RelativeLayout：页面右上角的购物车图标，图标右上角又有数字标记，按照指定方位排列控件正是相对布局的拿手好戏。</p></li><li><p>其他常见控件尚有文本视图TextView、图像视图ImageView，按钮控件Button等。</p><p>然后考虑一下购物车的存储功能，到底采取了哪些存储方式：</p></li><li><p>数据库SQLite：最直观的肯定是数据库了，购物车里的商品列表一定是放在SQLite中，增删改查都少不了它。</p></li><li><p>全局内存：购物车图标右上角的数字表示购物车中的商品数量，该数值建议保存在全局内存中，这样不必每次都到数据库中执行count操作。</p></li><li><p>存储卡文件：通常商品图片来自于电商平台的服务器，此时往往引入图片缓存机制，也就是首次访问先将网络图片保存到存储卡，下次访问时直接从存储卡获取缓存图片，从而提高图片的加载速度。</p></li><li><p>共享参数SharedPreferences：是否首次访问网络图片，这个标志位推荐放在共享参数中，因为它需要持久化存储，并且只有一个参数信息。真是想不到，一个小小的购物车，竟然用到了好几种存储方式。</p></li></ul><h3 id="_6-5-3-关键代码" tabindex="-1"><a class="header-anchor" href="#_6-5-3-关键代码" aria-hidden="true">#</a> 6.5.3　关键代码</h3><p>为了读者更好更快地完成购物车项目，下面列举几个重要功能的代码片段。</p><p><strong>1 ．关于页面跳转</strong></p><p>因为购物车页面允许直接跳到商场页面，并且商场页面也允许跳到购物车页面，所以如果用户在这两个页面之间来回跳转，然后再按返回键，结果发现返回的时候也是在两个页面间往返跳转。出现问题的缘由在于：每次启动活动页面都往活动栈加入一个新活动，那么返回出栈之时，也只好一个一个活动依次退出了。解决该问题的办法参见第 4 章的“4.1.3 Activity的启动模式”，对于购物车的活动跳转需要指定启动标志FLAG_ACTIVITY_CLEAR_TOP，表示活动栈有且仅有该页面的唯一实例，如此即可避免多次返回同一页面的情况。比如从购物车页面跳到商场页面，此时活动跳转的代码示例如下：</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 从购物车页面跳到商场页面</span>
<span class="token class-name">Intent</span> intent <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Intent</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token class-name">ShoppingChannelActivity</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
intent<span class="token punctuation">.</span><span class="token function">setFlags</span><span class="token punctuation">(</span><span class="token class-name">Intent</span><span class="token punctuation">.</span><span class="token constant">FLAG_ACTIVITY_CLEAR_TOP</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 设置启动标志 </span>
<span class="token function">startActivity</span><span class="token punctuation">(</span>intent<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 跳转到手机商场页面</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>又如从商场页面跳到购物车页面，此时活动跳转的代码示例如下：</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 从商场页面跳到购物车页面</span>
<span class="token class-name">Intent</span> intent <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Intent</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token class-name">ShoppingCartActivity</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
intent<span class="token punctuation">.</span><span class="token function">setFlags</span><span class="token punctuation">(</span><span class="token class-name">Intent</span><span class="token punctuation">.</span><span class="token constant">FLAG_ACTIVITY_CLEAR_TOP</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 设置启动标志 </span>
<span class="token function">startActivity</span><span class="token punctuation">(</span>intent<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 跳转到购物车页面</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>2 ．关于商品图片的缓存</strong></p><p>通常商品图片由后端服务器提供，App打开页面时再从服务器下载所需的商品图。可是购物车模块的多个页面都会展示商品图片，如果每次都到服务器请求图片，显然既耗时间又耗流量非常不经济。因此App都会缓存常用的图片，一旦从服务器成功下载图片，便在手机存储卡上保存图片文件。然后下次界面需要加载商品图片时，就先从存储卡寻找该图片，如果找到就读取图片的位图信息，如果没找到就再到服务器下载图片。</p><p>以上的缓存逻辑是最简单的二级图片缓存，实际开发往往使用更高级的三级缓存机制，即“运行内存→存储卡→网络下载”。当然就初学者而言，先从掌握最简单的二级缓存开始，也就是“存储卡→网络下载”。</p><p>按照二级缓存机制，可以设计以下的缓存处理逻辑：</p><p>（ 1 ）先判断是否为首次访问网络图片。</p><p>（ 2 ）如果是首次访问网络图片，就先从网络服务器下载图片。</p><p>（ 3 ）把下载完的图片数据保存到手机的存储卡。</p><p>（ 4 ）往数据库中写入商品记录，以及商品图片的本地存储路径。</p><p>（ 5 ）更新共享参数中的首次访问标志。</p><p>按照上述的处理逻辑，编写的图片加载代码示例如下：</p><p>（完整代码见chapter06\src\main\java\com\example\chapter06\ShoppingCartActivity.java）</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token class-name">String</span> mFirst <span class="token operator">=</span> <span class="token string">&quot;true&quot;</span><span class="token punctuation">;</span> <span class="token comment">// 是否首次打开 </span>
<span class="token comment">// 模拟网络数据，初始化数据库中的商品信息</span>
<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">downloadGoods</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token comment">// 获取共享参数保存的是否首次打开参数</span>
   mFirst <span class="token operator">=</span> <span class="token class-name">SharedUtil</span><span class="token punctuation">.</span><span class="token function">getIntance</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">readString</span><span class="token punctuation">(</span><span class="token string">&quot;first&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;true&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token comment">// 获取当前App的私有下载路径 </span>
   <span class="token class-name">String</span> path <span class="token operator">=</span>
<span class="token function">getExternalFilesDir</span><span class="token punctuation">(</span><span class="token class-name">Environment</span><span class="token punctuation">.</span><span class="token constant">DIRECTORY_DOWNLOADS</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;/&quot;</span><span class="token punctuation">;</span> 
   <span class="token keyword">if</span> <span class="token punctuation">(</span>mFirst<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">&quot;true&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 如果是首次打开</span>
       <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">GoodsInfo</span><span class="token punctuation">&gt;</span></span> goodsList <span class="token operator">=</span> <span class="token class-name">GoodsInfo</span><span class="token punctuation">.</span><span class="token function">getDefaultList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 模拟网络图片下载</span>
       <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> goodsList<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
           <span class="token class-name">GoodsInfo</span> info <span class="token operator">=</span> goodsList<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token keyword">long</span> rowid <span class="token operator">=</span> mGoodsHelper<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>info<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 往商品数据库插入一条该商品的记录</span>
           info<span class="token punctuation">.</span>rowid <span class="token operator">=</span> rowid<span class="token punctuation">;</span>
           <span class="token class-name">Bitmap</span> pic <span class="token operator">=</span> <span class="token class-name">BitmapFactory</span><span class="token punctuation">.</span><span class="token function">decodeResource</span><span class="token punctuation">(</span><span class="token function">getResources</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> info<span class="token punctuation">.</span>pic<span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token class-name">String</span> pic_path <span class="token operator">=</span> path <span class="token operator">+</span> rowid <span class="token operator">+</span> <span class="token string">&quot;.jpg&quot;</span><span class="token punctuation">;</span>
           <span class="token class-name">FileUtil</span><span class="token punctuation">.</span><span class="token function">saveImage</span><span class="token punctuation">(</span>pic_path<span class="token punctuation">,</span> pic<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 往存储卡保存商品图片</span>
           pic<span class="token punctuation">.</span><span class="token function">recycle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 回收位图对象</span>
           info<span class="token punctuation">.</span>pic_path <span class="token operator">=</span> pic_path<span class="token punctuation">;</span>
           mGoodsHelper<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>info<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 更新商品数据库中该商品记录的图片路径</span>
    <span class="token punctuation">}</span>
 <span class="token punctuation">}</span>
   <span class="token comment">// 把是否首次打开写入共享参数</span>
   <span class="token class-name">SharedUtil</span><span class="token punctuation">.</span><span class="token function">getIntance</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">writeString</span><span class="token punctuation">(</span><span class="token string">&quot;first&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;false&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>3 ．关于各页面共同的标题栏</strong></p><p>注意到购物车、手机商场、手机详情三个页面顶部都有标题栏，而且这三个标题栏风格统一，既然如此，能否把它做成公共的标题栏呢？当然App界面支持局部的公共布局，以购物车的标题栏为例，公共布局的实现过程包括以下两个步骤：</p><p>步骤一，首先定义标题栏专用的布局文件，包含返回箭头、文字标题、购物车图标、商品数量表等，具体内容如下所示：</p><p>（完整代码见chapter06\src\main\res\layout\title_shopping.xml）</p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>RelativeLayout</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>android</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://schemas.android.com/apk/res/android<span class="token punctuation">&quot;</span></span>
   <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>match_parent<span class="token punctuation">&quot;</span></span>
   <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>50dp<span class="token punctuation">&quot;</span></span>
   <span class="token attr-name"><span class="token namespace">android:</span>background</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>#aaaaff<span class="token punctuation">&quot;</span></span> <span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ImageView</span>
       <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>@+id/iv_back<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>50dp<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>match_parent<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">android:</span>layout_alignParentLeft</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">android:</span>padding</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>10dp<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">android:</span>scaleType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>fitCenter<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">android:</span>src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>@drawable/ic_back<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TextView</span>
       <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>@+id/tv_title<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>wrap_content<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>match_parent<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">android:</span>layout_centerInParent</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">android:</span>gravity</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>center<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">android:</span>textColor</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>@color/black<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">android:</span>textSize</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>20sp<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ImageView</span> 
       <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>@+id/iv_cart<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>50dp<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>match_parent<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">android:</span>layout_alignParentRight</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">android:</span>scaleType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>fitCenter<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">android:</span>src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>@drawable/cart<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TextView</span>
       <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>@+id/tv_count<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>20dp<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>20dp<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">android:</span>layout_alignParentTop</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">android:</span>layout_toRightOf</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>@+id/iv_cart<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">android:</span>layout_marginLeft</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>-20dp<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">android:</span>gravity</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>center<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">android:</span>background</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>@drawable/shape_oval_red<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">android:</span>text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>0<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">android:</span>textColor</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>@color/white<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">android:</span>textSize</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>15sp<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>RelativeLayout</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>步骤二，然后在购物车页面的布局文件中添加如下一行include标签，表示引入title_shopping.xml的布局内容：</p><p>（完整代码见chapter06\src\main\res\layout\activity_shopping_cart.xml）</p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>include</span> <span class="token attr-name">layout</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>@layout/title_shopping<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>之后重新运行测试App，即可发现购物车页面的顶部果然出现了公共标题栏，商场页面、详情页面的公共标题栏可参考购物车页面的include标签。</p><p><strong>4 ．关于商品网格的单元布局</strong></p><p>商场页面的商品列表，呈现三行二列的表格布局，每个表格单元的界面布局雷同，都是商品名称在上、商品图片居中、商品价格与添加按钮在下，看起来跟公共标题栏的处理有些类似。但后者为多个页面引用同一个标题栏，是多对一的关系；而前者为一个商场页面引用了多个商品网格，是一对多的关系。因此二者的实现过程不尽相同，就商场网格而言，它的单元复用分为下列 3 个步骤：</p><p>步骤一，在商场页面的布局文件中添加GridLayout节点，如下所示：</p><p>（完整代码见chapter06\src\main\res\layout\activity_shopping_channel.xml）</p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>LinearLayout</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>android</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://schemas.android.com/apk/res/android<span class="token punctuation">&quot;</span></span>
   <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>match_parent<span class="token punctuation">&quot;</span></span>
   <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>match_parent<span class="token punctuation">&quot;</span></span>
   <span class="token attr-name"><span class="token namespace">android:</span>background</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>@color/orange<span class="token punctuation">&quot;</span></span>
   <span class="token attr-name"><span class="token namespace">android:</span>orientation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>vertical<span class="token punctuation">&quot;</span></span> <span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>include</span> <span class="token attr-name">layout</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>@layout/title_shopping<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ScrollView</span>
       <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>match_parent<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>wrap_content<span class="token punctuation">&quot;</span></span> <span class="token punctuation">&gt;</span></span>
       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>GridLayout</span>
           <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>@+id/gl_channel<span class="token punctuation">&quot;</span></span>
           <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>match_parent<span class="token punctuation">&quot;</span></span>
           <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>wrap_content<span class="token punctuation">&quot;</span></span> 
           <span class="token attr-name"><span class="token namespace">android:</span>columnCount</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>2<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ScrollView</span><span class="token punctuation">&gt;</span></span> 
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>LinearLayout</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>步骤二，为商场网格编写统一的商品信息布局，XML文件内容示例如下：</p><p>（完整代码见chapter06\src\main\res\layout\item_goods.xml）</p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>LinearLayout</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>android</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://schemas.android.com/apk/res/android<span class="token punctuation">&quot;</span></span>
   <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>@+id/ll_item<span class="token punctuation">&quot;</span></span>
   <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>wrap_content<span class="token punctuation">&quot;</span></span>
   <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>wrap_content<span class="token punctuation">&quot;</span></span>
   <span class="token attr-name"><span class="token namespace">android:</span>layout_gravity</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>center<span class="token punctuation">&quot;</span></span>
   <span class="token attr-name"><span class="token namespace">android:</span>gravity</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>center<span class="token punctuation">&quot;</span></span>
   <span class="token attr-name"><span class="token namespace">android:</span>background</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>@color/white<span class="token punctuation">&quot;</span></span>
   <span class="token attr-name"><span class="token namespace">android:</span>orientation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>vertical<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TextView</span>
       <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>@+id/tv_name<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>match_parent<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>wrap_content<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">android:</span>gravity</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>center<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">android:</span>textColor</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>@color/black<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">android:</span>textSize</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>17sp<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ImageView</span>
       <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>@+id/iv_thumb<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>180dp<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>150dp<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">android:</span>scaleType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>fitCenter<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>LinearLayout</span>
       <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>match_parent<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>45dp<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">android:</span>orientation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>horizontal<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TextView</span>
           <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>@+id/tv_price<span class="token punctuation">&quot;</span></span>
           <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>0dp<span class="token punctuation">&quot;</span></span>
           <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>match_parent<span class="token punctuation">&quot;</span></span>
           <span class="token attr-name"><span class="token namespace">android:</span>layout_weight</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>2<span class="token punctuation">&quot;</span></span>
           <span class="token attr-name"><span class="token namespace">android:</span>gravity</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>center<span class="token punctuation">&quot;</span></span>
           <span class="token attr-name"><span class="token namespace">android:</span>textColor</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>@color/red<span class="token punctuation">&quot;</span></span>
           <span class="token attr-name"><span class="token namespace">android:</span>textSize</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>15sp<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Button</span>
           <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>@+id/btn_add<span class="token punctuation">&quot;</span></span>
           <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>0dp<span class="token punctuation">&quot;</span></span>
           <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>match_parent<span class="token punctuation">&quot;</span></span>
           <span class="token attr-name"><span class="token namespace">android:</span>layout_weight</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>3<span class="token punctuation">&quot;</span></span>
           <span class="token attr-name"><span class="token namespace">android:</span>gravity</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>center<span class="token punctuation">&quot;</span></span>
           <span class="token attr-name"><span class="token namespace">android:</span>text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>加入购物车<span class="token punctuation">&quot;</span></span>
           <span class="token attr-name"><span class="token namespace">android:</span>textColor</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>@color/black<span class="token punctuation">&quot;</span></span>
           <span class="token attr-name"><span class="token namespace">android:</span>textSize</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>15sp<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>LinearLayout</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>LinearLayout</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>步骤三，在商场页面的Java代码中，先利用下面代码获取布局文件item_goods.xml的根视图：</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">View</span> view <span class="token operator">=</span> <span class="token class-name">LayoutInflater</span><span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">inflate</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>layout<span class="token punctuation">.</span>item_goods<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>再从根视图中依据控件ID分别取出网格单元的各控件对象：</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">ImageView</span> iv_thumb <span class="token operator">=</span> view<span class="token punctuation">.</span><span class="token function">findViewById</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>iv_thumb<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token class-name">TextView</span> tv_name <span class="token operator">=</span> view<span class="token punctuation">.</span><span class="token function">findViewById</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>tv_name<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token class-name">TextView</span> tv_price <span class="token operator">=</span> view<span class="token punctuation">.</span><span class="token function">findViewById</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>tv_price<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token class-name">Button</span> btn_add <span class="token operator">=</span> view<span class="token punctuation">.</span><span class="token function">findViewById</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>btn_add<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>然后就能按照寻常方式操纵这些控件对象了，下面便是给网格布局加载商品的代码例子：</p><p>（完整代码见chapter06\src\main\java\com\example\chapter06\ShoppingChannelActivity.java）</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">showGoods</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">int</span> screenWidth <span class="token operator">=</span> <span class="token class-name">Utils</span><span class="token punctuation">.</span><span class="token function">getScreenWidth</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token class-name">LinearLayout<span class="token punctuation">.</span>LayoutParams</span> params <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LinearLayout<span class="token punctuation">.</span>LayoutParams</span><span class="token punctuation">(</span>
               screenWidth<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token class-name">LinearLayout<span class="token punctuation">.</span>LayoutParams</span><span class="token punctuation">.</span><span class="token constant">WRAP_CONTENT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       gl_channel<span class="token punctuation">.</span><span class="token function">removeAllViews</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 移除下面的所有子视图</span>
       <span class="token comment">// 查询商品数据库中的所有商品记录</span>
       <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">GoodsInfo</span><span class="token punctuation">&gt;</span></span> goodsArray <span class="token operator">=</span> mGoodsHelper<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string">&quot;1=1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">GoodsInfo</span> info <span class="token operator">:</span> goodsArray<span class="token punctuation">)</span> <span class="token punctuation">{</span>
           <span class="token comment">// 获取布局文件item_goods.xml的根视图</span>
           <span class="token class-name">View</span> view <span class="token operator">=</span> <span class="token class-name">LayoutInflater</span><span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">inflate</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>layout<span class="token punctuation">.</span>item_goods<span class="token punctuation">,</span> 
<span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token class-name">ImageView</span> iv_thumb <span class="token operator">=</span> view<span class="token punctuation">.</span><span class="token function">findViewById</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>iv_thumb<span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token class-name">TextView</span> tv_name <span class="token operator">=</span> view<span class="token punctuation">.</span><span class="token function">findViewById</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>tv_name<span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token class-name">TextView</span> tv_price <span class="token operator">=</span> view<span class="token punctuation">.</span><span class="token function">findViewById</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>tv_price<span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token class-name">Button</span> btn_add <span class="token operator">=</span> view<span class="token punctuation">.</span><span class="token function">findViewById</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>btn_add<span class="token punctuation">)</span><span class="token punctuation">;</span>
           tv_name<span class="token punctuation">.</span><span class="token function">setText</span><span class="token punctuation">(</span>info<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 设置商品名称</span>
           iv_thumb<span class="token punctuation">.</span><span class="token function">setImageURI</span><span class="token punctuation">(</span><span class="token class-name">Uri</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>info<span class="token punctuation">.</span>pic_path<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 设置商品图片</span>
           iv_thumb<span class="token punctuation">.</span><span class="token function">setOnClickListener</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">View<span class="token punctuation">.</span>OnClickListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
               <span class="token annotation punctuation">@Override</span>
               <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onClick</span><span class="token punctuation">(</span><span class="token class-name">View</span> v<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                   <span class="token class-name">Intent</span> intent <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Intent</span><span class="token punctuation">(</span><span class="token class-name">ShoppingChannelActivity</span><span class="token punctuation">.</span><span class="token keyword">this</span><span class="token punctuation">,</span> 
<span class="token class-name">ShoppingDetailActivity</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                   intent<span class="token punctuation">.</span><span class="token function">putExtra</span><span class="token punctuation">(</span><span class="token string">&quot;goods_id&quot;</span><span class="token punctuation">,</span> info<span class="token punctuation">.</span>rowid<span class="token punctuation">)</span><span class="token punctuation">;</span>
                   <span class="token function">startActivity</span><span class="token punctuation">(</span>intent<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 跳到商品详情页面</span>
        <span class="token punctuation">}</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           tv_price<span class="token punctuation">.</span><span class="token function">setText</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>info<span class="token punctuation">.</span>price<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 设置商品价格</span>
           btn_add<span class="token punctuation">.</span><span class="token function">setOnClickListener</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">View<span class="token punctuation">.</span>OnClickListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
               <span class="token annotation punctuation">@Override</span>
               <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onClick</span><span class="token punctuation">(</span><span class="token class-name">View</span> v<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                   <span class="token function">addToCart</span><span class="token punctuation">(</span>info<span class="token punctuation">.</span>rowid<span class="token punctuation">,</span> info<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 添加到购物车</span>
        <span class="token punctuation">}</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           gl_channel<span class="token punctuation">.</span><span class="token function">addView</span><span class="token punctuation">(</span>view<span class="token punctuation">,</span> params<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 把商品视图添加到网格布局</span>
    <span class="token punctuation">}</span>
 <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>弄好了商场页面的网格单元，购物车页面的商品行也可照此办理，不同之处在于购物车页面的商品行使用线性布局而非网格布局，其余实现过程依然分成上述 3 个步骤。</p><h2 id="_6-6-小结" tabindex="-1"><a class="header-anchor" href="#_6-6-小结" aria-hidden="true">#</a> 6.6　小结</h2><p>本章主要介绍了Android常用的几种数据存储方式，包括共享参数SharedPreferences的键值对存取、数据库SQLite的关系型数据存取、存储卡的文件读写操作（含文本文件读写和图片文件读写）、App全局内存的读写，以及为实现全局内存而学习的Application组件的生命周期及其用法。最后设计了一个实战项目“购物车”，通过该项目的编码进一步复习巩固本章几种存储方式的使用。</p><p>通过本章的学习，我们应该能够掌握以下 4 种开发技能：</p><p>（ 1 ）学会使用共享参数存取键值对数据。</p><p>（ 2 ）学会使用SQLite存取数据库记录。</p><p>（ 3 ）学会使用存储卡读写文本文件和图片文件。</p><p>（ 4 ）学会应用组件Application的用法。</p><h3 id="_6-7-课后练习题" tabindex="-1"><a class="header-anchor" href="#_6-7-课后练习题" aria-hidden="true">#</a> 6.7　课后练习题</h3><p>一、填空题</p><p>1 ．SharedPreferences采用的存储结构是 __ 的键值对方式。</p><p>2 ．Android可以直接操作的数据库名为 __ 。</p><p>3 ． __ 是Android提供的SQLite数据库管理器。</p><p>4 ．数据库记录的修改动作由 __ 命令完成。</p><p>5 ．为了确保在App运行期间只有唯一的Application实例，可以采取 __ __模式实现。</p><p>二、判断题（正确打√，错误打×）</p><p>1 ．共享参数只能保存字符串类型的数据。（　　）</p><p>2 ．SQLite可以直接读写布尔类型的数据。（　　）</p><p>3 ．从Android 7.0开始，系统默认禁止App访问公共存储空间。（　　）</p><p>4 ．App在私有空间上读写文件无须任何授权。（　　）</p><p>5 ．App终止时会调用Application的onTerminate方法。（　　）</p><p>三、选择题</p><p>1 ．（　　）不是持久化的存储方式。</p><p>A．共享参数</p><p>B．数据库</p><p>C．文件</p><p>D．全局变量</p><p>2 ．DDL语言包含哪些数据库操作（　　）。</p><p>A．创建表格</p><p>B．删除表格</p><p>C．清空表格</p><p>D．修改表结构</p><p>3 ．调用（　　）方法会返回结果集的Cursor对象。</p><p>A．update</p><p>B．insert</p><p>C．query</p><p>D．rawQuery</p><p>4 ．位图工厂BitmapFactory的（　　）方法支持获取图像数据。</p><p>A．decodeStream</p><p>B．decodeFile</p><p>C．decodeImage</p><p>D．decodeResource</p><p>5 ．已知某个图片文件的存储卡路径，可以调用（　　）方法将它显示到图像视图上。</p><p>A．setImageBitmap</p><p>B．setImageFile</p><p>C．setImageURI</p><p>D．setImageResource</p><p>四、简答题</p><p>请简要描述共享参数与数据库两种存储方式的主要区别。</p><p>五、动手练习</p><p>1 ．请上机实验完善找回密码项目的记住密码功能，分别采用以下两种存储方式：</p><p>（ 1 ）使用共享参数记住上次登录成功时输入的用户名和密码。</p><p>（ 2 ）使用SQLite数据库记住用户名对应的密码，也就是根据用户名自动填写密码。</p><p>2 ．请上机实验本章的购物车项目，要求实现下列功能：</p><p>（ 1 ）往购物车添加商品。</p><p>（ 2 ）自动计算购物车中所有商品的总金额。</p><p>（ 3 ）移除购物车里的某个商品。</p><p>（ 4 ）清空购物车。</p></div><!--[--><!--]--></div><footer class="page-meta"><div class="meta-item edit-link"><a class="external-link meta-item-label" href="https://gitee.com/xiaweifeng/vuepress-source/edit/master/docs/Android/AndroidBasic/第06章数据存储.md" rel="noopener noreferrer" target="_blank" aria-label="在Gitee上编辑此页"><!--[--><!--]--> 在Gitee上编辑此页 <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><div class="meta-item last-updated"><span class="meta-item-label">上次更新: </span><!----></div><div class="meta-item contributors"><span class="meta-item-label">贡献者: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: xiaweifeng@live.cn">夏一次</span><!----><!--]--><!--]--></span></div></footer><!----><!--[--><!--[--><div class="giscus-wrapper input-top" style="display:block;"><div style="text-align:center">Loading...</div></div><!--]--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/assets/app.3222cd28.js" defer></script>
  </body>
</html>
